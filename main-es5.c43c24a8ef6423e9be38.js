!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,c=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(s){r=!0,c=s}finally{try{i||null==a.return||a.return()}finally{if(r)throw c}}return n}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,n,i){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,n,i||e)}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=o(e);if(t){var r=o(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return c(this,n)}}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=u(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){a=!0,c=e},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw c}}}}function s(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function p(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+awi":function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n("fXoL"),r=n("ofXK");function c(e,t){if(1&e&&(i.Qb(0,"p",1),i.wc(1),i.Pb()),2&e){var n=i.Zb();i.Ab(1),i.yc(" ",n.config.name," is required\n")}}function o(e,t){if(1&e&&(i.Qb(0,"p",1),i.wc(1),i.Pb()),2&e){var n=i.Zb();i.Ab(1),i.zc(" ",n.config.name," can't be lower than ",n.config.options.min,"\n")}}function a(e,t){if(1&e&&(i.Qb(0,"p",1),i.wc(1),i.Pb()),2&e){var n=i.Zb();i.Ab(1),i.zc(" ",n.config.name," can't be higher than ",n.config.options.max,"\n")}}function s(e,t){if(1&e&&(i.Qb(0,"p",1),i.wc(1),i.Pb()),2&e){var n=i.Zb();i.Ab(1),i.zc(" ",n.config.name," cannot have less than ",n.config.options.minLength," characters\n")}}function u(e,t){if(1&e&&(i.Qb(0,"p",1),i.wc(1),i.Pb()),2&e){var n=i.Zb();i.Ab(1),i.zc(" ",n.config.name," cannot have more than ",n.config.options.maxLength," characters\n")}}var l=function(){var e=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){}},{key:"errors",get:function(){return this.control.errors}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Fb({type:e,selectors:[["dd-dynamic-validation-errors"]],inputs:{control:"control",config:"config"},decls:5,vars:5,consts:[["class","form-input-hint mb-1",4,"ngIf"],[1,"form-input-hint","mb-1"]],template:function(e,t){1&e&&(i.vc(0,c,2,1,"p",0),i.vc(1,o,2,2,"p",0),i.vc(2,a,2,2,"p",0),i.vc(3,s,2,2,"p",0),i.vc(4,u,2,2,"p",0)),2&e&&(i.ec("ngIf",t.control.invalid&&(t.control.dirty||t.control.touched)&&t.errors.required),i.Ab(1),i.ec("ngIf",t.control.invalid&&(t.control.dirty||t.control.touched)&&t.errors.min),i.Ab(1),i.ec("ngIf",t.control.invalid&&(t.control.dirty||t.control.touched)&&t.errors.max),i.Ab(1),i.ec("ngIf",t.control.invalid&&(t.control.dirty||t.control.touched)&&t.errors.minlength),i.Ab(1),i.ec("ngIf",t.control.invalid&&(t.control.dirty||t.control.touched)&&t.errors.maxlength))},directives:[r.k],styles:[""]}),e}()},"/AKn":function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i,r=n("fXoL"),c=n("ofXK"),o=((i=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||i)},i.\u0275cmp=r.Fb({type:i,selectors:[["dd-error-page"]],inputs:{header:"header",text:"text"},decls:6,vars:2,consts:[[1,"container","grid-xl"],[1,"error-container","w-100","d-flex","align-items-center","justify-content-center","flex-col"],[1,"error-code-text","mb-2"],[1,"error-subtitle-text"]],template:function(e,t){1&e&&(r.Qb(0,"div",0),r.Qb(1,"div",1),r.Qb(2,"h1",2),r.wc(3),r.Pb(),r.Qb(4,"p",3),r.wc(5),r.Pb(),r.Pb(),r.Pb()),2&e&&(r.Ab(3),r.xc(t.header),r.Ab(2),r.xc(t.text))},styles:[".error-container[_ngcontent-%COMP%]{background-image:url(https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto/v1552332874/error-background.png);background-repeat:no-repeat;background-position:50%;background-size:contain;height:50vh}.error-code-text[_ngcontent-%COMP%]{font-size:15vw;color:#181819}.error-subtitle-text[_ngcontent-%COMP%]{margin-top:1rem;font-size:3.5vw;font-weight:700;color:#181819;text-align:center}"]}),i);function a(e,t){if(1&e&&r.Mb(0,"dd-error-page",1),2&e){var n=r.Zb();r.ec("header",n.title)("text",n.text)}}var s,u=function(e){return e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.HTTP_404=1]="HTTP_404",e[e.HTTP_403=2]="HTTP_403",e}({}),l=((s=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){this.parseError(this.error)}},{key:"parseError",value:function(e){null!=e&&(e.status&&404===e.status?this.errType=u.HTTP_404:e.status&&403===e.status?this.errType=u.HTTP_403:console.log(e))}},{key:"title",get:function(){switch(this.errType){case u.HTTP_404:return"404";case u.HTTP_403:return"403";case u.UNKNOWN_ERROR:return"Oh Dear";default:return""}}},{key:"text",get:function(){switch(this.errType){case u.HTTP_404:return"The thing you are looking for appears to be missing";case u.HTTP_403:return"You're not allowed to do whatever it is you are trying to do";case u.UNKNOWN_ERROR:return"Not sure what went wrong here";default:return""}}}]),e}()).\u0275fac=function(e){return new(e||s)},s.\u0275cmp=r.Fb({type:s,selectors:[["dd-http-errors"]],inputs:{error:"error"},decls:1,vars:1,consts:[[3,"header","text",4,"ngIf"],[3,"header","text"]],template:function(e,t){1&e&&r.vc(0,a,1,2,"dd-error-page",0),2&e&&r.ec("ngIf",t.errType)},directives:[c.k,o],styles:[""]}),s)},"/fvA":function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n("AytR"),r=n("fXoL"),c=n("tk/3"),o=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},a=function(){var e=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"getConceptType",value:function(e){return this.http.get("".concat(i.a.apiURL,"/concepttypes/").concat(e)).toPromise()}},{key:"createConceptType",value:function(e){return this.http.post("".concat(i.a.apiURL,"/concepttypes"),e).toPromise()}},{key:"updateConceptType",value:function(e){return this.http.put("".concat(i.a.apiURL,"/concepttypes/").concat(e.id),e).toPromise()}},{key:"deleteConceptType",value:function(e){return this.http.delete("".concat(i.a.apiURL,"/concepttypes/").concat(e)).toPromise()}},{key:"getConcept",value:function(e){return this.http.get("".concat(i.a.apiURL,"/concepts/").concat(e)).toPromise()}},{key:"getConcepts",value:function(e,t,n,r,c,o){null==t||t<=0?t=10:t>50&&(t=50),(null==n||n<0)&&(n=0);var a="";null!=r&&r.trim().length>0&&(a="&search=".concat(encodeURIComponent(r)));var s="";o&&o.forEach(function(e){s+="&only=".concat(e)});var u="";return c&&c.forEach(function(e){u+="&except=".concat(e)}),this.http.get("".concat(i.a.apiURL,"/concepts?type=").concat(e,"&limit=").concat(t,"&offset=").concat(n).concat(a).concat(s).concat(u)).toPromise()}},{key:"getConceptHistory",value:function(e){return this.http.get("".concat(i.a.apiURL,"/concepts/").concat(e,"/history")).toPromise()}},{key:"restoreConcept",value:function(e,t){return this.http.post("".concat(i.a.apiURL,"/concepts/").concat(e,"/restore/").concat(t),null).toPromise()}},{key:"createConcept",value:function(e){return this.http.post("".concat(i.a.apiURL,"/concepts"),Object.assign(Object.assign({},e),{conceptType:void 0})).toPromise()}},{key:"updateConcept",value:function(e){return this.http.put("".concat(i.a.apiURL,"/concepts/").concat(e.id),Object.assign(Object.assign({},e),{conceptType:void 0})).toPromise()}},{key:"deleteConcept",value:function(e){return this.http.delete("".concat(i.a.apiURL,"/concepts/").concat(e)).toPromise()}},{key:"getConceptEntities",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.http.get("".concat(i.a.apiURL,"/conceptentities?entityId=").concat(e,"&conceptTypeId=").concat(t)).toPromise());case 1:case"end":return n.stop()}},n,this)}))}},{key:"updateConceptEntity",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.put("".concat(i.a.apiURL,"/conceptentities"),e).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"updateConceptEntities",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.http.put("".concat(i.a.apiURL,"/conceptentities/multi"),{conceptEntities:e,entityId:t}).toPromise());case 1:case"end":return n.stop()}},n,this)}))}},{key:"deleteConceptEntity",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.http.delete("".concat(i.a.apiURL,"/conceptentities/").concat(e,"/concept/").concat(t)).toPromise());case 1:case"end":return n.stop()}},n,this)}))}},{key:"getArticlesForConcept",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.get("".concat(i.a.apiURL,"/articleconcepts/articles/").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Ub(c.b))},e.\u0275prov=r.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},0:function(e,t,n){e.exports=n("zUnb")},"0ezk":function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n("btaL"),r=n("uCWu"),c=n("fXoL"),o=function(){var e=function(){function e(t,n){d(this,e),this.currencyService=t,this.campaignService=n,this.blankValue="nothing"}return p(e,[{key:"sortedLevels",get:function(){return this.levels?this.levels.sort(function(e,t){return t.value-e.value}):[]}},{key:"text",get:function(){return this.currency?0===(e=!0===this.trackCoins?this.currencyService.mapCoinValues(this.sortedLevels,this.currency.values):this.currencyService.mapCurrencyValues(this.sortedLevels,this.currency.value)).length?'<span class="currency-text">'.concat(this.blankValue,"</span>"):this.currencyService.getCurrencyHTMLString(e):'<span class="currency-text">'.concat(this.blankValue,"</span>");var e}},{key:"levels",get:function(){return this.campaignService.campaign.currencyMap||[{value:1,name:"gp",useInConversions:!0}]}},{key:"trackCoins",get:function(){return this.campaignService.campaign.trackCoins}}]),e}();return e.\u0275fac=function(t){return new(t||e)(c.Lb(i.a),c.Lb(r.b))},e.\u0275dir=c.Gb({type:e,selectors:[["","ddCurrency",""]],hostVars:1,hostBindings:function(e,t){2&e&&c.Tb("innerHTML",t.text,c.pc)},inputs:{currency:["ddCurrency","currency"],blankValue:"blankValue"}}),e}()},"8Qhy":function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n("PSD3"),r=n.n(i),c=n("fXoL"),o=function(){var e=function(){function e(){d(this,e)}return p(e,[{key:"canDeactivate",value:function(e,t,n,i){return c=this,a=regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve(e.canDeactivate());case 2:if(t.t0=!!t.sent,t.t0){t.next=9;break}return t.t1=!0,t.next=7,r.a.fire({title:"Are you sure?",text:"You have unsaved changes, are you sure you want to leave?",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes"});case 7:t.t2=t.sent.value,t.t0=t.t1===t.t2;case 9:return t.abrupt("return",t.t0);case 10:case"end":return t.stop()}},t)}),new((o=void 0)||(o=Promise))(function(e,t){function n(e){try{r(a.next(e))}catch(n){t(n)}}function i(e){try{r(a.throw(e))}catch(n){t(n)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o(function(e){e(r)})).then(n,i)}r((a=a.apply(c,[])).next())});var c,o,a}},{key:"handleUnload",value:function(e){return alert("test"),e.returnValue=!1,!1}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=c.Gb({type:e,hostBindings:function(e,t){1&e&&c.Xb("beforeunload",function(e){return t.handleUnload(e)},!1,c.nc)}}),e.\u0275prov=c.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},AxCL:function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return s}),n.d(t,"d",function(){return u}),n.d(t,"c",function(){return l});var i=n("AytR"),r=n("fXoL"),c=n("tk/3"),o=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},a=function(){var e=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"updateEntityPreset",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.put("".concat(i.a.apiURL,"/entitypresets/").concat(e.id),e).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"createEntityPreset",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.post("".concat(i.a.apiURL,"/entitypresets"),Object.assign(Object.assign({},e),{id:void 0})).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"getEntityPreset",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.get("".concat(i.a.apiURL,"/entitypresets/").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"deleteEntityPreset",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}))}},{key:"getEntity",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.get("".concat(i.a.apiURL,"/entities/").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"getEntities",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.http.get("".concat(i.a.apiURL,"/entities?campaignId=").concat(e,"&spawnable=").concat(t)).toPromise());case 1:case"end":return n.stop()}},n,this)}))}},{key:"createEntity",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.post("".concat(i.a.apiURL,"/entities"),Object.assign(Object.assign({},e),{id:void 0,campign:void 0,spawnedFrom:void 0,preset:void 0})).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"updateEntity",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.put("".concat(i.a.apiURL,"/entities/").concat(e.id),Object.assign(Object.assign({},e),{campign:void 0,spawnedFrom:void 0,preset:void 0})).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"deleteEntity",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.delete("".concat(i.a.apiURL,"/entities/").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"spawnSpawnable",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.http.post("".concat(i.a.apiURL,"/entities/spawn/").concat(e,"?count=").concat(t),null).toPromise());case 1:case"end":return n.stop()}},n,this)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Ub(c.b))},e.\u0275prov=r.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),s=function(e){return e[e.MAJOR=0]="MAJOR",e[e.NORMAL=1]="NORMAL",e[e.MINOR=2]="MINOR",e[e.UNIMPORTANT=3]="UNIMPORTANT",e}({}),u=function(e){return e[e.NORMAL=0]="NORMAL",e[e.TEXT_BASED=1]="TEXT_BASED",e}({}),l=function(e){return e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC",e}({})},AytR:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i={production:!0,auth0Domain:"panch-dd.auth0.com",auth0ClientId:"9vKGU44oDoiGxliIyFL7hjWQQSdmvWEz",apiURL:"https://panch-dd.herokuapp.com/api",hubURL:"https://panch-dd.herokuapp.com/hub",tileURL:"https://d2z1tfzzgmqozf.cloudfront.net/api",gitHash:"REPLACE_GIT_HASH",gitTag:"REPLACE_GIT_TAG",sentryDSN:"https://afdf2c17948049938e2f1d3151093cc1@sentry.io/1378358"}},CYb2:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return c});var i=n("fXoL"),r=function(){var e=function(){function e(){d(this,e)}return p(e,[{key:"load",value:function(){var e=localStorage.getItem("action-queue");this._queue=e?JSON.parse(e):[]}},{key:"save",value:function(){if(this._queue){var e={};this._queue=this._queue.filter(function(t){return void 0===e[t.type]&&(e[t.type]=!0,!0)}),localStorage.setItem("action-queue",JSON.stringify(this._queue))}}},{key:"queue",get:function(){return this.load(),this._queue}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),c=function(e){return e[e.ACCOUNT_SETUP=0]="ACCOUNT_SETUP",e[e.INVITE=1]="INVITE",e[e.REDIRECT=2]="REDIRECT",e}({})},DwCd:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(e){return e[e.STRING=0]="STRING",e[e.INT=1]="INT",e[e.FLOAT=2]="FLOAT",e[e.ENUM=3]="ENUM",e[e.ENUM_MULTI=4]="ENUM_MULTI",e[e.TEXT_FORMATTED=5]="TEXT_FORMATTED",e[e.CURRENCY=6]="CURRENCY",e[e.BOOLEAN=7]="BOOLEAN",e}({})},EA6F:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n("ofXK"),r=n("fXoL"),c=function(){var e=function e(){d(this,e)};return e.\u0275mod=r.Jb({type:e}),e.\u0275inj=r.Ib({factory:function(t){return new(t||e)},imports:[[i.b]]}),e}()},HRrE:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n("3Pt+"),r=n("fXoL"),c=n("ofXK"),o=["input"];function a(e,t){if(1&e){var n=r.Rb();r.Qb(0,"div",7),r.wc(1),r.Qb(2,"a",8),r.Xb("click",function(){r.oc(n);var e=t.$implicit;return r.Zb().removeTag(e)}),r.Pb(),r.Pb()}if(2&e){var i=t.$implicit;r.Ab(1),r.yc(" ",i," ")}}var s=function(){var e=function(){function e(){d(this,e),this.controlName="tags",this._currentValue="",this._previousValue=""}return p(e,[{key:"ngOnInit",value:function(){this.formGroup.contains(this.controlName)||this.formGroup.addControl(this.controlName,new i.c([]))}},{key:"removeTag",value:function(e){var t=this.formArray.value.indexOf(e);-1!==t&&(this.formArray.removeAt(t),this.formGroup.markAsDirty())}},{key:"onInputEvent",value:function(e){switch(e.key){case"Enter":this._currentValue.trim().length>0&&-1===this.formArray.value.indexOf(this._currentValue.trim())&&(this.formArray.push(new i.e(this._currentValue.trim())),this.formGroup.markAsDirty(),this.input.nativeElement.value="",this._previousValue=this._currentValue.trim(),this._currentValue="");break;case"Backspace":if(""===this._currentValue&&""===this._previousValue&&this.formArray.length>0){console.log(this._previousValue);var t=this.formArray.controls[this.formArray.controls.length-1];this.formArray.removeAt(this.formArray.length-1),this.formGroup.markAsDirty(),this.input.nativeElement.value=t.value,this._previousValue=this._currentValue.trim(),this._currentValue=t.value}else this._previousValue=""}}},{key:"onInputChanged",value:function(e){this._previousValue=this._currentValue,this._currentValue=e.target.value}},{key:"formArray",get:function(){return this.formGroup.get(this.controlName)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Fb({type:e,selectors:[["dd-tag-editor"]],viewQuery:function(e,t){var n;(1&e&&r.Ac(o,3),2&e)&&(r.lc(n=r.Yb())&&(t.input=n.first))},inputs:{formGroup:"formGroup",controlName:"controlName"},decls:8,vars:1,consts:[[1,"form-group"],[1,"form-autocomplete"],[1,"form-autocomplete-input","form-input"],["class","chip",4,"ngFor","ngForOf"],["type","text","name","tag","id","tag",1,"form-input",3,"input","keyup"],["input",""],[1,"form-input-hint","mb-0"],[1,"chip"],["aria-label","Close","role","button",1,"btn","btn-clear",3,"click"]],template:function(e,t){1&e&&(r.Qb(0,"div",0),r.Qb(1,"div",1),r.Qb(2,"div",2),r.vc(3,a,3,1,"div",3),r.Qb(4,"input",4,5),r.Xb("input",function(e){return t.onInputChanged(e)})("keyup",function(e){return t.onInputEvent(e)}),r.Pb(),r.Pb(),r.Pb(),r.Qb(6,"p",6),r.wc(7,"Type some text and hit enter to add a tag"),r.Pb(),r.Pb()),2&e&&(r.Ab(3),r.ec("ngForOf",t.formArray.value))},directives:[c.j],styles:[""]}),e}()},HboH:function(e,t,n){"use strict";n.r(t),n.d(t,"MappingModule",function(){return Be});var i,r=n("ofXK"),c=n("tyNb"),o=n("AytR"),u=n("fXoL"),l=n("tk/3"),b=((i=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"getMaps",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,r="";return i&&(r="&search=".concat(encodeURIComponent(i))),this.http.get("".concat(o.a.apiURL,"/maps?campaignId=").concat(e,"&limit=").concat(t,"&offset=").concat(n).concat(r)).toPromise()}},{key:"getMap",value:function(e){return this.http.get("".concat(o.a.apiURL,"/maps/").concat(e)).toPromise()}},{key:"deleteMap",value:function(e){return this.http.delete("".concat(o.a.apiURL,"/maps/").concat(e)).toPromise()}},{key:"updateMap",value:function(e){return this.http.put("".concat(o.a.apiURL,"/maps/").concat(e.id),e).toPromise()}}]),e}()).\u0275fac=function(e){return new(e||i)(u.Ub(l.b))},i.\u0275prov=u.Hb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),f=function(e){return e[e.POLYLINE=0]="POLYLINE",e[e.CIRCLE=1]="CIRCLE",e[e.MARKER=2]="MARKER",e[e.POLYGON=3]="POLYGON",e[e.RECTANGLE=4]="RECTANGLE",e}({}),h=n("uCWu"),v=n("PSD3"),m=n.n(v),g=n("y4Wg"),y=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function k(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",7),u.Qb(1,"button",8),u.Xb("click",function(){return u.oc(n),u.Zb().newMap()}),u.Mb(2,"i",9),u.Qb(3,"span",10),u.wc(4," New Map"),u.Pb(),u.Pb(),u.Pb()}}function w(e,t){1&e&&u.Mb(0,"div",11)}function P(e,t){1&e&&(u.Qb(0,"p",18),u.wc(1," Click the button to create one. "),u.Pb())}function I(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",19),u.Qb(1,"button",20),u.Xb("click",function(){return u.oc(n),u.Zb(2).newMap()}),u.wc(2,"New Map"),u.Pb(),u.Pb()}}function C(e,t){if(1&e&&(u.Qb(0,"div",12),u.Qb(1,"div",13),u.Mb(2,"i",14),u.Pb(),u.Qb(3,"p",15),u.wc(4,"There are no maps"),u.Pb(),u.vc(5,P,2,0,"p",16),u.vc(6,I,3,0,"div",17),u.Pb()),2&e){var n=u.Zb();u.Ab(5),u.ec("ngIf",n.editable),u.Ab(1),u.ec("ngIf",n.editable)}}function x(e,t){if(1&e&&(u.Qb(0,"div",2),u.Qb(1,"h5",28),u.wc(2),u.Pb(),u.Pb()),2&e){var n=u.Zb().$implicit;u.Ab(2),u.yc("",n.name," (Processing)")}}function Q(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",29),u.Xb("click",function(){u.oc(n);var e=u.Zb().$implicit;return u.Zb(2).selectMap(e)}),u.Qb(1,"h5"),u.wc(2),u.Pb(),u.Pb()}if(2&e){var i=u.Zb().$implicit;u.Ab(2),u.xc(i.name)}}function A(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",7),u.Qb(1,"button",30),u.Xb("click",function(){u.oc(n);var e=u.Zb().$implicit;return u.Zb(2).delete(e)}),u.Mb(2,"i",31),u.Qb(3,"span",10),u.wc(4," Delete"),u.Pb(),u.Pb(),u.Qb(5,"button",32),u.Mb(6,"i",33),u.Qb(7,"span",10),u.wc(8," Edit"),u.Pb(),u.Pb(),u.Pb()}}var T=function(e){return{hoverable:e}};function E(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",23),u.Qb(1,"div",1),u.Qb(2,"div",24),u.Xb("click",function(){u.oc(n);var e=t.$implicit;return u.Zb(2).selectMap(e)}),u.Mb(3,"img",25),u.Pb(),u.vc(4,x,3,1,"div",26),u.vc(5,Q,3,1,"div",27),u.vc(6,A,9,0,"div",3),u.Pb(),u.Pb()}if(2&e){var i=t.$implicit,r=u.Zb(2);u.ec("ngClass",u.ic(4,T,1===i.status)),u.Ab(4),u.ec("ngIf",0===i.status),u.Ab(1),u.ec("ngIf",1===i.status),u.Ab(1),u.ec("ngIf",r.editable)}}function R(e,t){if(1&e){var n=u.Rb();u.Qb(0,"dd-paginator",34),u.Xb("pageChange",function(e){return u.oc(n),u.Zb(2).page=e}),u.Pb()}if(2&e){var i=u.Zb(2);u.ec("totalItems",i.totalMaps)("autoHide",!1)("page",i.page)}}function L(e,t){if(1&e&&(u.Qb(0,"div"),u.vc(1,E,7,6,"div",21),u.vc(2,R,1,3,"dd-paginator",22),u.Pb()),2&e){var n=u.Zb();u.Ab(1),u.ec("ngForOf",n.maps),u.Ab(1),u.ec("ngIf",n.maps&&n.maps.length>0)}}var M,S=((M=function(){function e(t,n,i){d(this,e),this.mapService=t,this.campaignService=n,this.router=i,this.loading=!1,this.page=1}return p(e,[{key:"ngOnInit",value:function(){this.load()}},{key:"load",value:function(){return y(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.mapService.getMaps(this.campaignService.campaign.id,10,10*(this.page-1));case 4:t=e.sent,this.maps=t.maps,this.totalMaps=t.total,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:this.loading=!1;case 12:case"end":return e.stop()}},e,this,[[1,8]])}))}},{key:"selectMap",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",e.id])}},{key:"newMap",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps","upload"])}},{key:"delete",value:function(e){return y(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=!0,t.next=3,m.a.fire({title:"Are you sure?",showCancelButton:!0});case 3:if(t.t1=t.sent.value,t.t0!==t.t1){t.next=14;break}return t.prev=5,t.next=8,this.mapService.deleteMap(e.id);case 8:this.load(),t.next=14;break;case 11:throw t.prev=11,t.t2=t.catch(5),t.t2;case 14:case"end":return t.stop()}},t,this,[[5,11]])}))}},{key:"setPage",value:function(e){this.page=e,this.load()}},{key:"editable",get:function(){return this.campaignService.canEdit}}]),e}()).\u0275fac=function(e){return new(e||M)(u.Lb(b),u.Lb(h.b),u.Lb(c.c))},M.\u0275cmp=u.Fb({type:M,selectors:[["dd-map-manager"]],decls:9,vars:4,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],["class","column col-auto",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty",4,"ngIf"],[4,"ngIf"],[1,"column","col-auto"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"loading","loading-lg"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],["class","empty-action",4,"ngIf"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["class","card p-2 mb-2",3,"ngClass",4,"ngFor","ngForOf"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange",4,"ngIf"],[1,"card","p-2","mb-2",3,"ngClass"],[1,"column","col-auto",3,"click"],["width","32","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/map-default","alt","Map Fallback Picture",1,"s-rounded"],["class","column",4,"ngIf"],["class","column",3,"click",4,"ngIf"],[1,"text-gray"],[1,"column",3,"click"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"icon","icon-delete"],["disabled","",1,"btn","btn-sm"],[1,"icon","icon-edit"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange"]],template:function(e,t){1&e&&(u.Qb(0,"div",0),u.Qb(1,"div",1),u.Qb(2,"div",2),u.Qb(3,"h3"),u.wc(4,"Maps"),u.Pb(),u.Pb(),u.vc(5,k,5,0,"div",3),u.Pb(),u.vc(6,w,1,0,"div",4),u.vc(7,C,7,2,"div",5),u.vc(8,L,3,2,"div",6),u.Pb()),2&e&&(u.Ab(5),u.ec("ngIf",t.editable),u.Ab(1),u.ec("ngIf",t.loading),u.Ab(1),u.ec("ngIf",t.maps&&0===t.maps.length),u.Ab(1),u.ec("ngIf",t.maps))},directives:[r.k,r.j,r.i,g.a],styles:[""]}),M),O=n("edGd"),N=n("3Pt+");function _(e,t){1&e&&(u.Qb(0,"p",10),u.wc(1," A name is required "),u.Pb())}function F(e,t){if(1&e&&(u.Qb(0,"p",10),u.wc(1),u.Pb()),2&e){var n=u.Zb(2);u.Ab(1),u.yc(" ",n.fileError," ")}}var U=function(e){return{"has-error":e}};function q(e,t){if(1&e){var n=u.Rb();u.Qb(0,"form",3),u.Xb("ngSubmit",function(){return u.oc(n),u.Zb().submit()}),u.Qb(1,"div",4),u.Mb(2,"input",5),u.vc(3,_,2,0,"p",6),u.Pb(),u.Qb(4,"div",4),u.Qb(5,"label",7),u.wc(6,"Choose Image"),u.Pb(),u.Qb(7,"input",8),u.Xb("change",function(e){return u.oc(n),u.Zb().onFileChange(e)}),u.Pb(),u.vc(8,F,2,1,"p",6),u.Pb(),u.Qb(9,"button",9),u.wc(10,"Upload"),u.Pb(),u.Pb()}if(2&e){var i=u.Zb();u.ec("formGroup",i.formGroup),u.Ab(1),u.ec("ngClass",u.ic(5,U,i.name.invalid&&(i.name.touched||i.name.dirty))),u.Ab(2),u.ec("ngIf",i.name.invalid&&(i.name.touched||i.name.dirty)&&i.name.errors.required),u.Ab(1),u.ec("ngClass",u.ic(7,U,i.fileControl.invalid&&(i.fileControl.touched||i.fileControl.dirty)||null!==i.fileError)),u.Ab(4),u.ec("ngIf",null!==i.fileError)}}function G(e,t){1&e&&(u.Qb(0,"h5"),u.wc(1,"Uploading Map"),u.Pb())}function D(e,t){1&e&&(u.Qb(0,"h5"),u.wc(1,"Getting Ready"),u.Pb())}function Z(e,t){if(1&e&&u.Mb(0,"progress",13),2&e){var n=u.Zb(2);u.ec("value",n.uploadProgress)}}function X(e,t){1&e&&u.Mb(0,"progress",14)}function j(e,t){if(1&e&&(u.Qb(0,"div"),u.vc(1,G,2,0,"h5",2),u.vc(2,D,2,0,"h5",2),u.vc(3,Z,1,1,"progress",11),u.vc(4,X,1,0,"progress",12),u.Pb()),2&e){var n=u.Zb();u.Ab(1),u.ec("ngIf",n.uploadProgress<100),u.Ab(1),u.ec("ngIf",100===n.uploadProgress),u.Ab(1),u.ec("ngIf",n.uploadProgress<100),u.Ab(1),u.ec("ngIf",100===n.uploadProgress)}}function H(e,t){1&e&&(u.Qb(0,"div"),u.Qb(1,"h5"),u.wc(2,"Your map is processing!"),u.Pb(),u.Qb(3,"p"),u.wc(4," You will receive a notification when it is ready "),u.Pb(),u.Pb())}var V,$=((V=function(){function e(t,n,i){d(this,e),this.campaignService=t,this.loginService=n,this.router=i,this.fileError=null,this.isUploading=!1,this.mapId=null}return p(e,[{key:"ngOnInit",value:function(){this.formGroup=new N.h({name:new N.e(null,[N.v.required]),file:new N.e(null,[N.v.required])})}},{key:"viewMap",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",this.mapId])}},{key:"onFileChange",value:function(e){this.fileError=null;var t=e.target.files;t.length>0&&(this.file=t[0],this.file.size>5e7?this.fileError="Size cannot exceed 50mb":-1===["image/png","image/jpg","image/jpeg"].indexOf(this.file.type)&&(this.fileError="Image file must be a .png or a .jpg"))}},{key:"submit",value:function(){this.formGroup.invalid||this.handleFileUpload(this.file)}},{key:"handleFileUpload",value:function(e){var t=this;if(this.fileError=null,this.uploadProgress=null,e.type.startsWith("image/")){this.file=e;var n=new FormData;n.append("file",this.file),n.append("name",this.name.value),this.campaignService.campaign&&n.append("campaignId",this.campaignService.campaign.id);var i=new XMLHttpRequest;i.open("POST","".concat(o.a.apiURL,"/maps"),!0),i.setRequestHeader("Authorization","Bearer ".concat(this.loginService.token)),i.onload=function(e){var n=JSON.parse(i.responseText);t.mapId=n.id,t.isUploading=!1,t.file=null},i.upload.addEventListener("progress",function(e){t.uploadProgress=e.loaded/e.total*100}),this.isUploading=!0,i.send(n)}else this.fileError="Incorrect file type! Only images are accepted"}},{key:"fileControl",get:function(){return this.formGroup.get("file")}},{key:"name",get:function(){return this.formGroup.get("name")}}]),e}()).\u0275fac=function(e){return new(e||V)(u.Lb(h.b),u.Lb(O.a),u.Lb(c.c))},V.\u0275cmp=u.Fb({type:V,selectors:[["dd-map-upload"]],decls:8,vars:3,consts:[[1,"container","grid-xl"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"form-group",3,"ngClass"],["type","text","name","name","id","name","formControlName","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],["for","map-upload",1,"form-label"],["type","file","accept","image/*","name","map-upload","formControlName","file",1,"form-input",3,"change"],[1,"btn","btn-primary","mt-2"],[1,"form-input-hint"],["class","progress","max","100",3,"value",4,"ngIf"],["class","progress","max","100",4,"ngIf"],["max","100",1,"progress",3,"value"],["max","100",1,"progress"]],template:function(e,t){1&e&&(u.Qb(0,"div",0),u.Qb(1,"h3"),u.wc(2,"Create Map"),u.Pb(),u.Qb(3,"p"),u.wc(4," A map can be any .png or .jpg image. Maps can be up to 30,000px wide, and 30,000px tall. The image file can be up to 50mb. "),u.Pb(),u.vc(5,q,11,9,"form",1),u.vc(6,j,5,4,"div",2),u.vc(7,H,5,0,"div",2),u.Pb()),2&e&&(u.Ab(5),u.ec("ngIf",!t.isUploading&&!t.mapId),u.Ab(1),u.ec("ngIf",t.isUploading),u.Ab(1),u.ec("ngIf",t.mapId))},directives:[r.k,N.x,N.n,N.i,r.i,N.b,N.m,N.g],styles:[""]}),V),B=n("4R65"),z=n.n(B),Y=n("ygrl"),W=["modal"];function K(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",3),u.Xb("click",function(){return u.oc(n),u.Zb().updateEntityPosition()}),u.wc(1," Put me Here "),u.Pb()}}function J(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",3),u.Xb("click",function(){return u.oc(n),u.Zb().linkArticle()}),u.wc(1," Link Article "),u.Pb()}}var ee,te=function(e){return e[e.NONE=0]="NONE",e[e.PLACE_NOTE=1]="PLACE_NOTE",e[e.UPDATE_ENTITY_POSITION=2]="UPDATE_ENTITY_POSITION",e[e.LINK_ARTICLE=3]="LINK_ARTICLE",e[e.PLACE_SHAPELY_NOTE=4]="PLACE_SHAPELY_NOTE",e}({}),ne=((ee=function(){function e(t){d(this,e),this.campaignService=t}return p(e,[{key:"ngOnInit",value:function(){}},{key:"showMenu",value:function(){var e=this,t=new Promise(function(t,n){e._opResolver=t});return this.modal.open().then(function(){e._opResolver&&e._opResolver(null)}),t}},{key:"placeNote",value:function(){this._opResolver({type:te.PLACE_NOTE}),this.modal.close(null)}},{key:"placeShapelyNote",value:function(){this._opResolver({type:te.PLACE_SHAPELY_NOTE}),this.modal.close(null)}},{key:"updateEntityPosition",value:function(){this._opResolver({type:te.UPDATE_ENTITY_POSITION}),this.modal.close(null)}},{key:"linkArticle",value:function(){this._opResolver({type:te.LINK_ARTICLE}),this.modal.close(null)}},{key:"canUpdateEntityPosition",get:function(){return this.campaignService.editableEntities.length>0}},{key:"campaignEditable",get:function(){return this.campaignService.canEdit}}]),e}()).\u0275fac=function(e){return new(e||ee)(u.Lb(h.b))},ee.\u0275cmp=u.Fb({type:ee,selectors:[["dd-map-editor-menu"]],viewQuery:function(e,t){var n;1&e&&u.Ac(W,3),2&e&&u.lc(n=u.Yb())&&(t.modal=n.first)},decls:12,vars:2,consts:[["modal",""],["modal-header",""],["modal-body",""],[1,"card","p-2","hoverable","mb-2",3,"click"],["class","card p-2 hoverable mb-2",3,"click",4,"ngIf"]],template:function(e,t){1&e&&(u.Qb(0,"dd-modal",null,0),u.Qb(2,"div",1),u.Qb(3,"span"),u.wc(4,"Map Editor"),u.Pb(),u.Pb(),u.Qb(5,"div",2),u.Qb(6,"div",3),u.Xb("click",function(){return t.placeNote()}),u.wc(7,"Make Note"),u.Pb(),u.Qb(8,"div",3),u.Xb("click",function(){return t.placeShapelyNote()}),u.wc(9," Make Shapely Note "),u.Pb(),u.vc(10,K,2,0,"div",4),u.vc(11,J,2,0,"div",4),u.Pb(),u.Pb()),2&e&&(u.Ab(10),u.ec("ngIf",t.canUpdateEntityPosition),u.Ab(1),u.ec("ngIf",t.campaignEditable))},directives:[Y.a,r.k],styles:["[_nghost-%COMP%]{z-index:400}"]}),ee),ie=n("a8fi"),re=n("pLZG"),ce=n("AxCL"),oe=n("dtdw"),ae=(n("INa4"),n("W/nz")),se=n("qcJQ");function ue(e,t){if(1&e&&(u.Qb(0,"span"),u.wc(1),u.Pb()),2&e){var n=u.Zb();u.Ab(1),u.yc(" LV ",n.level,"")}}function le(e,t){1&e&&(u.Qb(0,"span",16),u.wc(1," \u2022 "),u.Pb())}function de(e,t){if(1&e&&(u.Qb(0,"div",17),u.Mb(1,"dd-health-display",18),u.Pb()),2&e){var n=u.Zb();u.Ab(1),u.ec("editable",!1)("health",n.entity.health)("preset",n.entity.preset.health)("mini",!0)}}var be,pe=function(e){return{loading:e}},fe=((be=function(){function e(t,n,i,r){d(this,e),this.campaignService=t,this.login=n,this.router=i,this.entityService=r,this.removing=!1}return p(e,[{key:"ngOnInit",value:function(){}},{key:"viewMore",value:function(){this.router.navigate(["campaigns",this.entity.campaignId,"entities",this.entity.id])}},{key:"removeFromMap",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.removing=!0,e.prev=1,e.next=4,this.entityService.updateEntity(Object.assign(Object.assign({},this.entity),{mapId:null,lat:null,lng:null}));case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:this.removing=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"editable",get:function(){return this.entity.userId===this.login.id||this.campaignService.canEdit}},{key:"level",get:function(){return this.entity&&this.entity.preset&&this.entity.preset.isXPEnabled?this.campaignService.calculateLevel(this.entity.xp):null}},{key:"user",get:function(){var e=this;return this.campaignService.campaign.members.find(function(t){return t.userId===e.entity.userId}).user}}]),e}()).\u0275fac=function(e){return new(e||be)(u.Lb(h.b),u.Lb(O.a),u.Lb(c.c),u.Lb(ce.b))},be.\u0275cmp=u.Fb({type:be,selectors:[["dd-entity-view-mini"]],inputs:{entity:"entity"},decls:22,vars:11,consts:[[3,"src","alt"],[1,"columns"],[1,"column"],[1,"mt-0","mb-1"],[1,"column","text-right"],[4,"ngIf"],["class","text-gray",4,"ngIf"],[1,"text-italic"],["class","mb-2",4,"ngIf"],[1,"column","col-auto","mt-auto"],[3,"ddUser"],[1,"column","col-auto","col-ml-auto"],["data-tooltip","Remove from map",1,"btn","btn-sm","btn-error","mr-1","tooltip",3,"ngClass","click"],[1,"icon","icon-cross"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-arrow-right"],[1,"text-gray"],[1,"mb-2"],[3,"editable","health","preset","mini"]],template:function(e,t){1&e&&(u.Qb(0,"div"),u.Qb(1,"div"),u.Mb(2,"img",0),u.Pb(),u.Qb(3,"div",1),u.Qb(4,"div",2),u.Qb(5,"h5",3),u.wc(6),u.Pb(),u.Pb(),u.Qb(7,"div",4),u.vc(8,ue,2,1,"span",5),u.vc(9,le,2,0,"span",6),u.Qb(10,"span",7),u.wc(11),u.Pb(),u.Pb(),u.Pb(),u.vc(12,de,2,4,"div",8),u.Qb(13,"div",1),u.Qb(14,"div",9),u.Mb(15,"div",10),u.Pb(),u.Qb(16,"div",11),u.Qb(17,"button",12),u.Xb("click",function(){return t.removeFromMap()}),u.Mb(18,"i",13),u.Pb(),u.Qb(19,"button",14),u.Xb("click",function(){return t.viewMore()}),u.wc(20,"More "),u.Mb(21,"i",15),u.Pb(),u.Pb(),u.Pb(),u.Pb()),2&e&&(u.Ab(2),u.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/bo_1px_solid_rgb:000000,c_lfill,g_faces:auto,h_20,r_0,w_250/",t.entity.imageId,"",u.qc),u.gc("alt","Picture Of ",t.entity.name,""),u.Ab(4),u.xc(t.entity.name),u.Ab(2),u.ec("ngIf",t.entity.preset.isXPEnabled),u.Ab(1),u.ec("ngIf",t.entity.preset.isXPEnabled),u.Ab(2),u.xc(t.entity.preset.name),u.Ab(1),u.ec("ngIf",t.entity.preset.isHealthEnabled),u.Ab(3),u.ec("ddUser",t.user),u.Ab(2),u.ec("ngClass",u.ic(9,pe,t.removing)))},directives:[r.k,ae.a,r.i,se.a],styles:[""]}),be),he=n("rZgH"),ve=n("MICr"),me=n("n10a"),ge=n("Pqmk"),ye=n("WNRK");function ke(e,t){if(1&e&&(u.Qb(0,"div",8),u.Qb(1,"figure",9),u.Mb(2,"img",10),u.Pb(),u.Pb()),2&e){var n=u.Zb();u.Ab(2),u.ec("src",n.user.pictureURL,u.qc)}}function we(e,t){if(1&e&&(u.Qb(0,"div",11),u.Qb(1,"span"),u.wc(2),u.Pb(),u.Pb()),2&e){var n=u.Zb();u.Ab(2),u.xc(n.user.username)}}function Pe(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",12),u.Qb(1,"a",13),u.Xb("click",function(){return u.oc(n),u.Zb().edit()}),u.wc(2,"Edit"),u.Pb(),u.Pb()}}var Ie,Ce=((Ie=function(){function e(t,n,i){d(this,e),this.campaignService=t,this.login=n,this.noteService=i}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.noteService.noteUpdate.pipe(Object(re.a)(function(t){return e.note&&t.id===e.note.id})).subscribe(function(t){e.note=t})}},{key:"edit",value:function(){this.noteService.editNote(this.note)}},{key:"user",get:function(){var e=this;if(!this.note)return null;if(this.note.user)return this.note.user;var t=this.campaignService.campaign.members.find(function(t){return t.userId===e.note.userId});return t&&t.user?t.user:void 0}},{key:"editable",get:function(){return this.note.userId===this.login.id||this.note.publicEdit}}]),e}()).\u0275fac=function(e){return new(e||Ie)(u.Lb(h.b),u.Lb(O.a),u.Lb(ie.a))},Ie.\u0275cmp=u.Fb({type:Ie,selectors:[["dd-note-view-mini"]],inputs:{note:"note"},decls:9,vars:4,consts:[["readOnly","true",3,"value"],[1,"columns"],[1,"column"],[1,"columns","col-gapless","mt-2"],["class","column col-auto pr-1 d-flex align-items-center",4,"ngIf"],["class","column d-flex align-items-center",4,"ngIf"],[1,"column","col-auto","col-ml-auto"],["class","mt-2",4,"ngIf"],[1,"column","col-auto","pr-1","d-flex","align-items-center"],[1,"avatar","avatar-xs"],["alt","User Image",3,"src"],[1,"column","d-flex","align-items-center"],[1,"mt-2"],[1,"c-hand",3,"click"]],template:function(e,t){1&e&&(u.Qb(0,"div"),u.Mb(1,"dd-quill",0),u.Qb(2,"div",1),u.Qb(3,"div",2),u.Qb(4,"div",3),u.vc(5,ke,3,1,"div",4),u.vc(6,we,3,1,"div",5),u.Pb(),u.Pb(),u.Qb(7,"div",6),u.vc(8,Pe,3,0,"div",7),u.Pb(),u.Pb(),u.Pb()),2&e&&(u.Ab(1),u.ec("value",t.note.content),u.Ab(4),u.ec("ngIf",t.user),u.Ab(1),u.ec("ngIf",t.user),u.Ab(2),u.ec("ngIf",t.editable))},directives:[ye.a,r.k],styles:[".note-display[_ngcontent-%COMP%]{white-space:pre-line}"]}),Ie),xe=n("5eHb"),Qe=n("S36L");function Ae(e,t){1&e&&u.Mb(0,"div",6)}var Te,Ee=((Te=function(){function e(t,n){d(this,e),this.location=t,this.notificationService=n}return p(e,[{key:"ngOnInit",value:function(){}},{key:"back",value:function(){this.location.back()}},{key:"suggest",value:function(){this.notificationService.suggestCurrentURL()}}]),e}()).\u0275fac=function(e){return new(e||Te)(u.Lb(r.g),u.Lb(Qe.a))},Te.\u0275cmp=u.Fb({type:Te,selectors:[["dd-map-toolbar"]],inputs:{title:"title",loading:"loading"},decls:8,vars:2,consts:[[1,"card","p-1","mt-2"],[1,"btn","btn-link","btn-sm",3,"click"],[1,"icon","icon-arrow-left"],[1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-share"],["class","loading",4,"ngIf"],[1,"loading"]],template:function(e,t){1&e&&(u.Qb(0,"div",0),u.Qb(1,"div"),u.Qb(2,"button",1),u.Xb("click",function(){return t.back()}),u.Mb(3,"i",2),u.Pb(),u.Qb(4,"button",3),u.Xb("click",function(){return t.suggest()}),u.Mb(5,"i",4),u.Pb(),u.wc(6),u.vc(7,Ae,1,0,"div",5),u.Pb(),u.Pb()),2&e&&(u.Ab(6),u.yc(" ",t.title," "),u.Ab(1),u.ec("ngIf",t.loading))},directives:[r.k],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:0;right:0;margin:0 auto;width:128px;height:64px;z-index:350}"]}),Te),Re=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},Le=["map"],Me=["editor"],Se=["entityselect"],Oe=["articleselect"];function Ne(e,t){1&e&&(u.Qb(0,"div",16),u.wc(1," Click the button below to create a new article "),u.Pb())}function _e(e,t){if(1&e&&u.Mb(0,"dd-map-toolbar",17),2&e){var n=u.Zb();u.ec("title",n.mapObj.name)("loading",n.loading)}}function Fe(e,t){1&e&&u.Mb(0,"div",18)}var Ue,qe,Ge,De,Ze=z.a.icon({iconUrl:"/assets/note-icon.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-20]}),Xe=z.a.icon({iconUrl:"/assets/note-icon-2.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-20]}),je=[{path:"",component:S},{path:"upload",component:$},{path:":m_id",component:(qe=function(){function e(t,n,i,r,c,o,a,s,u,l,b,p){var f=this;d(this,e),this.route=t,this.router=n,this.mapService=i,this.campaignService=r,this.noteService=c,this.login=o,this.entityService=a,this.componentService=s,this.updateHub=u,this.toast=l,this.articleService=b,this.iconService=p,this._entityLayerGroups={},this._entityComponents=[],this._noteComponents=[],this.loading=!1,this.loadSelectItems=function(e){return f.getArticleSelectionList(e)}}return p(e,[{key:"ngAfterViewInit",value:function(){var e=this;this._noteCreateSubscription=this.noteService.noteCreate.pipe(Object(re.a)(function(t){return t.mapId===e._map.id})).subscribe(function(t){e.addNoteToMap(t)}),this._noteDeleteSubscription=this.noteService.noteDelete.pipe(Object(re.a)(function(t){return t.mapId===e._map.id})).subscribe(function(t){for(var n=0,i=[].concat(s(e._notesLayerGroup.getLayers()),s(e._shapelyNotesLayerGroup.getLayers()));n<i.length;n++){var r=i[n];r._noteId===t.id&&function(){var t=r._noteComponent;e._noteComponents=e._noteComponents.filter(function(e){return e!==t}),t.destroy(),e._notesLayerGroup.removeLayer(r),e._shapelyNotesLayerGroup.removeLayer(r)}()}}),this._noteUpdateSubscription=this.noteService.noteUpdate.pipe(Object(re.a)(function(t){return t.mapId===e._map.id})).subscribe(function(t){void 0===[].concat(s(e._notesLayerGroup.getLayers()),s(e._shapelyNotesLayerGroup.getLayers())).find(function(e){return e._noteId===t.id})&&e.addNoteToMap(t)}),this._entityUpdateSubscription=this.updateHub.entityUpdated.subscribe(function(t){if(t.mapId===e._map.id){if(!e._entityLayerGroups[t.preset.name])return void e.addEntityToMap(t);var n=e._entityLayerGroups[t.preset.name].getLayers().find(function(e){return e._entity.id===t.id});n?(n.setLatLng([t.lat,t.lng]),n._entityComponent.instance.entity=t):e.addEntityToMap(t)}else e.removeEntityFromMap(t)}),this._articleUpdateSubscription=this.updateHub.articleUpdated.subscribe(function(t){t.mapId===e._map.id?e.addArticleToMap(t):e.removeArticleFromMap(t)}),this._articleDeleteSubscription=this.updateHub.articleDeleted.pipe(Object(re.a)(function(t){return t.mapId===e._map.id})).subscribe(function(t){e.removeArticleFromMap(t)}),this.route.paramMap.subscribe(function(t){(e._map&&e._map.id!==t.get("m_id")||!e._map)&&e.loadMap(t.get("m_id"))})}},{key:"ngOnDestroy",value:function(){var e,t=a(this._noteComponents);try{for(t.s();!(e=t.n()).done;)e.value.destroy()}catch(r){t.e(r)}finally{t.f()}var n,i=a(this._entityComponents);try{for(i.s();!(n=i.n()).done;)n.value.destroy()}catch(r){i.e(r)}finally{i.f()}this._noteCreateSubscription&&this._noteCreateSubscription.unsubscribe(),this._noteDeleteSubscription&&this._noteDeleteSubscription.unsubscribe(),this._noteUpdateSubscription&&this._noteUpdateSubscription.unsubscribe(),this._entityUpdateSubscription&&this._entityUpdateSubscription.unsubscribe(),this._articleUpdateSubscription&&this._articleUpdateSubscription.unsubscribe(),this._articleDeleteSubscription&&this._articleDeleteSubscription.unsubscribe()}},{key:"loadMap",value:function(e){return Re(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,r,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.load(e);case 3:return this.constructMap(),this.createNotesLayer(),this.createArticlesLayer(),t.next=8,this.loadNotes(e);case 8:return t.next=10,this.loadArticles();case 10:this.loading=!1,n=a(this.campaignService.campaign.entities);try{for(n.s();!(i=n.n()).done;)(r=i.value).mapId===this._map.id&&r.lat&&r.lng&&(c=this.route.snapshot.queryParamMap.get("entity"),this.addEntityToMap(r,r.id===c))}catch(o){n.e(o)}finally{n.f()}case 13:case"end":return t.stop()}},t,this)}))}},{key:"loadArticles",value:function(){return Re(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.articleService.getMapArticles(this._map.id);case 3:this._articles=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:if(this._articles){t=this.route.snapshot.queryParamMap.get("article"),n=a(this._articles);try{for(n.s();!(i=n.n()).done;)r=i.value,this.addArticleToMap(r,r.id===t)}catch(c){n.e(c)}finally{n.f()}}case 10:case"end":return e.stop()}},e,this,[[0,6]])}))}},{key:"load",value:function(e){return Re(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.mapService.getMap(e);case 3:this._map=t.sent,t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),t.t0;case 9:case"end":return t.stop()}},t,this,[[0,6]])}))}},{key:"loadNotes",value:function(e){return Re(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.noteService.getNotes(this.campaignService.campaign.id,{mapId:e});case 3:this._notes=t.sent,t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),t.t0;case 9:case"end":return t.stop()}},t,this,[[0,6]])}))}},{key:"constructMap",value:function(){var e=this;Ue=z.a.map(this.map.nativeElement,{crs:z.a.CRS.Simple,maxBounds:[[0,0],[-256,256]],zoomSnap:.5});var t=this.route.snapshot.queryParamMap,n=t.get("zoom"),i=t.get("lat"),r=t.get("lng");null==n||isNaN(n)?Ue.setZoom(1):Ue.setZoom(n),null===i||null===r||void 0===i||void 0===r||isNaN(i)||isNaN(r)?Ue.fitBounds([[-10,10],[-246,246]]):Ue.setView({lat:i,lng:r},n||this._map.maxZoom),Ue.on("contextmenu",function(t){e.editor.showMenu().then(function(n){null!=n&&e.handleEditorOperation(n,t)})}),Ue.on("zoomend",function(){e.writeMapStateToURL(Ue)}),Ue.on("moveend",function(){e.writeMapStateToURL(Ue)});var c=z.a.tileLayer("".concat(o.a.tileURL,"/maps/{id}/tile/{z}/{x}/{y}"),{maxZoom:this._map.maxZoom+2,minZoom:this._map.minZoom,minNativeZoom:1,maxNativeZoom:this._map.maxZoom,bounds:[[0,0],[-256,256]],id:this._map.id}).addTo(Ue);this._mapLayerControl=z.a.control.layers().addTo(Ue),this._mapLayerControl.addBaseLayer(c,"Base")}},{key:"writeMapStateToURL",value:function(e){this.router.navigate([],{replaceUrl:!0,queryParams:{zoom:e.getZoom(),lat:e.getCenter().lat,lng:e.getCenter().lng}})}},{key:"addArticleToMap",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._articlesLayerGroup.getLayers(),r=a(i);try{for(r.s();!(t=r.n()).done;){var c=t.value;if(c._article&&c._article.id===e.id)return c._article=e,c.setLatLng([e.lat,e.lng]),void(c._articleComponent.instance.article=e)}}catch(u){r.e(u)}finally{r.f()}if(e.lat&&e.lng){var o=z.a.marker([e.lat,e.lng]);o.setIcon(z.a.icon(null!=e.icon?{iconUrl:this.iconService.getIconSrc(e.icon),iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20]}:{iconUrl:"/assets/position-marker.png",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]})),o._article=e,this._articlesLayerGroup.addLayer(o);var s=z.a.popup({minWidth:150});s.setContent(this.createArticlePopupContent(e)),o.bindPopup(s),n&&o.openPopup()}}},{key:"createArticlePopupContent",value:function(e){var t=this,n=document.createElement("div"),i=document.createElement("h5");i.innerText=e.name,n.appendChild(i);var r=document.createElement("button");return r.classList.add("btn","btn-sm"),r.innerText="More",r.addEventListener("click",function(){t.router.navigate(["campaigns",t.campaignService.campaign.id,"articles",e.id])}),n.appendChild(r),n}},{key:"removeArticleFromMap",value:function(e){var t,n=a(this._articlesLayerGroup.getLayers());try{for(n.s();!(t=n.n()).done;){var i=t.value;i._article&&i._article.id===e.id&&this._articlesLayerGroup.removeLayer(i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"getDrawnShape",value:function(){var e=this;if(void 0!==this._drawControls)throw new Error("Cannot have multiple draw controls!");return new Promise(function(t,n){e._drawControls=new z.a.Control.Draw({position:"topleft",draw:{polygon:{allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!"}},circlemarker:!1,marker:!1},edit:!1}),Ue.addControl(e._drawControls),Ue.on("draw:created",function(n){e._drawControls&&(Ue.removeControl(e._drawControls),e._drawControls=void 0);var i=n.layer;if(i instanceof z.a.Circle)t({type:f.CIRCLE,lat:i.getLatLng().lat,lng:i.getLatLng().lng,radius:i.getRadius()});else if(i instanceof z.a.Rectangle){var r=i.getLatLngs()[0];t({type:f.RECTANGLE,points:r.map(function(e){return[e.lat,e.lng]})})}else i instanceof z.a.Polygon?t({type:f.POLYGON,points:i.getLatLngs()[0].map(function(e){return[e.lat,e.lng]})}):i instanceof z.a.Polyline&&t({type:f.POLYLINE,points:i.getLatLngs().map(function(e){return[e.lat,e.lng]})})})})}},{key:"createNotesLayer",value:function(){this._notesLayerGroup=z.a.layerGroup(),this._notesLayerGroup.addTo(Ue),this._mapLayerControl.addOverlay(this._notesLayerGroup,"Notes"),this._shapelyNotesLayerGroup=z.a.layerGroup(),this._shapelyNotesLayerGroup.addTo(Ue),this._mapLayerControl.addOverlay(this._shapelyNotesLayerGroup,"Shapely Notes")}},{key:"createArticlesLayer",value:function(){this._articlesLayerGroup=z.a.layerGroup(),this._articlesLayerGroup.addTo(Ue),this._mapLayerControl.addOverlay(this._articlesLayerGroup,"Articles")}},{key:"createEntityLayer",value:function(e){var t=z.a.layerGroup();this._entityLayerGroups[e]=t,t.addTo(Ue),this._mapLayerControl.addOverlay(t,e)}},{key:"addNoteToMap",value:function(e){if(e.mapShape){var t,n=e.mapShape;switch(n.type){case f.CIRCLE:t=z.a.circle([n.lat,n.lng],{radius:n.radius});break;case f.POLYGON:t=z.a.polygon(n.points);break;case f.POLYLINE:t=z.a.polyline(n.points);break;case f.RECTANGLE:t=z.a.rectangle(n.points)}t._noteId=e.id;var i=this.componentService.getComponent(Ce);i.instance.note=e,this._noteComponents.push(i),t._noteComponent=i;var r=z.a.popup({minWidth:150});r.setContent(this.componentService.getRootNode(i)),t.bindPopup(r),this._shapelyNotesLayerGroup.addLayer(t)}else if(e.lat&&e.lng){var c=z.a.marker([e.lat,e.lng],{icon:e.userId===this.login.id?Ze:Xe});c._noteId=e.id;var o=this.componentService.getComponent(Ce);o.instance.note=e,this._noteComponents.push(o),c._noteComponent=o;var a=z.a.popup({minWidth:150});a.setContent(this.componentService.getRootNode(o)),c.bindPopup(a),this._notesLayerGroup.addLayer(c)}}},{key:"addEntityToMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.lat&&e.lng){var n=z.a.marker([e.lat,e.lng],{icon:z.a.icon({iconUrl:"https://res.cloudinary.com/dqhk8k6iv/image/upload/bo_2px_solid_rgb:303742,c_lfill,g_faces:auto,h_40,r_20,w_40,f_png/".concat(e.imageId,".png"),iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20]})});n._entity=e;var i=this.componentService.getComponent(fe);i.instance.entity=e,this._entityComponents.push(i),n._entityComponent=i,this._entityLayerGroups[e.preset.name]||this.createEntityLayer(e.preset.name),this._entityLayerGroups[e.preset.name].addLayer(n);var r=z.a.popup({minWidth:250});r.setContent(this.componentService.getRootNode(i)),n.bindPopup(r),t&&n.openPopup()}}},{key:"removeEntityFromMap",value:function(e){if(this._entityLayerGroups[e.preset.name]){var t=this._entityLayerGroups[e.preset.name].getLayers().find(function(t){return t._entity.id===e.id});t&&(this._entityLayerGroups[e.preset.name].removeLayer(t),this._entityComponents=this._entityComponents.filter(function(e){return e!==t._entityComponent}),t._entityComponent.destroy())}}},{key:"handleEditorOperation",value:function(e,t){return Re(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,r,c,o,a,s,u,l;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e.type,n.next=n.t0===te.PLACE_NOTE?3:n.t0===te.UPDATE_ENTITY_POSITION?5:n.t0===te.LINK_ARTICLE?21:n.t0===te.PLACE_SHAPELY_NOTE?40:44;break;case 3:return this.noteService.addNote({type:ie.b.MAP,mapId:this._map.id,lat:t.latlng.lat,lng:t.latlng.lng}),n.abrupt("break",44);case 5:if(1!==(i=this.campaignService.editableEntities).length){n.next=10;break}r=i[0],n.next=15;break;case 10:return c=this.campaignService.editableEntities.slice().filter(function(e){return!1===e.spawnable}),n.next=13,this.entitySelect.openSelector(c.map(function(e){return{value:e,displayHtml:e.name}}));case 13:(o=n.sent)&&(r=o.value);case 15:if(n.t1=r,!n.t1){n.next=20;break}return n.next=19,this.entityService.updateEntity(Object.assign(Object.assign({},r),{user:void 0,preset:void 0,spawnedFrom:void 0,mapId:this._map.id,lat:t.latlng.lat,lng:t.latlng.lng}));case 19:this.toast.info("Updated ".concat(r.name,"'s position"));case 20:return n.abrupt("break",44);case 21:return n.next=23,this.articleSelect.openSelector();case 23:if("create-new-article"!==(a=n.sent).value.id){n.next=31;break}return n.next=27,this.articleService.createArticle({name:a.value.name,content:null,campaignId:this.campaignService.campaign.id,userId:"fake",published:!1,tags:["TODO"],mapId:this._map.id,lat:t.latlng.lat,lng:t.latlng.lng});case 27:s=n.sent,this.addArticleToMap(s),this.toast.info("Created and linked article ".concat(s.name)),n.next=39;break;case 31:return n.next=33,this.articleService.getArticle(a.value.id);case 33:if(u=n.sent,n.t2=null!==a,!n.t2){n.next=39;break}return n.next=38,this.articleService.updateArticle(Object.assign(Object.assign({},u),{mapId:this._map.id,lat:t.latlng.lat,lng:t.latlng.lng}));case 38:this.toast.info("Linked article ".concat(a.value.name));case 39:return n.abrupt("break",44);case 40:return n.next=42,this.getDrawnShape();case 42:null!==(l=n.sent)&&this.noteService.addNote({type:ie.b.MAP,mapId:this._map.id,lat:t.latlng.lat,lng:t.latlng.lng,mapShape:l});case 44:case"end":return n.stop()}},n,this)}))}},{key:"getArticleSelectionList",value:function(e){return Re(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.articleService.getArticles(this.campaignService.campaign.id,6,0,e);case 2:return n=t.sent.map(function(e){return{value:e,displayHtml:e.name}}),t.abrupt("return",(e&&e.trim().length>2&&n.length>0&&n.push({displayHtml:'<span><i class="icon icon-plus"></i> '.concat(e,"</span>"),value:{id:"create-new-article",name:e}}),n));case 4:case"end":return t.stop()}},t,this)}))}},{key:"createNewArticle",value:function(e){return Re(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.articleService.createArticle({name:e,content:null,campaignId:this.campaignService.campaign.id,userId:"fake",published:!1,tags:["TODO"]});case 2:n=t.sent,this.articleSelect.select({displayHtml:"",value:n});case 4:case"end":return t.stop()}},t,this)}))}},{key:"notes",get:function(){return this._notes},set:function(e){this._notes=e}},{key:"editable",get:function(){return this.campaignService.canEdit}},{key:"mapObj",get:function(){return this._map}}]),e}(),qe.\u0275fac=function(e){return new(e||qe)(u.Lb(c.a),u.Lb(c.c),u.Lb(b),u.Lb(h.b),u.Lb(ie.a),u.Lb(O.a),u.Lb(ce.b),u.Lb(me.a),u.Lb(oe.b),u.Lb(xe.b),u.Lb(he.a),u.Lb(ve.a))},qe.\u0275cmp=u.Fb({type:qe,selectors:[["dd-map"]],viewQuery:function(e,t){var n;1&e&&(u.Ac(Le,3),u.Ac(Me,3),u.Ac(Se,3),u.Ac(Oe,3)),2&e&&(u.lc(n=u.Yb())&&(t.map=n.first),u.lc(n=u.Yb())&&(t.editor=n.first),u.lc(n=u.Yb())&&(t.entitySelect=n.first),u.lc(n=u.Yb())&&(t.articleSelect=n.first))},decls:20,vars:6,consts:[[3,"searchable","loadSelectItems"],["articleselect",""],["empty",""],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["entityselect",""],[1,"map-container"],[3,"title","loading",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["editor",""],[1,"map"],["map",""],[1,"empty-subtitle"],[3,"title","loading"],[1,"loading","loading-lg"]],template:function(e,t){if(1&e){var n=u.Rb();u.Qb(0,"dd-selector-popup",0,1),u.Qb(2,"div",2),u.Qb(3,"div",3),u.Mb(4,"i",4),u.Pb(),u.Qb(5,"div",5),u.wc(6,"There's nothing here"),u.Pb(),u.vc(7,Ne,2,0,"div",6),u.Qb(8,"div",7),u.Qb(9,"button",8),u.Xb("click",function(){u.oc(n);var e=u.mc(1);return t.createNewArticle(e.search)}),u.wc(10),u.Pb(),u.Pb(),u.Pb(),u.Pb(),u.Mb(11,"dd-selector-popup",null,9),u.Qb(13,"div",10),u.vc(14,_e,1,2,"dd-map-toolbar",11),u.vc(15,Fe,1,0,"div",12),u.Mb(16,"dd-map-editor-menu",null,13),u.Mb(18,"div",14,15),u.Pb()}if(2&e){var i=u.mc(1),r=u.mc(19);u.ec("searchable",!0)("loadSelectItems",t.loadSelectItems),u.Ab(7),u.ec("ngIf",t.editable),u.Ab(3),u.yc("Create ",i.search,""),u.Ab(4),u.ec("ngIf",t.mapObj),u.Ab(1),u.ec("ngIf",!r)}},directives:[ge.a,r.k,ne,Ee],styles:[".map[_ngcontent-%COMP%]{z-index:100;height:100%}.map-container[_ngcontent-%COMP%]{top:0;left:0;position:fixed;z-index:300;background-color:#fff;height:100vh;width:100vw}"]}),qe)}],He=((Ge=function e(){d(this,e)}).\u0275mod=u.Jb({type:Ge}),Ge.\u0275inj=u.Ib({factory:function(e){return new(e||Ge)},imports:[[c.f.forChild(je)],c.f]}),Ge),Ve=n("wC5x"),$e=n("zrcO"),Be=((De=function e(){d(this,e)}).\u0275mod=u.Jb({type:De}),De.\u0275inj=u.Ib({factory:function(e){return new(e||De)},imports:[[r.b,He,Ve.a,N.s,$e.UsersModule]]}),De)},Kjs6:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n("a8fi"),r=n("uCWu"),c=n("edGd"),o=n("fXoL"),a=n("ofXK"),s=n("W/nz");function u(e,t){1&e&&(o.Qb(0,"div",9),o.Mb(1,"i",10),o.Pb())}function l(e,t){if(1&e){var n=o.Rb();o.Qb(0,"div",2),o.Xb("click",function(){o.oc(n);var e=t.$implicit;return o.Zb(2).noteSelected(e)}),o.Qb(1,"div",3),o.Qb(2,"div",4),o.wc(3),o.Pb(),o.Qb(4,"div",5),o.Mb(5,"div",6),o.Pb(),o.Qb(6,"div",7),o.Mb(7,"div",6),o.Pb(),o.vc(8,u,2,0,"div",8),o.Pb(),o.Pb()}if(2&e){var i=t.$implicit,r=o.Zb(2);o.Ab(3),o.xc(i.title),o.Ab(2),o.ec("ddUser",r.user(i.userId)),o.Ab(2),o.ec("ddUser",r.user(i.userId)),o.Ab(1),o.ec("ngIf",i.publicEdit)}}function b(e,t){if(1&e&&(o.Qb(0,"div"),o.vc(1,l,9,4,"div",1),o.Pb()),2&e){var n=o.Zb();o.Ab(1),o.ec("ngForOf",n.notes)}}var f=function(){var e=function(){function e(t,n,i){d(this,e),this.noteService=t,this.campaignService=n,this.loginService=i}return p(e,[{key:"ngOnInit",value:function(){}},{key:"noteSelected",value:function(e){this.noteService.editNote(e)}},{key:"isEditable",value:function(e){return e.userId===this.loginService.id||e.publicEdit}},{key:"user",value:function(e){return this.campaignService.getUser(e).user}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.Lb(i.a),o.Lb(r.b),o.Lb(c.a))},e.\u0275cmp=o.Fb({type:e,selectors:[["dd-note-list"]],inputs:{notes:"notes"},decls:1,vars:1,consts:[[4,"ngIf"],["class","card mb-1 p-1 hoverable",3,"click",4,"ngFor","ngForOf"],[1,"card","mb-1","p-1","hoverable",3,"click"],[1,"columns","col-gapless"],[1,"column"],[1,"column","col-auto","text-gray","text-italic","text-right","hide-sm"],[3,"ddUser"],[1,"column","text-gray","text-italic","show-sm","col-12"],["class","column col-auto d-flex align-items-center ml-1",4,"ngIf"],[1,"column","col-auto","d-flex","align-items-center","ml-1"],[1,"icon","icon-edit"]],template:function(e,t){1&e&&o.vc(0,b,2,1,"div",0),2&e&&o.ec("ngIf",t.notes)},directives:[a.k,a.j,s.a],styles:[""]}),e}()},MICr:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n("fXoL"),r=function(){var e=function(){function e(){d(this,e),this.srcPrefix="/assets/article-icons/",this.srcPostfix=".png",this.icons=["hanging-sign","mushroom-gills","pointy-sword","round-bottom-flask","shirt","virtual-marker","falling-leaf","brutal-helm","graduate-cap","uncertainty","hazard-sign","drakkar","pig","sharp-shuriken","swap-bag","radar-sweep","ship-wheel","coffee-cup","cheese-wedge","cancel","donut","grave-flowers","mustache","imperial-crown","magick-trick","barrel"]}return p(e,[{key:"getIcons",value:function(){var e=this;return this.icons.map(function(t){return{id:t,src:e.getIconSrc(t)}})}},{key:"getIconSrc",value:function(e){return"".concat(this.srcPrefix).concat(e).concat(this.srcPostfix)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},Pqmk:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i=n("3Pt+"),r=n("ygrl"),c=n("Kj3r"),o=n("fXoL"),a=n("ofXK"),s=["modal"];function u(e,t){1&e&&o.Mb(0,"i",9)}function l(e,t){if(1&e&&(o.Qb(0,"div",6),o.Mb(1,"input",7),o.vc(2,u,1,0,"i",8),o.Pb()),2&e){var n=o.Zb();o.Ab(1),o.ec("formControl",n.searchControl),o.Ab(1),o.ec("ngIf",n.loading)}}function b(e,t){if(1&e){var n=o.Rb();o.Qb(0,"div",10),o.Xb("click",function(){o.oc(n);var e=t.$implicit;return o.Zb().select(e)}),o.Pb()}2&e&&o.ec("innerHTML",t.$implicit.displayHtml,o.pc)}function f(e,t){1&e&&(o.Qb(0,"div",11),o.cc(1),o.Pb())}var h=[[["","empty",""]]],v=["[empty]"],m=function(){var e=function(){function e(){d(this,e),this.title="Pick One!",this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.searchControl=new i.e(null),this.searchControl.valueChanges.pipe(Object(c.a)(250)).subscribe(function(t){e.search=t,e.load()}),this.selectItems||this.load()}},{key:"load",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loading=!0,!this.loadSelectItems){e.next=13;break}return e.prev=1,e.next=4,this.loadSelectItems(this.search);case 4:this.selectItems=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:this.loading=!1,e.next=14;break;case 13:console.warn("No function provided to load select items");case 14:case"end":return e.stop()}},e,this,[[1,7]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"select",value:function(e){this._selectResolver?this._selectResolver(e):console.warn("Item was selected but no resolver was present");try{this.modal.close(null)}catch(t){}}},{key:"openSelector",value:function(e){var t=this;return this.selectItems=e,this.searchControl.setValue(null),this.selectItems||(this.search="",this.load()),this.modal.open().then(function(){t._selectResolver&&(t._selectResolver(null),t._selectResolver=void 0)}),new Promise(function(e){t._selectResolver=e})}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=o.Fb({type:e,selectors:[["dd-selector-popup"]],viewQuery:function(e,t){var n;(1&e&&o.Ac(s,3),2&e)&&(o.lc(n=o.Yb())&&(t.modal=n.first))},inputs:{searchable:"searchable",title:"title",loadSelectItems:"loadSelectItems"},ngContentSelectors:v,decls:8,vars:4,consts:[["modal",""],["modal-header",""],["modal-body",""],["class","has-icon-right mb-1",4,"ngIf"],["class","card p-1 hoverable mb-1",3,"innerHTML","click",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"has-icon-right","mb-1"],["type","text","placeholder","Search",1,"form-input",3,"formControl"],["class","form-icon loading",4,"ngIf"],[1,"form-icon","loading"],[1,"card","p-1","hoverable","mb-1",3,"innerHTML","click"],[1,"empty"]],template:function(e,t){1&e&&(o.dc(h),o.Qb(0,"dd-modal",null,0),o.Qb(2,"h5",1),o.wc(3),o.Pb(),o.Qb(4,"div",2),o.vc(5,l,3,2,"div",3),o.vc(6,b,1,1,"div",4),o.vc(7,f,2,0,"div",5),o.Pb(),o.Pb()),2&e&&(o.Ab(3),o.yc(" ",t.title," "),o.Ab(2),o.ec("ngIf",t.searchable),o.Ab(1),o.ec("ngForOf",t.selectItems),o.Ab(1),o.ec("ngIf",t.selectItems&&0===t.selectItems.length))},directives:[r.a,a.k,a.j,i.b,i.m,i.f],styles:[""]}),e}()},S36L:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n("uCWu"),r=n("AytR"),c=n("edGd"),o=n("dtdw"),s=n("fXoL"),u=n("tk/3"),l=n("5eHb"),b=n("tyNb"),f=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},h=function(){var e=function(){function e(t,n,i,r,o,a){var s=this;d(this,e),this.http=t,this.toast=n,this.router=o,this.campignService=a,this._loading=!1,i.loginStatus.subscribe(function(e){e===c.b.LOGGED_IN&&s.loadNotifications()}),r.notificationUpdate.subscribe(function(){s.loadNotifications()}),i.isLoggedIn&&this.loadNotifications()}return p(e,[{key:"getNewNotifications",value:function(e,t){var n=[];if(e){var i,r=a(t);try{var c=function(){var t=i.value;void 0===e.find(function(e){return e.id===t.id})&&n.push(t)};for(r.s();!(i=r.n()).done;)c()}catch(o){r.e(o)}finally{r.f()}}else n=t;return n}},{key:"makeNotificationToasts",value:function(e){var t,n=this,i=a(e);try{var r=function(){var e,i,r=t.value;r.suggestionURL?(n.campignService.campaign&&(e=n.campignService.campaign.members.find(function(e){return e.userId===r.suggestedById})),i=e&&e.user?"".concat(e.user.username," suggested something! ").concat(r.message):"A suggestion was made. ".concat(r.message),n.toast.info(i).onTap.subscribe(function(){n.router.navigateByUrl(r.suggestionURL),n.removeNotification(r)})):n.toast.info(r.message)};for(i.s();!(t=i.n()).done;)r()}catch(c){i.e(c)}finally{i.f()}}},{key:"loadNotifications",value:function(){return f(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._loading=!0,e.prev=1,e.next=4,this.getNotifications();case 4:t=e.sent,n=this.getNewNotifications(this._notifications,t),this._notifications=t,this.makeNotificationToasts(n),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),e.t0;case 12:this._loading=!1;case 13:case"end":return e.stop()}},e,this,[[1,9]])}))}},{key:"removeNotification",value:function(e){return f(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._notifications=this._notifications.filter(function(t){return e!==t}),t.prev=1,t.next=4,this.deleteNotification(e.id);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"clearAll",value:function(){return f(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._notifications=[],this.http.delete("".concat(r.a.apiURL,"/notifications/clearall")).toPromise()));case 1:case"end":return e.stop()}},e,this)}))}},{key:"getNotifications",value:function(){return this.http.get("".concat(r.a.apiURL,"/notifications")).toPromise()}},{key:"deleteNotification",value:function(e){return this.http.delete("".concat(r.a.apiURL,"/notifications/").concat(e)).toPromise()}},{key:"makeSuggestion",value:function(e){return this.http.post("".concat(r.a.apiURL,"/notifications/suggest"),e).toPromise()}},{key:"suggestCurrentURL",value:function(){if(this.campignService.campaign)return this.makeSuggestion({url:this.router.url,message:"Look!",campaignId:this.campignService.campaign.id})}},{key:"notifications",get:function(){return this._notifications}},{key:"loading",get:function(){return this._loading}}]),e}();return e.\u0275fac=function(t){return new(t||e)(s.Ub(u.b),s.Ub(l.b),s.Ub(c.a),s.Ub(o.b),s.Ub(b.c),s.Ub(i.b))},e.\u0275prov=s.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},"W/nz":function(e,t,n){"use strict";n.d(t,"a",function(){return c});var i=n("fXoL"),r=n("jhN1"),c=function(){var e=function(){function e(t){d(this,e),this.sanitize=t}return p(e,[{key:"html",get:function(){return this.user?this.sanitize.bypassSecurityTrustHtml('<div class="columns col-gapless">\n      <div class="column col-auto mr-1 d-flex align-items-center">\n        <figure class="avatar avatar-xs">\n          <img src="'.concat(this.user.pictureURL,'" alt="avatar" />\n        </figure>\n      </div>\n      <div class="column col-auto">').concat(this.user.username,"</div>\n    </div>")):""}}],[{key:"buildHTML",value:function(e){return e?'<div class="columns col-gapless">\n      <div class="column col-auto mr-1 d-flex align-items-center">\n        <figure class="avatar avatar-xs">\n          <img src="'.concat(e.pictureURL,'" alt="avatar" />\n        </figure>\n      </div>\n      <div class="column col-auto">').concat(e.username,"</div>\n    </div>"):""}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Lb(r.b))},e.\u0275dir=i.Gb({type:e,selectors:[["","ddUser",""]],hostVars:1,hostBindings:function(e,t){2&e&&i.Tb("innerHTML",t.html,i.pc)},inputs:{user:["ddUser","user"]}}),e}()},WNRK:function(e,t,n){"use strict";n.d(t,"a",function(){return S});var i,r=n("fXoL"),c=n("kzlf"),o=n.n(c),a=n("3Pt+"),s=n("PSD3"),u=n.n(s),l=n("sSWQ"),b=n("AytR"),f=n("nmfD"),h=n("uCWu"),v=n("rZgH"),m=n("edGd"),g=n("tk/3"),y=((i=function(){function e(t,n){d(this,e),this.campaignService=t,this.http=n}return p(e,[{key:"search",value:function(e){return this.http.get("".concat(b.a.apiURL,"/search?campaignId=").concat(this.campaignService.campaign.id,"&search=").concat(encodeURIComponent(e))).toPromise()}}]),e}()).\u0275fac=function(e){return new(e||i)(r.Ub(h.b),r.Ub(g.b))},i.\u0275prov=r.Hb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),k=function(e){return e[e.ENTITY=0]="ENTITY",e[e.LEGACY_SPELL=1]="LEGACY_SPELL",e[e.LEGACY_ITEM=2]="LEGACY_ITEM",e[e.ARTICLE=3]="ARTICLE",e[e.MAP=4]="MAP",e[e.QUEST=5]="QUEST",e[e.USER=6]="USER",e[e.CONCEPT=7]="CONCEPT",e}({}),w=n("n10a"),P=n("MICr"),I=n("xCX2"),C=n.n(I),x=n("BSgo"),Q=n("El1G"),A=n("X607"),T=n.n(A),E=n("tyNb"),R=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},L=["container"];o.a.register("modules/blotFormatter",C.a),o.a.register("modules/mention",x.a),o.a.register("modules/imageUploader",Q.a),o.a.register("modules/cursors",T.a);var M,S=((M=function(){function e(t,n,i,c,o,a,s,u){d(this,e),this.campaignService=t,this.articleService=n,this.login=i,this.router=c,this.http=o,this.searchService=a,this.componentService=s,this.iconService=u,this.textChange=new r.n,this.selectionChange=new r.n,this._cursorCollection={},this._writeQueue=[]}return p(e,[{key:"value",set:function(e){this.writeValue(e)}},{key:"ngOnInit",value:function(){}},{key:"ngAfterContentInit",value:function(){var e=this;if(this.readOnly)this._container.nativeElement.classList.add("ql-editor"),this._container.nativeElement.classList.add("p-0");else{for(this._quill=new o.a(this._container.nativeElement,this.getQuillSettings()),this._cursors=this._quill.getModule("cursors"),this._quill.on("text-change",function(t,n,i){if(("user"===i||"api"===i)&&e._onChange){var r=e._quill.getContents();r.ops&&r.ops.length>0&&"\n"!==r.ops[0].insert?(e._onChange(r),e.textChange.emit(t)):e._onChange(null)}}),this._quill.on("selection-change",function(t,n,i){"user"!==i&&"api"!==i||!e._onTouched||(e._onTouched(),e.selectionChange.emit(t))});this._writeQueue.length>0;)this.writeValue(this._writeQueue.pop());this.cursorUpdates&&this.cursorUpdates.subscribe(function(t){if(!e._cursorCollection[t.id]&&t.range){var n=new f.Chance(t.id);e._cursorCollection[t.id]=e._cursors.createCursor(t.id,t.displayName,n.color({format:"hex"}))}t.range?e._cursors.moveCursor(t.id,t.range):e._cursorCollection[t.id]&&e._cursors.removeCursor(t.id)}),this.deltaUpdates&&this.deltaUpdates.subscribe(function(t){e._quill&&e._quill.updateContents(t.ops,"colab")}),this._selectionUpdateInterval=setInterval(function(){e.selectionChange.emit(e._quill.getSelection())},1500)}}},{key:"writeValue",value:function(e){var t=this;if(this._quill||this.readOnly)if(this.readOnly){if(null==e)return;this.renderQuillHTML(e).then(function(e){t._container.nativeElement.innerHTML=e,setTimeout(function(){t.setupMentions(),t.setupImages()},1)})}else this._quill.setContents(null!=e?e.ops:[],"form");else this._writeQueue.push(e)}},{key:"registerOnChange",value:function(e){this._onChange=e}},{key:"registerOnTouched",value:function(e){this._onTouched=e}},{key:"setDisabledState",value:function(e){}},{key:"getEntityPreset",value:function(e){return this.campaignService.campaign.entityPresets.find(function(t){return t.id===e})}},{key:"getQuillSettings",value:function(){var e=this,t={placeholder:this.placeholder,modules:{blotFormatter:{},toolbar:[["bold","italic","underline","strike"],["blockquote","code-block","image","link"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],["clean"]],mention:{mentionDenotationChars:["@"],allowedChars:/^[A-Za-z0-9\s'_\-"]*$/,source:function(t,n,i){return R(e,void 0,void 0,regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.searchService.search(t);case 2:i=e.sent.map(function(e){switch(e.type){case k.ARTICLE:return{id:e.article.id,value:e.article.name,obj:e.article,type:e.type};case k.ENTITY:return{id:e.entity.id,value:e.entity.name,obj:e.entity,type:e.type};case k.MAP:return{id:e.map.id,value:e.map.name,obj:e.map,type:e.type};case k.QUEST:return{id:e.quest.id,value:e.quest.name,obj:e.quest,type:e.type};case k.USER:return{id:e.user.id,value:e.user.username,obj:e.user,type:e.type};case k.CONCEPT:return{id:e.concept.id,value:e.concept.name,concepttypeid:e.concept.conceptTypeId,obj:e.concept,type:e.type}}}),t.trim().length>=3&&this.campaignService.canEdit&&i.push({id:"create-empty-article",value:t,type:"create-article"}),n(i);case 4:case"end":return e.stop()}},e,this)}))},renderItem:function(t,n){var i="<div>";function r(e){return'<span class="label">'.concat(e,"</span>")}switch(t.type){case k.ARTICLE:i+='<span><i class="icon icon-bookmark"></i> '.concat(t.obj.name," ").concat(t.obj.published?"":r("Hidden"),"</span>");break;case k.ENTITY:var c=e.getEntityPreset(t.obj.entityPresetId);i+=c&&c.imageId?'<span><img width="16" src="https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/'.concat(c.imageId,'"> ').concat(t.obj.name,"</span>"):'<span><i class="icon icon-emoji"></i> '.concat(t.obj.name,"</span>");break;case k.MAP:i+='<span><i class="icon icon-location"></i> '.concat(t.obj.name," ").concat(t.obj.playerVisible?"":r("Hidden"),"</span>");break;case k.QUEST:i+='<span><i class="icon icon-flag"></i> '.concat(t.obj.name," ").concat(t.obj.visible?"":" "+r("Hidden")).concat(t.obj.visible?"":" "+r("Unavailable"),"</span>");break;case k.USER:i+='<span><i class="icon icon-people"></i> '.concat(t.obj.username,"</span>");break;case k.CONCEPT:i+=t.obj.conceptType&&t.obj.conceptType.icon?'<span><img width="16" src="'.concat(e.iconService.getIconSrc(t.obj.conceptType.icon),'"> ').concat(t.obj.name,"</span>"):"<span>".concat(t.obj.name,"</span>");break;case"create-article":i+='<span><i class="icon icon-plus"></i> '.concat(t.value,"</span>")}return i+="</div>"},onSelect:function(t,n){return R(e,void 0,void 0,regeneratorRuntime.mark(function e(){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next=e.t0===k.ARTICLE||e.t0===k.ENTITY||e.t0===k.MAP||e.t0===k.QUEST?3:e.t0===k.USER?5:e.t0===k.CONCEPT?7:"create-article"===e.t0?9:19;break;case 3:return t.value=t.value.name,e.abrupt("break",19);case 5:return t.value=t.value.username,e.abrupt("break",19);case 7:return t.value=t.value.name,t.concepttypeid=t.value.concepttypeid,e.abrupt("break",19);case 9:return e.t1=!0,e.next=12,u.a.fire({title:"Create new article?",text:"A new article with the name ".concat(t.value," will be created"),showCancelButton:!0});case 12:if(e.t2=e.sent.value,e.t1!==e.t2){e.next=18;break}return e.next=16,this.articleService.createArticle({name:t.value.trim(),published:!1,campaignId:this.campaignService.campaign.id,userId:this.login.id,tags:["ToDo"],content:{}});case 16:i=e.sent,t.id=i.id,t.type=k.ARTICLE,n(t);case 18:return e.abrupt("return");case 19:n(t);case 20:case"end":return e.stop()}},e,this)}))},showDenotationChar:!1,listItemClass:"menu-item",mentionListClass:"menu",dataAttributes:["id","value","type","concepttypeid"]}},readOnly:this.readOnly};return this.readOnly?(t.modules.toolbar=!1,t.modules.theme=void 0,t.modules.mention=!1):(t.theme="snow",t.modules.cursors=!0,this.simple?t.modules.toolbar=[["bold","italic","underline","strike",{list:"ordered"},{list:"bullet"},"blockquote"]]:t.modules.imageUploader={upload:function(t){return R(e,void 0,void 0,regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new FormData).append("file",t),n.append("campaignId",this.campaignService.campaign.id),e.next=5,this.http.post("".concat(b.a.apiURL,"/upload"),n).toPromise();case 5:return e.abrupt("return",e.sent.secure_url);case 6:case"end":return e.stop()}},e,this)}))}}),t}},{key:"renderQuillHTML",value:function(e){var t=this;return new Promise(function(n,i){var r=document.createElement("div");new o.a(r,t.getQuillSettings()).setContents(e.ops),setTimeout(function(){n(r.firstChild.innerHTML)},1)})}},{key:"setupMentions",value:function(){var e=this;this._container.nativeElement.querySelectorAll('[data-type="'.concat(k.ARTICLE,'"]')).forEach(function(t){var n=t.dataset.id;t.addEventListener("click",function(){e.router.navigate(["campaigns",e.campaignService.campaign.id,"articles",n])})}),this._container.nativeElement.querySelectorAll('[data-type="'.concat(k.ENTITY,'"]')).forEach(function(t){var n=t.dataset.id;t.addEventListener("click",function(){e.router.navigate(["campaigns",e.campaignService.campaign.id,"entities",n])})}),this._container.nativeElement.querySelectorAll('[data-type="'.concat(k.CONCEPT,'"]')).forEach(function(t){var n=t.dataset.id,i=t.dataset.concepttypeid;t.addEventListener("click",function(){e.router.navigate(["campaigns",e.campaignService.campaign.id,"concepts",i,n,"view"])})}),this._container.nativeElement.querySelectorAll('[data-type="'.concat(k.MAP,'"]')).forEach(function(t){var n=t.dataset.id;t.addEventListener("click",function(){e.router.navigate(["campaigns",e.campaignService.campaign.id,"maps",n])})}),this._container.nativeElement.querySelectorAll('[data-type="'.concat(k.QUEST,'"]')).forEach(function(t){var n=t.dataset.id;t.addEventListener("click",function(){e.router.navigate(["campaigns",e.campaignService.campaign.id,"quests",n])})}),this._container.nativeElement.querySelectorAll('[data-type="'.concat(k.USER,'"]')).forEach(function(t){var n=t.dataset.id,i=e.campaignService.campaign.members.find(function(e){return e.userId===n});i&&new l.a(t,{trigger:"click hover",html:!0,title:"Top",placement:"top-end",template:'<div class="tooltip-on-top card" role="tooltip">\n          <div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',popperOptions:{placement:"top-end",modifiers:{flip:{behavior:["bottom","top","left","right"]},preventOverflow:{boundariesElement:document.getElementById("app-content")}}}}).updateTitleContent('<div class="p-1"><h5>'.concat(i.user.username,"</h5></div>"))})}},{key:"setupImages",value:function(){this._container.nativeElement.querySelectorAll("img").forEach(function(e){e.classList.add("img-responsive")})}}]),e}()).\u0275fac=function(e){return new(e||M)(r.Lb(h.b),r.Lb(v.a),r.Lb(m.a),r.Lb(E.c),r.Lb(g.b),r.Lb(y),r.Lb(w.a),r.Lb(P.a))},M.\u0275cmp=r.Fb({type:M,selectors:[["dd-quill"]],viewQuery:function(e,t){var n;1&e&&r.Ac(L,3),2&e&&r.lc(n=r.Yb())&&(t._container=n.first)},inputs:{readOnly:"readOnly",simple:"simple",placeholder:"placeholder",value:"value",cursorUpdates:"cursorUpdates",deltaUpdates:"deltaUpdates"},outputs:{textChange:"textChange",selectionChange:"selectionChange"},features:[r.zb([{provide:a.l,useExisting:Object(r.U)(function(){return M}),multi:!0}])],decls:3,vars:0,consts:[["container",""]],template:function(e,t){1&e&&(r.Qb(0,"div"),r.Mb(1,"div",null,0),r.Pb())},styles:[""]}),M)},a8fi:function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return u});var i=n("fXoL"),r=n("AytR"),c=n("edGd"),o=n("tk/3"),s=function(){var e=function(){function e(t,n){d(this,e),this.http=t,this.login=n,this._noteUpdate=new i.n,this._noteCreate=new i.n,this._noteDelete=new i.n,this.clearNoteCache()}return p(e,[{key:"setNoteEditor",value:function(e){this._noteEditor=e}},{key:"addNote",value:function(e){this._noteEditor.addNote(e)}},{key:"editNote",value:function(e){this._noteEditor.editNote(e)}},{key:"clearNoteCache",value:function(){if(this._noteCache){var e,t=a(this._noteCache);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._noteDelete.emit(n)}}catch(i){t.e(i)}finally{t.f()}}this._noteCache=[]}},{key:"getQuestNotes",value:function(e){return this._noteCache.filter(function(t){return t.questId===e})}},{key:"getMapNotes",value:function(e){return this._noteCache.filter(function(t){return t.mapId===e})}},{key:"getArticleNotes",value:function(e){return this._noteCache.filter(function(t){return t.articleId===e})}},{key:"getNotes",value:function(e,t){var n=this,i="?campaignId=".concat(e);return t.questId&&(i+="&questId=".concat(t.questId)),t.mapId&&(i+="&mapId=".concat(t.mapId)),t.articleId&&(i+="&articleId=".concat(t.articleId)),this.http.get("".concat(r.a.apiURL,"/notes").concat(i)).toPromise().then(function(e){return n.addOrUpdateCacheNotes(e),e})}},{key:"getNote",value:function(e){var t=this;return this.http.get("".concat(r.a.apiURL,"/notes/").concat(e)).toPromise().then(function(e){return t.addOrUpdateCacheNotes([e]),e})}},{key:"createNote",value:function(e){var t=this;return this.http.post("".concat(r.a.apiURL,"/notes"),e).toPromise().then(function(e){return t.addOrUpdateCacheNotes([e]),e})}},{key:"updateNote",value:function(e){var t=this;return this.http.put("".concat(r.a.apiURL,"/notes/").concat(e.id),e).toPromise().then(function(){t.addOrUpdateCacheNotes([e])})}},{key:"deleteNote",value:function(e){var t=this;return this.http.delete("".concat(r.a.apiURL,"/notes/").concat(e)).toPromise().then(function(){t.removeNoteFromCache(e)})}},{key:"addOrUpdateCacheNotes",value:function(e){var t,n=this,i=a(e);try{var r=function(){var e=t.value,i=n._noteCache.find(function(t){return t.id===e.id});void 0!==i?e.userId!==n.login.id&&!1===e.publicView?n.removeNoteFromCache(e.id):(Object.assign(i,e),n._noteUpdate.emit(i)):(n._noteCache.push(Object.assign({},e)),n._noteCreate.emit(e))};for(i.s();!(t=i.n()).done;)r()}catch(c){i.e(c)}finally{i.f()}}},{key:"removeNoteFromCache",value:function(e){var t=this;this._noteCache=this._noteCache.filter(function(n){return n.id!==e||(t._noteDelete.emit(n),!1)})}},{key:"noteDelete",get:function(){return this._noteDelete}},{key:"noteCreate",get:function(){return this._noteCreate}},{key:"noteUpdate",get:function(){return this._noteUpdate}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Ub(o.b),i.Ub(c.a))},e.\u0275prov=i.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),u=function(e){return e[e.QUEST=0]="QUEST",e[e.MAP=1]="MAP",e[e.ARTICLE=2]="ARTICLE",e}({})},btaL:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n("fXoL"),r=function(){var e=function(){function e(){d(this,e)}return p(e,[{key:"mapCurrencyValues",value:function(e,t){null==e&&(e=[{value:1,name:"gp",useInConversions:!0}]),null==t?t=0:t*=100;var n,i=[],r=a(e.filter(function(e){return e.useInConversions}).map(function(e){return Object.assign(Object.assign({},e),{value:100*e.value})}).sort(function(e,t){return t.value-e.value}));try{for(r.s();!(n=r.n()).done;){var c=n.value,o=Math.round(t-t%c.value)/c.value;if(o>0&&i.push({name:c.name,amount:o}),(t-=o*c.value)<=0)break}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"mapCoinValues",value:function(e,t){t||(t={}),null==e&&(e=[{value:1,name:"gp",useInConversions:!0}]);var n,i=[],r=a(e.map(function(e){return Object.assign(Object.assign({},e),{value:100*e.value})}).sort(function(e,t){return t.value-e.value}));try{for(r.s();!(n=r.n()).done;){var c=n.value,o=t[c.name];o&&i.push({name:c.name,amount:o})}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"hasResources",value:function(e,t,n,i){if(null==e||null==t)return!1;if(!i)return null!=e.value&&e.value>=t.value;if(null==e.values||null==t.values)return!1;var r=this.getTotalValue(n,t,i);return this.getTotalValue(n,e,i)>=r}},{key:"getTotalValue",value:function(e,t,n){if(n){var i=0;t.values||(t.values={});var r,c=a(e);try{for(c.s();!(r=c.n()).done;){var o=r.value;t.values[o.name]&&(i+=t.values[o.name]*o.value)}}catch(s){c.e(s)}finally{c.f()}return i}return t.value}},{key:"subtract",value:function(e,t,n){if(n){e.values||(e.values={}),t.values||(t.values={});for(var i={value:null,values:{}},r=0,c=Object.keys(t);r<c.length;r++){var o=c[r];i.values[o]=e.values[o]?e.values[o]-t.values[o]:-t.values[o]}return i}return{value:e.value-t.value,values:null}}},{key:"getCurrencyString",value:function(e){return e.map(function(e){return"".concat(e.amount).concat(e.name)}).join(" ")}},{key:"getCurrencyHTMLString",value:function(e){return e.map(function(e){return"".concat(e.amount,'<span class="currency-text">').concat(e.name,"</span>")}).join(" ")}},{key:"defaultCurrencyMap",get:function(){return[{name:"gp",value:1,useInConversions:!0}]}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=i.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},dtdw:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return b});var i=n("fXoL"),r=n("Gpoy"),c=n("AytR"),o=n("edGd"),a=n("a8fi"),s=n("5eHb"),u=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},l=function(e){return e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTED=1]="CONNECTED",e[e.CLOSED=2]="CLOSED",e[e.CONNECTING=3]="CONNECTING",e[e.AUTHENTICATING=4]="AUTHENTICATING",e}({}),b=function(){var e=function(){function e(t,n,r){var c=this;d(this,e),this.login=t,this.noteService=n,this.toastr=r,this.entityUpdated=new i.n,this.entityCreated=new i.n,this.entityDeleted=new i.n,this.campaignUpdated=new i.n,this.campaignRefresh=new i.n,this.articleCreated=new i.n,this.articleUpdated=new i.n,this.articleDeleted=new i.n,this.cursorUpdate=new i.n,this.noteDeltaUpdate=new i.n,this.stateUpdate=new i.n,this.conceptEntityUpdate=new i.n,this.conceptEntityDelete=new i.n,this.conceptArticleUpdate=new i.n,this.conceptArticleDelete=new i.n,this.overviewStateUpdate=new i.n,this.notificationUpdate=new i.n,this._state=l.NOT_CONNECTED,this.stateUpdate.emit(this._state),this.login.loginStatus.subscribe(function(e){e===o.b.LOGGED_IN?c.start():e===o.b.NOT_LOGGED_IN&&c.stop()}),this.login.isLoggedIn&&this.start()}return p(e,[{key:"setup",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.connection.onclose(function(e){t._state!==l.NOT_CONNECTED&&(t._state=l.CLOSED,t.stateUpdate.emit(t._state),t.start())}),this.connection.on("AuthenticateComplete",function(){return t.authComplete()}),this.connection.on("CampaignUpdate",function(e){return t.campaignUpdated.emit(e)}),this.connection.on("Notify",function(){t.notificationUpdate.emit(!0)}),this.connection.on("EventNotify",function(e){t.toastr.info(e.message)}),this.connection.on("EntityUpdate",function(e){t.entityUpdated.emit(e)}),this.connection.on("EntityCreate",function(e){t.entityCreated.emit(e)}),this.connection.on("EntityDelete",function(e){t.entityDeleted.emit(e)}),this.connection.on("NoteCreate",function(e){t.noteService.addOrUpdateCacheNotes([e])}),this.connection.on("NoteUpdate",function(e){t.noteService.addOrUpdateCacheNotes([e])}),this.connection.on("NoteDelete",function(e){t.noteService.removeNoteFromCache(e.id)}),this.connection.on("ArticleCreate",function(e){t.articleCreated.emit(e)}),this.connection.on("ArticleUpdate",function(e){t.articleUpdated.emit(e)}),this.connection.on("ArticleDelete",function(e){t.articleDeleted.emit(e)}),this.connection.on("NoteCursorUpdate",function(e){t.cursorUpdate.emit(e)}),this.connection.on("NoteDeltaUpdate",function(e){t.noteDeltaUpdate.emit(e)}),this.connection.on("ConceptEntityUpdate",function(e){t.conceptEntityUpdate.emit(e)}),this.connection.on("ConceptEntityDelete",function(e){t.conceptEntityDelete.emit(e)}),this.connection.on("RefreshCurrentCampaign",function(){t.campaignRefresh.emit(!0)}),this.connection.on("ConceptArticleUpdate",function(e){t.conceptArticleUpdate.emit(e)}),this.connection.on("ConceptArticleDelete",function(e){t.conceptArticleDelete.emit(e)}),this.connection.on("OverviewStateUpdate",function(e){t.overviewStateUpdate.emit(e)}),e.next=24,this.authenticate();case 24:case"end":return e.stop()}},e,this)}))}},{key:"authenticate",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._state=l.AUTHENTICATING,this.stateUpdate.emit(this._state),e.prev=1,e.next=4,this.connection.invoke("Authenticate");case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:case"end":return e.stop()}},e,this,[[1,6]])}))}},{key:"start",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===[l.CLOSED,l.NOT_CONNECTED].indexOf(this.state)){e.next=16;break}return this.connection=(new r.a).withUrl("".concat(c.a.hubURL),{accessTokenFactory:function(){return t.login.token}}).configureLogging(c.a.production?r.b.Critical:r.b.Information).build(),e.prev=2,this._state=l.CONNECTING,this.stateUpdate.emit(this._state),e.next=7,this.connection.start();case 7:return this._state=l.CONNECTED,this.stateUpdate.emit(this._state),e.next=11,this.setup();case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),this._state=l.CLOSED,this.stateUpdate.emit(this._state),this._retryTimeout=window.setTimeout(function(){t.start()},5e3);case 16:case"end":return e.stop()}},e,this,[[2,13]])}))}},{key:"stop",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.connection,!e.t0){e.next=7;break}return clearTimeout(this._retryTimeout),this._state=l.NOT_CONNECTED,this.stateUpdate.emit(this._state),e.next=7,this.connection.stop();case 7:case"end":return e.stop()}},e,this)}))}},{key:"authComplete",value:function(){this._state=l.CONNECTED,this.stateUpdate.emit(this._state)}},{key:"subscribeCampaign",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=11;break}return t.prev=1,t.next=4,this.connection.invoke("SubscribeCampaign",e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:t.next=12;break;case 11:console.warn("Not in connected state");case 12:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"unsubscribeCampaign",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=11;break}return t.prev=1,t.next=4,this.connection.invoke("UnsubscribeCampaign",e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:t.next=12;break;case 11:console.warn("Not in connected state");case 12:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"subscribeEntities",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=11;break}return t.prev=1,t.next=4,this.connection.invoke("SubscribeEntities",e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:t.next=12;break;case 11:console.warn("Not in connected state");case 12:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"unsubscribeEntities",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=11;break}return t.prev=1,t.next=4,this.connection.invoke("UnsubscribeEntities",e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:t.next=12;break;case 11:console.warn("Not in connected state");case 12:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"subscribeNote",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=11;break}return t.prev=1,t.next=4,this.connection.invoke("SubscribeNote",e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:t.next=12;break;case 11:console.warn("Not in connected state");case 12:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"unsubscribeNote",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=11;break}return t.prev=1,t.next=4,this.connection.invoke("UnsubscribeNote",e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:t.next=12;break;case 11:console.warn("Not in connected state");case 12:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"sendNoteCursorUpdate",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.state!==l.CONNECTED){n.next=5;break}return n.next=3,this.connection.invoke("NoteCursorUpdate",e,{range:t});case 3:n.next=6;break;case 5:console.warn("Not in connected state");case 6:case"end":return n.stop()}},n,this)}))}},{key:"sendNoteDeltaUpdate",value:function(e,t){return u(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.state!==l.CONNECTED){n.next=5;break}return n.next=3,this.connection.invoke("NoteDeltaUpdate",e,t);case 3:n.next=6;break;case 5:console.warn("Not in connected state");case 6:case"end":return n.stop()}},n,this)}))}},{key:"subscribeArticles",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=5;break}return t.next=3,this.connection.invoke("SubscribeArticles",e);case 3:t.next=6;break;case 5:console.warn("Not in connected state");case 6:case"end":return t.stop()}},t,this)}))}},{key:"unsubscribeArticles",value:function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state!==l.CONNECTED){t.next=5;break}return t.next=3,this.connection.invoke("UnsubscribeArticles",e);case 3:t.next=6;break;case 5:console.warn("Not in connected state");case 6:case"end":return t.stop()}},t,this)}))}},{key:"state",get:function(){return this._state}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Ub(o.a),i.Ub(a.a),i.Ub(s.b))},e.\u0275prov=i.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},edGd:function(e,t,n){"use strict";n.d(t,"b",function(){return v}),n.d(t,"a",function(){return m});var i=n("fXoL"),r=n("sK8x"),c=n("AytR"),o=n("xdv0"),a=n("tk/3"),s=n("CYb2"),u=n("abTI"),l=n("PSD3"),b=n.n(l),f=n("tyNb"),h=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},v=function(e){return e[e.LOGGED_IN=0]="LOGGED_IN",e[e.LOGGING_IN=1]="LOGGING_IN",e[e.NOT_LOGGED_IN=2]="NOT_LOGGED_IN",e}({}),m=function(){var e=function(){function e(t,n,r){d(this,e),this.userService=t,this.router=n,this.actions=r,this.busy=!1,this.loginStatus=new i.n,this._loginData=this.loadLoginData(),this.isLoggedIn&&(this._loginData.expiresAt-Math.floor((new Date).getTime()/1e3)<60?(this._loginData.profile&&this.saveLastUsedLogin(this._loginData.profile),this.logout()):this.checkSession())}return p(e,[{key:"id",get:function(){return this._loginData&&this._loginData.profile?this._loginData.profile.sub:null}},{key:"userProfile",get:function(){return this._loginData&&this._loginData.profile?this._loginData.profile:null}},{key:"currentUser",get:function(){return this._loginData&&this._loginData.user?this._loginData.user:null}},{key:"token",get:function(){return this._loginData&&this._loginData.token?this._loginData.token:null}},{key:"isLoggedIn",get:function(){return!(!this._loginData||!this._loginData.user)}},{key:"getAuth",value:function(){return void 0===this._auth&&(this._auth=new r.a({domain:c.a.auth0Domain,clientID:c.a.auth0ClientId,responseType:"token",redirectUri:"".concat(location.protocol,"//").concat(location.host,"/callback"),audience:"https://dd.panchem.io",scope:"openid profile email"})),this._auth}},{key:"getUserInfo",value:function(e){var t=this.getAuth();return new Promise(function(n,i){t.client.userInfo(e,function(e,t){null!==e?i(e):n(t)})})}},{key:"checkSession",value:function(){var e=this;this.getAuth().checkSession({domain:c.a.auth0Domain,clientID:c.a.auth0ClientId,responseType:"token",redirectUri:"".concat(location.protocol,"//").concat(location.host,"/callback"),audience:"https://dd.panchem.io",scope:"openid profile email"},function(t,n){t?u.captureException(t):(e._loginData.token=n.accessToken,e._loginData.expiresAt=Math.floor((new Date).getTime()/1e3)+n.expiresIn,e.saveLoginData(e._loginData))}),setTimeout(function(){e.checkSession()},9e5)}},{key:"saveLoginData",value:function(e){this._loginData=e,localStorage.setItem("login-data",JSON.stringify(e))}},{key:"clearLoginData",value:function(){localStorage.removeItem("login-data")}},{key:"loadLoginData",value:function(){var e=localStorage.getItem("login-data");return e?JSON.parse(e):null}},{key:"saveLastUsedLogin",value:function(e){localStorage.setItem("last-used-login",JSON.stringify(e))}},{key:"loadLastUsedLogin",value:function(){return localStorage.getItem("last-used-login")?JSON.parse(localStorage.getItem("last-used-login")):null}},{key:"parseHash",value:function(e,t){var n=this.getAuth();return new Promise(function(i,r){n.parseHash({hash:e,state:t},function(e,t){e?r(e):i(t)})})}},{key:"authorize",value:function(e,t){var n=this.getAuth(),i={connection:e};t&&(i.login_hint=t),n.authorize(i)}},{key:"logout",value:function(){return h(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.clearLoginData(),u.configureScope(function(e){e.setUser(null)}),this._loginData=null,this.loginStatus.emit(v.NOT_LOGGED_IN);case 1:case"end":return e.stop()}},e,this)}))}},{key:"processLoginCallback",value:function(e){return h(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,r,c,o=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.busy=!0,this.loginStatus.emit(v.LOGGING_IN),t.prev=1,t.prev=2,t.next=5,this.parseHash(e,null);case 5:n=t.sent,i=Math.floor((new Date).getTime()/1e3)+n.expiresIn,this.saveLoginData({token:n.accessToken,expiresAt:i}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),t.t0&&"invalid_token"===t.t0.error?(this.logout(),this.router.navigate(["login"])):(console.log(t.t0),b.a.fire({title:"Oh dear.",text:"Something went wrong while logging you in, please try again."}).then(function(){o.logout(),o.router.navigate(["login"])}));case 13:return t.next=15,this.getUserInfo(this._loginData.token);case 15:return r=t.sent,this._loginData.profile=r,this.saveLoginData(this._loginData),this.saveLastUsedLogin(r),t.prev=17,t.next=20,this.userService.getUser(r.sub);case 20:c=t.sent,this._loginData.user=c,this.saveLoginData(this._loginData),this.loginStatus.emit(v.LOGGED_IN),t.next=29;break;case 24:if(t.prev=24,t.t1=t.catch(17),!(t.t1 instanceof a.d&&404===t.t1.status)){t.next=28;break}return t.abrupt("return",(this.actions.queue.push({type:s.b.ACCOUNT_SETUP,data:null}),this.actions.save(),void this.router.navigate(["register"],{replaceUrl:!0})));case 28:throw console.log(t.t1),t.t1;case 29:t.next=40;break;case 31:if(t.prev=31,t.t2=t.catch(1),!t.t2||"invalid_token"!==t.t2.error){t.next=39;break}return t.next=36,this.logout();case 36:this.router.navigate(["login"]),t.next=40;break;case 39:console.log("ERR",t.t2),b.a.fire({title:"Whoops",text:"Something went wrong while logging you in, please try again."}).then(function(){o.router.navigate(["login"])});case 40:setTimeout(function(){o.checkSession()},9e5),this.router.navigate(["home"],{replaceUrl:!0}),this.busy=!1;case 41:case"end":return t.stop()}},t,this,[[1,31],[2,10],[17,24]])}))}},{key:"setUser",value:function(e){if(!this._loginData)throw new Error("Cannot set user when login data missing");this._loginData.user=e,this.saveLoginData(this._loginData)}},{key:"lastUsedLogin",get:function(){return this.loadLastUsedLogin()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Ub(o.a),i.Ub(f.c),i.Ub(s.a))},e.\u0275prov=i.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},hEiF:function(e,t,n){"use strict";n.d(t,"a",function(){return T});var i=n("fXoL"),r=n("ofXK"),c=n("3Pt+"),o=n("WNRK"),a=n("/uUt");function s(e,t){if(1&e&&(i.Qb(0,"div",2),i.Mb(1,"input",3),i.Qb(2,"div",4),i.wc(3),i.Pb(),i.Pb()),2&e){var n=i.Zb();i.Ab(1),i.ec("formControl",n.formControl)("placeholder",n.singleInputName),i.Ab(2),i.xc(n.singleInputName)}}function u(e,t){if(1&e&&(i.Qb(0,"div",9),i.Qb(1,"div",2),i.Mb(2,"input",10),i.Qb(3,"div",4),i.wc(4),i.Pb(),i.Pb(),i.Pb()),2&e){var n=t.$implicit,r=t.index,c=i.Zb(2);i.Ab(2),i.ec("formControl",n)("placeholder",c.levels[r].name),i.Ab(2),i.xc(c.levels[r].name)}}function l(e,t){if(1&e){var n=i.Rb();i.Qb(0,"div",5),i.vc(1,u,5,3,"div",6),i.Qb(2,"div",7),i.Qb(3,"button",8),i.Xb("click",function(){return i.oc(n),i.Zb().reset()}),i.wc(4,"Clear Coin Values"),i.Pb(),i.Pb(),i.Pb()}if(2&e){var r=i.Zb();i.Ab(1),i.ec("ngForOf",r.controls)("ngForTrackBy",r.trackLevel)}}var b,f=((b=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.config.trackCoins?(this.formArray=this.createFormArray(this.config.levels),this.formArray.valueChanges.pipe(Object(a.a)(function(e,t){return null==e?e===t:!e.some(function(e,n){return t[n]!==e})})).subscribe(function(t){e._onChange&&e._onChange({values:e.convertCurrencyArrayToObject(t,e.config.levels),value:0})})):(this.formControl=new c.e(null),this.formControl.valueChanges.pipe(Object(a.a)()).subscribe(function(t){e._onChange&&e._onChange({values:{},value:t})}))}},{key:"createFormArray",value:function(e){return new c.c(e.map(function(){return new c.e(null)}))}},{key:"convertCurrencyArrayToObject",value:function(e,t){var n={};return e.forEach(function(e,i){var r=t[i];r&&r.name&&(n[r.name]=e)}),n}},{key:"mapCurrencyValuesToConfig",value:function(e,t){return null==e&&(e={}),t.map(function(t){return e[t.name]||0})}},{key:"reset",value:function(){this._onChange&&this._onChange(null),this.config.trackCoins?this.formArray.patchValue(this.controls.map(function(){return null}),{emitEvent:!1}):this.formControl.patchValue(null,{emitEvent:!1})}},{key:"writeValue",value:function(e){null!=e&&(this.config.trackCoins?this.formArray.setValue(this.mapCurrencyValuesToConfig(e.values,this.config.levels)):(this.formControl.setValue(e.value),this.formControl.markAsPristine()))}},{key:"registerOnChange",value:function(e){this._onChange=e}},{key:"registerOnTouched",value:function(e){this._onTouched=e}},{key:"setDisabledState",value:function(e){this.formArray&&(e?this.formArray.disable():this.formArray.enable()),this.formControl&&(e?this.formControl.disable():this.formControl.enable())}},{key:"trackLevel",value:function(e){return e}},{key:"levels",get:function(){return(this.config.levels||[{name:"gp",value:1,useInConversions:!0}]).sort(function(e,t){return t.value-e.value})}},{key:"controls",get:function(){if(this.formArray)return this.formArray.controls}},{key:"singleInputName",get:function(){var e=this.levels.find(function(e){return 1===e.value});return e?e.name:"gp"}}]),e}()).\u0275fac=function(e){return new(e||b)},b.\u0275cmp=i.Fb({type:b,selectors:[["dd-currency-input"]],inputs:{config:"config"},features:[i.zb([{provide:c.l,useExisting:Object(i.U)(function(){return b}),multi:!0}])],decls:3,vars:2,consts:[["class","input-group",4,"ngIf"],["class","columns col-gapless",4,"ngIf"],[1,"input-group"],["type","text",1,"form-input",3,"formControl","placeholder"],[1,"input-group-addon"],[1,"columns","col-gapless"],["class","col-3 col-sm-12 p-1",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-auto"],[1,"btn","btn-link","mt-1",3,"click"],[1,"col-3","col-sm-12","p-1"],["type","number",1,"form-input",3,"formControl","placeholder"]],template:function(e,t){1&e&&(i.Qb(0,"div"),i.vc(1,s,4,3,"div",0),i.vc(2,l,5,2,"div",1),i.Pb()),2&e&&(i.Ab(1),i.ec("ngIf",t.formControl),i.Ab(1),i.ec("ngIf",t.formArray))},directives:[r.k,c.b,c.m,c.f,r.j,c.q],styles:[""]}),b);function h(e,t){if(1&e&&i.Mb(0,"input",10),2&e){var n=i.Zb();i.ec("placeholder",n.config.name)("formControl",n.control)}}function v(e,t){if(1&e&&i.Mb(0,"input",11),2&e){var n=i.Zb();i.ec("placeholder",n.config.name)("formControl",n.control)}}function m(e,t){if(1&e&&i.Mb(0,"input",12),2&e){var n=i.Zb();i.ec("placeholder",n.config.name)("formControl",n.control)("step",n.config.options.step||.01)}}function g(e,t){if(1&e&&(i.Qb(0,"option",15),i.wc(1),i.Pb()),2&e){var n=t.$implicit;i.ec("value",n),i.Ab(1),i.xc(n)}}function y(e,t){if(1&e&&(i.Qb(0,"select",13),i.vc(1,g,2,2,"option",14),i.Pb()),2&e){var n=i.Zb();i.ec("formControl",n.control),i.Ab(1),i.ec("ngForOf",n.config.options.choices)}}function k(e,t){if(1&e&&(i.Qb(0,"option",15),i.wc(1),i.Pb()),2&e){var n=t.$implicit;i.ec("value",n),i.Ab(1),i.xc(n)}}function w(e,t){if(1&e&&(i.Qb(0,"select",16),i.vc(1,k,2,2,"option",14),i.Pb()),2&e){var n=i.Zb();i.ec("formControl",n.control),i.Ab(1),i.ec("ngForOf",n.config.options.choices)}}function P(e,t){if(1&e&&i.Mb(0,"dd-quill",17),2&e){var n=i.Zb();i.ec("placeholder",n.config.name)("formControl",n.control)}}function I(e,t){if(1&e&&i.Mb(0,"dd-currency-input",18),2&e){var n=i.Zb();i.ec("config",n.config.options)("formControl",n.control)}}function C(e,t){if(1&e&&(i.Qb(0,"div",19),i.Qb(1,"label",20),i.Mb(2,"input",21),i.Mb(3,"i",22),i.wc(4),i.Pb(),i.Pb()),2&e){var n=i.Zb();i.Ab(2),i.ec("formControl",n.control),i.Ab(2),i.yc(" ",n.config.name," ")}}function x(e,t){if(1&e&&(i.Qb(0,"figure",23),i.Mb(1,"img",24),i.Pb()),2&e){var n=i.Zb();i.Ab(1),i.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.config.imageId,"",i.qc)}}var Q,A=function(e){return{"has-icon-left":e}},T=((Q=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Q)},Q.\u0275cmp=i.Fb({type:Q,selectors:[["dd-dynamic-input"]],inputs:{control:"control",config:"config"},decls:10,vars:13,consts:[[3,"ngClass","ngSwitch"],["type","text","name","attr","class","form-input",3,"placeholder","formControl",4,"ngSwitchCase"],["type","number","name","attr","class","form-input",3,"placeholder","formControl",4,"ngSwitchCase"],["type","number","name","attr","class","form-input",3,"placeholder","formControl","step",4,"ngSwitchCase"],["class","form-select","name","attr",3,"formControl",4,"ngSwitchCase"],["class","form-select","name","attr","multiple","true",3,"formControl",4,"ngSwitchCase"],["simple","true",3,"placeholder","formControl",4,"ngSwitchCase"],[3,"config","formControl",4,"ngSwitchCase"],["class","form-group",4,"ngSwitchCase"],["class","form-icon avatar",4,"ngIf"],["type","text","name","attr",1,"form-input",3,"placeholder","formControl"],["type","number","name","attr",1,"form-input",3,"placeholder","formControl"],["type","number","name","attr",1,"form-input",3,"placeholder","formControl","step"],["name","attr",1,"form-select",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["name","attr","multiple","true",1,"form-select",3,"formControl"],["simple","true",3,"placeholder","formControl"],[3,"config","formControl"],[1,"form-group"],[1,"form-checkbox"],["type","checkbox",3,"formControl"],[1,"form-icon"],[1,"form-icon","avatar"],[3,"src"]],template:function(e,t){1&e&&(i.Qb(0,"div",0),i.vc(1,h,1,2,"input",1),i.vc(2,v,1,2,"input",2),i.vc(3,m,1,3,"input",3),i.vc(4,y,2,2,"select",4),i.vc(5,w,2,2,"select",5),i.vc(6,P,1,2,"dd-quill",6),i.vc(7,I,1,2,"dd-currency-input",7),i.vc(8,C,5,2,"div",8),i.vc(9,x,2,1,"figure",9),i.Pb()),2&e&&(i.ec("ngClass",i.ic(11,A,t.config.imageId))("ngSwitch",t.config.type),i.Ab(1),i.ec("ngSwitchCase",0),i.Ab(1),i.ec("ngSwitchCase",1),i.Ab(1),i.ec("ngSwitchCase",2),i.Ab(1),i.ec("ngSwitchCase",3),i.Ab(1),i.ec("ngSwitchCase",4),i.Ab(1),i.ec("ngSwitchCase",5),i.Ab(1),i.ec("ngSwitchCase",6),i.Ab(1),i.ec("ngSwitchCase",7),i.Ab(1),i.ec("ngIf",t.config.imageId))},directives:[r.i,r.l,r.m,r.k,c.b,c.m,c.f,c.q,c.t,r.j,c.p,c.w,c.u,o.a,f,c.a],styles:[""]}),Q)},kNgC:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n("fXoL"),r=n("3Pt+"),c=n("MICr"),o=n("ygrl"),a=n("ofXK"),s=["modal"];function u(e,t){if(1&e){var n=i.Rb();i.Qb(0,"div",9),i.Xb("click",function(){i.oc(n);var e=t.$implicit;return i.Zb().selectIcon(e)}),i.Mb(1,"img",10),i.Pb()}if(2&e){var r=t.$implicit;i.Ab(1),i.ec("src",r.src,i.qc)}}function l(e,t){if(1&e&&i.Mb(0,"img",10),2&e){var n=i.Zb();i.ec("src",n.selectedIconSrc,i.qc)}}var b=function(e){return{disabled:e}},f=function(){var e=function(){function e(t){d(this,e),this.iconService=t,this.selected=new i.n,this.isDisabled=!1}return p(e,[{key:"ngOnInit",value:function(){}},{key:"writeValue",value:function(e){this._icon=e}},{key:"registerOnChange",value:function(e){this._onChange=e}},{key:"registerOnTouched",value:function(e){this._onTouched=e}},{key:"setDisabledState",value:function(e){this.isDisabled=e}},{key:"trackIcon",value:function(e,t){return t.id}},{key:"openPicker",value:function(){this._onTouched&&this._onTouched(),this._modal.open()}},{key:"selectIcon",value:function(e){this.selected.emit(e),this._onChange&&this._onChange(e.id),this._icon=e.id;try{this._modal.close(null)}catch(t){}}},{key:"clear",value:function(){this.selected.emit(null),this._icon=null,this._onChange&&this._onChange(null);try{this._modal.close(null)}catch(e){}}},{key:"icons",get:function(){return this.iconService.getIcons()}},{key:"selectedIconSrc",get:function(){return this._icon?this.iconService.getIconSrc(this._icon):null}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Lb(c.a))},e.\u0275cmp=i.Fb({type:e,selectors:[["dd-icon-picker"]],viewQuery:function(e,t){var n;(1&e&&i.Ac(s,3),2&e)&&(i.lc(n=i.Yb())&&(t._modal=n.first))},outputs:{selected:"selected"},features:[i.zb([{provide:r.l,useExisting:Object(i.U)(function(){return e}),multi:!0}])],decls:10,vars:6,consts:[["size","small"],["modal",""],["modal-header",""],[1,"fake-link",3,"click"],["modal-body",""],[1,"columns"],["class","column col-3 hoverable text-center",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"picker-box",3,"ngClass","click"],[3,"src",4,"ngIf"],[1,"column","col-3","hoverable","text-center",3,"click"],[3,"src"]],template:function(e,t){1&e&&(i.Qb(0,"dd-modal",0,1),i.Qb(2,"div",2),i.Qb(3,"span",3),i.Xb("click",function(){return t.clear()}),i.wc(4,"Clear Icon"),i.Pb(),i.Pb(),i.Qb(5,"div",4),i.Qb(6,"div",5),i.vc(7,u,2,1,"div",6),i.Pb(),i.Pb(),i.Pb(),i.Qb(8,"div",7),i.Xb("click",function(){return t.openPicker()}),i.vc(9,l,1,1,"img",8),i.Pb()),2&e&&(i.Ab(7),i.ec("ngForOf",t.icons)("ngForTrackBy",t.trackIcon),i.Ab(1),i.ec("ngClass",i.ic(4,b,t.isDisabled)),i.Ab(1),i.ec("ngIf",t.selectedIconSrc))},directives:[o.a,a.j,a.i,a.k],styles:[".picker-box[_ngcontent-%COMP%]{width:50px;height:50px;padding:5px;border:.05rem solid #dadee4;border-radius:.1rem;cursor:pointer}.picker-box.disabled[_ngcontent-%COMP%]{background-color:#f7f7f9}"]}),e}()},"lD+H":function(e,i,c){"use strict";c.d(i,"a",function(){return g});var a=c("nXDu"),s=c("fXoL"),u=c("ofXK"),l=c("hEiF"),b=c("+awi");function f(e,t){1&e&&(s.Qb(0,"span",7),s.wc(1,"*"),s.Pb())}function h(e,t){if(1&e&&(s.Qb(0,"label",5),s.wc(1),s.vc(2,f,2,0,"span",6),s.Pb()),2&e){var n=s.Zb();s.Ab(1),s.yc("",n.fieldConfig.name," "),s.Ab(1),s.ec("ngIf",n.options.required)}}function v(e,t){if(1&e&&(s.Qb(0,"p",8),s.wc(1),s.Pb()),2&e){var n=s.Zb();s.Ab(1),s.yc(" ",n.fieldConfig.description," ")}}var m=function(e,t){return{"has-error":e,"has-success":t}},g=function(){var e=function(e){n(c,e);var i=r(c);function c(){return d(this,c),i.call(this)}return p(c,[{key:"ngOnInit",value:function(){t(o(c.prototype),"ngOnInit",this).call(this)}}]),c}(a.a);return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=s.Fb({type:e,selectors:[["dd-dynamic-field"]],inputs:{showLabel:"showLabel"},features:[s.xb],decls:5,vars:10,consts:[[1,"form-group",3,"ngClass"],["class","form-label",4,"ngIf"],[3,"control","config"],["class","form-input-hint mb-0",4,"ngIf"],[3,"config","control"],[1,"form-label"],["class","text-primary text-large text-bold",4,"ngIf"],[1,"text-primary","text-large","text-bold"],[1,"form-input-hint","mb-0"]],template:function(e,t){1&e&&(s.Qb(0,"div",0),s.vc(1,h,3,2,"label",1),s.Mb(2,"dd-dynamic-input",2),s.vc(3,v,2,1,"p",3),s.Mb(4,"dd-dynamic-validation-errors",4),s.Pb()),2&e&&(s.ec("ngClass",s.jc(7,m,t.control.invalid&&(t.control.dirty||t.control.touched),t.control.valid&&(t.control.dirty||t.control.touched))),s.Ab(1),s.ec("ngIf",t.showLabel),s.Ab(1),s.ec("control",t.control)("config",t.fieldConfig),s.Ab(1),s.ec("ngIf",t.fieldConfig.description),s.Ab(1),s.ec("config",t.fieldConfig)("control",t.control))},directives:[u.i,u.k,l.a,b.a],styles:[""]}),e}()},n10a:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n("fXoL"),r=function(){var e=function(){function e(t,n,i){d(this,e),this.resolver=t,this.injector=n,this.appRef=i}return p(e,[{key:"getComponent",value:function(e){var t=this.resolver.resolveComponentFactory(e).create(this.injector);return this.appRef.attachView(t.hostView),t}},{key:"getRootNode",value:function(e){return e.hostView.rootNodes[0]}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Ub(i.j),i.Ub(i.s),i.Ub(i.g))},e.\u0275prov=i.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},nXDu:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i,r=n("3Pt+"),c=function(e){return e[e.STRING=0]="STRING",e[e.NUMBER=1]="NUMBER",e[e.ENUM=2]="ENUM",e[e.BIG_TEXT=3]="BIG_TEXT",e[e.SELECT_MULTI=4]="SELECT_MULTI",e}({}),o=n("DwCd"),a=n("fXoL"),s=((i=function(){function e(){d(this,e)}return p(e,[{key:"attribute",get:function(){return this._attribute},set:function(e){null!=e&&(this._attribute=e,this._fieldConfigCache=void 0,this.control.setValidators(this.getValidators(this.fieldConfig)))}},{key:"config",get:function(){return this._config},set:function(e){null!=e&&(this._config=e,this._fieldConfigCache=void 0,this.control&&this.control.setValidators(this.getValidators(this.fieldConfig)))}},{key:"ngOnInit",value:function(){this.control.setValidators(this.getValidators(this.fieldConfig))}},{key:"getValidators",value:function(e){var t=[],n=e.options||this.getDefaultSettings();if(e.type===o.a.STRING){var i=n;null!=i.minLength&&t.push(r.v.minLength(i.minLength)),i.maxLength&&null!=i.maxLength&&t.push(r.v.maxLength(i.maxLength)),i.pattern&&t.push(r.v.pattern(i.pattern))}else if(e.type===o.a.INT||e.type===o.a.FLOAT){var c=n;null!=c.min&&t.push(r.v.min(c.min)),null!=c.max&&t.push(r.v.max(c.max))}return n.required&&t.push(r.v.required),t}},{key:"mapAttributeTypeToFieldConfigType",value:function(e){switch(e){case c.BIG_TEXT:return o.a.TEXT_FORMATTED;case c.ENUM:return o.a.ENUM;case c.NUMBER:return o.a.INT;case c.SELECT_MULTI:return o.a.ENUM_MULTI;case c.STRING:return o.a.STRING}}},{key:"mapAttributeOptionsToFieldConfigOptions",value:function(e){var t=this.getDefaultSettings(),n=this.mapAttributeTypeToFieldConfigType(e.type);if(n===o.a.STRING){var i=t;i.minLength=e.min,i.maxLength=e.max}else if(n===o.a.INT||n===o.a.FLOAT){var r=t;r.step=.01,r.max=e.max,r.min=e.min}else n!==o.a.ENUM&&n!==o.a.ENUM_MULTI||(t.choices=e.options);return t.required=e.required,t}},{key:"getDefaultSettings",value:function(){return{}}},{key:"errors",get:function(){return this.control.errors}},{key:"fieldConfig",get:function(){return this.config||this._fieldConfigCache||!this.attribute||(this._fieldConfigCache={name:this.attribute.name,description:this.attribute.description,imageId:this.attribute.imageId,defaultValue:this.attribute.defaultValue,type:this.mapAttributeTypeToFieldConfigType(this.attribute.type),options:this.mapAttributeOptionsToFieldConfigOptions(this.attribute)}),this.config?this.config:this._fieldConfigCache}},{key:"options",get:function(){return this.fieldConfig.options||{}}}]),e}()).\u0275fac=function(e){return new(e||i)},i.\u0275cmp=a.Fb({type:i,selectors:[["dd-field-base"]],inputs:{control:"control",attribute:"attribute",config:"config"},decls:1,vars:0,template:function(e,t){1&e&&a.wc(0,"NO UI!")},encapsulation:2}),i)},nzV2:function(e,t,n){"use strict";n.d(t,"a",function(){return R});var i=n("a8fi"),r=n("uCWu"),c=n("edGd"),o=n("pLZG"),a=n("PSD3"),s=n.n(a),u=(n("ygrl"),n("rpEA"),n("fXoL")),l=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},b=["modal"],f=["noteform"];function h(e,t){1&e&&(u.Qb(0,"div",8),u.Mb(1,"div",9),u.Pb())}function v(e,t){1&e&&u.Mb(0,"i",10)}function m(e,t){1&e&&u.Mb(0,"i",11)}function g(e,t){if(1&e&&(u.Qb(0,"div",4),u.vc(1,h,2,0,"div",5),u.vc(2,v,1,0,"i",6),u.vc(3,m,1,0,"i",7),u.Pb()),2&e){var n=u.Zb();u.Ab(1),u.ec("ngIf",n.loading),u.Ab(1),u.ec("ngIf",!n.loading&&!n.unsaved),u.Ab(1),u.ec("ngIf",!n.loading&&n.unsaved)}}function y(e,t){if(1&e){var n=u.Rb();u.Qb(0,"dd-note-form",14,15),u.Xb("noteChange",function(e){return u.oc(n),u.Zb(2).onNoteChange(e)}),u.Pb()}if(2&e){var i=u.Zb(2);u.ec("note",i.note)("editable",i.editable)("advancedEditable",i.advancedEditable)}}function k(e,t){if(1&e&&(u.Qb(0,"div",12),u.vc(1,y,2,3,"dd-note-form",13),u.Pb()),2&e){var n=u.Zb();u.Ab(1),u.ec("ngIf",n.note)}}function w(e,t){if(1&e&&(u.Qb(0,"div",24),u.Mb(1,"div",25),u.Pb()),2&e){var n=u.Zb(2);u.Ab(1),u.ec("ddUser",n.user)}}var P=function(e,t){return["/campaigns",e,"articles",t]};function I(e,t){if(1&e&&(u.Qb(0,"button",26),u.Mb(1,"i",27),u.wc(2),u.Pb()),2&e){var n=u.Zb(2);u.ec("routerLink",u.jc(2,P,n.campaign.id,n.note.articleId)),u.Ab(2),u.yc(" ",n.note.article.name," ")}}var C=function(e,t){return["/campaigns",e,"quests",t]};function x(e,t){if(1&e&&(u.Qb(0,"button",26),u.Mb(1,"i",28),u.wc(2),u.Pb()),2&e){var n=u.Zb(2);u.ec("routerLink",u.jc(2,C,n.campaign.id,n.note.questId)),u.Ab(2),u.yc(" ",n.note.quest.name," ")}}var Q=function(e,t){return["/campaigns",e,"maps",t]};function A(e,t){if(1&e&&(u.Qb(0,"button",26),u.Mb(1,"i",29),u.wc(2),u.Pb()),2&e){var n=u.Zb(2);u.ec("routerLink",u.jc(2,Q,n.campaign.id,n.note.mapId)),u.Ab(2),u.yc(" ",n.note.map.name," ")}}function T(e,t){if(1&e){var n=u.Rb();u.Qb(0,"button",30),u.Xb("click",function(){return u.oc(n),u.Zb(2).delete()}),u.wc(1," Delete "),u.Pb()}}function E(e,t){if(1&e){var n=u.Rb();u.Qb(0,"div",16),u.Qb(1,"div",17),u.vc(2,w,2,1,"div",18),u.Qb(3,"div",19),u.vc(4,I,3,5,"button",20),u.vc(5,x,3,5,"button",20),u.vc(6,A,3,5,"button",20),u.Pb(),u.Qb(7,"div",21),u.vc(8,T,2,0,"button",22),u.Qb(9,"button",23),u.Xb("click",function(){return u.oc(n),u.Zb(),u.mc(1).close(null)}),u.wc(10,"Close"),u.Pb(),u.Pb(),u.Pb(),u.Pb()}if(2&e){var i=u.Zb();u.Ab(2),u.ec("ngIf",i.user),u.Ab(2),u.ec("ngIf",null!==i.note.article),u.Ab(1),u.ec("ngIf",null!==i.note.quest),u.Ab(1),u.ec("ngIf",null!==i.note.map),u.Ab(2),u.ec("ngIf",i.note&&i.editable)}}var R=function(){var e=function(){function e(t,n,i){d(this,e),this.noteService=t,this.campaignService=n,this.loginService=i,this.loading=!1,this.unsaved=!1,this._autosaveInterval=1500,this._lastAutosave=0,this._autosavePromise=null,t.setNoteEditor(this)}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.noteService.noteUpdate.pipe(Object(o.a)(function(t){return e.note&&t.id===e.note.id})).subscribe(function(t){e.editable||(e.note=t,e._noteForm&&(e._noteForm.note=t))})}},{key:"createNote",value:function(e){return l(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.loading=!0,n={title:"UNNAMED_NOTE",userId:this.loginService.id,content:null,campaignId:this.campaignService.campaign.id,publicEdit:!1,publicView:!1},t.t0=e.type,t.next=t.t0===i.b.QUEST?5:t.t0===i.b.MAP?7:t.t0===i.b.ARTICLE?9:10;break;case 5:return n.questId=e.questId,t.abrupt("break",10);case 7:return n.mapId=e.mapId,n.lat=e.lat,n.lng=e.lng,n.mapShape=e.mapShape,t.abrupt("break",10);case 9:n.articleId=e.articleId;case 10:return t.prev=10,t.next=13,this.noteService.createNote(n);case 13:this.note=t.sent,this.note.title="",t.next=20;break;case 17:throw t.prev=17,t.t1=t.catch(10),t.t1;case 20:this.loading=!1;case 21:case"end":return t.stop()}},t,this,[[10,17]])}))}},{key:"saveNote",value:function(){return l(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!==this._autosavePromise,!e.t0){e.next=4;break}return e.next=4,this._autosavePromise;case 4:return this.loading=!0,e.prev=5,this._autosavePromise=this.noteService.updateNote(this.note),e.next=9,this._autosavePromise;case 9:this._autosavePromise=null,e.next=15;break;case 12:throw e.prev=12,e.t1=e.catch(5),e.t1;case 15:this._lastAutosave=Date.now(),this.loading=!1,this.unsaved=!1;case 16:case"end":return e.stop()}},e,this,[[5,12]])}))}},{key:"onNoteChange",value:function(e){var t=this;this.editable&&(Date.now()>this._lastAutosave+this._autosaveInterval?(this.note=e,this.saveNote()):(this.unsaved=!0,void 0!==this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=window.setTimeout(function(){t.note=e,t.saveNote(),t._saveTimeout=void 0},this._autosaveInterval)))}},{key:"addNote",value:function(e){return l(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.createNote(e);case 2:this.modal.open().then(function(){null===n.note.content&&""===n.note.title&&n.noteService.deleteNote(n.note.id),n.note=void 0});case 3:case"end":return t.stop()}},t,this)}))}},{key:"editNote",value:function(e){return l(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.modal.open().then(function(){n.note=void 0}),this.loading=!0,t.prev=1,t.next=4,this.noteService.getNote(e.id);case 4:this.note=t.sent,t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(1),t.t0;case 10:this.loading=!1;case 11:case"end":return t.stop()}},t,this,[[1,7]])}))}},{key:"delete",value:function(){return l(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.note,!e.t0){e.next=7;break}return e.t1=!0,e.next=5,s.a.fire({text:"Are you sure?",showCancelButton:!0});case 5:e.t2=e.sent.value,e.t0=e.t1===e.t2;case 7:if(!e.t0){e.next=18;break}return e.prev=8,e.next=11,this.noteService.deleteNote(this.note.id);case 11:this.modal.close(null),e.next=18;break;case 14:if(e.prev=14,e.t3=e.catch(8),-1!==e.t3.message.indexOf("Cannot close modal")){e.next=18;break}throw e.t3;case 18:case"end":return e.stop()}},e,this,[[8,14]])}))}},{key:"editable",get:function(){return this.note.userId===this.loginService.id||this.note.publicEdit}},{key:"advancedEditable",get:function(){return this.note.userId===this.loginService.id}},{key:"user",get:function(){var e=this;if(!this.note)return null;if(this.note.user)return this.note.user;var t=this.campaignService.campaign.members.find(function(t){return t.userId===e.note.userId});return t&&t.user?t.user:void 0}},{key:"campaign",get:function(){return this.campaignService.campaign}}]),e}();return e.\u0275fac=function(t){return new(t||e)(u.Lb(i.a),u.Lb(r.b),u.Lb(c.a))},e.\u0275cmp=u.Fb({type:e,selectors:[["dd-note-editor"]],viewQuery:function(e,t){var n;(1&e&&(u.Ac(b,3),u.Ac(f,1)),2&e)&&(u.lc(n=u.Yb())&&(t.modal=n.first),u.lc(n=u.Yb())&&(t._noteForm=n.first))},decls:5,vars:3,consts:[["modal",""],["modal-header","",4,"ngIf"],["modal-body","",4,"ngIf"],["modal-footer","",4,"ngIf"],["modal-header",""],["class","d-inline-block ml-2",4,"ngIf"],["class","icon icon-check",4,"ngIf"],["class","icon icon-cross",4,"ngIf"],[1,"d-inline-block","ml-2"],[1,"loading"],[1,"icon","icon-check"],[1,"icon","icon-cross"],["modal-body",""],[3,"note","editable","advancedEditable","noteChange",4,"ngIf"],[3,"note","editable","advancedEditable","noteChange"],["noteform",""],["modal-footer",""],[1,"columns","col-gapless","mt-2"],["class","column col-auto d-flex align-items-center mr-2",4,"ngIf"],[1,"column","col-auto","d-flex","align-items-center"],["class","btn btn-sm",3,"routerLink",4,"ngIf"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-error mr-2",3,"click",4,"ngIf"],[1,"btn",3,"click"],[1,"column","col-auto","d-flex","align-items-center","mr-2"],[3,"ddUser"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-bookmark"],[1,"icon","icon-flag"],[1,"icon","icon-location"],[1,"btn","btn-error","mr-2",3,"click"]],template:function(e,t){1&e&&(u.Qb(0,"dd-modal",null,0),u.vc(2,g,4,3,"div",1),u.vc(3,k,2,1,"div",2),u.vc(4,E,11,5,"div",3),u.Pb()),2&e&&(u.Ab(2),u.ec("ngIf",t.note&&t.editable),u.Ab(1),u.ec("ngIf",t.note),u.Ab(1),u.ec("ngIf",t.note))},styles:[".note-display[_ngcontent-%COMP%]{white-space:pre-line}"]}),e}()},qcJQ:function(t,n,i){"use strict";i.d(n,"a",function(){return R});var r=i("fXoL"),c=i("AxCL"),o=i("3Pt+"),s=i("uCWu"),u=i("ygrl"),l=i("ofXK"),b=["editmodal"],f=["hpinput"];function h(e,t){if(1&e){var n=r.Rb();r.Qb(0,"dd-modal",null,2),r.Qb(2,"div",3),r.wc(3,"Edit Health"),r.Pb(),r.Qb(4,"div",4),r.Qb(5,"form",5),r.Xb("ngSubmit",function(){return r.oc(n),r.Zb().submitEdit()}),r.Qb(6,"div",6),r.Qb(7,"label",7),r.wc(8,"HP"),r.Pb(),r.Mb(9,"input",8,9),r.Pb(),r.Pb(),r.Mb(11,"dd-health-display",10),r.Qb(12,"input",11),r.Xb("change",function(e){return r.oc(n),r.Zb().onSliderChange(e)}),r.Pb(),r.Pb(),r.Qb(13,"div",12),r.Qb(14,"button",13),r.Xb("click",function(){return r.oc(n),r.mc(1).close(null)}),r.wc(15,"Cancel"),r.Pb(),r.Qb(16,"button",14),r.Xb("click",function(){return r.oc(n),r.Zb().submitEdit()}),r.wc(17,"Save"),r.Pb(),r.Pb(),r.Pb()}if(2&e){var i=r.Zb();r.Ab(9),r.ec("formControl",i.operationControl),r.Ab(2),r.ec("editable",!1)("health",i.hpAfterOperation)("disableAnimation",!0)("forceShowBar",!0)("preset",i.preset),r.Ab(1),r.ec("max",i.health.max)("formControl",i.sliderControl)}}function v(e,t){if(1&e&&(r.Qb(0,"h5",24),r.wc(1),r.Pb()),2&e){var n=r.Zb().$implicit;r.Ab(1),r.zc("",n.current," / ",n.max,"")}}function m(e,t){1&e&&(r.Qb(0,"h5",25),r.wc(1," . "),r.Pb())}function g(e,t){1&e&&(r.Qb(0,"h5",25),r.wc(1," . "),r.Pb())}function y(e,t){if(1&e&&(r.Qb(0,"div"),r.wc(1),r.Pb()),2&e){var n=r.Zb().$implicit;r.Ab(1),r.zc("",n.current," / ",n.max,"")}}function k(e,t){1&e&&(r.Qb(0,"div",26),r.wc(1," . "),r.Pb())}function w(e,t){1&e&&(r.Qb(0,"div",26),r.wc(1," . "),r.Pb())}function P(e,t){if(1&e&&(r.Qb(0,"div",27),r.Qb(1,"h5",24),r.wc(2),r.Pb(),r.Pb()),2&e){var n=r.Zb().$implicit;r.Ab(2),r.zc("",n.current," / ",n.max,"")}}function I(e,t){if(1&e&&(r.Qb(0,"div",28),r.Qb(1,"div"),r.wc(2),r.Pb(),r.Pb()),2&e){var n=r.Zb().$implicit;r.Ab(2),r.zc("",n.current," / ",n.max,"")}}var C=function(e){return{"c-hand":e}},x=function(e,t){return{"bar-animated":e,"p-1":t}};function Q(e,t){if(1&e){var n=r.Rb();r.Qb(0,"div",17),r.Xb("click",function(){return r.oc(n),r.Zb(2).editHP()}),r.Qb(1,"div",18),r.vc(2,v,2,2,"h5",19),r.vc(3,m,2,0,"h5",20),r.vc(4,g,2,0,"h5",20),r.vc(5,y,2,2,"div",0),r.vc(6,k,2,0,"div",21),r.vc(7,w,2,0,"div",21),r.Pb(),r.vc(8,P,3,2,"div",22),r.vc(9,I,3,2,"div",23),r.Pb()}if(2&e){var i=t.$implicit,c=r.Zb(2);r.ec("ngClass",r.ic(14,C,c.editable)),r.Ab(1),r.tc("width",i.percentCSS)("background-color",i.colorCSS),r.ec("ngClass",r.jc(16,x,!c.disableAnimation,!c.mini)),r.Ab(1),r.ec("ngIf",c.hpPercent>50&&!c.mini&&c.amountVisible),r.Ab(1),r.ec("ngIf",c.hpPercent<=50&&!c.mini&&c.amountVisible),r.Ab(1),r.ec("ngIf",!c.mini&&!c.amountVisible),r.Ab(1),r.ec("ngIf",c.hpPercent>50&&c.mini&&c.amountVisible),r.Ab(1),r.ec("ngIf",c.hpPercent<=50&&c.mini&&c.amountVisible),r.Ab(1),r.ec("ngIf",!c.amountVisible&&c.mini),r.Ab(1),r.ec("ngIf",c.hpPercent<=50&&!c.mini&&c.amountVisible),r.Ab(1),r.ec("ngIf",c.hpPercent<=50&&c.mini&&c.amountVisible)}}function A(e,t){if(1&e&&(r.Qb(0,"div"),r.vc(1,Q,10,19,"div",15),r.Qb(2,"div",16),r.wc(3),r.Pb(),r.Pb()),2&e){var n=r.Zb();r.Ab(1),r.ec("ngForOf",n.bars)("ngForTrackBy",n.trackBarElement),r.Ab(2),r.xc(n.hpText)}}function T(e,t){if(1&e&&(r.Qb(0,"div",29),r.Qb(1,"h5",30),r.wc(2),r.Pb(),r.Pb()),2&e){var n=r.Zb();r.Ab(2),r.xc(n.hpText)}}var E=function(e){return e[e.ADD=0]="ADD",e[e.SUBTRACT=1]="SUBTRACT",e[e.DIVIDE=2]="DIVIDE",e[e.MULTIPLY=3]="MULTIPLY",e[e.FILL=4]="FILL",e[e.SET=5]="SET",e}({}),R=function(){var t=function(){function t(e){d(this,t),this.campaignService=e,this.disableAnimation=!1,this.mini=!1,this.forceShowBar=!1,this.healthChange=new r.n,this.operationRegex=/^(\+([0-9]+))|(-([0-9]+))|(\/([0-9]+))|(\*([0-9]+))|(\+\+)|([0-9]+)$/}return p(t,[{key:"ngOnInit",value:function(){var e=this;this.operationControl=new o.e(null),this.sliderControl=new o.e(this.health.current),this.sliderControl.valueChanges.subscribe(function(t){e.updateOperationFromSliderValue(t)})}},{key:"updateOperationFromSliderValue",value:function(e){var t="";e===this.health.current?t=e:e<this.health.current?t="-"+(this.health.current-e):e>this.health.current&&(t="+"+(e-this.health.current)),this.operationControl.setValue(t)}},{key:"onSliderChange",value:function(e){var t=this;setTimeout(function(){t.updateOperationFromSliderValue(t.sliderControl.value)},1)}},{key:"editHP",value:function(){var e=this;this.editable&&(this.sliderControl.setValue(this.health.current),this.editModal.open().then(function(t){null!==t&&e.healthChange.emit(t)}),setTimeout(function(){e.operationControl.reset(),e.hpInput.nativeElement.focus()},1))}},{key:"submitEdit",value:function(){this.editModal.close(this.hpAfterOperation)}},{key:"parseOperation",value:function(t){var n=this.operationRegex.exec(t);if(null===n)return null;var i={type:E.ADD,amount:10},r=e(n,11),c=(r[0],r[1]),o=r[2],a=r[3],s=r[4],u=r[5],l=r[6],d=r[7],b=r[8],p=r[9],f=r[10];return c?(i.type=E.ADD,i.amount=parseInt(o,10)):a?(i.type=E.SUBTRACT,i.amount=parseInt(s,10)):u?(i.type=E.DIVIDE,i.amount=parseInt(l,10)):d?(i.type=E.MULTIPLY,i.amount=parseInt(b,10)):p?(i.type=E.FILL,i.amount=0):f&&(i.type=E.SET,i.amount=parseInt(f,10)),i}},{key:"applyOperation",value:function(e,t){var n=Object.assign({},t);switch(e.type){case E.ADD:n.current+=e.amount;break;case E.SUBTRACT:n.current-=e.amount;break;case E.SET:n.current=e.amount;break;case E.DIVIDE:n.current=Math.round(n.current/e.amount);break;case E.MULTIPLY:n.current=Math.round(n.current*e.amount);break;case E.FILL:n.current=n.max}return n.current<0?n.current=0:n.current>n.max&&(n.current=n.max),n}},{key:"trackBarElement",value:function(e,t){return e.toString()}},{key:"hpAfterOperation",get:function(){if(!this.health||this.operationControl.invalid)return null;var e=this.parseOperation(this.operationControl.value);return null===e?this.health:this.applyOperation(e,this.health)}},{key:"hpPercent",get:function(){return this.health?this.health.current/this.health.max*100:0}},{key:"bars",get:function(){var e,t=this.hpPercent;switch(this.preset.colorType){case c.c.DYNAMIC:e=t>80?"#64ad53":t>60?"#84bb47":t>40?"#d2ae2b":t>20?"#d86e54":"#d8545b";break;case c.c.STATIC:e=this.preset.staticColor||"#5755d9"}return[{max:this.health.max,current:this.health.current,percentCSS:t.toFixed(2)+"%",colorCSS:e}]}},{key:"sliderTooltip",get:function(){return"".concat(this.sliderControl.value,"/").concat(this.health.max)}},{key:"amountVisible",get:function(){return!this.preset.amountHidden||this.editable||this.forceShowBar}},{key:"textOnly",get:function(){return this.preset.type===c.d.TEXT_BASED&&!this.editable&&!this.forceShowBar}},{key:"hpText",get:function(){var e=this;if(this.health&&this.preset&&this.preset.type===c.d.TEXT_BASED&&this.health.textDamageLevels){var t,n=a(Object.keys(this.health.textDamageLevels).map(function(t){return{percent:parseInt(t,10),text:e.health.textDamageLevels[t]}}).sort(function(e,t){return e.percent-t.percent}));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this.hpPercent<=i.percent)return i.text}}catch(r){n.e(r)}finally{n.f()}return""}return""}}]),t}();return t.\u0275fac=function(e){return new(e||t)(r.Lb(s.b))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-health-display"]],viewQuery:function(e,t){var n;(1&e&&(r.Ac(b,1),r.Ac(f,1)),2&e)&&(r.lc(n=r.Yb())&&(t.editModal=n.first),r.lc(n=r.Yb())&&(t.hpInput=n.first))},inputs:{editable:"editable",health:"health",preset:"preset",disableAnimation:"disableAnimation",mini:"mini",forceShowBar:"forceShowBar"},outputs:{healthChange:"healthChange"},decls:3,vars:3,consts:[[4,"ngIf"],["class","text-center",4,"ngIf"],["editmodal",""],["modal-header",""],["modal-body",""],[1,"mb-2",3,"ngSubmit"],[1,"form-group"],["for","operation",1,"form-label"],["type","tel","name","operation","id","operation","placeholder","HP",1,"form-input",3,"formControl"],["hpinput",""],[3,"editable","health","disableAnimation","forceShowBar","preset"],["type","range","min","0","name","hp-slider",1,"slider","mt-1",3,"max","formControl","change"],["modal-footer",""],[1,"btn",3,"click"],[1,"btn","btn-primary","ml-2",3,"click"],["class","bar h-100 no-select",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-input-hint","text-center"],[1,"bar","h-100","no-select",3,"ngClass","click"],[1,"bar-item","d-flex","align-items-center","justify-content-center",3,"ngClass"],["class","mb-1 text-bold",4,"ngIf"],["class","mb-1 text-bold","style","opacity: 0;",4,"ngIf"],["style","opacity: 0;",4,"ngIf"],["class","d-flex justify-content-center align-items-center p-1",4,"ngIf"],["class","d-flex justify-content-center align-items-center pl-1","style","line-height: 0.8rem",4,"ngIf"],[1,"mb-1","text-bold"],[1,"mb-1","text-bold",2,"opacity","0"],[2,"opacity","0"],[1,"d-flex","justify-content-center","align-items-center","p-1"],[1,"d-flex","justify-content-center","align-items-center","pl-1",2,"line-height","0.8rem"],[1,"text-center"],[1,"mb-2"]],template:function(e,t){1&e&&(r.vc(0,h,18,8,"dd-modal",0),r.vc(1,A,4,3,"div",0),r.vc(2,T,3,1,"div",1)),2&e&&(r.ec("ngIf",t.editable),r.Ab(1),r.ec("ngIf",!t.textOnly),r.Ab(1),r.ec("ngIf",t.textOnly))},directives:[l.k,u.a,o.x,o.n,o.o,o.b,o.m,o.f,t,o.r,l.j,l.i],styles:[".bar-animated[_ngcontent-%COMP%]{transition:all .4s ease-in-out!important}[_nghost-%COMP%]{height:100%}.bar-item.d-flex[_ngcontent-%COMP%]{display:flex}.bar-item[_ngcontent-%COMP%]{background-image:url(/assets/hp-pattern.png);background-repeat:repeat;background-blend-mode:multiply}"]}),t}()},rZgH:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n("AytR"),r=n("fXoL"),c=n("tk/3"),o=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},a=function(){var e=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"getArticle",value:function(e){return this.http.get("".concat(i.a.apiURL,"/articles/").concat(e)).toPromise()}},{key:"getArticles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,c=r?"&search=".concat(encodeURIComponent(r)):"";return this.http.get("".concat(i.a.apiURL,"/articles?campaignId=").concat(e,"&limit=").concat(t,"&offset=").concat(n).concat(c)).toPromise()}},{key:"createArticle",value:function(e){return this.http.post("".concat(i.a.apiURL,"/articles"),e).toPromise()}},{key:"updateArticle",value:function(e){return this.http.put("".concat(i.a.apiURL,"/articles/").concat(e.id),e).toPromise()}},{key:"getMapArticles",value:function(e){return this.http.get("".concat(i.a.apiURL,"/articles/map/").concat(e)).toPromise()}},{key:"deleteArticle",value:function(e){return this.http.delete("".concat(i.a.apiURL,"/articles/").concat(e)).toPromise()}},{key:"getArticleQuests",value:function(e){return this.http.get("".concat(i.a.apiURL,"/articlequests/?articleId=").concat(e)).toPromise()}},{key:"updateArticleQuest",value:function(e){return this.http.put("".concat(i.a.apiURL,"/articlequests"),e).toPromise()}},{key:"deleteArticleQuest",value:function(e){return this.http.delete("".concat(i.a.apiURL,"/articlequests?articleId=").concat(e.articleId,"&questId=").concat(e.questId)).toPromise()}},{key:"getArticleConcepts",value:function(e,t){return this.http.get("".concat(i.a.apiURL,"/articleconcepts/?articleId=").concat(e,"&conceptTypeId=").concat(t)).toPromise()}},{key:"updateArticleConcept",value:function(e){return this.http.put("".concat(i.a.apiURL,"/articleconcepts"),e).toPromise()}},{key:"deleteArticleConcept",value:function(e){return this.http.delete("".concat(i.a.apiURL,"/articleconcepts?articleId=").concat(e.articleId,"&conceptId=").concat(e.conceptId)).toPromise()}},{key:"buyArticleConcept",value:function(e,t,n){return o(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.http.post("".concat(i.a.apiURL,"/articleconcepts/buy?quantity=").concat(t,"&entityId=").concat(n),e).toPromise());case 1:case"end":return r.stop()}},r,this)}))}},{key:"getPopular",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.get("".concat(i.a.apiURL,"/articles/popular?campaignId=").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"makeCopy",value:function(e){return o(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.post("".concat(i.a.apiURL,"/articles/makecopy/").concat(e),null).toPromise());case 1:case"end":return t.stop()}},t,this)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Ub(c.b))},e.\u0275prov=r.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},reMG:function(e,t,n){"use strict";n.r(t),n.d(t,"NotesModule",function(){return _});var i=n("ofXK"),r=n("wC5x"),c=n("3Pt+"),o=n("EA6F"),a=n("tyNb"),s=n("uCWu"),u=n("a8fi"),l=n("fXoL"),b=n("/AKn"),f=n("W/nz");function h(e,t){1&e&&l.Mb(0,"i",10)}function v(e,t){1&e&&l.Mb(0,"i",11)}function m(e,t){1&e&&l.Mb(0,"i",12)}function g(e,t){1&e&&l.Mb(0,"i",13)}var y,k=((y=function(){function e(t){d(this,e),this.campaignService=t,this.select=new l.n}return p(e,[{key:"ngOnInit",value:function(){}},{key:"doSelect",value:function(){this.select.emit(this.note)}},{key:"user",get:function(){var e=this;return this.campaignService.campaign.members.find(function(t){return t.userId===e.note.userId}).user}}]),e}()).\u0275fac=function(e){return new(e||y)(l.Lb(s.b))},y.\u0275cmp=l.Fb({type:y,selectors:[["dd-note-list-item"]],inputs:{note:"note"},outputs:{select:"select"},decls:11,vars:6,consts:[[1,"card","p-1","hoverable",3,"click"],[1,"columns","col-gapless"],[1,"column"],[1,"column","col-auto","d-flex","align-items-center","ml-1"],["class","icon icon-edit ml-1",4,"ngIf"],["class","icon icon-bookmark ml-1",4,"ngIf"],["class","icon icon-flag ml-1",4,"ngIf"],["class","icon icon-location ml-1",4,"ngIf"],[1,"column","col-auto","text-gray","text-italic","text-right","ml-1"],[3,"ddUser"],[1,"icon","icon-edit","ml-1"],[1,"icon","icon-bookmark","ml-1"],[1,"icon","icon-flag","ml-1"],[1,"icon","icon-location","ml-1"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Xb("click",function(){return t.doSelect()}),l.Qb(1,"div",1),l.Qb(2,"div",2),l.wc(3),l.Pb(),l.Qb(4,"div",3),l.vc(5,h,1,0,"i",4),l.vc(6,v,1,0,"i",5),l.vc(7,m,1,0,"i",6),l.vc(8,g,1,0,"i",7),l.Pb(),l.Qb(9,"div",8),l.Mb(10,"div",9),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(3),l.xc(t.note.title),l.Ab(2),l.ec("ngIf",t.note.publicEdit),l.Ab(1),l.ec("ngIf",t.note.articleId),l.Ab(1),l.ec("ngIf",t.note.questId),l.Ab(1),l.ec("ngIf",t.note.mapId),l.Ab(2),l.ec("ddUser",t.user))},directives:[i.k,f.a],styles:[""]}),y);function w(e,t){1&e&&l.Mb(0,"div",10)}function P(e,t){if(1&e&&l.Mb(0,"dd-http-errors",11),2&e){var n=l.Zb();l.ec("error",n.loadErr)}}function I(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",14),l.Qb(1,"dd-note-list-item",15),l.Xb("select",function(e){return l.oc(n),l.Zb(2).selectNote(e)}),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("note",i)}}function C(e,t){if(1&e&&(l.Qb(0,"div",12),l.vc(1,I,2,1,"div",13),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.sortedNotes.other)}}function x(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",14),l.Qb(1,"dd-note-list-item",15),l.Xb("select",function(e){return l.oc(n),l.Zb(2).selectNote(e)}),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("note",i)}}function Q(e,t){if(1&e&&(l.Qb(0,"div",12),l.vc(1,x,2,1,"div",13),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.sortedNotes.quest)}}function A(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",14),l.Qb(1,"dd-note-list-item",15),l.Xb("select",function(e){return l.oc(n),l.Zb(2).selectNote(e)}),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("note",i)}}function T(e,t){if(1&e&&(l.Qb(0,"div",12),l.vc(1,A,2,1,"div",13),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.sortedNotes.article)}}function E(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",14),l.Qb(1,"dd-note-list-item",15),l.Xb("select",function(e){return l.oc(n),l.Zb(2).selectNote(e)}),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("note",i)}}function R(e,t){if(1&e&&(l.Qb(0,"div",12),l.vc(1,E,2,1,"div",13),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.sortedNotes.map)}}var L,M,S,O=[{path:"",component:(L=function(){function e(t,n){d(this,e),this.campaignService=t,this.noteService=n,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){this.load()}},{key:"load",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.noteService.getNotes(this.campaignService.campaign.id,{});case 4:this.notes=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),this.loadErr=e.t0;case 10:this.loading=!1;case 11:case"end":return e.stop()}},e,this,[[1,7]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"selectNote",value:function(e){this.noteService.editNote(e)}},{key:"sortedNotes",get:function(){if(!this.notes)return null;var e={quest:[],article:[],map:[],other:[]};return this.notes.forEach(function(t){null!=t.questId?e.quest.push(t):null!=t.articleId?e.article.push(t):null!=t.mapId?e.map.push(t):e.other.push(t)}),e}}]),e}(),L.\u0275fac=function(e){return new(e||L)(l.Lb(s.b),l.Lb(u.a))},L.\u0275cmp=l.Fb({type:L,selectors:[["dd-note-manager"]],decls:15,vars:6,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto"],["class","loading loading-lg",4,"ngIf"],[3,"error",4,"ngIf"],["class","columns col-gapless",4,"ngIf"],["data-content","Quest Notes",1,"divider","text-center"],["data-content","Article Notes",1,"divider","text-center"],["data-content","Map Notes",1,"divider","text-center"],[1,"loading","loading-lg"],[3,"error"],[1,"columns","col-gapless"],["class","column col-3 col-md-4 col-sm-6 p-1 col-xs-12",4,"ngFor","ngForOf"],[1,"column","col-3","col-md-4","col-sm-6","p-1","col-xs-12"],[3,"note","select"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"h3"),l.wc(4,"Notebook"),l.Pb(),l.Pb(),l.Mb(5,"div",3),l.Pb(),l.vc(6,w,1,0,"div",4),l.vc(7,P,1,1,"dd-http-errors",5),l.vc(8,C,2,1,"div",6),l.Mb(9,"div",7),l.vc(10,Q,2,1,"div",6),l.Mb(11,"div",8),l.vc(12,T,2,1,"div",6),l.Mb(13,"div",9),l.vc(14,R,2,1,"div",6),l.Pb()),2&e&&(l.Ab(6),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.loadErr),l.Ab(1),l.ec("ngIf",t.sortedNotes),l.Ab(2),l.ec("ngIf",t.sortedNotes),l.Ab(2),l.ec("ngIf",t.sortedNotes),l.Ab(2),l.ec("ngIf",t.sortedNotes))},directives:[i.k,b.a,i.j,k],styles:[""]}),L)}],N=((S=function e(){d(this,e)}).\u0275mod=l.Jb({type:S}),S.\u0275inj=l.Ib({factory:function(e){return new(e||S)},imports:[[a.f.forChild(O)],a.f]}),S),_=((M=function e(){d(this,e)}).\u0275mod=l.Jb({type:M}),M.\u0275inj=l.Ib({factory:function(e){return new(e||M)},imports:[[N,i.b,r.a,c.s,o.a]]}),M)},rpEA:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var i=n("fXoL"),r=n("3Pt+"),c=n("edGd"),o=n("dtdw"),a=n("pLZG");function s(e,t){1&e&&(i.Qb(0,"div",2),i.Mb(1,"input",4),i.Pb())}function u(e,t){1&e&&(i.Qb(0,"div",2),i.Qb(1,"label",5),i.Mb(2,"input",6),i.Mb(3,"i",7),i.wc(4," This note is publicly visible "),i.Pb(),i.Pb())}function l(e,t){1&e&&(i.Qb(0,"div",2),i.Qb(1,"label",5),i.Mb(2,"input",8),i.Mb(3,"i",7),i.wc(4," This note is publicly editable "),i.Pb(),i.Pb())}var b=function(){var e=function(){function e(t,n){d(this,e),this.login=t,this.updateHub=n,this.cursorUpdates=new i.n,this.deltaUpdates=new i.n,this.noteChange=new i.n,this.editable=!1,this.advancedEditable=!1}return p(e,[{key:"note",get:function(){return this._note},set:function(e){this._note=e,this.formGroup&&this.formGroup.patchValue(e)}},{key:"ngOnInit",value:function(){var e=this;this.formGroup=new r.h({content:new r.e(this.note.content),title:new r.e(this.note.title),publicView:new r.e(this.note.publicView),publicEdit:new r.e(this.note.publicEdit)}),this.note.title="Placeholder",this.formGroup.valueChanges.subscribe(function(t){e.note.title=t.title||"Placeholder",e.note.publicEdit=t.publicEdit,e.note.publicView=t.publicView,e.note.content=t.content,e.noteChange.emit(e.note)}),this.updateHub.subscribeNote(this.note.id),this.updateHub.stateUpdate.subscribe(function(t){t===o.a.CONNECTED&&e.updateHub.subscribeNote(e.note.id)}),this.updateHub.cursorUpdate.pipe(Object(a.a)(function(t){return t.noteId===e.note.id})).subscribe(function(t){e.cursorUpdates.emit(t)}),this.updateHub.noteDeltaUpdate.pipe(Object(a.a)(function(t){return t.id===e.note.id})).subscribe(function(t){e.deltaUpdates.emit(t.delta)})}},{key:"ngOnDestroy",value:function(){this.updateHub.sendNoteCursorUpdate(this.note.id,null),this.updateHub.unsubscribeNote(this.note.id)}},{key:"textChange",value:function(e){this.note.publicEdit&&this.updateHub.sendNoteDeltaUpdate(this.note.id,e)}},{key:"selectionChange",value:function(e){this.note.publicEdit&&this.updateHub.sendNoteCursorUpdate(this.note.id,e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Lb(c.a),i.Lb(o.b))},e.\u0275cmp=i.Fb({type:e,selectors:[["dd-note-form"]],inputs:{note:"note",editable:"editable",advancedEditable:"advancedEditable"},outputs:{noteChange:"noteChange"},decls:6,vars:7,consts:[[3,"formGroup"],["class","form-group",4,"ngIf"],[1,"form-group"],["simple","true","formControlName","content",3,"readOnly","cursorUpdates","deltaUpdates","textChange","selectionChange"],["type","text","formControlName","title","placeholder","Title",1,"form-input","input-sm"],[1,"form-switch"],["type","checkbox","formControlName","publicView"],[1,"form-icon"],["type","checkbox","formControlName","publicEdit"]],template:function(e,t){1&e&&(i.Qb(0,"form",0),i.vc(1,s,2,0,"div",1),i.Qb(2,"div",2),i.Qb(3,"dd-quill",3),i.Xb("textChange",function(e){return t.textChange(e)})("selectionChange",function(e){return t.selectionChange(e)}),i.Pb(),i.Pb(),i.vc(4,u,5,0,"div",1),i.vc(5,l,5,0,"div",1),i.Pb()),2&e&&(i.ec("formGroup",t.formGroup),i.Ab(1),i.ec("ngIf",t.editable),i.Ab(2),i.ec("readOnly",!t.editable)("cursorUpdates",t.cursorUpdates)("deltaUpdates",t.deltaUpdates),i.Ab(1),i.ec("ngIf",t.advancedEditable),i.Ab(1),i.ec("ngIf",t.advancedEditable))},styles:[""]}),e}()},uCWu:function(e,t,n){"use strict";n.d(t,"b",function(){return u}),n.d(t,"a",function(){return l});var i=n("AytR"),r=n("edGd"),c=n("dtdw"),o=n("fXoL"),a=n("tk/3"),s=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},u=function(){var e=function(){function e(t,n,i){var r=this;d(this,e),this.http=t,this.login=n,this.updateHub=i,this._campaign=null,this.loadingCampaign=!1,this.updateHub.stateUpdate.subscribe(function(e){e===c.a.CONNECTED&&r._campaign&&r.updateHub.subscribeCampaign(r._campaign.id)}),this.updateHub.campaignUpdated.subscribe(function(e){r._campaign&&r._campaign.id===e.id&&(r._campaign.name=e.name,r._campaign.content=e.content,r._campaign.imageId=e.imageId,r._campaign.experienceTable=e.experienceTable,r._campaign.itemTypes=e.itemTypes,r._campaign.currencyMap=e.currencyMap)}),this.updateHub.campaignRefresh.subscribe(function(){r.refreshCurrentCampaign()}),this.updateHub.entityUpdated.subscribe(function(e){r._campaign&&(e.preset=r._campaign.entityPresets.find(function(t){return t.id===e.entityPresetId}),e.user=r._campaign.members.find(function(t){return t.userId===e.userId}).user,r._campaign.entities.forEach(function(t,n){t.id===e.id&&(r._campaign.entities[n]=Object.assign(Object.assign({},t),e))}))}),this.updateHub.entityDeleted.subscribe(function(e){r._campaign&&(r._campaign.entities=r._campaign.entities.filter(function(t){return t.id!==e}))}),this.updateHub.entityCreated.subscribe(function(e){r._campaign&&(e.preset=r._campaign.entityPresets.find(function(t){return t.id===e.entityPresetId}),e.user=r._campaign.members.find(function(t){return t.userId===e.userId}).user,r._campaign.entities.push(e))})}return p(e,[{key:"setSelection",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e){t.next=2;break}return t.abrupt("return",(null!=this.campaign&&(this.previousCampaignId=this.campaign.id,this.updateHub.unsubscribeCampaign(this.previousCampaignId)),void(this.campaign=null)));case 2:return this.updateHub.subscribeCampaign(e),this.campaign=null,this.loadingCampaign=!0,t.prev=3,t.next=6,this.getCampaign(e);case 6:n=t.sent,this.campaign=n,document.title=this.campaign.name,t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(3),t.t0;case 13:this.loadingCampaign=!1;case 14:case"end":return t.stop()}},t,this,[[3,10]])}))}},{key:"refreshCurrentCampaign",value:function(){return s(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.campaign){e.next=11;break}return e.prev=1,e.next=4,this.getCampaign(this.campaign.id);case 4:t=e.sent,Object.assign(this.campaign,t),document.title=this.campaign.name,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:case"end":return e.stop()}},e,this,[[1,8]])}))}},{key:"getCampaigns",value:function(){return s(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.http.get("".concat(i.a.apiURL,"/campaigns")).toPromise());case 1:case"end":return e.stop()}},e,this)}))}},{key:"getCampaign",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.get("".concat(i.a.apiURL,"/campaigns/").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"createCampaign",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.post("".concat(i.a.apiURL,"/campaigns"),Object.assign(Object.assign({},e),{id:void 0})).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"updateCampaign",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.put("".concat(i.a.apiURL,"/campaigns/").concat(e.id),e).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"deleteCampaign",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.delete("".concat(i.a.apiURL,"/campaigns/").concat(e.id)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"getInvites",value:function(){return s(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.http.get("".concat(i.a.apiURL,"/campaigninvites?campaignId=").concat(this.campaign.id)).toPromise());case 1:case"end":return e.stop()}},e,this)}))}},{key:"getInvite",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.get("".concat(i.a.apiURL,"/campaigninvites/").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"createInvite",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.post("".concat(i.a.apiURL,"/campaigninvites"),{campaignId:this.campaign.id,name:e}).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"updateInvite",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.put("".concat(i.a.apiURL,"/campaigninvites/").concat(e.id),e).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"deleteInvite",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.delete("".concat(i.a.apiURL,"/campaigninvites/").concat(e)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"acceptInvite",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.post("".concat(i.a.apiURL,"/campaigninvites/").concat(e,"/accept"),{}).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"denyInvite",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.post("".concat(i.a.apiURL,"/campaigninvites/").concat(e,"/decline"),{}).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"removeMember",value:function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.http.delete("".concat(i.a.apiURL,"/campaigns/").concat(e.campaignId,"/member/").concat(e.userId)).toPromise());case 1:case"end":return t.stop()}},t,this)}))}},{key:"calculateLevel",value:function(e){if(!this.campaign)throw new Error("No campaign present");for(var t=this.campaign.experienceTable||[],n=1,i=0;i<t.length&&e>=t[i];i++)n++;return n}},{key:"getXPToNextLevel",value:function(e){for(var t=this.campaign.experienceTable||[],n=0;n<t.length;n++){var i=t[n];if(e<i)return i-e}return-1}},{key:"getEntityPreset",value:function(e){return this.campaign&&this.campaign.entityPresets.find(function(t){return t.id===e})||null}},{key:"getUser",value:function(e){return this.campaign&&this.campaign.members.find(function(t){return t.userId===e})||null}},{key:"canEdit",get:function(){return!!this.campaign&&this.login.id===this.campaign.userId}},{key:"editableEntities",get:function(){var e=this;return this.campaign?this.canEdit?this.campaign.entities:this.campaign.entities.filter(function(t){return t.userId===e.login.id}):[]}},{key:"campaign",get:function(){return this._campaign},set:function(e){this._campaign=e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.Ub(a.b),o.Ub(r.a),o.Ub(c.b))},e.\u0275prov=o.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),l=function(e){return e[e.PENDING=0]="PENDING",e[e.REVOKED=1]="REVOKED",e[e.ACCEPTED=2]="ACCEPTED",e}({})},wC5x:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n("ofXK"),r=n("ygrl"),c=n("3Pt+"),o=n("WNRK"),a=n("aCXV"),s=n("nzV2"),u=n("rpEA"),l=n("EA6F"),b=n("tyNb"),p=n("fXoL"),f=n("W/nz"),h=function(){var e=function e(){d(this,e)};return e.\u0275mod=p.Jb({type:e}),e.\u0275inj=p.Ib({factory:function(t){return new(t||e)},imports:[[i.b,c.s,c.k,a.e,l.a,b.f]]}),e}();p.rc(s.a,[r.a,i.k,u.a,f.a,b.d],[]),p.rc(u.a,[c.x,c.n,c.i,i.k,c.b,c.m,c.g,o.a,c.a],[])},wNqa:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a});var i=n("AytR"),r=n("fXoL"),c=n("tk/3"),o=function(){var e=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"getQuests",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s="";null!=t&&(s="&search=".concat(encodeURIComponent(t.trim().toLowerCase())));var u="";c&&c.length>0&&c.forEach(function(e){u+="&except=".concat(encodeURIComponent(e))});var l="";o&&o.length>0&&o.forEach(function(e){l+="&only=".concat(encodeURIComponent(e))});var d="";return a&&a.length>0&&a.forEach(function(e){d+="&status=".concat(e)}),n||(n=10),r||(r=0),this.http.get("".concat(i.a.apiURL,"/quests?campaignId=").concat(e).concat(s,"&limit=").concat(n,"&offset=").concat(r).concat(u).concat(l).concat(d)).toPromise()}},{key:"getQuest",value:function(e){return this.http.get("".concat(i.a.apiURL,"/quests/").concat(e)).toPromise()}},{key:"createQuest",value:function(e){return this.http.post("".concat(i.a.apiURL,"/quests"),Object.assign(Object.assign({},e),{id:void 0})).toPromise()}},{key:"updateQuest",value:function(e){return this.http.put("".concat(i.a.apiURL,"/quests/").concat(e.id),e).toPromise()}},{key:"deleteQuest",value:function(e){return this.http.delete("".concat(i.a.apiURL,"/quests/").concat(e.id)).toPromise()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Ub(c.b))},e.\u0275prov=r.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),a=function(e){return e[e.NONE=0]="NONE",e[e.ON_HOLD=1]="ON_HOLD",e[e.IN_PROGRESS=2]="IN_PROGRESS",e[e.TO_DO=3]="TO_DO",e[e.COMPLETED=4]="COMPLETED",e}({})},xdv0:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n("AytR"),r=n("fXoL"),c=n("tk/3"),o=function(){var e=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"getUser",value:function(e){return this.http.get("".concat(i.a.apiURL,"/users/").concat(e)).toPromise()}},{key:"createUser",value:function(e){return this.http.post("".concat(i.a.apiURL,"/users"),e).toPromise()}},{key:"updateUser",value:function(e){return this.http.put("".concat(i.a.apiURL,"/users/").concat(e.id),e).toPromise()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(r.Ub(c.b))},e.\u0275prov=r.Hb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},y4Wg:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n("fXoL"),r=n("ofXK"),c=function(e,t,n){return{"btn-primary":e,"btn-link":t,loading:n}};function o(e,t){if(1&e){var n=i.Rb();i.Qb(0,"button",9),i.Xb("click",function(){i.oc(n);var e=i.Zb().$implicit;return i.Zb(2).setPage(e)}),i.wc(1),i.Pb()}if(2&e){var r=i.Zb().$implicit,o=i.Zb(2);i.ec("ngClass",i.kc(2,c,o.page===r,o.page!==r,o.page===r&&o.loading)),i.Ab(1),i.yc(" ",r," ")}}function a(e,t){1&e&&(i.Qb(0,"span"),i.wc(1,"..."),i.Pb())}function s(e,t){if(1&e&&(i.Qb(0,"li",2),i.vc(1,o,2,6,"button",7),i.vc(2,a,2,0,"span",8),i.Pb()),2&e){var n=t.$implicit;i.Ab(1),i.ec("ngIf",n>0),i.Ab(1),i.ec("ngIf",-1===n)}}function u(e,t){if(1&e){var n=i.Rb();i.Qb(0,"ul",1),i.Qb(1,"li",2),i.Qb(2,"button",3),i.Xb("click",function(){return i.oc(n),i.Zb().prev()}),i.Mb(3,"i",4),i.Pb(),i.Pb(),i.vc(4,s,3,2,"li",5),i.Qb(5,"li",2),i.Qb(6,"button",3),i.Xb("click",function(){return i.oc(n),i.Zb().next()}),i.Mb(7,"i",6),i.Pb(),i.Pb(),i.Pb()}if(2&e){var r=i.Zb();i.Ab(2),i.ec("disabled",!r.canPrev),i.Ab(2),i.ec("ngForOf",r.pageArr),i.Ab(2),i.ec("disabled",!r.canNext)}}var l=function(){var e=function(){function e(){d(this,e),this.itemsPerPage=5,this.page=0,this.autoHide=!0,this.loading=!1,this.pageChange=new i.n}return p(e,[{key:"ngOnInit",value:function(){}},{key:"next",value:function(){this.canNext&&(this.page++,this.pageChange.emit(this.page))}},{key:"prev",value:function(){this.canPrev&&(this.page--,this.pageChange.emit(this.page))}},{key:"setPage",value:function(e){this.page=e,this.pageChange.emit(this.page)}},{key:"pageArr",get:function(){var e=[1];if(this.numPages>4){this.page>2&&e.push(-1);for(var t=Math.max(2,this.page-1);t<Math.min(this.page+2,this.numPages);t++)e.push(t);this.page<this.numPages-2&&e.push(-1),e.push(this.numPages)}else if(this.numPages>1)for(var n=2;n<this.numPages+1;n++)e.push(n);return e}},{key:"numPages",get:function(){return Math.ceil(this.totalItems/this.itemsPerPage)}},{key:"canNext",get:function(){return this.page<this.numPages}},{key:"canPrev",get:function(){return this.page>1}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Fb({type:e,selectors:[["dd-paginator"]],inputs:{totalItems:"totalItems",itemsPerPage:"itemsPerPage",page:"page",autoHide:"autoHide",loading:"loading"},outputs:{pageChange:"pageChange"},decls:1,vars:1,consts:[["class","pagination",4,"ngIf"],[1,"pagination"],[1,"page-item"],[1,"btn","btn-link",3,"disabled","click"],[1,"icon","icon-arrow-left"],["class","page-item",4,"ngFor","ngForOf"],[1,"icon","icon-arrow-right"],["class","btn",3,"ngClass","click",4,"ngIf"],[4,"ngIf"],[1,"btn",3,"ngClass","click"]],template:function(e,t){1&e&&i.vc(0,u,8,3,"ul",0),2&e&&i.ec("ngIf",t.numPages>1||!t.autoHide)},directives:[r.k,r.j,r.i],styles:[".pagination[_ngcontent-%COMP%]{justify-content:center}"]}),e}()},ygrl:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var i=n("fXoL"),r=n("ofXK"),c=n("aCXV");function o(e,t){1&e&&i.Mb(0,"i",9)}function a(e,t){if(1&e){var n=i.Rb();i.Qb(0,"a",10),i.Xb("click",function(){return i.oc(n),i.Zb().userClose(null)}),i.Pb()}}var s=[[["","modal-header",""]],[["","modal-body",""]],[["","modal-footer",""]]],u=function(e,t,n){return{active:e,"modal-sm":t,"modal-lg":n}},l=["[modal-header]","[modal-body]","[modal-footer]"],b=function(){var e=function(){function e(){d(this,e),this.size="normal",this.codeOnly=!1}return p(e,[{key:"ngOnInit",value:function(){}},{key:"open",value:function(){var e=this;if(void 0!==this.openPromise)throw new Error("Cannot open modal when it is already open");return this.openPromise=new Promise(function(t,n){e.resolve=t}),this.openPromise}},{key:"userClose",value:function(e){if(!0!==this.codeOnly)return this.close(e)}},{key:"close",value:function(e){if(void 0===this.openPromise)throw new Error("Cannot close modal when it has not been opened");var t=this.openPromise;return this.resolve(e),this.openPromise=void 0,this.resolve=void 0,t}},{key:"isOpen",get:function(){return void 0!==this.openPromise}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Fb({type:e,selectors:[["dd-modal"]],inputs:{size:"size",codeOnly:"codeOnly"},ngContentSelectors:l,decls:12,vars:8,consts:[["id","modal-parent",1,"modal",3,"ngClass"],["aria-label","Close",1,"modal-overlay",3,"click"],["cdkDragBoundary","#modal-parent","cdkDrag","",1,"modal-container",3,"cdkDragDisabled"],[1,"modal-header","p-2"],["class","icon icon-resize-vert c-move float-left mt-1","style","margin-left: -1rem;","cdkDragHandle","",4,"ngIf"],["class","btn btn-clear float-right","aria-label","Close",3,"click",4,"ngIf"],[1,"modal-body","p-2"],[1,"content"],[1,"modal-footer","px-2","pt-2"],["cdkDragHandle","",1,"icon","icon-resize-vert","c-move","float-left","mt-1",2,"margin-left","-1rem"],["aria-label","Close",1,"btn","btn-clear","float-right",3,"click"]],template:function(e,t){1&e&&(i.dc(s),i.Qb(0,"div",0),i.Qb(1,"a",1),i.Xb("click",function(){return t.userClose(null)}),i.Pb(),i.Qb(2,"div",2),i.Qb(3,"div",3),i.vc(4,o,1,0,"i",4),i.vc(5,a,1,0,"a",5),i.cc(6),i.Pb(),i.Qb(7,"div",6),i.Qb(8,"div",7),i.cc(9,1),i.Pb(),i.Pb(),i.Qb(10,"div",8),i.cc(11,2),i.Pb(),i.Pb(),i.Pb()),2&e&&(i.ec("ngClass",i.kc(4,u,t.isOpen,"small"===t.size,"large"===t.size)),i.Ab(2),i.ec("cdkDragDisabled","small"===t.size||"large"===t.size),i.Ab(2),i.ec("ngIf","small"!==t.size&&"large"!==t.size),i.Ab(1),i.ec("ngIf",!t.codeOnly))},directives:[r.i,c.a,r.k,c.b],styles:[""]}),e}()},zUnb:function(i,c,s){"use strict";s.r(c);var u=s("jhN1"),l=s("fXoL"),b=s("aCXV"),f=s("tk/3"),h=s("3Pt+"),v=s("R1ws"),m=s("Jho9"),g=s("o2tx"),y=s("5eHb"),k=s("AytR"),w=s("tyNb"),P=s("uCWu"),I=s("ofXK");function C(e,t){1&e&&l.Mb(0,"div",2)}function x(e,t){1&e&&l.Mb(0,"router-outlet")}var Q,A,T=((Q=function(){function e(t,n){d(this,e),this.campaignService=t,this.route=n}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.route.paramMap.subscribe(function(t){e.campaignService.setSelection(t.get("id"))})}},{key:"ngOnDestroy",value:function(){this.campaignService.setSelection(null)}},{key:"loading",get:function(){return this.campaignService.loadingCampaign}},{key:"campaign",get:function(){return this.campaignService.campaign}}]),e}()).\u0275fac=function(e){return new(e||Q)(l.Lb(P.b),l.Lb(w.a))},Q.\u0275cmp=l.Fb({type:Q,selectors:[["dd-campaign"]],decls:2,vars:2,consts:[["class","loading loading-lg",4,"ngIf"],[4,"ngIf"],[1,"loading","loading-lg"]],template:function(e,t){1&e&&(l.vc(0,C,1,0,"div",0),l.vc(1,x,1,0,"router-outlet",1)),2&e&&(l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.campaign))},directives:[I.k,w.g],styles:[""]}),Q),E=s("edGd"),R=s("nmfD"),L=["Securing","Ripening","Planting","Cooking","Loading","Computing","Slurping","Destroying","Demolishing"],M=["trebuchets","apples","pumpkins","dank memes","characters","dinner","a smoothie","chocolate cake","gloves","a water bottle","an absolute unit"],S=((A=function(){function e(){d(this,e),this.chance=new R.Chance}return p(e,[{key:"ngOnInit",value:function(){this.generatePhrase()}},{key:"generatePhrase",value:function(){var e=this;this.phrase="".concat(L[this.chance.integer({min:0,max:L.length-1})]," ").concat(M[this.chance.integer({min:0,max:M.length-1})]),setTimeout(function(){e.generatePhrase()},this.chance.integer({min:250,max:1500}))}}]),e}()).\u0275fac=function(e){return new(e||A)},A.\u0275cmp=l.Fb({type:A,selectors:[["dd-phraser"]],decls:1,vars:1,template:function(e,t){1&e&&l.wc(0),2&e&&l.yc("",t.phrase,"\n")},styles:[""]}),A);function O(e,t){1&e&&l.Mb(0,"img",18)}function N(e,t){1&e&&l.Mb(0,"img",19)}function _(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",5),l.Qb(1,"div",6),l.Qb(2,"h5",7),l.wc(3,"Last time you logged in with..."),l.Pb(),l.Pb(),l.Qb(4,"div",8),l.Qb(5,"div",1),l.Qb(6,"div",9),l.Qb(7,"figure",10),l.Mb(8,"img",11),l.vc(9,O,1,0,"img",12),l.vc(10,N,1,0,"img",13),l.Pb(),l.Pb(),l.Qb(11,"div",14),l.Qb(12,"h5",15),l.wc(13),l.Pb(),l.Qb(14,"span"),l.wc(15),l.Pb(),l.Pb(),l.Pb(),l.Qb(16,"button",16),l.Xb("click",function(){return l.oc(n),l.Zb().useLastLogin()}),l.wc(17,"Use This Login "),l.Mb(18,"i",17),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(8),l.ec("src",i.lastUsedLogin.picture,l.qc),l.Ab(1),l.ec("ngIf",i.lastLoginWasGoogle),l.Ab(1),l.ec("ngIf",i.lastLoginWasFacebook),l.Ab(3),l.xc(i.lastUsedLogin.name),l.Ab(2),l.xc(i.lastUsedLogin.email)}}function F(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",20),l.Qb(1,"div",6),l.Qb(2,"h2"),l.wc(3,"Login"),l.Pb(),l.Pb(),l.Qb(4,"div",8),l.Qb(5,"button",21),l.Xb("click",function(){return l.oc(n),l.Zb().authGoog()}),l.wc(6," Google "),l.Pb(),l.Mb(7,"div",22),l.Qb(8,"button",21),l.Xb("click",function(){return l.oc(n),l.Zb().authFb()}),l.wc(9," Facebook "),l.Pb(),l.Pb(),l.Pb()}}function U(e,t){1&e&&(l.Qb(0,"div",20),l.Qb(1,"div",8),l.Qb(2,"h6",23),l.wc(3,"Processing Information..."),l.Pb(),l.Mb(4,"dd-phraser"),l.Pb(),l.Pb())}var q,G=((q=function(){function e(t,n,i){d(this,e),this.login=t,this.route=n,this.router=i}return p(e,[{key:"ngOnInit",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"callback"===this.route.snapshot.url[0].path&&window.location.hash&&(t=window.location.hash,this.router.navigate([],{replaceUrl:!0}),this.login.processLoginCallback(t));case 1:case"end":return e.stop()}},e,this)}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"authGoog",value:function(){this.login.authorize("google-oauth2",this.lastLoginWasGoogle?this.lastUsedLogin.email:void 0)}},{key:"authFb",value:function(){this.login.authorize("facebook")}},{key:"useLastLogin",value:function(){this.lastLoginWasFacebook?this.authFb():this.lastLoginWasGoogle&&this.authGoog()}},{key:"id",get:function(){return"dummy"}},{key:"busy",get:function(){return this.login.busy}},{key:"lastUsedLogin",get:function(){return this.login.lastUsedLogin}},{key:"lastLoginWasGoogle",get:function(){return this.lastUsedLogin&&this.lastUsedLogin.sub.startsWith("google")}},{key:"lastLoginWasFacebook",get:function(){return this.lastUsedLogin&&this.lastUsedLogin.sub.startsWith("facebook")}}]),e}()).\u0275fac=function(e){return new(e||q)(l.Lb(E.a),l.Lb(w.a),l.Lb(w.c))},q.\u0275cmp=l.Fb({type:q,selectors:[["dd-login"]],decls:6,vars:3,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column","col-5","col-md-8","col-sm-11","col-mx-auto"],["class","card mb-2",4,"ngIf"],["class","card text-center",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"mb-0"],[1,"card-body"],[1,"column","col-auto"],[1,"avatar","avatar-lg"],["alt","User Avatar",3,"src"],["class","avatar-icon","src","/assets/g-logo.png","alt","Google Logo",4,"ngIf"],["class","avatar-icon","src","/assets/fb-logo.png","alt","Facebook Logo",4,"ngIf"],[1,"column","mb-2"],[1,"text-bold","mb-0"],[1,"btn","mt-2","wide",3,"click"],[1,"icon","icon-arrow-right"],["src","/assets/g-logo.png","alt","Google Logo",1,"avatar-icon"],["src","/assets/fb-logo.png","alt","Facebook Logo",1,"avatar-icon"],[1,"card","text-center"],[1,"btn","btn-lg","btn-primary","wide",3,"click"],["data-content","OR",1,"divider"],[1,"mb-1"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.vc(3,_,19,5,"div",3),l.vc(4,F,10,0,"div",4),l.vc(5,U,5,0,"div",4),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(3),l.ec("ngIf",t.lastUsedLogin&&!t.busy),l.Ab(1),l.ec("ngIf",!t.busy),l.Ab(1),l.ec("ngIf",t.busy))},directives:[I.k,S],styles:[".wide[_ngcontent-%COMP%]{width:100%}"]}),q),D=s("W/nz"),Z=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function X(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",5),l.Qb(1,"div",6),l.Qb(2,"h3"),l.wc(3,"Campaigns"),l.Pb(),l.Pb(),l.Qb(4,"div",7),l.Qb(5,"button",8),l.Xb("click",function(){return l.oc(n),l.Zb().createCampaign()}),l.Mb(6,"i",9),l.Qb(7,"span",10),l.wc(8," New Campaign"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}}function j(e,t){1&e&&l.Mb(0,"div",11)}function H(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",12),l.Qb(1,"div",13),l.Mb(2,"i",14),l.Pb(),l.Qb(3,"p",15),l.wc(4,"There are no campaigns here"),l.Pb(),l.Qb(5,"p",16),l.wc(6," Click the button to create your own, or ask your DM for an invite "),l.Pb(),l.Qb(7,"div",17),l.Qb(8,"button",18),l.Xb("click",function(){return l.oc(n),l.Zb().createCampaign()}),l.wc(9," Create Campaign "),l.Pb(),l.Pb(),l.Pb()}}function V(e,t){if(1&e&&(l.Qb(0,"div",26),l.Mb(1,"img",27),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.imageId,"",l.qc)}}function $(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div"),l.Qb(1,"div",19),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb().selectCampaign(e)}),l.Qb(2,"div",5),l.vc(3,V,2,1,"div",20),l.Qb(4,"div",6),l.Qb(5,"div",5),l.Qb(6,"div",6),l.Qb(7,"h4",21),l.wc(8),l.Pb(),l.Mb(9,"div",22),l.Pb(),l.Qb(10,"div",23),l.Qb(11,"span",24),l.wc(12),l.Pb(),l.Pb(),l.Qb(13,"div",25),l.Qb(14,"span",24),l.wc(15),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(3),l.ec("ngIf",i.imageId),l.Ab(5),l.xc(i.name),l.Ab(1),l.ec("ddUser",i.user),l.Ab(3),l.zc("",i.members.length," Member",1===i.members.length?"":"s",""),l.Ab(3),l.zc(" ",i.members.length," Member",1===i.members.length?"":"s"," ")}}var B,z,Y,W=((z=function(){function e(t,n){d(this,e),this.campaignService=t,this.router=n,this.loading=!1,this.creating=!1,this.campaigns=null,this.hideHeader=!1}return p(e,[{key:"ngOnInit",value:function(){this.loadCampaigns()}},{key:"loadCampaigns",value:function(){return Z(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.campaignService.getCampaigns();case 4:t=e.sent,this.campaigns=t,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:this.loading=!1;case 12:case"end":return e.stop()}},e,this,[[1,8]])}))}},{key:"createCampaign",value:function(){return Z(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.router.navigate(["campaigns","create"]);case 1:case"end":return e.stop()}},e,this)}))}},{key:"selectCampaign",value:function(e){this.campaignService.setSelection(e.id),this.router.navigate(["campaigns",e.id])}}]),e}()).\u0275fac=function(e){return new(e||z)(l.Lb(P.b),l.Lb(w.c))},z.\u0275cmp=l.Fb({type:z,selectors:[["dd-campaign-list"]],inputs:{hideHeader:"hideHeader"},decls:5,vars:4,consts:[[1,"container","grid-xl"],["class","columns",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"loading","loading-lg"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],[1,"card","hoverable","p-2","mb-2",3,"click"],["class","column col-auto",4,"ngIf"],[1,"mb-1"],[3,"ddUser"],[1,"column","col-md-12","hide-md","col-auto"],[1,"text-gray","text-italic"],[1,"column","col-md-12","show-md"],[1,"column","col-auto"],[1,"img-responsive","s-rounded",3,"src"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,X,9,0,"div",1),l.vc(2,j,1,0,"div",2),l.vc(3,H,10,0,"div",3),l.vc(4,$,16,7,"div",4),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",!t.hideHeader),l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.campaigns&&0===t.campaigns.length),l.Ab(1),l.ec("ngForOf",t.campaigns))},directives:[I.k,I.j,D.a],styles:[""]}),z),K=((B=function(){function e(t){d(this,e),this.login=t}return p(e,[{key:"ngOnInit",value:function(){}},{key:"user",get:function(){return this.login.currentUser}}]),e}()).\u0275fac=function(e){return new(e||B)(l.Lb(E.a))},B.\u0275cmp=l.Fb({type:B,selectors:[["dd-home"]],decls:4,vars:1,consts:[[1,"container","grid-xl"],["hideHeader","true"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"h3"),l.wc(2),l.Pb(),l.Mb(3,"dd-campaign-list",1),l.Pb()),2&e&&(l.Ab(2),l.yc("Hello, ",t.user.username,""))},directives:[W],styles:[""]}),B),J=s("CYb2"),ee=((Y=function(){function e(t,n,i){d(this,e),this.login=t,this.router=n,this.action=i}return p(e,[{key:"canActivate",value:function(e,t){return n=this,r=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!!this.login.isLoggedIn||(this.action.queue.push({type:J.b.REDIRECT,data:{url:t.url}}),this.action.save(),this.router.navigate(["login"]),!1));case 1:case"end":return e.stop()}},e,this)}),new((i=void 0)||(i=Promise))(function(e,t){function c(e){try{a(r.next(e))}catch(n){t(n)}}function o(e){try{a(r.throw(e))}catch(n){t(n)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i(function(e){e(n)})).then(c,o)}a((r=r.apply(n,[])).next())});var n,i,r}}]),e}()).\u0275fac=function(e){return new(e||Y)(l.Ub(E.a),l.Ub(w.c),l.Ub(J.a))},Y.\u0275prov=l.Hb({token:Y,factory:Y.\u0275fac,providedIn:"root"}),Y),te=s("ygrl"),ne=s("lD+H"),ie=["modal"];function re(e,t){if(1&e&&(l.Qb(0,"div",4),l.Qb(1,"div",5),l.wc(2),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(2),l.yc("Edit ",n.config.name,"")}}function ce(e,t){if(1&e&&l.Mb(0,"dd-dynamic-field",9),2&e){var n=t.$implicit,i=l.Zb(3);l.ec("control",i.modifiersGroup.get(n.config.name))("config",n.config)}}function oe(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,ce,1,2,"dd-dynamic-field",11),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("ngForOf",n.modifiers)("ngForTrackBy",n.trackModifier)}}function ae(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",6),l.Qb(1,"form",7,8),l.Xb("ngSubmit",function(){return l.oc(n),l.Zb().ok()}),l.Mb(3,"dd-dynamic-field",9),l.vc(4,oe,2,2,"div",10),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(3),l.ec("control",i.control)("config",i.config),l.Ab(1),l.ec("ngIf",i.modifiers&&i.modifiersGroup)}}function se(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",12),l.Qb(1,"button",13),l.Xb("click",function(){return l.oc(n),l.Zb().cancel()}),l.wc(2,"Cancel"),l.Pb(),l.Qb(3,"button",14),l.Xb("click",function(){return l.oc(n),l.Zb().ok()}),l.wc(4," Save "),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(3),l.ec("disabled",i.control.invalid)}}var ue,le=((ue=function(){function e(t){d(this,e),this.campaignService=t}return p(e,[{key:"ngOnInit",value:function(){}},{key:"editAttribute",value:function(e,t,n){return i=this,c=regeneratorRuntime.mark(function i(){var r,c,o,s=this;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(this.config=e,this.modifiers=n,this.control=new h.e(t),this.modifiers){this.modifiersGroup=new h.h({}),r=a(this.modifiers);try{for(r.s();!(c=r.n()).done;)o=c.value,this.modifiersGroup.addControl(o.config.name,new h.e(o.field.value))}catch(u){r.e(u)}finally{r.f()}}return i.abrupt("return",this.modal.open().then(function(e){return s.config=void 0,s.modifiers=void 0,s.modifiersGroup=void 0,e}));case 2:case"end":return i.stop()}},i,this)}),new((r=void 0)||(r=Promise))(function(e,t){function n(e){try{a(c.next(e))}catch(n){t(n)}}function o(e){try{a(c.throw(e))}catch(n){t(n)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r(function(e){e(i)})).then(n,o)}a((c=c.apply(i,[])).next())});var i,r,c}},{key:"trackModifier",value:function(e){return e}},{key:"ok",value:function(){this.control.invalid||this.modal.close({value:this.control.value,mods:this.modifiersGroup?this.modifiersGroup.value:null})}},{key:"cancel",value:function(){this.modal.close(null)}}]),e}()).\u0275fac=function(e){return new(e||ue)(l.Lb(P.b))},ue.\u0275cmp=l.Fb({type:ue,selectors:[["dd-entity-attribute-editor-modal"]],viewQuery:function(e,t){var n;1&e&&l.Ac(ie,3),2&e&&l.lc(n=l.Yb())&&(t.modal=n.first)},decls:5,vars:3,consts:[["modal",""],["modal-header","",4,"ngIf"],["modal-body","",4,"ngIf"],["modal-footer","",4,"ngIf"],["modal-header",""],[1,"modal-title"],["modal-body",""],[3,"ngSubmit"],["attrForm","ngForm"],["showLabel","false",3,"control","config"],[4,"ngIf"],["showLabel","false",3,"control","config",4,"ngFor","ngForOf","ngForTrackBy"],["modal-footer",""],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn",3,"disabled","click"]],template:function(e,t){1&e&&(l.Qb(0,"dd-modal",null,0),l.vc(2,re,3,1,"div",1),l.vc(3,ae,5,3,"div",2),l.vc(4,se,5,1,"div",3),l.Pb()),2&e&&(l.Ab(2),l.ec("ngIf",t.config&&t.control),l.Ab(1),l.ec("ngIf",t.config&&t.control),l.Ab(1),l.ec("ngIf",t.config&&t.control))},directives:[te.a,I.k,h.x,h.n,h.o,ne.a,I.j],styles:[""]}),ue),de=s("AxCL"),be=s("dtdw"),pe=s("DwCd"),fe=s("WNRK");function he(e,t){if(1&e&&(l.Qb(0,"figure",8),l.Mb(1,"img",9),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.config.imageId,"",l.qc)}}function ve(e,t){if(1&e&&(l.Qb(0,"sup"),l.wc(1),l.Pb()),2&e){var n=l.Zb().$implicit,i=l.Zb(2);l.Ab(1),l.xc(i.getModifierString(i.getModifiers(n)))}}var me=function(e){return{"c-hand":e}};function ge(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",3),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).editField(e)}),l.Qb(1,"div",4),l.vc(2,he,2,1,"figure",5),l.wc(3),l.Pb(),l.Qb(4,"div",6),l.wc(5),l.vc(6,ve,2,1,"sup",7),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit,r=l.Zb(2);l.ec("ngClass",l.ic(5,me,r.editable)),l.Ab(2),l.ec("ngIf",i.config&&i.config.imageId),l.Ab(1),l.yc(" ",i.config.name," "),l.Ab(2),l.yc(" ",i.field.value," "),l.Ab(1),l.ec("ngIf",r.getModifiers(i.field.name).length>0)}}function ye(e,t){if(1&e&&(l.Qb(0,"div",1),l.vc(1,ge,7,7,"div",2),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.fields)("ngForTrackBy",n.trackField)}}function ke(e,t){if(1&e&&(l.Qb(0,"div"),l.Qb(1,"figure",14),l.Mb(2,"img",9),l.Pb(),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(2),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.config.imageId,"",l.qc)}}function we(e,t){if(1&e&&(l.Qb(0,"sup"),l.wc(1),l.Pb()),2&e){var n=l.Zb().$implicit,i=l.Zb(2);l.Ab(1),l.yc("(",i.getModifierString(i.getModifiers(n.field.name)),")")}}function Pe(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",11),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).editField(e)}),l.Qb(1,"div",12),l.vc(2,ke,3,1,"div",7),l.wc(3),l.Pb(),l.Qb(4,"div",13),l.wc(5),l.vc(6,we,2,1,"sup",7),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit,r=l.Zb(2);l.ec("ngClass",l.ic(5,me,r.editable)),l.Ab(2),l.ec("ngIf",i.config&&i.config.imageId),l.Ab(1),l.yc(" ",i.config.name," "),l.Ab(2),l.yc(" ",i.field.value," "),l.Ab(1),l.ec("ngIf",r.getModifiers(i.field.name).length>0)}}function Ie(e,t){if(1&e&&(l.Qb(0,"div",1),l.vc(1,Pe,7,7,"div",10),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.fields)("ngForTrackBy",n.trackField)}}var Ce,xe=((Ce=function(){function e(){d(this,e),this.modifiers=[],this.mode="major",this.editable=!1,this.edit=new l.n}return p(e,[{key:"ngOnInit",value:function(){}},{key:"editField",value:function(e){this.edit.emit(e)}},{key:"trackField",value:function(e,t){return t.field.name}},{key:"getModifiers",value:function(e){return this.modifiers.filter(function(t){return t.config&&t.config.options&&t.config.options.modifierFor===e&&null!=t.field.value})}},{key:"getModifierString",value:function(e){return e.map(function(e){return e.field.value}).join(" ")}}]),e}()).\u0275fac=function(e){return new(e||Ce)},Ce.\u0275cmp=l.Fb({type:Ce,selectors:[["dd-attribute-row-view"]],inputs:{fields:"fields",modifiers:"modifiers",mode:"mode",editable:"editable"},outputs:{edit:"edit"},decls:2,vars:2,consts:[["class","columns mt-2",4,"ngIf"],[1,"columns","mt-2"],["class","column col-2 col-md-3 col-sm-5 col-mx-auto text-center",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-2","col-md-3","col-sm-5","col-mx-auto","text-center",3,"ngClass","click"],[1,"h5","no-select"],["class","avatar avatar",4,"ngIf"],[1,"h4","text-bold"],[4,"ngIf"],[1,"avatar","avatar"],[3,"src"],["class","column col-2 col-md-3 col-sm-4 col-mx-auto text-center",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-2","col-md-3","col-sm-4","col-mx-auto","text-center",3,"ngClass","click"],[1,"h6","no-select"],[1,"h5"],[1,"avatar","avatar-sm"]],template:function(e,t){1&e&&(l.vc(0,ye,2,2,"div",0),l.vc(1,Ie,2,2,"div",0)),2&e&&(l.ec("ngIf","major"===t.mode),l.Ab(1),l.ec("ngIf","normal"===t.mode))},directives:[I.k,I.j,I.i],styles:[""]}),Ce),Qe=s("qcJQ"),Ae=s("0ezk");function Te(e,t){if(1&e&&(l.Qb(0,"figure",7),l.Mb(1,"img",8),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.config.imageId,"",l.qc)}}var Ee=function(e){return{"c-hand":e}};function Re(e,t){if(1&e){var n=l.Rb();l.Qb(0,"tr",3),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb().editField(e)}),l.Qb(1,"td",4),l.vc(2,Te,2,1,"figure",5),l.wc(3),l.Pb(),l.Qb(4,"td",6),l.wc(5),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit,r=l.Zb();l.ec("ngClass",l.ic(4,Ee,r.editable)),l.Ab(2),l.ec("ngIf",i.config&&i.config.imageId),l.Ab(1),l.yc(" ",i.field.name," "),l.Ab(2),l.xc(i.field.value)}}var Le,Me=function(e){return{"table-hover":e}},Se=((Le=function(){function e(){d(this,e),this.editable=!1,this.edit=new l.n}return p(e,[{key:"ngOnInit",value:function(){}},{key:"editField",value:function(e){this.edit.emit(e)}},{key:"trackField",value:function(e,t){return t.field.name}}]),e}()).\u0275fac=function(e){return new(e||Le)},Le.\u0275cmp=l.Fb({type:Le,selectors:[["dd-attribute-table-view"]],inputs:{fields:"fields",editable:"editable"},outputs:{edit:"edit"},decls:8,vars:5,consts:[[1,"table","table-striped",3,"ngClass"],[1,"w-100"],[3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngClass","click"],[1,"no-select","py-0"],["class","avatar avatar-xs",4,"ngIf"],[1,"text-bold","py-0","text-right"],[1,"avatar","avatar-xs"],[3,"src"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"thead"),l.Qb(2,"tr"),l.Qb(3,"th",1),l.wc(4,"Minor Attributes"),l.Pb(),l.Mb(5,"th"),l.Pb(),l.Pb(),l.Qb(6,"tbody"),l.vc(7,Re,6,6,"tr",2),l.Pb(),l.Pb()),2&e&&(l.ec("ngClass",l.ic(3,Me,t.editable)),l.Ab(7),l.ec("ngForOf",t.fields)("ngForTrackBy",t.trackField))},directives:[I.i,I.j,I.k],styles:[""]}),Le),Oe=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},Ne=["attributemodal"];function _e(e,t){1&e&&l.Mb(0,"div",4)}function Fe(e,t){1&e&&(l.Qb(0,"div",23),l.wc(1,"Saving..."),l.Pb())}var Ue=function(e,t,n){return["/campaigns",e,"entities",t,n,"edit"]};function qe(e,t){if(1&e&&(l.Qb(0,"a",24),l.Mb(1,"i",25),l.Pb()),2&e){var n=l.Zb(2);l.ec("routerLink",l.kc(1,Ue,n.campaign.id,n.entity.preset.id,n.entity.id))}}function Ge(e,t){if(1&e&&(l.Qb(0,"div",26),l.Mb(1,"div",27),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("ddUser",n.user)}}var De=function(e){return{"c-hand":e}};function Ze(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",28),l.Qb(1,"span",29),l.Xb("click",function(){return l.oc(n),l.Zb(2).editXP()}),l.Qb(2,"span",30),l.wc(3,"LV. "),l.Pb(),l.Qb(4,"span",31),l.wc(5),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(1),l.ec("ngClass",l.ic(2,De,i.editable)),l.Ab(4),l.xc(i.level)}}function Xe(e,t){if(1&e&&(l.Qb(0,"div",32),l.Qb(1,"span"),l.wc(2),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(2),l.zc("",n.entity.xp," / ",n.xpToNextLevel,"")}}function je(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",33),l.Xb("click",function(){return l.oc(n),l.Zb(2).openLocationOnMap()}),l.wc(1," Location "),l.Mb(2,"i",34),l.Pb()}}function He(e,t){if(1&e&&(l.Qb(0,"div",5),l.Qb(1,"div",6),l.Qb(2,"div",7),l.Qb(3,"div",8),l.vc(4,Fe,2,0,"div",9),l.Pb(),l.Pb(),l.Qb(5,"div",10),l.Qb(6,"div",11),l.Qb(7,"div",12),l.Qb(8,"div"),l.Qb(9,"h3",13),l.wc(10),l.vc(11,qe,2,5,"a",14),l.Pb(),l.Qb(12,"div",15),l.vc(13,Ge,2,1,"div",16),l.Qb(14,"div",17),l.wc(15),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Qb(16,"div",18),l.Qb(17,"div",19),l.vc(18,Ze,6,4,"div",20),l.vc(19,Xe,3,2,"div",21),l.vc(20,je,3,0,"div",22),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.tc("background-image",n.backgroundCSS(n.entity.imageId)),l.Ab(4),l.ec("ngIf",n.saving),l.Ab(6),l.yc(" ",n.entity.name," "),l.Ab(1),l.ec("ngIf",n.editable),l.Ab(2),l.ec("ngIf",n.user),l.Ab(2),l.yc("(",n.entity.preset.name,")"),l.Ab(3),l.ec("ngIf",n.preset.isXPEnabled),l.Ab(1),l.ec("ngIf",n.preset.isXPEnabled),l.Ab(1),l.ec("ngIf",null!==n.entity.mapId)}}function Ve(e,t){if(1&e){var n=l.Rb();l.Qb(0,"dd-attribute-row-view",53),l.Xb("edit",function(e){return l.oc(n),l.Zb(2).editAttribute(e)}),l.Pb()}if(2&e){var i=l.Zb(2);l.ec("fields",i.majorAttributes)("modifiers",i.modifiers)("editable",i.editable)}}function $e(e,t){1&e&&l.Mb(0,"div",54)}function Be(e,t){if(1&e){var n=l.Rb();l.Qb(0,"dd-attribute-row-view",55),l.Xb("edit",function(e){return l.oc(n),l.Zb(2).editAttribute(e)}),l.Pb()}if(2&e){var i=l.Zb(2);l.ec("fields",i.normalAttributes)("editable",i.editable)("modifiers",i.modifiers)}}function ze(e,t){1&e&&l.Mb(0,"div",54)}var Ye=function(e,t){return{"col-9 col-md-7 col-sm-12":e,"col-12 mt-2":t}};function We(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",56),l.Qb(1,"div",57),l.Qb(2,"dd-health-display",58),l.Xb("healthChange",function(e){return l.oc(n),l.Zb(2).onHPEdit(e)}),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.ec("ngClass",l.jc(4,Ye,i.preset.isCurrencyEnabled,!i.preset.isCurrencyEnabled)),l.Ab(2),l.ec("editable",i.editable)("preset",i.entity.preset.health)("health",i.entity.health)}}function Ke(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",59),l.Qb(1,"div",60),l.Xb("click",function(){return l.oc(n),l.Zb(2).editCurrency()}),l.Mb(2,"h5",61),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(1),l.ec("ngClass",l.ic(2,De,i.editable)),l.Ab(1),l.ec("ddCurrency",i.entity.currency)}}function Je(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",51),l.Qb(1,"div",62),l.Xb("click",function(){return l.oc(n),l.Zb(2).editCurrency()}),l.Mb(2,"h5",61),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(1),l.ec("ngClass",l.ic(2,De,i.editable)),l.Ab(1),l.ec("ddCurrency",i.entity.currency)}}function et(e,t){1&e&&l.Mb(0,"div",54)}function tt(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",23),l.Qb(1,"button",63),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).openConceptEntities(e.id)}),l.wc(2),l.Mb(3,"i",44),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(2),l.yc(" ",i.pluralForm," ")}}function nt(e,t){1&e&&l.Mb(0,"div",54)}function it(e,t){if(1&e&&(l.Qb(0,"div"),l.Qb(1,"h3"),l.wc(2),l.Pb(),l.Mb(3,"dd-quill",47),l.Pb()),2&e){var n=t.$implicit;l.Ab(2),l.xc(n.field.name),l.Ab(1),l.ec("value",n.field.value)}}function rt(e,t){if(1&e){var n=l.Rb();l.Qb(0,"dd-attribute-table-view",66),l.Xb("edit",function(e){return l.oc(n),l.Zb(3).editAttribute(e)}),l.Pb()}if(2&e){var i=l.Zb(3);l.ec("fields",i.minorAttributes)("editable",i.editable)}}function ct(e,t){if(1&e&&(l.Qb(0,"div",64),l.vc(1,rt,1,2,"dd-attribute-table-view",65),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("ngIf",n.minorAttributes.length>0)}}function ot(e,t){1&e&&l.Mb(0,"div",54)}function at(e,t){if(1&e&&(l.Qb(0,"div"),l.Qb(1,"h3"),l.wc(2),l.Pb(),l.Mb(3,"dd-quill",47),l.Pb()),2&e){var n=t.$implicit;l.Ab(2),l.xc(n.field.name),l.Ab(1),l.ec("value",n.field.value)}}var st=function(){return["purchases"]};function ut(e,t){if(1&e&&(l.Qb(0,"div",10),l.vc(1,Ve,1,3,"dd-attribute-row-view",35),l.vc(2,$e,1,0,"div",36),l.vc(3,Be,1,3,"dd-attribute-row-view",37),l.vc(4,ze,1,0,"div",36),l.Qb(5,"div",38),l.vc(6,We,3,7,"div",39),l.vc(7,Ke,3,4,"div",40),l.vc(8,Je,3,4,"div",41),l.Pb(),l.vc(9,et,1,0,"div",36),l.Qb(10,"div",38),l.vc(11,tt,4,1,"div",42),l.Qb(12,"div",23),l.Qb(13,"button",43),l.wc(14,"Purchases "),l.Mb(15,"i",44),l.Pb(),l.Pb(),l.Pb(),l.Qb(16,"div",38),l.Qb(17,"div",45),l.Mb(18,"div",46),l.Mb(19,"dd-quill",47),l.Mb(20,"img",48),l.vc(21,nt,1,0,"div",36),l.vc(22,it,4,2,"div",49),l.Pb(),l.vc(23,ct,2,1,"div",50),l.Qb(24,"div",51),l.Mb(25,"div",46),l.Mb(26,"dd-quill",47),l.Mb(27,"img",52),l.vc(28,ot,1,0,"div",36),l.vc(29,at,4,2,"div",49),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngIf",n.majorAttributes.length>0),l.Ab(1),l.ec("ngIf",n.majorAttributes.length>0),l.Ab(1),l.ec("ngIf",n.normalAttributes.length>0),l.Ab(1),l.ec("ngIf",n.normalAttributes.length>0),l.Ab(2),l.ec("ngIf",n.preset.isHealthEnabled),l.Ab(1),l.ec("ngIf",n.preset.isCurrencyEnabled),l.Ab(1),l.ec("ngIf",n.preset.isCurrencyEnabled),l.Ab(1),l.ec("ngIf",n.preset.isCurrencyEnabled),l.Ab(2),l.ec("ngForOf",n.conceptTypeList),l.Ab(2),l.ec("routerLink",l.hc(23,st)),l.Ab(5),l.Bb("data-content","About "+n.entity.name),l.Ab(1),l.ec("value",n.entity.content),l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",n.entity.imageId,"",l.qc),l.Ab(1),l.ec("ngIf",n.bigTextAttributes.length>0),l.Ab(1),l.ec("ngForOf",n.bigTextAttributes)("ngForTrackBy",n.trackAttribute),l.Ab(1),l.ec("ngIf",n.minorAttributes.length>0),l.Ab(2),l.Bb("data-content","About "+n.entity.name),l.Ab(1),l.ec("value",n.entity.content),l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",n.entity.imageId,"",l.qc),l.Ab(1),l.ec("ngIf",n.bigTextAttributes.length>0),l.Ab(1),l.ec("ngForOf",n.bigTextAttributes)("ngForTrackBy",n.trackAttribute)}}var lt,dt=((lt=function(){function e(t,n,i,r,c,o,a){d(this,e),this.route=t,this.entityService=n,this.campaignService=i,this.sanitizer=r,this.login=c,this.router=o,this.update=a,this.loading=!1,this.saving=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.route.paramMap.subscribe(function(t){e.update.subscribeEntities([t.get("ent_id")]),e.loadEntity(t.get("ent_id"))}),this._updateHubStatus$=this.update.stateUpdate.subscribe(function(t){t===be.a.CONNECTED&&e.entity&&e.update.subscribeEntities([e.entity.id])}),this._entityUpdate$=this.update.entityUpdated.subscribe(function(t){e.entity&&t.id===e.entity.id&&(e.entity=t)})}},{key:"ngOnDestroy",value:function(){this.entity&&this.update.unsubscribeEntities([this.entity.id]),this._updateHubStatus$&&this._updateHubStatus$.unsubscribe()}},{key:"getEntityField",value:function(e){return this.entity.preset.fields.find(function(t){return t.name===e})}},{key:"updateEntity",value:function(){return Oe(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.saving=!0,t=Object.assign(Object.assign({},this.entity),{preset:void 0}),e.prev=2,e.next=5,this.entityService.updateEntity(t);case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),e.t0;case 10:this.saving=!1;case 11:case"end":return e.stop()}},e,this,[[2,7]])}))}},{key:"loadEntity",value:function(e){return Oe(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,this.entityService.getEntity(e);case 4:this.entity=t.sent,t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(1),t.t0;case 10:this.loading=!1;case 11:case"end":return t.stop()}},t,this,[[1,7]])}))}},{key:"editAttribute",value:function(e){return Oe(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,r,c,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.editable){t.next=2;break}return t.abrupt("return");case 2:return n=this.modifiers.filter(function(t){return(t.config&&t.config.options&&t.config.options.modifierFor)===e.config.name}),t.next=5,this.attributeModal.editAttribute(e.config,e.field.value,n);case 5:if(null!=(i=t.sent)){r=a(this.entity.fields);try{for(r.s();!(c=r.n()).done;)(o=c.value).name===e.field.name&&(o.value=i.value),i.mods&&void 0!==i.mods[o.name]&&(o.value=i.mods[o.name])}catch(s){r.e(s)}finally{r.f()}this.updateEntity()}case 7:case"end":return t.stop()}},t,this)}))}},{key:"onHPEdit",value:function(e){return Oe(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.entity.health=e,t.next=3,this.updateEntity();case 3:case"end":return t.stop()}},t,this)}))}},{key:"editCurrency",value:function(){return Oe(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editable){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.attributeModal.editAttribute({name:"Money",type:pe.a.CURRENCY,options:{required:!0,levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}},this.entity.currency);case 4:null!=(t=e.sent)&&(this.entity.currency=t.value,this.updateEntity());case 6:case"end":return e.stop()}},e,this)}))}},{key:"editXP",value:function(){return Oe(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.editable){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.attributeModal.editAttribute({name:"XP",description:"Experience points that this ".concat(this.entity.preset.name," has"),type:pe.a.INT,options:{required:!0,min:0}},this.entity.xp.toString());case 4:null!=(t=e.sent)&&(this.entity.xp=parseInt(t.value,10),this.updateEntity());case 6:case"end":return e.stop()}},e,this)}))}},{key:"openLocationOnMap",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",this.entity.mapId],{queryParams:{lat:this.entity.lat,lng:this.entity.lng,entity:this.entity.id}})}},{key:"openConceptEntities",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",this.entity.id,"ct",e])}},{key:"trackAttribute",value:function(e,t){return t.name}},{key:"majorAttributes",get:function(){var e=this;return(this.entity.fields||[]).map(function(t){return{field:t,config:e.getEntityField(t.name)}}).filter(function(e){return e.config&&e.config.class===de.a.MAJOR&&e.config.type!==pe.a.TEXT_FORMATTED&&null==e.config.options.modifierFor})}},{key:"normalAttributes",get:function(){var e=this;return(this.entity.fields||[]).map(function(t){return{field:t,config:e.getEntityField(t.name)}}).filter(function(e){return e.config&&e.config.class===de.a.NORMAL&&e.config.type!==pe.a.TEXT_FORMATTED&&null==e.config.options.modifierFor})}},{key:"bigTextAttributes",get:function(){var e=this;return(this.entity.fields||[]).map(function(t){return{field:t,config:e.getEntityField(t.name)}}).filter(function(e){return e.config&&e.config.type===pe.a.TEXT_FORMATTED&&e.field.value})}},{key:"minorAttributes",get:function(){var e=this;return(this.entity.fields||[]).map(function(t){return{field:t,config:e.getEntityField(t.name)}}).filter(function(e){return e.config&&e.config.class===de.a.MINOR&&e.config.type!==pe.a.TEXT_FORMATTED})}},{key:"unimportantAttributes",get:function(){var e=this;return(this.entity.fields||[]).map(function(t){return{field:t,config:e.getEntityField(t.name)}}).filter(function(e){return e.config&&e.config.class===de.a.UNIMPORTANT&&e.config.type!==pe.a.TEXT_FORMATTED})}},{key:"modifiers",get:function(){var e=this;return(this.entity.fields||[]).map(function(t){return{field:t,config:e.getEntityField(t.name)}}).filter(function(e){return e.config&&e.config.options&&null!=e.config.options.modifierFor})}},{key:"level",get:function(){return this.campaignService.calculateLevel(this.entity.xp)}},{key:"xpToNextLevel",get:function(){return this.campaignService.getXPToNextLevel(this.entity.xp)}},{key:"editable",get:function(){return this.campaignService.canEdit||this.entity.userId===this.login.id}},{key:"preset",get:function(){var e=this;return this.entity?this.campaignService.campaign.entityPresets.find(function(t){return t.id===e.entity.entityPresetId}):null}},{key:"user",get:function(){var e=this;if(this.entity){var t=this.campaign.members.find(function(t){return t.userId===e.entity.userId});return t?t.user:null}return null}},{key:"campaign",get:function(){return this.campaignService.campaign}},{key:"conceptTypeList",get:function(){var e=this;return this.preset?this.campaignService.campaign.conceptTypes.filter(function(t){return-1!==e.preset.conceptTypesEnabled.indexOf(t.id)}):[]}},{key:"backgroundCSS",value:function(e){return this.sanitizer.bypassSecurityTrustStyle('linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%),\n      url("https://res.cloudinary.com/dqhk8k6iv/image/upload/t_chr_blur/'.concat(e,'.jpg")'))}}]),e}()).\u0275fac=function(e){return new(e||lt)(l.Lb(w.a),l.Lb(de.b),l.Lb(P.b),l.Lb(u.b),l.Lb(E.a),l.Lb(w.c),l.Lb(be.b))},lt.\u0275cmp=l.Fb({type:lt,selectors:[["dd-entity-view"]],viewQuery:function(e,t){var n;1&e&&l.Ac(Ne,3),2&e&&l.lc(n=l.Yb())&&(t.attributeModal=n.first)},decls:5,vars:3,consts:[["class","loading loading-lg",4,"ngIf"],["attributemodal",""],["class","player-bg d-flex",3,"background-image",4,"ngIf"],["class","container grid-xl",4,"ngIf"],[1,"loading","loading-lg"],[1,"player-bg","d-flex"],["id","head-container"],[1,"container","grid-xl","mb-auto"],[1,"columns","text-gray"],["class","column",4,"ngIf"],[1,"container","grid-xl"],[1,"columns","text-light","mx-0"],[1,"column","text-light","mb-1","d-flex","flex-col","justify-end"],[1,"mb-0","text-bold"],["class","text-light",3,"routerLink",4,"ngIf"],[1,"columns","col-gapless"],["class","column col-auto mr-1",4,"ngIf"],[1,"column","text-italic","no-select"],[1,"column","col-auto","d-flex","justify-end","align-items-end","col-ml-auto",2,"line-height","1.2"],[1,"mb-1"],["class","text-right",4,"ngIf"],["class","text-right tooltip","data-tooltip","XP / Next Level",4,"ngIf"],["class","text-italic no-select c-hand",3,"click",4,"ngIf"],[1,"column"],[1,"text-light",3,"routerLink"],[1,"icon","icon-edit"],[1,"column","col-auto","mr-1"],[3,"ddUser"],[1,"text-right"],[3,"ngClass","click"],[1,"h5","no-select","mb-0"],[1,"h3","text-bold","mb-0"],["data-tooltip","XP / Next Level",1,"text-right","tooltip"],[1,"text-italic","no-select","c-hand",3,"click"],[1,"icon","icon-location"],[3,"fields","modifiers","editable","edit",4,"ngIf"],["class","divider",4,"ngIf"],["mode","normal",3,"fields","editable","modifiers","edit",4,"ngIf"],[1,"columns"],["class","column",3,"ngClass",4,"ngIf"],["class","column col-3 col-md-5 hide-sm",4,"ngIf"],["class","column col-12 show-sm mt-2",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],[1,"btn","btn-sm","w-100",3,"routerLink"],[1,"icon","icon-arrow-right"],[1,"column","col-8","col-md-6","col-sm-12","hide-sm"],[1,"divider","text-center"],["readOnly","true",3,"value"],[1,"img-responsive","s-rounded","mt-2",3,"src"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","column col-4 col-md-6 col-sm-12 col-ml-auto",4,"ngIf"],[1,"column","col-12","show-sm","mt-2"],[1,"img-responsive","s-rounded",3,"src"],[3,"fields","modifiers","editable","edit"],[1,"divider"],["mode","normal",3,"fields","editable","modifiers","edit"],[1,"column",3,"ngClass"],[1,"h-100"],[3,"editable","preset","health","healthChange"],[1,"column","col-3","col-md-5","hide-sm"],[1,"s-rounded","h-100","p-1","currency-box","text-center",2,"height","36px",3,"ngClass","click"],[1,"mb-0",3,"ddCurrency"],[1,"card","p-1","currency-box","text-center",3,"ngClass","click"],[1,"btn","btn-sm","w-100",3,"click"],[1,"column","col-4","col-md-6","col-sm-12","col-ml-auto"],[3,"fields","editable","edit",4,"ngIf"],[3,"fields","editable","edit"]],template:function(e,t){1&e&&(l.vc(0,_e,1,0,"div",0),l.Mb(1,"dd-entity-attribute-editor-modal",null,1),l.vc(3,He,21,10,"div",2),l.vc(4,ut,30,24,"div",3)),2&e&&(l.ec("ngIf",t.loading),l.Ab(3),l.ec("ngIf",t.entity),l.Ab(1),l.ec("ngIf",t.entity))},directives:[I.k,le,w.e,D.a,I.i,I.j,w.d,fe.a,xe,Qe.a,Ae.a,Se],styles:[".player-bg[_ngcontent-%COMP%]{background-color:#000;min-height:30vh;margin-top:-.4rem;background-size:cover;background-repeat:no-repeat;background-position:50%}#head-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:flex-end}.currency-box[_ngcontent-%COMP%]{background-color:#ffb700;background-image:url(/assets/hp-pattern.png);background-repeat:repeat;background-blend-mode:multiply}.coin-icon[_ngcontent-%COMP%]{margin-bottom:-.4rem}"]}),lt),bt=["modal"];function pt(e,t){if(1&e&&(l.Qb(0,"label",4),l.Mb(1,"input",12),l.Mb(2,"i",6),l.wc(3),l.Pb()),2&e){var n=t.$implicit;l.Ab(1),l.ec("formControlName","ct-"+n.id),l.Ab(2),l.yc(" Export ",n.pluralForm," ")}}var ft,ht=((ft=function(){function e(t){d(this,e),this.campaignService=t}return p(e,[{key:"conceptTypes",get:function(){return this._conceptTypes},set:function(e){this._conceptTypes=e,this.ngOnInit()}},{key:"ngOnInit",value:function(){this.formGroup=new h.h({exportQuests:new h.e(!0),exportArticles:new h.e(!0),exportEntityPresets:new h.e(!0)});var e,t=a(this.conceptTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.formGroup.addControl("ct-".concat(n.id),new h.e(!0))}}catch(i){t.e(i)}finally{t.f()}}},{key:"doExport",value:function(){this.modal.open()}},{key:"exportLink",get:function(){var e="".concat(k.a.apiURL,"/export?campaignId=").concat(this.campaignService.campaign.id),t=this.formGroup.value;t.exportQuests&&(e+="&quests=true"),t.exportArticles&&(e+="&articles=true"),t.exportEntityPresets&&(e+="&entitypresets=true");var n,i=a(this.conceptTypes);try{for(i.s();!(n=i.n()).done;){var r=n.value;!0===this.formGroup.get("ct-".concat(r.id)).value&&(e+="&conceptType=".concat(r.id))}}catch(c){i.e(c)}finally{i.f()}return e}}]),e}()).\u0275fac=function(e){return new(e||ft)(l.Lb(P.b))},ft.\u0275cmp=l.Fb({type:ft,selectors:[["dd-exporter"]],viewQuery:function(e,t){var n;1&e&&l.Ac(bt,3),2&e&&l.lc(n=l.Yb())&&(t.modal=n.first)},inputs:{conceptTypes:"conceptTypes"},decls:22,vars:3,consts:[["modal",""],["modal-header",""],["modal-body",""],[1,"form-group",3,"formGroup"],[1,"form-checkbox"],["type","checkbox","formControlName","exportQuests"],[1,"form-icon"],["type","checkbox","formControlName","exportArticles"],["type","checkbox","formControlName","exportEntityPresets"],["class","form-checkbox",4,"ngFor","ngForOf"],["target","_blank",1,"btn","btn-primary","mt-2",3,"href"],[1,"icon","icon-download"],["type","checkbox",3,"formControlName"]],template:function(e,t){1&e&&(l.Qb(0,"dd-modal",null,0),l.Qb(2,"h4",1),l.wc(3,"Export"),l.Pb(),l.Qb(4,"div",2),l.Qb(5,"div",3),l.Qb(6,"label",4),l.Mb(7,"input",5),l.Mb(8,"i",6),l.wc(9," Export Quests "),l.Pb(),l.Qb(10,"label",4),l.Mb(11,"input",7),l.Mb(12,"i",6),l.wc(13," Export Articles "),l.Pb(),l.Qb(14,"label",4),l.Mb(15,"input",8),l.Mb(16,"i",6),l.wc(17," Export Entity Types "),l.Pb(),l.vc(18,pt,4,2,"label",9),l.Pb(),l.Qb(19,"a",10),l.Mb(20,"i",11),l.wc(21," Export "),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(5),l.ec("formGroup",t.formGroup),l.Ab(13),l.ec("ngForOf",t.conceptTypes),l.Ab(1),l.ec("href",t.exportLink,l.qc))},directives:[te.a,h.n,h.i,h.a,h.m,h.g,I.j],styles:[""]}),ft),vt=s("PSD3"),mt=s.n(vt),gt=s("MICr"),yt=["fupload"];function kt(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Upload Image"),l.Pb())}function wt(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Change Image"),l.Pb())}function Pt(e,t){if(1&e&&(l.Qb(0,"span"),l.wc(1),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.xc(n.file.name)}}function It(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",10),l.Xb("click",function(){return l.oc(n),l.Zb().clearImage()}),l.wc(1," Clear Image "),l.Pb()}}function Ct(e,t){if(1&e&&(l.Qb(0,"div",11),l.Mb(1,"div",12),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.tc("width",n.uploadProgress+"%")}}function xt(e,t){if(1&e&&l.Mb(0,"img",13),2&e){var n=l.Zb();l.ec("src",n.imageURL,l.qc)}}function Qt(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",14),l.Qb(1,"button",15),l.Xb("click",function(){return l.oc(n),l.Zb().clearError()}),l.Pb(),l.wc(2),l.Pb()}if(2&e){var i=l.Zb();l.Ab(2),l.yc(" ",i.fileError,"\n")}}var At,Tt=function(e){return{"drag-over":e}},Et=((At=function(){function e(t,n){d(this,e),this.loginService=t,this.campaignService=n,this.file=null,this.fileError=null,this.isDragOver=!1,this.isUploading=!1,this.uploadProgress=null,this.eleId=""}return p(e,[{key:"ngOnInit",value:function(){}},{key:"ngAfterViewInit",value:function(){var e=this;["dragenter","dragover"].forEach(function(t){return e.fupload.nativeElement.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.isDragOver=!0})}),["dragleave","dragend","drop"].forEach(function(t){return e.fupload.nativeElement.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation(),e.isDragOver=!1})}),this.fupload.nativeElement.addEventListener("drop",function(t){t.dataTransfer.files.length>0&&e.handleFileUpload(t.dataTransfer.files[0])})}},{key:"writeValue",value:function(e){this.imageId=e}},{key:"registerOnChange",value:function(e){this._onChange=e}},{key:"registerOnTouched",value:function(e){this._onTouched=e}},{key:"setDisabledState",value:function(e){}},{key:"clearImage",value:function(){this.writeValue(null)}},{key:"clearError",value:function(){this.fileError=null}},{key:"onFileChange",value:function(e){var t=e.target.files;t.length>0&&this.handleFileUpload(t[0])}},{key:"imageURL",get:function(){return this.imageId?"https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/".concat(this.imageId):null}},{key:"handleFileUpload",value:function(e){var t=this;if(this.fileError=null,this.uploadProgress=null,e.type.startsWith("image/")){this.file=e;var n=new FormData;n.append("file",this.file),this.campaignService.campaign&&n.append("campaignId",this.campaignService.campaign.id);var i=new XMLHttpRequest;i.open("POST","".concat(k.a.apiURL,"/upload"),!0),i.setRequestHeader("Authorization","Bearer ".concat(this.loginService.token)),i.onload=function(e){var n=JSON.parse(i.responseText);t.isUploading=!1,t.file=null,t.writeValue(n.public_id),t._onChange&&t._onChange(n.public_id)},i.upload.addEventListener("progress",function(e){t.uploadProgress=e.loaded/e.total*100}),this.isUploading=!0,i.send(n)}else this.fileError="Incorrect file type! Only images are accepted"}},{key:"controlId",get:function(){return"file-upload-".concat(this.eleId)}}]),e}()).\u0275fac=function(e){return new(e||At)(l.Lb(E.a),l.Lb(P.b))},At.\u0275cmp=l.Fb({type:At,selectors:[["dd-image-upload"]],viewQuery:function(e,t){var n;1&e&&l.Ac(yt,3),2&e&&l.lc(n=l.Yb())&&(t.fupload=n.first)},inputs:{eleId:"eleId"},features:[l.zb([{provide:h.l,useExisting:Object(l.U)(function(){return At}),multi:!0}])],decls:12,vars:12,consts:[[1,"form-group"],["id","drop-area",1,"p-2",3,"ngClass"],["fupload",""],["type","file","accept","image/*",1,"file-input",3,"id","change"],[1,"btn","btn-sm","text-ellipsis",3,"for"],[4,"ngIf"],["class","btn btn-error btn-sm mt-2",3,"click",4,"ngIf"],["class","bar bar-sm mt-2",4,"ngIf"],["class","image-preview img-fit-contain mt-2",3,"src",4,"ngIf"],["class","toast toast-error",4,"ngIf"],[1,"btn","btn-error","btn-sm","mt-2",3,"click"],[1,"bar","bar-sm","mt-2"],["role","progressbar",1,"bar-item"],[1,"image-preview","img-fit-contain","mt-2",3,"src"],[1,"toast","toast-error"],[1,"btn","btn-clear","float-right",3,"click"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1,2),l.Qb(3,"input",3),l.Xb("change",function(e){return t.onFileChange(e)}),l.Pb(),l.Qb(4,"label",4),l.vc(5,kt,2,0,"span",5),l.vc(6,wt,2,0,"span",5),l.vc(7,Pt,2,1,"span",5),l.Pb(),l.vc(8,It,2,0,"button",6),l.vc(9,Ct,2,2,"div",7),l.vc(10,xt,1,1,"img",8),l.Pb(),l.Pb(),l.vc(11,Qt,3,1,"div",9)),2&e&&(l.Ab(1),l.ec("ngClass",l.ic(10,Tt,t.isDragOver)),l.Ab(2),l.ec("id",t.controlId),l.Ab(1),l.ec("for",t.controlId),l.Ab(1),l.ec("ngIf",null===t.file&&null===t.imageURL),l.Ab(1),l.ec("ngIf",null===t.file&&null!==t.imageURL),l.Ab(1),l.ec("ngIf",null!==t.file),l.Ab(1),l.ec("ngIf",null!==t.imageURL),l.Ab(1),l.ec("ngIf",t.isUploading),l.Ab(1),l.ec("ngIf",null!==t.imageURL),l.Ab(1),l.ec("ngIf",null!==t.fileError))},directives:[I.i,I.k],styles:["#drop-area[_ngcontent-%COMP%]{border:2px dashed #5755d9;border-radius:.1rem;display:flex;align-content:center;justify-content:center;flex-direction:column}.form-group.has-error[_ngcontent-%COMP%] > #drop-area[_ngcontent-%COMP%]{border:2px dashed #e85600}#drop-area.drag-over[_ngcontent-%COMP%]{cursor:pointer;background:#f1f1fc}.file-input[_ngcontent-%COMP%]{display:none}.image-preview[_ngcontent-%COMP%]{height:10vh}"]}),At);function Rt(e,t){1&e&&(l.Qb(0,"div",11),l.Qb(1,"label",9),l.wc(2,"Image"),l.Pb(),l.Mb(3,"dd-image-upload",12),l.Pb())}function Lt(e,t){1&e&&(l.Qb(0,"p",13),l.wc(1," A name is required "),l.Pb())}function Mt(e,t){1&e&&(l.Qb(0,"p",13),l.wc(1," The name cannot be shorter than 3 characters "),l.Pb())}function St(e,t){1&e&&(l.Qb(0,"p",13),l.wc(1," The name cannot be longer than 30 characters "),l.Pb())}var Ot,Nt,_t=function(e){return{"has-error":e}},Ft=((Ot=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){this.formGroup.addControl("name",new h.e(this.campaign?this.campaign.name:null,[h.v.required,h.v.maxLength(30),h.v.minLength(2)])),this.formGroup.addControl("content",new h.e(this.campaign?this.campaign.content:null)),this.formGroup.addControl("imageId",new h.e(this.includeImage?""!==this.campaign.imageId&&this.campaign?this.campaign.imageId:null:"placeholder",[h.v.required]))}},{key:"name",get:function(){return this.formGroup.get("name")}},{key:"description",get:function(){return this.formGroup.get("description")}}]),e}()).\u0275fac=function(e){return new(e||Ot)},Ot.\u0275cmp=l.Fb({type:Ot,selectors:[["dd-campaign-form"]],inputs:{formGroup:"formGroup",campaign:"campaign",includeImage:"includeImage"},decls:15,vars:8,consts:[[1,"container","grid-xl",3,"formGroup"],[1,"columns"],["class","column col-3 col-md-12 col-mx-auto",4,"ngIf"],[1,"column","col-9","col-md-12"],[1,"form-group",3,"ngClass"],["for","name",1,"form-label"],["type","text","name","name","formControlName","name","id","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],[1,"form-group"],[1,"form-label"],["simple","true","formControlName","content","placeholder","Description"],[1,"column","col-3","col-md-12","col-mx-auto"],["formControlName","imageId"],[1,"form-input-hint"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.vc(2,Rt,4,0,"div",2),l.Qb(3,"div",3),l.Qb(4,"div",4),l.Qb(5,"label",5),l.wc(6,"Name"),l.Pb(),l.Mb(7,"input",6),l.vc(8,Lt,2,0,"p",7),l.vc(9,Mt,2,0,"p",7),l.vc(10,St,2,0,"p",7),l.Pb(),l.Qb(11,"div",8),l.Qb(12,"label",9),l.wc(13,"Description"),l.Pb(),l.Mb(14,"dd-quill",10),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.ec("formGroup",t.formGroup),l.Ab(2),l.ec("ngIf",t.includeImage),l.Ab(2),l.ec("ngClass",l.ic(6,_t,t.name.invalid&&(t.name.dirty||t.name.touched))),l.Ab(4),l.ec("ngIf",t.name.invalid&&(t.name.dirty||t.name.touched)&&t.name.errors.required),l.Ab(1),l.ec("ngIf",t.name.invalid&&(t.name.dirty||t.name.touched)&&t.name.errors.minlength),l.Ab(1),l.ec("ngIf",t.name.invalid&&(t.name.dirty||t.name.touched)&&t.name.errors.maxlength))},directives:[h.n,h.i,I.k,I.i,h.b,h.m,h.g,fe.a,Et],styles:[""]}),Ot),Ut=[300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3],qt=[1e3,2250,3750,5500,7500,1e4,13e3,16500,20500,26e3,32e3,39e3,47e3,57e3,69e3,83e3,99e3,119e3,143e3,175e3,21e4,255e3,31e4,375e3,45e4,55e4,675e3,825e3,1e6],Gt=((Nt=function(){function e(){d(this,e)}return p(e,[{key:"getPresets",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[{name:"DnD 5E",xpTable:Ut},{name:"DnD 4E",xpTable:qt}]);case 1:case"end":return e.stop()}},e)}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}}]),e}()).\u0275fac=function(e){return new(e||Nt)},Nt.\u0275prov=l.Hb({token:Nt,factory:Nt.\u0275fac,providedIn:"root"}),Nt),Dt=["presets"];function Zt(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",16),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb().usePreset(e)}),l.Qb(1,"h6"),l.wc(2),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(2),l.xc(i.name)}}function Xt(e,t){1&e&&(l.Qb(0,"p",20),l.wc(1," XP value must be more than the previous level "),l.Pb())}function jt(e,t){1&e&&(l.Qb(0,"p",20),l.wc(1," XP value is required "),l.Pb())}function Ht(e,t){1&e&&(l.Qb(0,"p",20),l.wc(1," XP value must be more than 0 "),l.Pb())}function Vt(e,t){1&e&&(l.Qb(0,"p",20),l.wc(1," The max xp value is 2,147,483,647 "),l.Pb())}var $t=function(e){return{"has-error":e}};function Bt(e,t){if(1&e&&(l.Qb(0,"div",17),l.Qb(1,"div",6),l.Qb(2,"label",7),l.wc(3),l.Pb(),l.Pb(),l.Qb(4,"div",8),l.Mb(5,"input",18),l.vc(6,Xt,2,0,"p",19),l.vc(7,jt,2,0,"p",19),l.vc(8,Ht,2,0,"p",19),l.vc(9,Vt,2,0,"p",19),l.Pb(),l.Pb()),2&e){var n=t.index,i=l.Zb();l.ec("ngClass",l.ic(7,$t,i.hasOrderError(n)||i.controls[n].invalid&&(i.controls[n].dirty||i.controls[n].touched))),l.Ab(3),l.yc("Level ",n+2,""),l.Ab(2),l.ec("formControlName",n),l.Ab(1),l.ec("ngIf",i.hasOrderError(n)),l.Ab(1),l.ec("ngIf",i.controls[n].invalid&&(i.controls[n].dirty||i.controls[n].touched)&&i.controls[n].errors.required),l.Ab(1),l.ec("ngIf",i.controls[n].invalid&&(i.controls[n].dirty||i.controls[n].touched)&&i.controls[n].errors.min),l.Ab(1),l.ec("ngIf",i.controls[n].invalid&&(i.controls[n].dirty||i.controls[n].touched)&&i.controls[n].errors.max)}}var zt,Yt=function(e){for(var t=0,n={},i=0;i<e.value.length;i++)e.value[i]&&(e.value[i]>t?t=e.value[i]:n["order-".concat(i)]=!0);return Object.keys(n).length>0?n:null},Wt=((zt=function(){function e(t){d(this,e),this.presets=t}return p(e,[{key:"ngOnInit",value:function(){var e=this;if(!this.campaign)throw new Error("The param campaign is required!");this.presets.getPresets().then(function(t){return e.presetList=t}),this.formGroup.addControl("experienceTable",new h.c(this.campaign.experienceTable.map(function(t){return e.createRow(t)}),Yt))}},{key:"createRow",value:function(e){return new h.e(e||0,[h.v.required,h.v.min(0)])}},{key:"usePreset",value:function(e){var t=this;this.formArray.controls=e.xpTable.map(function(e){return t.createRow(e)}),this.presetsModal.close(null)}},{key:"addRow",value:function(){this.formArray.push(this.createRow())}},{key:"removeRow",value:function(){this.formArray.removeAt(this.controls.length-1)}},{key:"hasOrderError",value:function(e){return this.formArray.errors&&this.formArray.errors["order-".concat(e)]}},{key:"formArray",get:function(){return this.formGroup.get("experienceTable")}},{key:"controls",get:function(){return this.formArray.controls}}]),e}()).\u0275fac=function(e){return new(e||zt)(l.Lb(Gt))},zt.\u0275cmp=l.Fb({type:zt,selectors:[["dd-experience-table-editor"]],viewQuery:function(e,t){var n;1&e&&l.Ac(Dt,3),2&e&&l.lc(n=l.Yb())&&(t.presetsModal=n.first)},inputs:{campaign:"campaign",formGroup:"formGroup"},decls:23,vars:4,consts:[["presets",""],["modal-header",""],["modal-body",""],["class","card p-1 hoverable mb-2",3,"click",4,"ngFor","ngForOf"],[1,"form-horizontal",3,"formGroup"],[1,"form-group"],[1,"col-1","col-lg-2","col-sm-12"],[1,"form-label","text-bold"],[1,"col-11","col-lg-10","col-sm-12"],["type","number","value","0","disabled","",1,"form-input"],["class","form-group","formArrayName","experienceTable",3,"ngClass",4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"btn","btn-sm","ml-2",3,"click"],[1,"btn","btn-sm","btn-error","ml-2",3,"disabled","click"],[1,"icon","icon-cross"],[1,"card","p-1","hoverable","mb-2",3,"click"],["formArrayName","experienceTable",1,"form-group",3,"ngClass"],["type","number","placeholder","XP",1,"form-input",3,"formControlName"],["class","form-input-hint",4,"ngIf"],[1,"form-input-hint"]],template:function(e,t){if(1&e){var n=l.Rb();l.Qb(0,"dd-modal",null,0),l.Qb(2,"div",1),l.Qb(3,"h5"),l.wc(4,"Experience Table Presets"),l.Pb(),l.Pb(),l.Qb(5,"div",2),l.vc(6,Zt,3,1,"div",3),l.Pb(),l.Pb(),l.Qb(7,"div",4),l.Qb(8,"div",5),l.Qb(9,"div",6),l.Qb(10,"label",7),l.wc(11,"Level 1"),l.Pb(),l.Pb(),l.Qb(12,"div",8),l.Mb(13,"input",9),l.Pb(),l.Pb(),l.vc(14,Bt,10,9,"div",10),l.Pb(),l.Qb(15,"button",11),l.Xb("click",function(){return t.addRow()}),l.Mb(16,"i",12),l.wc(17," Add Level\n"),l.Pb(),l.Qb(18,"button",13),l.Xb("click",function(){return l.oc(n),l.mc(1).open()}),l.wc(19,"Use Preset"),l.Pb(),l.Qb(20,"button",14),l.Xb("click",function(){return t.removeRow()}),l.Mb(21,"i",15),l.wc(22," Remove Level\n"),l.Pb()}2&e&&(l.Ab(6),l.ec("ngForOf",t.presetList),l.Ab(1),l.ec("formGroup",t.formGroup),l.Ab(7),l.ec("ngForOf",t.controls),l.Ab(6),l.ec("disabled",0===t.controls.length))},directives:[te.a,I.j,h.n,h.i,h.d,I.i,h.q,h.b,h.m,h.g,I.k],styles:[""]}),zt);function Kt(e,t){1&e&&l.Mb(0,"div",24)}function Jt(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",10),l.Qb(1,"div",2),l.vc(2,Kt,1,0,"div",11),l.Qb(3,"div",12),l.Mb(4,"i",13),l.Pb(),l.Qb(5,"div",14),l.Qb(6,"div",15),l.Qb(7,"label",16),l.wc(8,"Name"),l.Pb(),l.Mb(9,"input",17),l.Pb(),l.Pb(),l.Qb(10,"div",14),l.Qb(11,"div",15),l.Qb(12,"label",16),l.wc(13,"Value"),l.Pb(),l.Mb(14,"input",18),l.Pb(),l.Pb(),l.Qb(15,"div",14),l.Qb(16,"div",15),l.Qb(17,"label",19),l.wc(18,"Conversion"),l.Pb(),l.Qb(19,"label",20),l.Mb(20,"input",21),l.Mb(21,"i",9),l.wc(22," Use in conversions "),l.Pb(),l.Pb(),l.Pb(),l.Qb(23,"div",3),l.Qb(24,"label",19),l.wc(25,"Remove"),l.Pb(),l.Qb(26,"button",22),l.Xb("click",function(){l.oc(n);var e=t.index;return l.Zb().removeCurrencyLevel(e)}),l.Mb(27,"i",23),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=t.index;l.ec("formGroup",t.$implicit),l.Ab(7),l.gc("for","cm-name-",i,""),l.Ab(2),l.gc("id","cm-name-",i,""),l.Ab(3),l.gc("for","cm-value-",i,""),l.Ab(2),l.gc("id","cm-value-",i,"")}}var en,tn=((en=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){this.items=new h.c(this.campaign.currencyMap?this.campaign.currencyMap.map(this.getFormGroup):[{name:"gp",value:1,useInConversions:!0},{name:"cp",value:.01,useInConversions:!0},{name:"sp",value:.1,useInConversions:!0},{name:"pp",value:10,useInConversions:!1}].map(this.getFormGroup)),this.formGroup.addControl("currencyMap",this.items),this.formGroup.addControl("trackCoins",new h.e(this.campaign.trackCoins||!1))}},{key:"getFormGroup",value:function(e){return new h.h({name:new h.e(e.name,[h.v.required,h.v.maxLength(20)]),value:new h.e(e.value,[h.v.required,h.v.min(.01)]),useInConversions:new h.e(e.useInConversions)})}},{key:"removeCurrencyLevel",value:function(e){this.items.removeAt(e),0===this.items.length&&this.items.push(this.getFormGroup({name:"gp",value:1,useInConversions:!0})),this.formGroup.markAsDirty()}},{key:"addCurrencyLevel",value:function(){this.items.push(this.getFormGroup({name:null,value:null,useInConversions:!0})),this.formGroup.markAsDirty()}},{key:"drop",value:function(e){var t=this.items.at(e.previousIndex);this.items.removeAt(e.previousIndex),this.items.insert(e.currentIndex,t)}},{key:"controls",get:function(){return this.items.controls}},{key:"trackCoins",get:function(){return this.formGroup.get("trackCoins")}}]),e}()).\u0275fac=function(e){return new(e||en)},en.\u0275cmp=l.Fb({type:en,selectors:[["dd-currency-map-editor"]],inputs:{formGroup:"formGroup",campaign:"campaign"},decls:13,vars:2,consts:[["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",3,"formGroup",4,"ngFor","ngForOf"],[1,"columns"],[1,"column","col-auto"],[1,"btn","btn-sm","mt-2",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"form-checkbox","mt-2"],["type","checkbox",3,"formControl"],[1,"form-icon"],["cdkDrag","",3,"formGroup"],["class","drag-placeholder",4,"cdkDragPlaceholder"],["cdkDragHandle","",1,"column","col-auto","c-move"],[1,"icon","icon-resize-vert"],[1,"column"],[1,"form-group"],[1,"form-label",3,"for"],["type","text","name","name","formControlName","name",1,"form-input",3,"id"],["type","number","name","name","formControlName","value","step","0.01",1,"form-input",3,"id"],[1,"form-label"],[1,"form-checkbox"],["type","checkbox","formControlName","useInConversions"],[1,"btn","btn-sm","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"drag-placeholder"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Xb("cdkDropListDropped",function(e){return t.drop(e)}),l.vc(1,Jt,28,5,"div",1),l.Qb(2,"div",2),l.Qb(3,"div",3),l.Qb(4,"button",4),l.Xb("click",function(){return t.addCurrencyLevel()}),l.Mb(5,"i",5),l.Qb(6,"span",6),l.wc(7," Add Level"),l.Pb(),l.Pb(),l.Pb(),l.Qb(8,"div",3),l.Qb(9,"label",7),l.Mb(10,"input",8),l.Mb(11,"i",9),l.wc(12," Track individual coins "),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(1),l.ec("ngForOf",t.controls),l.Ab(9),l.ec("formControl",t.trackCoins))},directives:[b.d,I.j,h.a,h.m,h.f,b.a,h.n,h.i,b.c,b.b,h.b,h.g,h.q],styles:[""]}),en),nn=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},rn=["exporter"];function cn(e,t){if(1&e&&l.Mb(0,"dd-exporter",3,4),2&e){var n=l.Zb();l.ec("conceptTypes",n.campaign.conceptTypes)}}function on(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",17),l.Xb("click",function(){l.oc(n);var e=l.Zb(2);return e.expandXPTable=!e.expandXPTable}),l.wc(1," Expand "),l.Mb(2,"i",24),l.Pb()}}function an(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",17),l.Xb("click",function(){l.oc(n);var e=l.Zb(2);return e.expandXPTable=!e.expandXPTable}),l.wc(1," Collapse "),l.Mb(2,"i",25),l.Pb()}}function sn(e,t){1&e&&(l.Qb(0,"span",26),l.wc(1,"This is the experience table. This will determine entities' levels based on the amount of XP they have. For example, if level 2 was set to 30 XP, an entity would be level 2 when they reach 30 or above XP."),l.Pb())}function un(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Collapse "),l.Mb(2,"i",25),l.Pb())}function ln(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Expand "),l.Mb(2,"i",24),l.Pb())}function dn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",13),l.Qb(1,"div",7),l.Qb(2,"h3"),l.wc(3,"Entity Types"),l.Pb(),l.Pb(),l.Qb(4,"div",27),l.Qb(5,"button",17),l.Xb("click",function(){return l.oc(n),l.Zb(2).createEntityPreset()}),l.Mb(6,"i",28),l.Qb(7,"span",29),l.wc(8," New Entity Type"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}}function bn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",30),l.Qb(1,"div",31),l.Mb(2,"i",32),l.Pb(),l.Qb(3,"p",33),l.wc(4,"There are no entity types :("),l.Pb(),l.Qb(5,"p",34),l.wc(6,"Click the button to create one"),l.Pb(),l.Qb(7,"div",35),l.Qb(8,"button",36),l.Xb("click",function(){return l.oc(n),l.Zb(2).createEntityPreset()}),l.wc(9," Create Type "),l.Pb(),l.Pb(),l.Pb()}}function pn(e,t){if(1&e&&(l.Qb(0,"div",27),l.Qb(1,"figure",41),l.Mb(2,"img",42),l.Pb(),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(2),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.imageId,"",l.qc)}}function fn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",38),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(3).selectEntityPreset(e)}),l.Qb(1,"div",6),l.vc(2,pn,3,1,"div",39),l.Qb(3,"div",7),l.Qb(4,"h4",40),l.wc(5),l.Pb(),l.Qb(6,"span",26),l.wc(7),l.ac(8,"truncate"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(2),l.ec("ngIf",i.imageId),l.Ab(3),l.xc(i.name),l.Ab(2),l.xc(l.bc(8,3,i.description,120))}}function hn(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,fn,9,6,"div",37),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("ngForOf",n.campaign.entityPresets)}}function vn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",13),l.Qb(1,"div",7),l.Qb(2,"h3"),l.wc(3,"Concept Types"),l.Pb(),l.Pb(),l.Qb(4,"div",27),l.Qb(5,"button",17),l.Xb("click",function(){return l.oc(n),l.Zb(2).createConceptType()}),l.Mb(6,"i",28),l.Qb(7,"span",29),l.wc(8," New Concept Type"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}}function mn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",30),l.Qb(1,"div",31),l.Mb(2,"i",32),l.Pb(),l.Qb(3,"p",33),l.wc(4,"There are no concept types :("),l.Pb(),l.Qb(5,"p",34),l.wc(6,"Click the button to create one"),l.Pb(),l.Qb(7,"div",35),l.Qb(8,"button",36),l.Xb("click",function(){return l.oc(n),l.Zb(2).createConceptType()}),l.wc(9," Create Concept Type "),l.Pb(),l.Pb(),l.Pb()}}function gn(e,t){if(1&e&&(l.Qb(0,"div",27),l.Mb(1,"img",43),l.Pb()),2&e){var n=l.Zb().$implicit,i=l.Zb(3);l.Ab(1),l.fc("src",i.getIcon(n.icon),l.qc)}}function yn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",38),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(3).selectConceptType(e)}),l.Qb(1,"div",6),l.vc(2,gn,2,1,"div",39),l.Qb(3,"div",7),l.Qb(4,"h4",40),l.wc(5),l.Pb(),l.Qb(6,"span",26),l.wc(7),l.ac(8,"truncate"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(2),l.ec("ngIf",i.icon),l.Ab(3),l.xc(i.name),l.Ab(2),l.xc(l.bc(8,3,i.description,120))}}function kn(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,yn,9,6,"div",37),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("ngForOf",n.campaign.conceptTypes)}}function wn(e,t){1&e&&(l.Qb(0,"h3",44),l.wc(1,"Other Stuff"),l.Pb())}var Pn=function(e){return{loading:e}};function In(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",45),l.Qb(1,"div",46),l.Qb(2,"button",36),l.Xb("click",function(){return l.oc(n),l.Zb(2).export()}),l.Mb(3,"i",47),l.wc(4," Export Data "),l.Pb(),l.Qb(5,"label",48),l.Mb(6,"i",49),l.wc(7," Import Data "),l.Qb(8,"input",50),l.Xb("change",function(e){return l.oc(n),l.Zb(2).import(e)}),l.Pb(),l.Pb(),l.Pb(),l.Qb(9,"div",46),l.Qb(10,"h4",51),l.wc(11,"Danger!"),l.Pb(),l.Qb(12,"button",52),l.Xb("click",function(){return l.oc(n),l.Zb(2).delete()}),l.Mb(13,"i",53),l.wc(14," Delete Campaign "),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(5),l.ec("ngClass",l.ic(2,Pn,i.importing)),l.Ab(7),l.ec("ngClass",l.ic(4,Pn,i.deleting))}}function Cn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",5),l.Qb(1,"div",6),l.Qb(2,"div",7),l.Qb(3,"h2"),l.wc(4),l.Pb(),l.Pb(),l.Qb(5,"div",8),l.Qb(6,"button",9),l.Xb("click",function(){return l.oc(n),l.Zb().cancel()}),l.wc(7,"Cancel"),l.Pb(),l.Qb(8,"button",10),l.Xb("click",function(){return l.oc(n),l.Zb().save()}),l.wc(9," Save "),l.Pb(),l.Pb(),l.Pb(),l.Qb(10,"h3",11),l.wc(11,"General Settings"),l.Pb(),l.Mb(12,"dd-campaign-form",12),l.Qb(13,"div",13),l.Qb(14,"div",7),l.Qb(15,"h3",11),l.wc(16,"Experience Table"),l.Pb(),l.Pb(),l.Qb(17,"div",8),l.vc(18,on,3,0,"button",14),l.vc(19,an,3,0,"button",14),l.Pb(),l.Pb(),l.vc(20,sn,2,0,"span",15),l.Mb(21,"dd-experience-table-editor",16),l.Qb(22,"div",13),l.Qb(23,"div",7),l.Qb(24,"h3",11),l.wc(25,"Currency Map"),l.Pb(),l.Pb(),l.Qb(26,"div",8),l.Qb(27,"button",17),l.Xb("click",function(){l.oc(n);var e=l.Zb();return e.expandCurrencyMapEditor=!e.expandCurrencyMapEditor}),l.vc(28,un,3,0,"span",18),l.vc(29,ln,3,0,"span",18),l.Pb(),l.Pb(),l.Pb(),l.Mb(30,"dd-currency-map-editor",19),l.vc(31,dn,9,0,"div",20),l.vc(32,bn,10,0,"div",21),l.vc(33,hn,2,1,"div",18),l.vc(34,vn,9,0,"div",20),l.vc(35,mn,10,0,"div",21),l.vc(36,kn,2,1,"div",18),l.vc(37,wn,2,0,"h3",22),l.vc(38,In,15,6,"div",23),l.Pb()}if(2&e){var i=l.Zb();l.Ab(4),l.xc(i.editing?"Settings":"Create Campaign"),l.Ab(4),l.ec("disabled",i.formGroup.invalid||i.formGroup.pristine)("ngClass",l.ic(25,Pn,i.saving)),l.Ab(4),l.ec("campaign",i.campaign)("formGroup",i.formGroup)("includeImage",i.editing),l.Ab(6),l.ec("ngIf",!i.expandXPTable),l.Ab(1),l.ec("ngIf",i.expandXPTable),l.Ab(1),l.ec("ngIf",i.expandXPTable),l.Ab(1),l.ec("campaign",i.campaign)("formGroup",i.formGroup)("hidden",!i.expandXPTable),l.Ab(7),l.ec("ngIf",i.expandCurrencyMapEditor),l.Ab(1),l.ec("ngIf",!i.expandCurrencyMapEditor),l.Ab(1),l.ec("hidden",!i.expandCurrencyMapEditor)("formGroup",i.formGroup)("campaign",i.campaign),l.Ab(1),l.ec("ngIf",i.editing),l.Ab(1),l.ec("ngIf",i.editing&&0===i.campaign.entityPresets.length),l.Ab(1),l.ec("ngIf",i.editing),l.Ab(1),l.ec("ngIf",i.editing),l.Ab(1),l.ec("ngIf",i.editing&&0===i.campaign.conceptTypes.length),l.Ab(1),l.ec("ngIf",i.editing),l.Ab(1),l.ec("ngIf",i.editing),l.Ab(1),l.ec("ngIf",i.editing)}}function xn(e,t){1&e&&l.Mb(0,"div",54)}var Qn,An=((Qn=function(){function e(t,n,i,r,c,o,a,s){d(this,e),this.campaignService=t,this.router=n,this.route=i,this.login=r,this.location=c,this.toast=o,this.http=a,this.iconService=s,this.saving=!1,this.deleting=!1,this.importing=!1,this.expandXPTable=!1,this.expandCurrencyMapEditor=!1}return p(e,[{key:"ngOnInit",value:function(){this.formGroup=new h.h({}),this.expandXPTable=!this.editing,this.expandCurrencyMapEditor=!this.editing,null==this.campaign.experienceTable&&(this.campaign.experienceTable=[]),"true"===this.route.snapshot.queryParamMap.get("refresh")&&(this.campaignService.refreshCurrentCampaign(),this.router.navigate([],{replaceUrl:!0}))}},{key:"canDeactivate",value:function(){return!this.formGroup.dirty}},{key:"selectEntityPreset",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entitytypes",e.id,"edit"])}},{key:"selectConceptType",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepttypes",e.id,"edit"])}},{key:"createEntityPreset",value:function(){return nn(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.router.navigate(["campaigns",this.campaignService.campaign.id,"entitytypes","create"]);case 1:case"end":return e.stop()}},e,this)}))}},{key:"createConceptType",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepttypes","create"])}},{key:"save",value:function(){return nn(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.saving=!0,!this.editing){e.next=15;break}return e.prev=1,t=this.formGroup.value,n={name:t.name,content:t.content,imageId:t.imageId,experienceTable:t.experienceTable,userId:this.login.id,currencyMap:t.currencyMap,trackCoins:t.trackCoins,id:this.campaign.id},e.next=5,this.campaignService.updateCampaign(n);case 5:this.campaignService.campaign=Object.assign(Object.assign({},this.campaign),n),this.formGroup.markAsPristine(),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(1),e.t0;case 12:this.toast.info("Campaign settings updated"),e.next=26;break;case 15:return i=this.formGroup.value,e.prev=16,e.next=19,this.campaignService.createCampaign({name:i.name,content:i.content,imageId:i.imageId,experienceTable:i.experienceTable,currencyMap:i.currencyMap,trackCoins:i.trackCoins,userId:this.login.id,id:""});case 19:r=e.sent,this.router.navigate(["campaigns",r.id,"settings"]),e.next=26;break;case 23:throw e.prev=23,e.t1=e.catch(16),e.t1;case 26:this.saving=!1;case 27:case"end":return e.stop()}},e,this,[[1,9],[16,23]])}))}},{key:"cancel",value:function(){this.location.back()}},{key:"delete",value:function(){return nn(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mt.a.fire({title:"Are you sure?",text:"This will completely delete this campaign and everything that goes along with it. This cannot be undone!",showCancelButton:!0,cancelButtonText:"Back to safety",confirmButtonText:"\u2622\ufe0f Nuke It"});case 2:if(!e.sent.value){e.next=13;break}return this.deleting=!0,e.prev=4,e.next=7,this.campaignService.deleteCampaign(this.campaign);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),e.t0;case 12:this.deleting=!1,this.router.navigate(["home"]);case 13:case"end":return e.stop()}},e,this,[[4,9]])}))}},{key:"export",value:function(){this.exporter.doExport()}},{key:"import",value:function(e){return nn(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.target.files[0],-1===["application/zip","application/x-zip-compressed","multipart/x-zip"].indexOf(n.type)){t.next=13;break}this.importing=!0,t.prev=3,(i=new FormData).append("file",n),i.append("campaignId",this.campaignService.campaign.id),this.http.post("".concat(k.a.apiURL,"/import"),i).subscribe(function(e){var t=e.articles,n=e.entityPresets,i=e.quests,c=e.concepts,o=e.conceptTypes;r.importing=!1,mt.a.fire({title:"All Done!",html:"All done importing the things. Here's how it went:<br/>Articles: ".concat(t,"<br/>Entity Types: ").concat(n,"<br/>Concepts: ").concat(c,"<br/>Quests: ").concat(i,"<br/>ConceptTypes: ").concat(o)}).then(function(){return r.campaignService.refreshCurrentCampaign()})},function(e){throw mt.a.fire({type:"error",title:"Hmm...",text:"Something went wrong during import. Please try again"}),e}),t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(3),t.t0;case 11:t.next=14;break;case 13:mt.a.fire({type:"error",title:"Invalid File Type!",text:"File should be a zip file created from an export"});case 14:case"end":return t.stop()}},t,this,[[3,8]])}))}},{key:"getIcon",value:function(e){return this.iconService.getIconSrc(e)}},{key:"campaign",get:function(){return this.editing?this.campaignService.campaign:{id:"",name:"",content:null,imageId:"",userId:"",experienceTable:[]}}},{key:"editing",get:function(){return this.route.snapshot.data.editing}},{key:"loading",get:function(){return this.campaignService.loadingCampaign}}]),e}()).\u0275fac=function(e){return new(e||Qn)(l.Lb(P.b),l.Lb(w.c),l.Lb(w.a),l.Lb(E.a),l.Lb(I.g),l.Lb(y.b),l.Lb(f.b),l.Lb(gt.a))},Qn.\u0275cmp=l.Fb({type:Qn,selectors:[["dd-campaign-settings"]],viewQuery:function(e,t){var n;1&e&&l.Ac(rn,1),2&e&&l.lc(n=l.Yb())&&(t.exporter=n.first)},decls:3,vars:3,consts:[[3,"conceptTypes",4,"ngIf"],["class","container grid-xl",4,"ngIf"],["class","loading",4,"ngIf"],[3,"conceptTypes"],["exporter",""],[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],[1,"btn","mr-2",3,"click"],[1,"btn","btn-primary",3,"disabled","ngClass","click"],[1,"mb-0"],[3,"campaign","formGroup","includeImage"],[1,"columns","big-space"],["class","btn btn-sm",3,"click",4,"ngIf"],["class","text-gray",4,"ngIf"],[3,"campaign","formGroup","hidden"],[1,"btn","btn-sm",3,"click"],[4,"ngIf"],[3,"hidden","formGroup","campaign"],["class","columns big-space",4,"ngIf"],["class","empty",4,"ngIf"],["class","mb-2 big-space",4,"ngIf"],["class","card p-2",4,"ngIf"],[1,"icon","icon-arrow-down"],[1,"icon","icon-arrow-up"],[1,"text-gray"],[1,"column","col-auto"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["class","card p-2 mb-2 hoverable",3,"click",4,"ngFor","ngForOf"],[1,"card","p-2","mb-2","hoverable",3,"click"],["class","column col-auto",4,"ngIf"],[1,"mb-1"],[1,"avatar","avatar-lg"],[3,"src"],[1,"img-responsive",3,"src"],[1,"mb-2","big-space"],[1,"card","p-2"],[1,"card-body"],[1,"icon","icon-download"],["for","import-button",1,"btn","btn-primary","ml-2",3,"ngClass"],[1,"icon","icon-upload"],["type","file","id","import-button",2,"display","none",3,"change"],[1,"mb-2"],[1,"btn","btn-error",3,"ngClass","click"],[1,"icon","icon-cross"],[1,"loading"]],template:function(e,t){1&e&&(l.vc(0,cn,2,1,"dd-exporter",0),l.vc(1,Cn,39,27,"div",1),l.vc(2,xn,1,0,"div",2)),2&e&&(l.ec("ngIf",t.editing),l.Ab(1),l.ec("ngIf",t.campaign||!t.editing),l.Ab(1),l.ec("ngIf",t.loading))},directives:[I.k,ht,I.i,Ft,h.n,h.i,Wt,tn,I.j],pipes:[g.a],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),Qn),Tn=s("wNqa");function En(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",8),l.Xb("click",function(){return l.oc(n),l.Zb().addQuest()}),l.Mb(1,"i",9),l.Qb(2,"span",10),l.wc(3," Add Quest"),l.Pb(),l.Pb()}}function Rn(e,t){1&e&&l.Mb(0,"div",11)}function Ln(e,t){1&e&&(l.Qb(0,"p",19),l.wc(1," Click the button to create one. "),l.Pb())}function Mn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",20),l.Xb("click",function(){return l.oc(n),l.Zb(2).addQuest()}),l.wc(1," Create Quest "),l.Pb()}}function Sn(e,t){if(1&e&&(l.Qb(0,"div",12),l.Qb(1,"div",13),l.Mb(2,"i",14),l.Pb(),l.Qb(3,"p",15),l.wc(4,"There are no quests here"),l.Pb(),l.vc(5,Ln,2,0,"p",16),l.Qb(6,"div",17),l.vc(7,Mn,2,0,"button",18),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(5),l.ec("ngIf",n.editable),l.Ab(2),l.ec("ngIf",n.editable)}}function On(e,t){1&e&&(l.Qb(0,"div",28),l.Mb(1,"i",29),l.Pb())}function Nn(e,t){1&e&&(l.Qb(0,"div",28),l.Mb(1,"i",30),l.Pb())}function _n(e,t){1&e&&(l.Qb(0,"div",28),l.Mb(1,"i",31),l.Pb())}function Fn(e,t){1&e&&(l.Qb(0,"div",28),l.Mb(1,"i",32),l.Pb())}function Un(e,t){1&e&&(l.Qb(0,"span",33),l.wc(1,"Unavailable"),l.Pb())}function qn(e,t){1&e&&(l.Qb(0,"span",34),l.wc(1,"Hidden"),l.Pb())}var Gn=function(e){return{"text-gray":e}};function Dn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",22),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).viewQuest(e)}),l.Qb(1,"div",23),l.vc(2,On,2,0,"div",24),l.vc(3,Nn,2,0,"div",24),l.vc(4,_n,2,0,"div",24),l.vc(5,Fn,2,0,"div",24),l.Qb(6,"div",2),l.Qb(7,"span",25),l.wc(8),l.Pb(),l.vc(9,Un,2,0,"span",26),l.vc(10,qn,2,0,"span",27),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(2),l.ec("ngIf",1===i.status),l.Ab(1),l.ec("ngIf",2===i.status),l.Ab(1),l.ec("ngIf",3===i.status),l.Ab(1),l.ec("ngIf",4===i.status),l.Ab(2),l.ec("ngClass",l.ic(8,Gn,!i.visible)),l.Ab(1),l.yc(" ",i.name," "),l.Ab(1),l.ec("ngIf",!i.available),l.Ab(1),l.ec("ngIf",!i.visible)}}function Zn(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,Dn,11,10,"div",21),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.quests)}}var Xn,jn=((Xn=function(){function e(t,n,i,r){d(this,e),this.router=t,this.campaignService=n,this.questService=i,this.route=r,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){this.loadQuests()}},{key:"loadQuests",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.questService.getQuests(this.campaignService.campaign.id);case 4:this.quests=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:this.loading=!1;case 11:case"end":return e.stop()}},e,this,[[1,7]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"viewQuest",value:function(e){this.router.navigate([e.id],{relativeTo:this.route})}},{key:"addQuest",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests","create"])}},{key:"editable",get:function(){return this.campaignService.canEdit}}]),e}()).\u0275fac=function(e){return new(e||Xn)(l.Lb(w.c),l.Lb(P.b),l.Lb(Tn.a),l.Lb(w.a))},Xn.\u0275cmp=l.Fb({type:Xn,selectors:[["dd-quest-manager"]],decls:10,vars:4,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-sm",3,"click",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"loading","loading-lg"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],[1,"empty-action"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"empty-subtitle"],[1,"btn","btn-primary",3,"click"],["class","card p-2 mb-2 hoverable",3,"click",4,"ngFor","ngForOf"],[1,"card","p-2","mb-2","hoverable",3,"click"],[1,"columns","col-gapless"],["class","column col-auto mr-1",4,"ngIf"],[3,"ngClass"],["class","label label-rounded",4,"ngIf"],["class","label label-rounded ml-1",4,"ngIf"],[1,"column","col-auto","mr-1"],[1,"icon","icon-stop"],[1,"icon","icon-flag"],[1,"icon","icon-time"],[1,"icon","icon-check"],[1,"label","label-rounded"],[1,"label","label-rounded","ml-1"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"h3"),l.wc(4,"Quests"),l.Pb(),l.Pb(),l.Qb(5,"div",3),l.vc(6,En,4,0,"button",4),l.Pb(),l.Pb(),l.vc(7,Rn,1,0,"div",5),l.vc(8,Sn,8,2,"div",6),l.vc(9,Zn,2,1,"div",7),l.Pb()),2&e&&(l.Ab(6),l.ec("ngIf",t.editable),l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.quests&&0===t.quests.length),l.Ab(1),l.ec("ngIf",t.quests))},directives:[I.k,I.j,I.i],styles:[""]}),Xn);function Hn(e,t){1&e&&l.Mb(0,"div",2)}function Vn(e,t){1&e&&(l.Qb(0,"div",9),l.Mb(1,"i",10),l.Pb())}var $n=function(e){return{"text-gray":e}};function Bn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",4),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).viewQuest(e)}),l.Qb(1,"div",5),l.vc(2,Vn,2,0,"div",6),l.Qb(3,"div",7),l.Qb(4,"span",8),l.wc(5),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(2),l.ec("ngIf",i.active),l.Ab(2),l.ec("ngClass",l.ic(3,$n,!i.visible)),l.Ab(1),l.yc(" ",i.name," ")}}function zn(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,Bn,6,5,"div",3),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.quests)}}var Yn,Wn=((Yn=function(){function e(t,n,i){d(this,e),this.router=t,this.questService=n,this.campaignService=i,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){this.loadQuests()}},{key:"viewQuest",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",e.id])}},{key:"loadQuests",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.questService.getQuests(this.campaignService.campaign.id,null,null,null,null,null,[Tn.b.IN_PROGRESS]);case 4:this.quests=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:this.loading=!1;case 11:case"end":return e.stop()}},e,this,[[1,7]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}}]),e}()).\u0275fac=function(e){return new(e||Yn)(l.Lb(w.c),l.Lb(Tn.a),l.Lb(P.b))},Yn.\u0275cmp=l.Fb({type:Yn,selectors:[["dd-quest-quick-view"]],decls:2,vars:2,consts:[["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],["class","card p-2 hoverable mb-1",3,"click",4,"ngFor","ngForOf"],[1,"card","p-2","hoverable","mb-1",3,"click"],[1,"columns","col-gapless"],["class","column col-auto mr-1",4,"ngIf"],[1,"column"],[3,"ngClass"],[1,"column","col-auto","mr-1"],[1,"icon","icon-flag"]],template:function(e,t){1&e&&(l.vc(0,Hn,1,0,"div",0),l.vc(1,zn,2,1,"div",1)),2&e&&(l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.quests))},directives:[I.k,I.j,I.i],styles:[""]}),Yn);function Kn(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",4),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).selectDie(e)}),l.Mb(1,"img",5),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("src",i.src,l.qc)}}function Jn(e,t){if(1&e&&(l.Qb(0,"div",2),l.vc(1,Kn,2,1,"div",3),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.diceOptions)}}var ei=function(e,t){return{"col-12":e,"col-4 col-md-2 col-sm-4":t}};function ti(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",7),l.Qb(1,"button",8),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).selectDieCount(e)}),l.wc(2),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.ec("ngClass",l.jc(2,ei,1===i,1!==i)),l.Ab(2),l.yc(" ",i," ")}}function ni(e,t){if(1&e&&(l.Qb(0,"div",2),l.vc(1,ti,3,5,"div",6),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.dieCountOptions)}}var ii=function(e){return{"rotate-scale-up":e}};function ri(e,t){if(1&e&&(l.Qb(0,"div",17),l.Mb(1,"img",18),l.Qb(2,"div",19),l.wc(3),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(2);l.Ab(1),l.ec("ngClass",l.ic(3,ii,n.rollValue===n.dieValue))("src",i.die.src,l.qc),l.Ab(2),l.yc(" ",n.rollValue," ")}}function ci(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",2),l.Qb(1,"div",9),l.Qb(2,"h4"),l.wc(3),l.Pb(),l.Pb(),l.vc(4,ri,4,5,"div",10),l.Qb(5,"div",11),l.Qb(6,"button",12),l.Xb("click",function(){return l.oc(n),l.Zb().reset()}),l.Mb(7,"i",13),l.Qb(8,"span",14),l.wc(9," Reset"),l.Pb(),l.Pb(),l.Qb(10,"button",15),l.Xb("click",function(){return l.oc(n),l.Zb().roll()}),l.Mb(11,"i",16),l.Qb(12,"span",14),l.wc(13," Roll Again"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(3),l.xc(i.resultTotal),l.Ab(1),l.ec("ngForOf",i.rollResults)}}var oi,ai=((oi=function(){function e(){d(this,e),this.diceOptions=[{n:4,src:"/assets/dice/d4.png"},{n:6,src:"/assets/dice/d6.png"},{n:8,src:"/assets/dice/d8.png"},{n:10,src:"/assets/dice/d10.png"},{n:12,src:"/assets/dice/d12.png"},{n:20,src:"/assets/dice/d20.png"}],this.dieCountOptions=[1,2,3,4,5,6,7,8,9,10,12]}return p(e,[{key:"ngOnInit",value:function(){}},{key:"selectDie",value:function(e){this.die=e}},{key:"selectDieCount",value:function(e){this.dieCount=e,this.roll()}},{key:"roll",value:function(){for(var e=[],t=new R.Chance,n=0;n<this.dieCount;n++){var i=t.integer({min:1,max:this.die.n});e.push({dieValue:this.die.n,rollValue:i})}this.rollResults=e}},{key:"reset",value:function(){this.die=void 0,this.dieCount=void 0,this.rollResults=void 0}},{key:"resultTotal",get:function(){return this.rollResults?this.rollResults.map(function(e){return e.rollValue}).reduce(function(e,t){return e+t}):0}}]),e}()).\u0275fac=function(e){return new(e||oi)},oi.\u0275cmp=l.Fb({type:oi,selectors:[["dd-quick-dice"]],decls:4,vars:3,consts:[[1,"card","p-1"],["class","columns",4,"ngIf"],[1,"columns"],["class","column col-4 col-md-2 col-sm-4 text-center hoverable",3,"click",4,"ngFor","ngForOf"],[1,"column","col-4","col-md-2","col-sm-4","text-center","hoverable",3,"click"],["width","45",3,"src"],["class","column mb-1",3,"ngClass",4,"ngFor","ngForOf"],[1,"column","mb-1",3,"ngClass"],[1,"btn","btn-primary","w-100",3,"click"],[1,"column","text-center","col-12"],["class","column col-4 col-md-2 col-sm-4 col-mx-auto mb-1 text-center",4,"ngFor","ngForOf"],[1,"column","col-12","text-center"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[1,"btn","btn-sm","ml-2",3,"click"],[1,"icon","icon-refresh"],[1,"column","col-4","col-md-2","col-sm-4","col-mx-auto","mb-1","text-center"],["width","24",3,"ngClass","src"],[1,"text-bold"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,Jn,2,1,"div",1),l.vc(2,ni,2,1,"div",1),l.vc(3,ci,14,2,"div",1),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",!t.die),l.Ab(1),l.ec("ngIf",t.die&&!t.dieCount),l.Ab(1),l.ec("ngIf",t.rollResults))},directives:[I.k,I.j,I.i],styles:[".rotate-scale-up[_ngcontent-%COMP%]{-webkit-animation:rotate-scale-up .65s cubic-bezier(.165,.84,.44,1) infinite both;animation:rotate-scale-up .65s cubic-bezier(.165,.84,.44,1) infinite both}@-webkit-keyframes rotate-scale-up{0%{transform:scale(1) rotate(0)}50%{transform:scale(1.4) rotate(180deg)}to{transform:scale(1) rotate(1turn)}}@keyframes rotate-scale-up{0%{transform:scale(1) rotate(0)}50%{transform:scale(1.4) rotate(180deg)}to{transform:scale(1) rotate(1turn)}}"]}),oi),si=function(e,t){return["/campaigns",e,"entities",t,"create"]};function ui(e,t){if(1&e&&(l.Qb(0,"li",24),l.Qb(1,"a",25),l.wc(2),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(2);l.Ab(1),l.ec("routerLink",l.jc(2,si,i.campaign.id,n.id)),l.Ab(1),l.yc("Create ",n.name,"")}}var li=function(e){return["/campaigns",e,"settings"]};function di(e,t){if(1&e&&(l.Qb(0,"li",24),l.Qb(1,"a",25),l.wc(2,"Settings"),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("routerLink",l.ic(1,li,n.campaign.id))}}function bi(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",26),l.Qb(1,"button",27),l.Xb("click",function(){return l.oc(n),l.Zb(2).manageMembers()}),l.Qb(2,"span",28),l.wc(3,"Manage "),l.Pb(),l.Mb(4,"i",29),l.Pb(),l.Pb()}}function pi(e,t){if(1&e){var n=l.Rb();l.Qb(0,"span",38),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(3).selectEntity(e)}),l.Mb(1,"img",39),l.wc(2),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",i.imageId,"",l.qc),l.Ab(1),l.yc(" ",i.name," ")}}function fi(e,t){if(1&e&&(l.Qb(0,"div",30),l.Qb(1,"div",31),l.Qb(2,"figure",32),l.Mb(3,"img",33),l.Pb(),l.Pb(),l.Qb(4,"div",34),l.Qb(5,"div",35),l.wc(6),l.Pb(),l.Qb(7,"div",36),l.vc(8,pi,3,2,"span",37),l.Pb(),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(2);l.Ab(3),l.ec("src",n.user.pictureURL,l.qc),l.Ab(3),l.xc(n.user.username),l.Ab(2),l.ec("ngForOf",i.userEntities(n.user.id))}}function hi(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",26),l.Qb(1,"button",27),l.Xb("click",function(){return l.oc(n),l.Zb(2).manageQuests()}),l.Qb(2,"span",28),l.wc(3,"Manage "),l.Pb(),l.Mb(4,"i",29),l.Pb(),l.Pb()}}var vi=function(e,t){return["/campaigns",e,"concepts",t,"manage"]},mi=function(e){return{"mb-2":e}};function gi(e,t){if(1&e&&(l.Qb(0,"button",42),l.wc(1),l.Pb()),2&e){var n=t.$implicit,i=t.index,r=l.Zb(3);l.ec("routerLink",l.jc(3,vi,r.campaign.id,n.id))("ngClass",l.ic(6,mi,i!==r.campaign.conceptTypes.length-1)),l.Ab(1),l.yc(" ",n.pluralForm," ")}}function yi(e,t){if(1&e&&(l.Qb(0,"div",40),l.vc(1,gi,2,8,"button",41),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("ngForOf",n.campaign.conceptTypes)}}function ki(e,t){if(1&e&&(l.Qb(0,"div",1),l.Qb(1,"div",2),l.Qb(2,"div",3),l.Qb(3,"h1"),l.wc(4),l.Pb(),l.Pb(),l.Qb(5,"div",4),l.Qb(6,"h3"),l.wc(7),l.Pb(),l.Pb(),l.Qb(8,"div",5),l.Qb(9,"div",6),l.Qb(10,"button",7),l.wc(11,"Menu "),l.Mb(12,"i",8),l.Pb(),l.Qb(13,"ul",9),l.vc(14,ui,3,5,"li",10),l.vc(15,di,3,3,"li",11),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Qb(16,"div",2),l.Qb(17,"div",12),l.Mb(18,"dd-quill",13),l.Pb(),l.Qb(19,"div",14),l.Qb(20,"div",15),l.Qb(21,"div",16),l.Qb(22,"div",2),l.Qb(23,"div",17),l.Qb(24,"h5"),l.wc(25,"Members"),l.Pb(),l.Pb(),l.vc(26,bi,5,0,"div",18),l.Pb(),l.Pb(),l.Qb(27,"div",19),l.vc(28,fi,9,3,"div",20),l.Pb(),l.Pb(),l.Qb(29,"div",21),l.Qb(30,"div",16),l.Qb(31,"div",2),l.Qb(32,"div",17),l.Qb(33,"h5"),l.wc(34,"Active Quests"),l.Pb(),l.Pb(),l.vc(35,hi,5,0,"div",18),l.Pb(),l.Pb(),l.Qb(36,"div",19),l.Mb(37,"dd-quest-quick-view"),l.Pb(),l.Pb(),l.vc(38,yi,2,1,"div",22),l.Qb(39,"div",23),l.Mb(40,"dd-quick-dice"),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(4),l.xc(n.campaign.name),l.Ab(3),l.xc(n.campaign.name),l.Ab(7),l.ec("ngForOf",n.entityPresets),l.Ab(1),l.ec("ngIf",n.editable),l.Ab(3),l.ec("value",n.campaign.content),l.Ab(8),l.ec("ngIf",n.editable),l.Ab(2),l.ec("ngForOf",n.campaign.members),l.Ab(7),l.ec("ngIf",n.editable),l.Ab(3),l.ec("ngIf",n.campaign.conceptTypes&&n.campaign.conceptTypes.length>0)}}var wi,Pi,Ii=((wi=function(){function e(t,n,i){d(this,e),this.campaignService=t,this.router=n,this.route=i}return p(e,[{key:"ngOnInit",value:function(){}},{key:"userEntities",value:function(e){return this.campaign.entities.filter(function(t){return t.userId===e&&!t.spawnable&&!t.spawnedFromId})}},{key:"selectEntity",value:function(e){this.router.navigate(["..","entities",e.id],{relativeTo:this.route})}},{key:"manageQuests",value:function(){this.router.navigate(["campaigns",this.campaign.id,"quests"])}},{key:"manageMembers",value:function(){this.router.navigate(["campaigns",this.campaign.id,"members"])}},{key:"campaign",get:function(){return this.campaignService.campaign}},{key:"editable",get:function(){return this.campaignService.canEdit}},{key:"entityPresets",get:function(){return this.campaign.entityPresets.filter(function(e){return e.playerCreatable})}}]),e}()).\u0275fac=function(e){return new(e||wi)(l.Lb(P.b),l.Lb(w.c),l.Lb(w.a))},wi.\u0275cmp=l.Fb({type:wi,selectors:[["dd-campaign-landing"]],decls:1,vars:1,consts:[["class","container grid-xl",4,"ngIf"],[1,"container","grid-xl"],[1,"columns"],[1,"column","col-9","col-lg-8","col-md-12","hide-md"],[1,"column","col-6","col-md-12","show-md"],[1,"column","col-auto","col-ml-auto","hide-md"],[1,"dropdown","dropdown-right"],[1,"btn","btn-link","dropdown-toggle"],[1,"icon","icon-caret"],[1,"menu"],["class","menu-item",4,"ngFor","ngForOf"],["class","menu-item",4,"ngIf"],[1,"column","col-9","col-xl-8","col-md-12"],["readOnly","true",3,"value"],[1,"column","col-3","col-md-12","col-xl-4","col-ml-auto"],[1,"card"],[1,"card-header"],[1,"column"],["class","column col-auto col-ml-auto",4,"ngIf"],[1,"card-body"],["class","tile tile-centered mb-2",4,"ngFor","ngForOf"],[1,"card","mt-2"],["class","card mt-2 p-2",4,"ngIf"],[1,"mt-2"],[1,"menu-item"],[3,"routerLink"],[1,"column","col-auto","col-ml-auto"],[1,"btn","btn-sm",3,"click"],[1,"hide-sm"],[1,"icon","icon-menu"],[1,"tile","tile-centered","mb-2"],[1,"tile-icon"],[1,"avatar"],[3,"src"],[1,"tile-content"],[1,"tile-title"],[1,"d-flex"],["class","chip hoverable-chip",3,"click",4,"ngFor","ngForOf"],[1,"chip","hoverable-chip",3,"click"],[1,"avatar","avatar-sm",3,"src"],[1,"card","mt-2","p-2"],["class","btn",3,"routerLink","ngClass",4,"ngFor","ngForOf"],[1,"btn",3,"routerLink","ngClass"]],template:function(e,t){1&e&&l.vc(0,ki,41,9,"div",0),2&e&&l.ec("ngIf",t.campaign)},directives:[I.k,I.j,fe.a,Wn,ai,w.e,w.d,I.i],styles:[".d-flex[_ngcontent-%COMP%] > .chip[_ngcontent-%COMP%]{flex-shrink:0;flex-grow:0}.d-flex[_ngcontent-%COMP%]{flex-wrap:wrap}.hoverable-chip[_ngcontent-%COMP%]{transition:transform .25s}.hoverable-chip[_ngcontent-%COMP%]:hover{transform:scale(1.05);cursor:pointer;background-color:#5755d9;color:#fff}"]}),wi),Ci=s("xdv0"),xi=function(e,t){return{"has-error":e,"has-success":t}},Qi=function(e){return{loading:e}},Ai=((Pi=function(){function e(t,n,i,r){d(this,e),this.login=t,this.userService=n,this.router=i,this.action=r,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){this.login.userProfile||this.router.navigate(["login"]),this.usernameControl=new h.e(this.login.userProfile.nickname,[h.v.required,h.v.minLength(3),h.v.maxLength(30)])}},{key:"submit",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.usernameControl.valid){e.next=13;break}return this.loading=!0,e.prev=2,e.next=5,this.userService.createUser({id:this.login.id,username:this.usernameControl.value,pictureURL:this.login.userProfile.picture});case 5:t=e.sent,this.login.setUser(t),this.action.queue.pop(),this.action.save(),this.router.navigate(["home"]),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(2),e.t0;case 12:this.loading=!1;case 13:case"end":return e.stop()}},e,this,[[2,9]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}}]),e}()).\u0275fac=function(e){return new(e||Pi)(l.Lb(E.a),l.Lb(Ci.a),l.Lb(w.c),l.Lb(J.a))},Pi.\u0275cmp=l.Fb({type:Pi,selectors:[["dd-register"]],decls:17,vars:9,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column","col-6","col-md-8","col-sm-12","col-mx-auto"],[1,"card"],[1,"card-header"],[1,"mb-0"],[1,"text-gray","text-italic"],[1,"card-body"],[3,"ngSubmit"],[1,"form-group",3,"ngClass"],["type","text","name","username","id","username","placeholder","Jimbo",1,"form-input",3,"formControl"],[1,"card-footer"],[1,"btn","btn-primary","float-right",3,"ngClass","disabled","click"],[1,"icon","icon-arrow-right"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"div",3),l.Qb(4,"div",4),l.Qb(5,"h3",5),l.wc(6,"Username"),l.Pb(),l.Qb(7,"span",6),l.wc(8,"What should we call you?"),l.Pb(),l.Pb(),l.Qb(9,"div",7),l.Qb(10,"form",8),l.Xb("ngSubmit",function(){return t.submit()}),l.Qb(11,"div",9),l.Mb(12,"input",10),l.Pb(),l.Pb(),l.Pb(),l.Qb(13,"div",11),l.Qb(14,"button",12),l.Xb("click",function(){return t.submit()}),l.wc(15," Done "),l.Mb(16,"i",13),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(11),l.ec("ngClass",l.jc(4,xi,t.usernameControl.invalid&&(t.usernameControl.touched||t.usernameControl.dirty),t.usernameControl.valid)),l.Ab(1),l.ec("formControl",t.usernameControl),l.Ab(2),l.ec("ngClass",l.ic(7,Qi,t.loading))("disabled",t.usernameControl.invalid))},directives:[h.x,h.n,h.o,I.i,h.b,h.m,h.f],styles:[""]}),Pi),Ti=s("abTI"),Ei=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function Ri(e,t){1&e&&(l.Qb(0,"div",2),l.Qb(1,"div",3),l.Qb(2,"div",4),l.Qb(3,"div",5),l.wc(4," Processing information... "),l.Mb(5,"div",6),l.Pb(),l.Pb(),l.Pb(),l.Pb())}var Li=function(e){return{loading:e}};function Mi(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",10),l.Qb(1,"h2"),l.wc(2,"Would you like to join this campaign?"),l.Pb(),l.Qb(3,"figure",11),l.Mb(4,"img",12),l.Pb(),l.Qb(5,"h1"),l.wc(6),l.Pb(),l.Qb(7,"button",13),l.Xb("click",function(){return l.oc(n),l.Zb(2).deny()}),l.wc(8,"No"),l.Pb(),l.Qb(9,"button",14),l.Xb("click",function(){return l.oc(n),l.Zb(2).accept()}),l.wc(10," Yes "),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(4),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",i.campaign.imageId,"",l.qc),l.Ab(2),l.xc(i.campaign.name),l.Ab(3),l.ec("ngClass",l.ic(3,Li,i.accepting))}}function Si(e,t){1&e&&(l.Qb(0,"div",15),l.Qb(1,"h6"),l.wc(2,"Invalid Invite"),l.Pb(),l.Qb(3,"p"),l.wc(4," Unfortunately this invite is no longer valid. Sorry about that \xaf\\_(\u30c4)_/\xaf "),l.Pb(),l.Pb())}function Oi(e,t){if(1&e&&(l.Qb(0,"div",2),l.Qb(1,"div",7),l.vc(2,Mi,11,5,"div",8),l.vc(3,Si,5,0,"div",9),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(2),l.ec("ngIf",0===n.invite.status),l.Ab(1),l.ec("ngIf",0!==n.invite.status)}}var Ni,_i,Fi,Ui=((Fi=function(){function e(t,n,i,r,c){d(this,e),this.login=t,this.actions=n,this.campaignService=i,this.router=r,this.route=c,this.loading=!1,this.accepting=!1,this.denying=!1}return p(e,[{key:"ngOnInit",value:function(){return Ei(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.actions.queue.unshift({type:J.b.INVITE,data:{inviteId:this.route.snapshot.paramMap.get("invite_id")}}),this.actions.save(),e.next=4,this.login.isLoggedIn;case 4:if(!e.sent){e.next=21;break}return e.prev=5,this.loading=!0,e.next=9,this.loadInvite();case 9:0!==this.invite.status&&(this.actions.queue.pop(),this.actions.save()),e.next=18;break;case 12:return e.prev=12,e.t0=e.catch(5),this.actions.queue.pop(),this.actions.save(),e.next=18,this.router.navigate(["home"]);case 18:this.loading=!1,e.next=22;break;case 21:this.router.navigate(["login"]);case 22:case"end":return e.stop()}},e,this,[[5,12]])}))}},{key:"accept",value:function(){return Ei(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.accepting=!0,e.prev=1,e.next=4,this.campaignService.acceptInvite(this.invite.id);case 4:this.actions.queue.pop(),this.actions.save(),this.router.navigate(["campaigns",this.campaign.id,"landing"]),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),Ti.captureException(e.t0);case 12:this.accepting=!1;case 13:case"end":return e.stop()}},e,this,[[1,9]])}))}},{key:"deny",value:function(){return Ei(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.denying=!0,e.prev=1,e.next=4,this.campaignService.denyInvite(this.invite.id);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),Ti.captureException(e.t0);case 9:this.actions.queue.pop(),this.actions.save(),this.router.navigate(["home"]),this.denying=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}))}},{key:"loadInvite",value:function(){return Ei(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.campaignService.getInvite(this.route.snapshot.paramMap.get("invite_id"));case 3:t=e.sent,this.invite=t,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(0),e.t0;case 10:case"end":return e.stop()}},e,this,[[0,7]])}))}},{key:"campaign",get:function(){return this.invite?this.invite.campaign:null}}]),e}()).\u0275fac=function(e){return new(e||Fi)(l.Lb(E.a),l.Lb(J.a),l.Lb(P.b),l.Lb(w.c),l.Lb(w.a))},Fi.\u0275cmp=l.Fb({type:Fi,selectors:[["dd-invite"]],decls:3,vars:2,consts:[[1,"container","grid-xl"],["class","columns",4,"ngIf"],[1,"columns"],[1,"column","col-4","col-md-6","col-sm-12","col-mx-auto"],[1,"card"],[1,"card-body"],[1,"loading"],[1,"column","col-6","col-md-10","col-sm-12","text-center","col-mx-auto"],["class","card p-2",4,"ngIf"],["class","toast text-left toast-error",4,"ngIf"],[1,"card","p-2"],[1,"avatar","avatar-xl","align-self-center"],[3,"src"],[1,"btn","btn-lg","my-2",3,"click"],[1,"btn","btn-primary","btn-lg",3,"ngClass","click"],[1,"toast","text-left","toast-error"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,Ri,6,0,"div",1),l.vc(2,Oi,4,2,"div",1),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",!t.loading&&t.campaign))},directives:[I.k,I.i],styles:[""]}),Fi),qi=((_i=function(){function e(t,n,i){d(this,e),this.actions=t,this.router=n,this.login=i}return p(e,[{key:"canActivate",value:function(e,t){return n=this,r=regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.login.isLoggedIn){e.next=2;break}return e.abrupt("return",!1);case 2:if(0!==(t=this.actions.queue).length){e.next=5;break}return e.abrupt("return",!0);case 5:n=t.pop(),e.t0=(this.actions.save(),n.type),e.next=e.t0===J.b.ACCOUNT_SETUP?9:e.t0===J.b.INVITE?11:e.t0===J.b.REDIRECT?13:15;break;case 9:return this.router.navigate(["register"]),e.abrupt("break",15);case 11:return this.router.navigate(["invite",n.data.inviteId]),e.abrupt("break",15);case 13:return e.next=15,this.router.navigateByUrl(n.data.url);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,this)}),new((i=void 0)||(i=Promise))(function(e,t){function c(e){try{a(r.next(e))}catch(n){t(n)}}function o(e){try{a(r.throw(e))}catch(n){t(n)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i(function(e){e(n)})).then(c,o)}a((r=r.apply(n,[])).next())});var n,i,r}}]),e}()).\u0275fac=function(e){return new(e||_i)(l.Ub(J.a),l.Ub(w.c),l.Ub(E.a))},_i.\u0275prov=l.Hb({token:_i,factory:_i.\u0275fac,providedIn:"root"}),_i),Gi=((Ni=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"remoteAbout",value:function(){return this.http.get("".concat(k.a.apiURL,"/aboutinfo")).toPromise()}},{key:"localAbout",value:function(){return{gitHash:k.a.gitHash,gitTag:k.a.gitTag}}}]),e}()).\u0275fac=function(e){return new(e||Ni)(l.Ub(f.b))},Ni.\u0275prov=l.Hb({token:Ni,factory:Ni.\u0275fac,providedIn:"root"}),Ni);function Di(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"(Loading...)"),l.Pb())}function Zi(e,t){if(1&e&&(l.Qb(0,"div",1),l.Qb(1,"h5",2),l.wc(2,"Commit Hash"),l.Pb(),l.Qb(3,"span",3),l.wc(4),l.Pb(),l.Qb(5,"h5",4),l.wc(6,"Version Tag"),l.Pb(),l.Qb(7,"span",3),l.wc(8),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(4),l.xc(n.remote.gitHash),l.Ab(4),l.xc(n.remote.gitTag)}}var Xi,ji,Hi=((ji=function(){function e(t){d(this,e),this.aboutService=t,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){this.load()}},{key:"load",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.local=this.aboutService.localAbout(),e.prev=1,e.next=4,this.aboutService.remoteAbout();case 4:t=e.sent,this.remote=t,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:this.loading=!1;case 12:case"end":return e.stop()}},e,this,[[1,8]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"makeDummyException",value:function(){var e=new Error("This is a test error!");throw e.name="SentryTestError",e}}]),e}()).\u0275fac=function(e){return new(e||ji)(l.Lb(Gi))},ji.\u0275cmp=l.Fb({type:ji,selectors:[["dd-about"]],decls:20,vars:4,consts:[[1,"container","grid-xl"],[1,"card","p-2"],[1,"mb-1"],[1,"text-italic","text-gray"],[1,"mt-2","mb-1"],[1,"mt-2"],[4,"ngIf"],["class","card p-2",4,"ngIf"],[1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"h4"),l.wc(2,"DD - App"),l.Pb(),l.Qb(3,"div",1),l.Qb(4,"h5",2),l.wc(5,"Commit Hash"),l.Pb(),l.Qb(6,"span",3),l.wc(7),l.Pb(),l.Qb(8,"h5",4),l.wc(9,"Version Tag"),l.Pb(),l.Qb(10,"span",3),l.wc(11),l.Pb(),l.Pb(),l.Qb(12,"h4",5),l.wc(13,"DD - Server "),l.vc(14,Di,2,0,"span",6),l.Pb(),l.vc(15,Zi,9,2,"div",7),l.Qb(16,"h4"),l.wc(17,"Error Testing"),l.Pb(),l.Qb(18,"button",8),l.Xb("click",function(){return t.makeDummyException()}),l.wc(19," Make Test Error "),l.Pb(),l.Pb()),2&e&&(l.Ab(7),l.xc(t.local.gitHash),l.Ab(4),l.xc(t.local.gitTag),l.Ab(3),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.remote))},directives:[I.k],styles:[""]}),ji),Vi=((Xi=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Xi)},Xi.\u0275cmp=l.Fb({type:Xi,selectors:[["dd-entity"]],decls:1,vars:0,template:function(e,t){1&e&&l.Mb(0,"router-outlet")},directives:[w.g],styles:[""]}),Xi),$i=s("/uUt"),Bi=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},zi=function(e){return{loading:e}};function Yi(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",29),l.Xb("click",function(){return l.oc(n),l.Zb().delete()}),l.wc(1," Delete "),l.Pb()}if(2&e){var i=l.Zb();l.ec("ngClass",l.ic(1,zi,i.deleting))}}function Wi(e,t){1&e&&(l.Qb(0,"p",30),l.wc(1," The quest needs a name "),l.Pb())}function Ki(e,t){1&e&&(l.Qb(0,"p",30),l.wc(1," The name is too short "),l.Pb())}function Ji(e,t){1&e&&(l.Qb(0,"p",30),l.wc(1," The name can't be more than 30 characters long "),l.Pb())}var er,tr=function(e,t){return{"has-error":e,"has-success":t}},nr=((er=function(){function e(t,n,i,r,c){d(this,e),this.router=t,this.route=n,this.campaignService=i,this.questService=r,this.location=c,this.loading=!1,this.deleting=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;if(this.formGroup=new h.h({name:new h.e(null,[h.v.required,h.v.minLength(3),h.v.maxLength(30)]),accepted:new h.e(!1),available:new h.e(!1),visible:new h.e(!1),status:new h.e("0"),content:new h.e(null)}),this.visible.valueChanges.subscribe(function(){e.dataToUI()}),this.available.valueChanges.pipe(Object($i.a)()).subscribe(function(){e.dataToUI()}),this.dataToUI(),this.editing){var t=this.route.snapshot.paramMap.get("q_id");this.loadQuest(t)}}},{key:"canDeactivate",value:function(){return!this.formGroup.dirty}},{key:"dataToUI",value:function(){if(this.quest||!this.editing){var e=this.available.value;this.visible.value?(this.available.enable(),e?(this.accepted.enable(),this.status.enable()):(this.accepted.setValue(!1),this.status.setValue(Tn.b.NONE),this.accepted.disable(),this.status.disable())):(this.available.setValue(!1),this.accepted.setValue(!1),this.status.setValue(Tn.b.NONE),this.accepted.disable(),this.available.disable(),this.status.disable())}}},{key:"loadQuest",value:function(e){return Bi(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,this.formGroup.disable(),t.prev=1,t.next=4,this.questService.getQuest(e);case 4:n=t.sent,this.formGroup.patchValue(n),this.quest=n,setTimeout(function(){i.dataToUI()},1),t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(1),t.t0;case 11:this.loading=!1,this.formGroup.enable();case 12:case"end":return t.stop()}},t,this,[[1,8]])}))}},{key:"constructQuest",value:function(){var e={name:this.name.value,accepted:this.accepted.value,available:this.available.value,visible:this.visible.value,content:this.formGroup.get("content").value,status:this.status.value,campaignId:this.campaignService.campaign.id};return this.editing&&(e.id=this.quest.id),e}},{key:"submit",value:function(){return Bi(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.formGroup.invalid){e.next=2;break}return e.abrupt("return");case 2:if(t=this.constructQuest(),this.loading=!0,!this.editing){e.next=16;break}return e.prev=4,e.next=7,this.questService.updateQuest(t);case 7:this.formGroup.markAsPristine(),this.cancel(),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(4),e.t0;case 14:e.next=26;break;case 16:return e.prev=16,e.next=19,this.questService.createQuest(t);case 19:n=e.sent,this.formGroup.markAsPristine(),this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",n.id]),e.next=26;break;case 23:throw e.prev=23,e.t1=e.catch(16),e.t1;case 26:this.loading=!1;case 27:case"end":return e.stop()}},e,this,[[4,11],[16,23]])}))}},{key:"delete",value:function(){return Bi(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.deleting=!0,e.prev=1,e.next=4,this.questService.deleteQuest(this.quest);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:this.location.back(),this.deleting=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}))}},{key:"cancel",value:function(){this.location.back()}},{key:"editing",get:function(){return this.route.snapshot.data.editing}},{key:"name",get:function(){return this.formGroup.get("name")}},{key:"accepted",get:function(){return this.formGroup.get("accepted")}},{key:"available",get:function(){return this.formGroup.get("available")}},{key:"visible",get:function(){return this.formGroup.get("visible")}},{key:"status",get:function(){return this.formGroup.get("status")}}]),e}()).\u0275fac=function(e){return new(e||er)(l.Lb(w.c),l.Lb(w.a),l.Lb(P.b),l.Lb(Tn.a),l.Lb(I.g))},er.\u0275cmp=l.Fb({type:er,selectors:[["dd-quest-form"]],decls:52,vars:11,consts:[[1,"container","grid-xl"],[3,"formGroup","ngSubmit"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],["type","button",1,"btn","mr-2",3,"click"],["class","btn btn-error mr-2","type","button",3,"ngClass","click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled"],[1,"form-group",3,"ngClass"],["for","name",1,"form-label","label-lg"],["formControlName","name","type","text","id","name","placeholder","Name",1,"form-input","input-lg"],["class","form-input-hint",4,"ngIf"],[1,"form-group"],["for","item-description",1,"form-label"],["placeholder","Do Quest","formControlName","content"],["for","accepted",1,"form-switch"],["type","checkbox","name","accepted","id","accepted","formControlName","accepted"],[1,"form-icon"],["for","available",1,"form-switch"],["type","checkbox","name","available","id","available","formControlName","available"],["for","visible",1,"form-switch"],["type","checkbox","name","visible","id","visible","formControlName","visible"],["for","status",1,"form-label"],["name","status","id","status","formControlName","status",1,"form-input"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["type","button",1,"btn","btn-error","mr-2",3,"ngClass","click"],[1,"form-input-hint"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"form",1),l.Xb("ngSubmit",function(){return t.submit()}),l.Qb(2,"div",2),l.Qb(3,"div",3),l.Qb(4,"h3"),l.wc(5),l.Pb(),l.Pb(),l.Qb(6,"div",4),l.Qb(7,"button",5),l.Xb("click",function(){return t.cancel()}),l.wc(8," Cancel "),l.Pb(),l.vc(9,Yi,2,3,"button",6),l.Qb(10,"button",7),l.wc(11," Save "),l.Pb(),l.Pb(),l.Pb(),l.Qb(12,"div",8),l.Qb(13,"label",9),l.wc(14,"Name"),l.Pb(),l.Mb(15,"input",10),l.vc(16,Wi,2,0,"p",11),l.vc(17,Ki,2,0,"p",11),l.vc(18,Ji,2,0,"p",11),l.Pb(),l.Qb(19,"div",12),l.Qb(20,"label",13),l.wc(21,"Description"),l.Pb(),l.Mb(22,"dd-quill",14),l.Pb(),l.Qb(23,"div",12),l.Qb(24,"label",15),l.Mb(25,"input",16),l.Mb(26,"i",17),l.wc(27," The players have accepted this quest "),l.Pb(),l.Pb(),l.Qb(28,"div",12),l.Qb(29,"label",18),l.Mb(30,"input",19),l.Mb(31,"i",17),l.wc(32," This quest is available for players to accept "),l.Pb(),l.Pb(),l.Qb(33,"div",12),l.Qb(34,"label",20),l.Mb(35,"input",21),l.Mb(36,"i",17),l.wc(37," Players can see this quest "),l.Pb(),l.Pb(),l.Qb(38,"div",12),l.Qb(39,"label",22),l.wc(40," Status "),l.Pb(),l.Qb(41,"select",23),l.Qb(42,"option",24),l.wc(43,"None"),l.Pb(),l.Qb(44,"option",25),l.wc(45,"On Hold"),l.Pb(),l.Qb(46,"option",26),l.wc(47,"In Progress"),l.Pb(),l.Qb(48,"option",27),l.wc(49,"To Do"),l.Pb(),l.Qb(50,"option",28),l.wc(51,"Completed"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(1),l.ec("formGroup",t.formGroup),l.Ab(4),l.yc("",t.editing?"Edit":"Create"," Quest"),l.Ab(4),l.ec("ngIf",t.editing),l.Ab(1),l.ec("disabled",t.formGroup.invalid),l.Ab(2),l.ec("ngClass",l.jc(8,tr,t.name.invalid&&(t.name.dirty||t.name.touched),t.name.valid)),l.Ab(4),l.ec("ngIf",t.name.invalid&&(t.name.dirty||t.name.touched)&&t.name.errors.required),l.Ab(1),l.ec("ngIf",t.name.invalid&&(t.name.dirty||t.name.touched)&&t.name.errors.minlength),l.Ab(1),l.ec("ngIf",t.name.invalid&&(t.name.dirty||t.name.touched)&&t.name.errors.maxlength))},directives:[h.x,h.n,h.i,I.k,I.i,h.b,h.m,h.g,fe.a,h.a,h.t,h.p,h.w],styles:[""]}),er),ir=s("a8fi"),rr=s("/AKn"),cr=s("Kjs6");function or(e,t){1&e&&l.Mb(0,"div",4)}function ar(e,t){if(1&e&&l.Mb(0,"dd-http-errors",5),2&e){var n=l.Zb();l.ec("error",n.loadError)}}function sr(e,t){1&e&&l.Mb(0,"i",19)}function ur(e,t){1&e&&l.Mb(0,"i",20)}function lr(e,t){1&e&&l.Mb(0,"i",21)}function dr(e,t){1&e&&l.Mb(0,"i",22)}function br(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",23),l.Xb("click",function(){return l.oc(n),l.Zb(2).edit()}),l.Mb(1,"i",24),l.Qb(2,"span",15),l.wc(3," Edit"),l.Pb(),l.Pb()}}function pr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div"),l.Qb(1,"div",6),l.Qb(2,"div",7),l.Qb(3,"h3"),l.vc(4,sr,1,0,"i",8),l.vc(5,ur,1,0,"i",9),l.vc(6,lr,1,0,"i",10),l.vc(7,dr,1,0,"i",11),l.wc(8),l.Pb(),l.Pb(),l.Qb(9,"div",12),l.Qb(10,"button",13),l.Xb("click",function(){return l.oc(n),l.Zb().addNote()}),l.Mb(11,"i",14),l.Qb(12,"span",15),l.wc(13," Add Note"),l.Pb(),l.Pb(),l.vc(14,br,4,0,"button",16),l.Pb(),l.Pb(),l.Mb(15,"dd-quill",17),l.Mb(16,"dd-note-list",18),l.Pb()}if(2&e){var i=l.Zb();l.Ab(4),l.ec("ngIf",1===i.quest.status),l.Ab(1),l.ec("ngIf",2===i.quest.status),l.Ab(1),l.ec("ngIf",3===i.quest.status),l.Ab(1),l.ec("ngIf",4===i.quest.status),l.Ab(1),l.yc(" ",i.quest.name," "),l.Ab(6),l.ec("ngIf",i.editable),l.Ab(1),l.ec("value",i.quest.content),l.Ab(1),l.ec("notes",i.notes)}}var fr,hr,vr=((hr=function(){function e(t,n,i,r,c){d(this,e),this.router=t,this.route=n,this.questService=i,this.campaignService=r,this.noteService=c,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.route.paramMap.subscribe(function(t){t.get("q_id")&&(e.quest=void 0,e.loadQuest(t.get("q_id")))})}},{key:"loadQuest",value:function(e){return t=this,i=regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,this.questService.getQuest(e);case 4:this.quest=t.sent,this.noteService.getNotes(this.campaignService.campaign.id,{questId:this.quest.id}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),this.loadError=t.t0;case 11:this.loading=!1;case 12:case"end":return t.stop()}},t,this,[[1,8]])}),new((n=void 0)||(n=Promise))(function(e,r){function c(e){try{a(i.next(e))}catch(t){r(t)}}function o(e){try{a(i.throw(e))}catch(t){r(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n(function(e){e(i)})).then(c,o)}a((i=i.apply(t,[])).next())});var t,n,i}},{key:"addNote",value:function(){this.noteService.addNote({type:ir.b.QUEST,questId:this.quest.id})}},{key:"edit",value:function(){this.editable&&this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",this.quest.id,"edit"])}},{key:"editable",get:function(){return this.campaignService.canEdit}},{key:"notes",get:function(){return this.quest?this.noteService.getQuestNotes(this.quest.id):[]}}]),e}()).\u0275fac=function(e){return new(e||hr)(l.Lb(w.c),l.Lb(w.a),l.Lb(Tn.a),l.Lb(P.b),l.Lb(ir.a))},hr.\u0275cmp=l.Fb({type:hr,selectors:[["dd-quest-view"]],decls:4,vars:3,consts:[[1,"container","grid-lg"],["class","loading loading-lg",4,"ngIf"],[3,"error",4,"ngIf"],[4,"ngIf"],[1,"loading","loading-lg"],[3,"error"],[1,"columns"],[1,"column"],["class","icon icon-stop",4,"ngIf"],["class","icon icon-flag",4,"ngIf"],["class","icon icon-time",4,"ngIf"],["class","icon icon-check",4,"ngIf"],[1,"column","col-auto","col-ml-auto"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"icon","icon-link"],[1,"hide-sm"],["class","btn btn-sm",3,"click",4,"ngIf"],["readOnly","true",3,"value"],[3,"notes"],[1,"icon","icon-stop"],[1,"icon","icon-flag"],[1,"icon","icon-time"],[1,"icon","icon-check"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-edit"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,or,1,0,"div",1),l.vc(2,ar,1,1,"dd-http-errors",2),l.vc(3,pr,17,8,"div",3),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.loadError),l.Ab(1),l.ec("ngIf",t.quest))},directives:[I.k,rr.a,fe.a,cr.a],styles:[""]}),hr),mr=((fr=function(){function e(){d(this,e),this.sliderMax=10,this.max=60,this.min=1,this.loading=!1,this.selected=new l.n,this.cancel=new l.n,this.customInput=!1}return p(e,[{key:"ngOnInit",value:function(){this.inputControl=new h.e(1,[h.v.required,h.v.min(this.min),h.v.max(this.max)])}},{key:"submit",value:function(){this.inputControl.valid&&this.selected.emit(this.inputControl.value)}},{key:"number",get:function(){return this.inputControl.value},set:function(e){this.inputControl.setValue(e)}}]),e}()).\u0275fac=function(e){return new(e||fr)},fr.\u0275cmp=l.Fb({type:fr,selectors:[["dd-number-quick-select"]],inputs:{sliderMax:"sliderMax",max:"max",min:"min",loading:"loading",number:"number"},outputs:{selected:"selected",cancel:"cancel"},decls:9,vars:5,consts:[[1,"columns"],[1,"column"],["type","range","name","slider",1,"slider","tooltip",3,"min","max","formControl"],[1,"column","col-auto"],[1,"btn","btn-sm","mr-1",3,"click"],[1,"icon","icon-cross"],[1,"btn","btn-sm",3,"disabled","click"],[1,"icon","icon-check"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Mb(2,"input",2),l.Pb(),l.Qb(3,"div",3),l.Qb(4,"button",4),l.Xb("click",function(){return t.cancel.emit(!0)}),l.Mb(5,"i",5),l.Pb(),l.Qb(6,"button",6),l.Xb("click",function(){return t.submit()}),l.Mb(7,"i",7),l.wc(8),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(2),l.fc("min",t.min),l.fc("max",t.sliderMax),l.ec("formControl",t.inputControl),l.Ab(4),l.ec("disabled",t.inputControl.invalid||t.loading),l.Ab(2),l.yc(" ",t.inputControl.value," "))},directives:[h.r,h.b,h.m,h.f],styles:[""]}),fr);function gr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",5),l.Qb(1,"button",6),l.Xb("click",function(){return l.oc(n),l.Zb().edit()}),l.wc(2,"Edit"),l.Pb(),l.Qb(3,"button",7),l.Xb("click",function(){return l.oc(n),l.Zb().spawnMode=!0}),l.wc(4,"Spawn"),l.Pb(),l.Pb()}}function yr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",8),l.Qb(1,"dd-number-quick-select",9),l.Xb("selected",function(e){return l.oc(n),l.Zb().spawn(e)})("cancel",function(){return l.oc(n),l.Zb().spawnMode=!1}),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(1),l.ec("loading",i.spawning)}}var kr,wr=((kr=function(){function e(t,n,i){d(this,e),this.entityService=t,this.router=n,this.campaignService=i,this.spawnMode=!1,this.spawning=!1}return p(e,[{key:"ngOnInit",value:function(){}},{key:"edit",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",this.spawnable.entityPresetId,this.spawnable.id,"edit"])}},{key:"spawn",value:function(e){return t=this,i=regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.spawning=!0,t.prev=1,t.next=4,this.entityService.spawnSpawnable(this.spawnable.id,e);case 4:return t.next=6,this.router.navigate(["campaigns",this.campaignService.campaign.id,"overview"]);case 6:t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(1),t.t0;case 11:this.spawning=!1;case 12:case"end":return t.stop()}},t,this,[[1,8]])}),new((n=void 0)||(n=Promise))(function(e,r){function c(e){try{a(i.next(e))}catch(t){r(t)}}function o(e){try{a(i.throw(e))}catch(t){r(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n(function(e){e(i)})).then(c,o)}a((i=i.apply(t,[])).next())});var t,n,i}}]),e}()).\u0275fac=function(e){return new(e||kr)(l.Lb(de.b),l.Lb(w.c),l.Lb(P.b))},kr.\u0275cmp=l.Fb({type:kr,selectors:[["dd-spawnable-list-item"]],inputs:{spawnable:"spawnable"},decls:6,vars:3,consts:[[1,"columns"],[1,"column"],[1,"mb-0"],["class","column text-right",4,"ngIf"],["class","column col-sm-12",4,"ngIf"],[1,"column","text-right"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"btn","btn-sm",3,"click"],[1,"column","col-sm-12"],[3,"loading","selected","cancel"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"h5",2),l.wc(3),l.Pb(),l.Pb(),l.vc(4,gr,5,0,"div",3),l.vc(5,yr,2,1,"div",4),l.Pb()),2&e&&(l.Ab(3),l.xc(t.spawnable.name),l.Ab(1),l.ec("ngIf",!t.spawnMode),l.Ab(1),l.ec("ngIf",t.spawnMode))},directives:[I.k,mr],styles:[""]}),kr);function Pr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",7),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb().addSpawnable(e)}),l.Mb(1,"i",8),l.wc(2),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(2),l.yc(" ",i.name," ")}}function Ir(e,t){1&e&&l.Mb(0,"div",9)}function Cr(e,t){1&e&&(l.Qb(0,"div",12),l.Qb(1,"div",13),l.Mb(2,"i",14),l.Pb(),l.Qb(3,"p",15),l.wc(4,"There are no spawnables :("),l.Pb(),l.Qb(5,"p",16),l.wc(6,"Use the buttons above to create one"),l.Pb(),l.Pb())}function xr(e,t){if(1&e&&(l.Qb(0,"div",17),l.Mb(1,"dd-spawnable-list-item",18),l.Pb()),2&e){var n=t.$implicit;l.Ab(1),l.ec("spawnable",n)}}function Qr(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,Cr,7,0,"div",10),l.vc(2,xr,2,1,"div",11),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngIf",0===n.spawnables.length),l.Ab(1),l.ec("ngForOf",n.spawnables)}}var Ar,Tr=((Ar=function(){function e(t,n,i){d(this,e),this.router=t,this.entityService=n,this.campaignService=i,this.loading=!1,this.spawnables=null}return p(e,[{key:"ngOnInit",value:function(){this.load()}},{key:"load",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.entityService.getEntities(this.campaignService.campaign.id,!0);case 4:this.spawnables=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:this.loading=!1;case 11:case"end":return e.stop()}},e,this,[[1,7]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"addSpawnable",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",e.id,"create"],{queryParams:{spawnable:!0}})}},{key:"selectSpawnable",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",e.entityPresetId,e.id,"edit"])}},{key:"campaign",get:function(){return this.campaignService.campaign}}]),e}()).\u0275fac=function(e){return new(e||Ar)(l.Lb(w.c),l.Lb(de.b),l.Lb(P.b))},Ar.\u0275cmp=l.Fb({type:Ar,selectors:[["dd-spawnable-manager"]],decls:9,vars:3,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-sm ml-1",3,"click",4,"ngFor","ngForOf"],["class","loading loading-lg",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm","ml-1",3,"click"],[1,"icon","icon-plus"],[1,"loading","loading-lg"],["class","empty",4,"ngIf"],["class","card mb-2 p-2",4,"ngFor","ngForOf"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"card","mb-2","p-2"],[3,"spawnable"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"h3"),l.wc(4,"Spawnables"),l.Pb(),l.Pb(),l.Qb(5,"div",3),l.vc(6,Pr,3,1,"button",4),l.Pb(),l.Pb(),l.vc(7,Ir,1,0,"div",5),l.vc(8,Qr,3,2,"div",6),l.Pb()),2&e&&(l.Ab(6),l.ec("ngForOf",t.campaign.entityPresets),l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.spawnables))},directives:[I.j,I.k,wr],styles:[""]}),Ar),Er=s("8Qhy"),Rr=s("/fvA"),Lr=s("HRrE");function Mr(e,t){1&e&&(l.Qb(0,"p",27),l.wc(1," A name is required "),l.Pb())}function Sr(e,t){1&e&&(l.Qb(0,"p",27),l.wc(1," A type is required "),l.Pb())}function Or(e,t){1&e&&(l.Qb(0,"div",30),l.Qb(1,"div",31),l.Mb(2,"input",32),l.Pb(),l.Qb(3,"div",31),l.Mb(4,"input",33),l.Pb(),l.Pb())}function Nr(e,t){1&e&&(l.Qb(0,"div",30),l.Qb(1,"div",31),l.Mb(2,"input",34),l.Pb(),l.Qb(3,"div",31),l.Mb(4,"input",35),l.Pb(),l.Pb())}function _r(e,t){if(1&e&&(l.Qb(0,"div",30),l.Qb(1,"div",31),l.Mb(2,"dd-tag-editor",36),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(2),l.ec("formGroup",n.options)}}function Fr(e,t){if(1&e&&(l.Qb(0,"div",28),l.vc(1,Or,5,0,"div",29),l.vc(2,Nr,5,0,"div",29),l.vc(3,_r,3,1,"div",29),l.Pb()),2&e){var n=l.Zb();l.ec("ngSwitch",!0)("formGroup",n.options)("hidden",n.hideExtra),l.Ab(1),l.ec("ngSwitchCase","0"===n.type.value||0===n.type.value),l.Ab(1),l.ec("ngSwitchCase","1"===n.type.value||"2"===n.type.value||1===n.type.value||2===n.type.value),l.Ab(1),l.ec("ngSwitchCase","3"===n.type.value||"4"===n.type.value||3===n.type.value||4===n.type.value)}}function Ur(e,t){if(1&e&&(l.Qb(0,"div",37),l.Qb(1,"label",38),l.Mb(2,"input",39),l.Mb(3,"i",40),l.wc(4," Required "),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.ec("formGroup",n.options)}}function qr(e,t){if(1&e&&(l.Qb(0,"option",24),l.wc(1),l.Pb()),2&e){var n=t.$implicit;l.ec("value",n),l.Ab(1),l.xc(n)}}function Gr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"span",41),l.Xb("click",function(){return l.oc(n),l.Zb().hideExtra=!1}),l.wc(1,"Show More"),l.Pb()}}function Dr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"span",41),l.Xb("click",function(){return l.oc(n),l.Zb().hideExtra=!0}),l.wc(1,"Show Less"),l.Pb()}}var Zr,Xr=function(e,t){return{"col-9":e,"col-12":t}},jr=function(e){return{"has-error":e}},Hr=((Zr=function(){function e(t){d(this,e),this.campaignService=t,this.hideExtra=!0,this.uniqueFieldId=(new R.Chance).guid()}return p(e,[{key:"ngOnInit",value:function(){var t=this;this.formGroup.get("type").valueChanges.subscribe(function(n){n=parseInt(n,10),t.options=e.createOptionsFormGroup(n,t.formGroup.value.options),t.formGroup.setControl("options",t.options)}),this.options=e.createOptionsFormGroup(this.type.value,this.formGroup.value.options),this.formGroup.setControl("options",this.options)}},{key:"campaign",get:function(){return this.campaignService.campaign}},{key:"name",get:function(){return this.formGroup.get("name")}},{key:"type",get:function(){return this.formGroup.get("type")}}],[{key:"createFormGroup",value:function(e){return null==e&&(e={name:null,type:null}),new h.h({name:new h.e(e.name,[h.v.required,h.v.maxLength(30)]),description:new h.e(e.description),type:new h.e(e.type,[h.v.required]),imageId:new h.e(e.imageId),options:this.createOptionsFormGroup(e.type,e.options)})}},{key:"createOptionsFormGroup",value:function(e,t){var n;switch(null==t&&(t={}),e){case pe.a.STRING:return n=t,new h.h({maxLength:new h.e(n.maxLength),minLength:new h.e(n.minLength),required:new h.e(n.required),modifierFor:new h.e(n.modifierFor)});case pe.a.INT:case pe.a.FLOAT:return n=t,new h.h({min:new h.e(n.min),max:new h.e(n.max),required:new h.e(n.required),modifierFor:new h.e(n.modifierFor)});case pe.a.ENUM:case pe.a.ENUM_MULTI:return n=t,new h.h({choices:new h.c(n.choices?n.choices.map(function(e){return new h.e(e)}):[]),required:new h.e(n.required),modifierFor:new h.e(n.modifierFor)});default:return new h.h({required:new h.e(t.required),modifierFor:new h.e(t.modifierFor)})}}}]),e}()).\u0275fac=function(e){return new(e||Zr)(l.Lb(P.b))},Zr.\u0275cmp=l.Fb({type:Zr,selectors:[["dd-field-definition-form"]],inputs:{formGroup:"formGroup",otherFields:"otherFields"},decls:40,vars:26,consts:[[1,"columns",3,"formGroup"],[1,"column","col-3",3,"hidden"],["formControlName","imageId",3,"eleId"],[1,"column","col-9",3,"ngClass"],[1,"form-group",3,"ngClass"],["type","text","name","name","placeholder","Name","formControlName","name",1,"form-input","input-sm"],["class","form-input-hint mb-0",4,"ngIf"],[1,"form-group",3,"hidden"],["type","text","name","description","formControlName","description","placeholder","Short Description",1,"form-input","input-sm"],["name","type","formControlName","type",1,"form-input","input-sm","mt-1"],["disabled","",3,"value"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["value","6"],["value","7"],[3,"ngSwitch","formGroup","hidden",4,"ngIf"],[1,"column","col-auto","mt-1",3,"hidden"],["class","form-group",3,"formGroup",4,"ngIf"],[1,"column","mt-1",3,"formGroup","hidden"],["formControlName","modifierFor",1,"form-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["class","fake-link",3,"click",4,"ngIf"],[1,"form-input-hint","mb-0"],[3,"ngSwitch","formGroup","hidden"],["class","columns",4,"ngSwitchCase"],[1,"columns"],[1,"column"],["type","number","placeholder","Minimum Length","formControlName","minLength",1,"form-input","input-sm"],["type","number","placeholder","Maximum Length","formControlName","maxLength",1,"form-input","input-sm"],["type","number","placeholder","Minimum","formControlName","min",1,"form-input","input-sm"],["type","number","placeholder","Maximum","formControlName","max",1,"form-input","input-sm"],["controlName","choices",3,"formGroup"],[1,"form-group",3,"formGroup"],[1,"form-checkbox"],["type","checkbox","formControlName","required"],[1,"form-icon"],[1,"fake-link",3,"click"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Mb(2,"dd-image-upload",2),l.Pb(),l.Qb(3,"div",3),l.Qb(4,"div",4),l.Mb(5,"input",5),l.vc(6,Mr,2,0,"p",6),l.Pb(),l.Qb(7,"div",7),l.Mb(8,"input",8),l.Pb(),l.Qb(9,"div",4),l.Qb(10,"select",9),l.Qb(11,"option",10),l.wc(12,"Type"),l.Pb(),l.Qb(13,"option",11),l.wc(14,"Word"),l.Pb(),l.Qb(15,"option",12),l.wc(16,"Whole Number"),l.Pb(),l.Qb(17,"option",13),l.wc(18,"Real Number"),l.Pb(),l.Qb(19,"option",14),l.wc(20,"Selection"),l.Pb(),l.Qb(21,"option",15),l.wc(22,"Selection (Multiple)"),l.Pb(),l.Qb(23,"option",16),l.wc(24,"Text (Formatted)"),l.Pb(),l.Qb(25,"option",17),l.wc(26,"Currency"),l.Pb(),l.Qb(27,"option",18),l.wc(28,"Yes or No"),l.Pb(),l.Pb(),l.vc(29,Sr,2,0,"p",6),l.Pb(),l.vc(30,Fr,4,6,"div",19),l.Pb(),l.Qb(31,"div",20),l.vc(32,Ur,5,1,"div",21),l.Pb(),l.Qb(33,"div",22),l.Qb(34,"select",23),l.Qb(35,"option",24),l.wc(36,"Modifier For"),l.Pb(),l.vc(37,qr,2,2,"option",25),l.Pb(),l.Pb(),l.Pb(),l.vc(38,Gr,2,0,"span",26),l.vc(39,Dr,2,0,"span",26)),2&e&&(l.ec("formGroup",t.formGroup),l.Ab(1),l.ec("hidden",t.hideExtra),l.Ab(1),l.ec("eleId",t.uniqueFieldId),l.Ab(1),l.ec("ngClass",l.jc(19,Xr,!t.hideExtra,t.hideExtra)),l.Ab(1),l.ec("ngClass",l.ic(22,jr,t.name.invalid&&(t.name.dirty||t.name.touched))),l.Ab(2),l.ec("ngIf",t.name.invalid&&(t.name.dirty||t.name.touched)&&t.name.errors.required),l.Ab(1),l.ec("hidden",t.hideExtra),l.Ab(2),l.ec("ngClass",l.ic(24,jr,t.type.invalid&&(t.type.dirty||t.type.touched))),l.Ab(2),l.ec("value",null),l.Ab(18),l.ec("ngIf",t.type.invalid&&(t.type.dirty||t.type.touched)&&t.type.errors.required),l.Ab(1),l.ec("ngIf",t.options),l.Ab(1),l.ec("hidden",t.hideExtra),l.Ab(1),l.ec("ngIf",t.options),l.Ab(1),l.ec("formGroup",t.options)("hidden",t.hideExtra),l.Ab(2),l.ec("value",null),l.Ab(2),l.ec("ngForOf",t.otherFields),l.Ab(1),l.ec("ngIf",t.hideExtra),l.Ab(1),l.ec("ngIf",!t.hideExtra))},directives:[h.n,h.i,Et,h.m,h.g,I.i,h.b,I.k,h.t,h.p,h.w,I.j,I.l,I.m,h.q,Lr.a,h.a],styles:[""]}),Zr),Vr=s("kNgC"),$r=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},Br=function(e){return{loading:e}};function zr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",25),l.Xb("click",function(){return l.oc(n),l.Zb().delete()}),l.wc(1," Delete "),l.Pb()}if(2&e){var i=l.Zb();l.ec("ngClass",l.ic(1,Br,i.deleting))}}function Yr(e,t){1&e&&(l.Qb(0,"div",11),l.Qb(1,"label",12),l.Mb(2,"input",26),l.Mb(3,"i",14),l.wc(4," Enable quantities "),l.Pb(),l.Qb(5,"div",18),l.wc(6,"This would be like characters having a specific number of a certain item"),l.Pb(),l.Pb())}function Wr(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",7),l.Qb(1,"div",27),l.Qb(2,"div",21),l.Qb(3,"h6",28),l.wc(4),l.Pb(),l.Pb(),l.Qb(5,"div",3),l.Qb(6,"button",29),l.Xb("click",function(){l.oc(n);var e=t.index;return l.Zb().removeField(e)}),l.Mb(7,"i",30),l.Qb(8,"span",31),l.wc(9," Remove"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Mb(10,"dd-field-definition-form",32),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(4),l.xc(i.value.name),l.Ab(6),l.ec("formGroup",i)}}var Kr,Jr,ec=((Kr=function(){function e(t,n,i,r,c,o){d(this,e),this.route=t,this.campaignService=n,this.conceptService=i,this.login=r,this.location=c,this.router=o,this.saving=!1,this.deleting=!1,this.loading=!1,this.nameFieldConfig={name:"Name",description:"The name of this concept",type:pe.a.STRING,options:{maxLength:30,required:!0}},this.pluralFormFieldConfig={name:"Plural Form",description:"This will be used in various places, the plural form",type:pe.a.STRING,options:{maxLength:32,required:!0}},this.descriptionFieldConfig={name:"Description",type:pe.a.STRING,options:{maxLength:100,required:!1}}}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.formGroup=new h.h({name:new h.e(null,[h.v.required]),pluralForm:new h.e(null,[h.v.required]),description:new h.e(null),icon:new h.e(null),fields:new h.c([]),playerEditable:new h.e(!1),isShownInNavigationMenu:new h.e(!0),isLinkableToArticles:new h.e(!1),isUsableInOverviewScreen:new h.e(!1),entityConfig:new h.h({enabled:new h.e(!1),enableQuantity:new h.e(!1),fields:new h.c([])})}),this.editing&&this.route.paramMap.subscribe(function(t){var n=t.get("ct_id");e.load(n)}),this.name.valueChanges.subscribe()}},{key:"constructConceptType",value:function(){var e={name:this.name.value,pluralForm:this.pluarlForm.value,description:this.description.value,userId:this.login.id,icon:this.icon.value,playerEditable:this.playerEditable.value,campaignId:this.campaignService.campaign.id,fields:this.fields.value||[],entityConfig:this.entityConfig.value,isShownInNavigationMenu:this.isShownInNavigationMenu.value,isLinkableToArticles:this.isLinkableToArticles.value,isUsableInOverviewScreen:this.isUsableInOverviewScreen.value};return this.editing&&(e.id=this.conceptType.id,e.userId=this.conceptType.userId),e}},{key:"load",value:function(e){return $r(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,this.formGroup.disable(),t.prev=1,t.next=4,this.conceptService.getConceptType(e);case 4:this.conceptType=t.sent,this.conceptType.fields.forEach(function(e){return n.fields.push(Hr.createFormGroup(e))}),this.formGroup.patchValue(this.conceptType,{emitEvent:!1}),t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(1),t.t0;case 12:this.formGroup.enable({emitEvent:!1}),this.loading=!1;case 13:case"end":return t.stop()}},t,this,[[1,9]])}))}},{key:"addField",value:function(){this.fields.push(Hr.createFormGroup(null))}},{key:"removeField",value:function(e){this.fields.removeAt(e),this.formGroup.markAsDirty()}},{key:"canDeactivate",value:function(){return!this.formGroup.dirty}},{key:"save",value:function(){return $r(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.saving=!0,e.prev=1,t=this.constructConceptType(),!this.editing){e.next=8;break}return e.next=6,this.conceptService.updateConceptType(t);case 6:e.next=10;break;case 8:return e.next=10,this.conceptService.createConceptType(t);case 10:this.formGroup.markAsPristine(),e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(1),e.t0;case 16:return this.formGroup.markAsPristine(),this.saving=!1,e.next=20,this.router.navigate(["campaigns",this.campaignService.campaign.id,"settings"],{queryParams:{refresh:!0}});case 20:case"end":return e.stop()}},e,this,[[1,13]])}))}},{key:"trackField",value:function(e){return e}},{key:"cancel",value:function(){this.location.back()}},{key:"delete",value:function(){return $r(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.deleting=!0,e.prev=1,e.next=4,this.conceptService.deleteConceptType(this.conceptType.id);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:this.formGroup.markAsPristine(),this.cancel(),this.deleting=!1;case 10:case"end":return e.stop()}},e,this,[[1,6]])}))}},{key:"editing",get:function(){return this.route.snapshot.data.editing}},{key:"name",get:function(){return this.formGroup.get("name")}},{key:"description",get:function(){return this.formGroup.get("description")}},{key:"pluarlForm",get:function(){return this.formGroup.get("pluralForm")}},{key:"icon",get:function(){return this.formGroup.get("icon")}},{key:"playerEditable",get:function(){return this.formGroup.get("playerEditable")}},{key:"entityConfig",get:function(){return this.formGroup.get("entityConfig")}},{key:"fields",get:function(){return this.formGroup.get("fields")}},{key:"isShownInNavigationMenu",get:function(){return this.formGroup.get("isShownInNavigationMenu")}},{key:"isLinkableToArticles",get:function(){return this.formGroup.get("isLinkableToArticles")}},{key:"isUsableInOverviewScreen",get:function(){return this.formGroup.get("isUsableInOverviewScreen")}}]),e}()).\u0275fac=function(e){return new(e||Kr)(l.Lb(w.a),l.Lb(P.b),l.Lb(Rr.a),l.Lb(E.a),l.Lb(I.g),l.Lb(w.c))},Kr.\u0275cmp=l.Fb({type:Kr,selectors:[["dd-concept-type-editor"]],decls:63,vars:21,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column","mb-0"],[1,"column","col-auto"],["class","btn btn-error mr-2",3,"ngClass","click",4,"ngIf"],[1,"btn","mr-2",3,"click"],[1,"btn","btn-primary",3,"ngClass","disabled","click"],[1,"mt-2"],["showLabel","true",3,"control","config"],[1,"form-group","mt-2"],[3,"formControl"],[1,"form-group"],[1,"form-checkbox","mb-0"],["type","checkbox",3,"formControl"],[1,"form-icon"],[1,"big-space",3,"formGroup"],[1,"my-2"],["type","checkbox","formControlName","enabled"],[1,"form-input-hint","mt-0"],["class","form-group",4,"ngIf"],[1,"columns","big-space"],[1,"column"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],["class","mt-2",4,"ngFor","ngForOf","ngForTrackBy"],[1,"btn","btn-error","mr-2",3,"ngClass","click"],["type","checkbox","formControlName","enableQuantity"],[1,"columns","mb-1"],[1,"mb-0"],[1,"btn","btn-sm","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[3,"formGroup"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"h3"),l.wc(4),l.Pb(),l.Pb(),l.Qb(5,"div",3),l.vc(6,zr,2,3,"button",4),l.Qb(7,"button",5),l.Xb("click",function(){return t.cancel()}),l.wc(8," Cancel "),l.Pb(),l.Qb(9,"button",6),l.Xb("click",function(){return t.save()}),l.wc(10," Save "),l.Pb(),l.Pb(),l.Pb(),l.Qb(11,"div",7),l.Mb(12,"dd-dynamic-field",8),l.Mb(13,"dd-dynamic-field",8),l.Mb(14,"dd-dynamic-field",8),l.Qb(15,"div",9),l.Qb(16,"label"),l.wc(17,"Icon"),l.Pb(),l.Mb(18,"dd-icon-picker",10),l.Pb(),l.Qb(19,"div",11),l.Qb(20,"label",12),l.Mb(21,"input",13),l.Mb(22,"i",14),l.wc(23," Players can manage this concept "),l.Pb(),l.Pb(),l.Qb(24,"div",11),l.Qb(25,"label",12),l.Mb(26,"input",13),l.Mb(27,"i",14),l.wc(28," This concept can be linked to articles "),l.Qb(29,"i"),l.wc(30,"(ie. items in a shop)"),l.Pb(),l.Pb(),l.Pb(),l.Qb(31,"div",11),l.Qb(32,"label",12),l.Mb(33,"input",13),l.Mb(34,"i",14),l.wc(35," Show this concept in the sidebar "),l.Pb(),l.Pb(),l.Qb(36,"div",11),l.Qb(37,"label",12),l.Mb(38,"input",13),l.Mb(39,"i",14),l.wc(40," This concept can be used in the overview screen "),l.Qb(41,"i"),l.wc(42,"(ie. character statuses)"),l.Pb(),l.Pb(),l.Pb(),l.Qb(43,"div",15),l.Qb(44,"h3",16),l.wc(45,"Entity Settings"),l.Pb(),l.Qb(46,"div",11),l.Qb(47,"label",12),l.Mb(48,"input",17),l.Mb(49,"i",14),l.wc(50," Entities can have this concept "),l.Pb(),l.Qb(51,"div",18),l.wc(52," This would be like characters having items for example "),l.Pb(),l.Pb(),l.vc(53,Yr,7,0,"div",19),l.Pb(),l.Qb(54,"div",20),l.Qb(55,"div",21),l.Qb(56,"h3"),l.wc(57,"Fields"),l.Pb(),l.Pb(),l.Qb(58,"div",3),l.Qb(59,"button",22),l.Xb("click",function(){return t.addField()}),l.Mb(60,"i",23),l.wc(61," Add Field"),l.Pb(),l.Pb(),l.Pb(),l.vc(62,Wr,11,2,"div",24),l.Pb(),l.Pb()),2&e&&(l.Ab(4),l.yc("",t.editing?"Edit":"Create"," Concept Type"),l.Ab(2),l.ec("ngIf",t.editing),l.Ab(3),l.ec("ngClass",l.ic(19,Br,t.saving))("disabled",t.formGroup.invalid||t.formGroup.pristine),l.Ab(3),l.ec("control",t.name)("config",t.nameFieldConfig),l.Ab(1),l.ec("control",t.pluarlForm)("config",t.pluralFormFieldConfig),l.Ab(1),l.ec("control",t.description)("config",t.descriptionFieldConfig),l.Ab(4),l.ec("formControl",t.icon),l.Ab(3),l.ec("formControl",t.playerEditable),l.Ab(5),l.ec("formControl",t.isLinkableToArticles),l.Ab(7),l.ec("formControl",t.isShownInNavigationMenu),l.Ab(5),l.ec("formControl",t.isUsableInOverviewScreen),l.Ab(5),l.ec("formGroup",t.entityConfig),l.Ab(10),l.ec("ngIf",t.entityConfig.value.enabled),l.Ab(9),l.ec("ngForOf",t.fields.controls)("ngForTrackBy",t.trackField))},directives:[I.k,I.i,ne.a,Vr.a,h.m,h.f,h.a,h.n,h.i,h.g,I.j,Hr],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),Kr),tc=s("Kj3r"),nc=((Jr=function(){function e(){d(this,e),this.imageSize=40}return p(e,[{key:"ngOnInit",value:function(){}},{key:"imgSrc",get:function(){return this.concept.imageId?"https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/".concat(this.concept.imageId):"https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword"}}]),e}()).\u0275fac=function(e){return new(e||Jr)},Jr.\u0275cmp=l.Fb({type:Jr,selectors:[["dd-concept-list-item"]],inputs:{concept:"concept",imageSize:"imageSize"},decls:6,vars:3,consts:[[1,"columns","col-gapless"],[1,"column","col-auto","mr-2"],[1,"s-rounded","img-responsive",3,"src","width"],[1,"column"],[1,"my-0"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Mb(2,"img",2),l.Pb(),l.Qb(3,"div",3),l.Qb(4,"h5",4),l.wc(5),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(2),l.ec("src",t.imgSrc,l.qc)("width",t.imageSize),l.Ab(3),l.xc(t.concept.name))},styles:[""]}),Jr),ic=s("y4Wg");function rc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",15),l.Xb("click",function(){return l.oc(n),l.Zb(2).create()}),l.Mb(1,"i",16),l.Qb(2,"span",17),l.wc(3),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(3),l.yc(" New ",i.conceptType.name,"")}}function cc(e,t){1&e&&l.Mb(0,"i",18)}function oc(e,t){1&e&&l.Mb(0,"div",19)}function ac(e,t){if(1&e&&(l.Qb(0,"div",6),l.Qb(1,"div",7),l.Qb(2,"h3",8),l.wc(3),l.Pb(),l.Pb(),l.Qb(4,"div",7),l.vc(5,rc,4,1,"button",9),l.Pb(),l.Qb(6,"div",10),l.Qb(7,"div",11),l.Mb(8,"input",12),l.vc(9,cc,1,0,"i",13),l.vc(10,oc,1,0,"div",14),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(3),l.xc(n.conceptType.pluralForm),l.Ab(2),l.ec("ngIf",n.editing),l.Ab(3),l.ec("formControl",n.searchControl),l.Ab(1),l.ec("ngIf",!n.loading||!n.concepts),l.Ab(1),l.ec("ngIf",n.loading&&n.concepts)}}function sc(e,t){1&e&&l.Mb(0,"div",20)}function uc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",23),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).selectConcept(e)}),l.Mb(1,"dd-concept-list-item",24),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("concept",i)}}function lc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"dd-paginator",25),l.Xb("pageChange",function(e){return l.oc(n),l.Zb(2).changePage(e)}),l.Pb()}if(2&e){var i=l.Zb(2);l.ec("itemsPerPage",10)("page",i.page)("autoHide",!1)("totalItems",i.totalConcepts)("loading",i.loading)}}function dc(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,uc,2,1,"div",21),l.vc(2,lc,1,5,"dd-paginator",22),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.concepts)("ngForTrackBy",n.trackConcept),l.Ab(1),l.ec("ngIf",n.concepts&&n.concepts.length>0)}}function bc(e,t){1&e&&(l.Qb(0,"p",32),l.wc(1,"Click the button to create one"),l.Pb())}function pc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",33),l.Qb(1,"button",34),l.Xb("click",function(){return l.oc(n),l.Zb(2).create()}),l.wc(2),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(2),l.yc("Create ",i.conceptType.name,"")}}function fc(e,t){if(1&e&&(l.Qb(0,"div",26),l.Qb(1,"div",27),l.Mb(2,"i",28),l.Pb(),l.Qb(3,"p",29),l.wc(4),l.Pb(),l.vc(5,bc,2,0,"p",30),l.vc(6,pc,3,1,"div",31),l.Pb()),2&e){var n=l.Zb();l.Ab(4),l.yc("There are no ",n.conceptType.pluralForm,""),l.Ab(1),l.ec("ngIf",n.editing),l.Ab(1),l.ec("ngIf",n.editing)}}function hc(e,t){if(1&e&&(l.Qb(0,"p",32),l.wc(1),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.zc(" Click the button below to create a new ",n.conceptType.name," called ",n.search," ")}}function vc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",33),l.Qb(1,"button",34),l.Xb("click",function(){return l.oc(n),l.Zb(2).createFromSearch()}),l.wc(2),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(2),l.yc("Create ",i.search,"")}}function mc(e,t){if(1&e&&(l.Qb(0,"div",26),l.Qb(1,"div",27),l.Mb(2,"i",28),l.Pb(),l.Qb(3,"p",29),l.wc(4,"Your search returned nothing"),l.Pb(),l.vc(5,hc,2,2,"p",30),l.vc(6,vc,3,1,"div",31),l.Pb()),2&e){var n=l.Zb();l.Ab(5),l.ec("ngIf",n.canCreateFromSearch),l.Ab(1),l.ec("ngIf",n.canCreateFromSearch)}}var gc,yc=((gc=function(){function e(t,n,i,r){d(this,e),this.route=t,this.router=n,this.conceptService=i,this.campaignService=r,this.loading=!1,this.search=null,this.page=1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.searchControl=new h.e(null),this.searchControl.valueChanges.pipe(Object($i.a)(),Object(tc.a)(250)).subscribe(function(t){e.search=null==t||0===t.trim().length?null:t.trim(),e.conceptType&&(e.page=1,e.load(e.conceptType.id))}),this.route.paramMap.subscribe(function(t){var n=t.get("ct_id");e.conceptType=e.getConceptType(n),e.concepts=null;var i=e.readQueryFromURL();e.searchControl.setValue(i.search),e.page=i.offset/i.limit+1,e.search=i.search,e.load(n)})}},{key:"getConceptType",value:function(e){return this.campaignService.campaign.conceptTypes.find(function(t){return t.id===e})}},{key:"writeQueryToURL",value:function(){var e={limit:10,offset:10*(this.page-1)};this.search&&(e.search=this.search),this.router.navigate([],{relativeTo:this.route,queryParams:e,replaceUrl:!0})}},{key:"readQueryFromURL",value:function(){var e={limit:10,offset:0,search:void 0},t=this.route.snapshot.queryParamMap;try{t.has("limit")&&(e.limit=parseInt(t.get("limit"),10)),t.has("offset")&&(e.offset=parseInt(t.get("offset"),10)),t.has("search")&&(e.search=t.get("search"))}catch(n){}return e}},{key:"load",value:function(e){return t=this,i=regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.conceptType){t.next=15;break}return this.loadError=void 0,this.loading=!0,t.prev=2,t.next=5,this.conceptService.getConcepts(e,10,10*(this.page-1),this.search);case 5:n=t.sent,this.concepts=n.concepts,this.totalConcepts=n.total,this.writeQueryToURL(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),this.loadError=t.t0;case 12:this.loading=!1,t.next=16;break;case 15:this.loadError={status:404};case 16:case"end":return t.stop()}},t,this,[[2,9]])}),new((n=void 0)||(n=Promise))(function(e,r){function c(e){try{a(i.next(e))}catch(t){r(t)}}function o(e){try{a(i.throw(e))}catch(t){r(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n(function(e){e(i)})).then(c,o)}a((i=i.apply(t,[])).next())});var t,n,i}},{key:"create",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,"create"])}},{key:"createFromSearch",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,"create"],{queryParams:{name:this.search}})}},{key:"selectConcept",value:function(e){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,e.id,"view"])}},{key:"trackConcept",value:function(e,t){return t.id}},{key:"changePage",value:function(e){this.page=e,this.load(this.conceptType.id)}},{key:"editing",get:function(){return this.campaignService.canEdit||this.conceptType&&this.conceptType.playerEditable}},{key:"canCreateFromSearch",get:function(){return this.editing&&this.search}}]),e}()).\u0275fac=function(e){return new(e||gc)(l.Lb(w.a),l.Lb(w.c),l.Lb(Rr.a),l.Lb(P.b))},gc.\u0275cmp=l.Fb({type:gc,selectors:[["dd-concept-manager"]],decls:7,vars:6,consts:[[1,"container","grid-xl"],[3,"error"],["class","columns",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],[1,"columns"],[1,"column","col-auto"],[1,"mb-0"],["class","btn btn-sm",3,"click",4,"ngIf"],[1,"column","col-sm-12","my-1"],[1,"has-icon-right"],["type","text","placeholder","Search...",1,"form-input",3,"formControl"],["class","icon icon-search form-icon",4,"ngIf"],["class","loading form-icon",4,"ngIf"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"icon","icon-search","form-icon"],[1,"loading","form-icon"],[1,"loading","loading-lg"],["class","card p-1 hoverable mb-1",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"itemsPerPage","page","autoHide","totalItems","loading","pageChange",4,"ngIf"],[1,"card","p-1","hoverable","mb-1",3,"click"],[3,"concept"],[3,"itemsPerPage","page","autoHide","totalItems","loading","pageChange"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],["class","empty-action",4,"ngIf"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Mb(1,"dd-http-errors",1),l.vc(2,ac,11,5,"div",2),l.vc(3,sc,1,0,"div",3),l.vc(4,dc,3,3,"div",4),l.vc(5,fc,7,3,"div",5),l.vc(6,mc,7,2,"div",5),l.Pb()),2&e&&(l.Ab(1),l.ec("error",t.loadError),l.Ab(1),l.ec("ngIf",t.conceptType),l.Ab(1),l.ec("ngIf",t.loading&&!t.concepts),l.Ab(1),l.ec("ngIf",t.concepts&&t.conceptType),l.Ab(1),l.ec("ngIf",t.conceptType&&t.concepts&&0===t.totalConcepts&&!t.search),l.Ab(1),l.ec("ngIf",t.conceptType&&t.concepts&&0===t.concepts.length&&t.search))},directives:[rr.a,I.k,h.b,h.m,h.f,I.j,nc,ic.a],styles:[""]}),gc),kc=s("nXDu"),wc=s("hEiF"),Pc=s("+awi");function Ic(e,t){1&e&&(l.Qb(0,"span",7),l.wc(1,"*"),l.Pb())}function Cc(e,t){if(1&e&&(l.Qb(0,"p",8),l.wc(1),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.yc(" ",n.fieldConfig.description," ")}}var xc,Qc=function(e,t){return{"has-error":e,"has-success":t}},Ac=((xc=function(e){n(c,e);var i=r(c);function c(){return d(this,c),i.call(this)}return p(c,[{key:"ngOnInit",value:function(){t(o(c.prototype),"ngOnInit",this).call(this)}}]),c}(kc.a)).\u0275fac=function(e){return new(e||xc)},xc.\u0275cmp=l.Fb({type:xc,selectors:[["dd-dynamic-field-horizontal"]],features:[l.xb],decls:10,vars:11,consts:[[1,"form-group",3,"ngClass"],[1,"col-2","col-lg-3","col-sm-12"],[1,"form-label"],["class","text-primary text-large text-bold",4,"ngIf"],[1,"col-10","col-lg-9","col-md-12"],[3,"config","control"],["class","form-input-hint mb-0",4,"ngIf"],[1,"text-primary","text-large","text-bold"],[1,"form-input-hint","mb-0"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"label",2),l.wc(3),l.vc(4,Ic,2,0,"span",3),l.Pb(),l.Pb(),l.Qb(5,"div",4),l.Qb(6,"div"),l.Mb(7,"dd-dynamic-input",5),l.vc(8,Cc,2,1,"p",6),l.Mb(9,"dd-dynamic-validation-errors",5),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.ec("ngClass",l.jc(8,Qc,t.control.invalid&&(t.control.dirty||t.control.touched),t.control.valid&&(t.control.dirty||t.control.touched))),l.Ab(3),l.yc("",t.fieldConfig.name," "),l.Ab(1),l.ec("ngIf",t.options.required),l.Ab(3),l.ec("config",t.fieldConfig)("control",t.control),l.Ab(1),l.ec("ngIf",t.fieldConfig.description),l.Ab(1),l.ec("config",t.fieldConfig)("control",t.control))},directives:[I.i,I.k,wc.a,Pc.a],styles:["[_nghost-%COMP%]{display:block}"]}),xc),Tc=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function Ec(e,t){1&e&&l.Mb(0,"div",5)}function Rc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",14),l.Xb("click",function(){return l.oc(n),l.Zb(2).delete()}),l.Mb(1,"i",15),l.wc(2," Delete"),l.Pb()}}var Lc=function(e){return{loading:e}};function Mc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",6),l.Qb(1,"div",7),l.Qb(2,"h3"),l.wc(3),l.Pb(),l.Pb(),l.Qb(4,"div",8),l.Qb(5,"button",9),l.Xb("click",function(){return l.oc(n),l.Zb().cancel()}),l.Mb(6,"i",10),l.wc(7," Cancel"),l.Pb(),l.vc(8,Rc,3,0,"button",11),l.Qb(9,"button",12),l.Xb("click",function(){return l.oc(n),l.Zb().save()}),l.Mb(10,"i",13),l.wc(11," Save "),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(3),l.zc("",i.editing?"Edit":"Create"," ",i.conceptType.name,""),l.Ab(5),l.ec("ngIf",i.editing),l.Ab(1),l.ec("disabled",i.formGroup.invalid||i.formGroup.pristine)("ngClass",l.ic(5,Lc,i.saving))}}function Sc(e,t){if(1&e&&l.Mb(0,"dd-dynamic-field-horizontal",26),2&e){var n=t.$implicit,i=t.index,r=l.Zb(2);l.ec("config",r.getFieldConfig(n))("control",r.fields.controls[i])}}function Oc(e,t){if(1&e&&(l.Qb(0,"div",16),l.Qb(1,"div",6),l.Qb(2,"div",8),l.Mb(3,"dd-image-upload",17),l.Pb(),l.Qb(4,"div",7),l.Mb(5,"dd-dynamic-field",18),l.Mb(6,"dd-dynamic-field",18),l.Qb(7,"div",19),l.Qb(8,"label",20),l.wc(9,"Tags"),l.Pb(),l.Mb(10,"dd-tag-editor",16),l.Pb(),l.Qb(11,"label",21),l.Mb(12,"input",22),l.Mb(13,"i",23),l.wc(14),l.Pb(),l.Pb(),l.Pb(),l.Qb(15,"div",24),l.vc(16,Sc,1,2,"dd-dynamic-field-horizontal",25),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.ec("formGroup",n.formGroup),l.Ab(5),l.ec("control",n.name)("config",n.nameFieldConfig),l.Ab(1),l.ec("control",n.description)("config",n.descriptionFieldConfig),l.Ab(4),l.ec("formGroup",n.formGroup),l.Ab(4),l.yc(" This ",n.conceptType.name," is a container "),l.Ab(2),l.ec("ngForOf",n.conceptType.fields)("ngForTrackBy",n.trackField)}}var Nc,_c=((Nc=function(){function e(t,n,i,r,c){d(this,e),this.route=t,this.router=n,this.conceptService=i,this.campaignService=r,this.location=c,this.loading=!1,this.saving=!1,this.deleting=!0,this.nameFieldConfig={name:"Name",description:"The name of this concept",type:pe.a.STRING,options:{maxLength:30,required:!0}},this.descriptionFieldConfig={name:"Description",type:pe.a.TEXT_FORMATTED}}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.formGroup=new h.h({name:new h.e(null,[h.v.required,h.v.maxLength(30)]),imageId:new h.e(null),content:new h.e(null),isContainer:new h.e(!1),fields:new h.c([]),tags:new h.c([])}),!this.editing&&this.route.snapshot.queryParamMap.has("name")&&(this.name.setValue(this.route.snapshot.queryParamMap.get("name")),this.name.markAsDirty()),this.route.paramMap.subscribe(function(t){var n=t.get("ct_id"),i=t.get("c_id");e.conceptType=e.getConceptType(n),null==e.conceptType?e.error={status:404}:(e.conceptType.fields.forEach(function(){e.fields.push(new h.e(null))}),e.editing&&e.load(i))})}},{key:"getConceptType",value:function(e){return this.campaignService.campaign.conceptTypes.find(function(t){return t.id===e})}},{key:"constructConcept",value:function(){var e=this,t={name:this.name.value,content:this.description.value,userId:"dmmy",isContainer:this.isContainer.value,fields:this.fields.value.map(function(t,n){return{name:e.conceptType.fields[n].name,value:t}}).filter(function(e){return null!=e.value&&""!==e.value}),tags:this.tags.value,imageId:this.imageId.value,conceptTypeId:this.conceptType.id};return this.editing&&(t.id=this.concept.id),t}},{key:"load",value:function(e){return Tc(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,this.formGroup.disable(),t.prev=1,t.next=4,this.conceptService.getConcept(e);case 4:this.concept=t.sent,t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(1),t.t0;case 10:this.formGroup.patchValue(Object.assign(Object.assign({},this.concept),{fields:this.conceptType.fields.map(function(e){var t=n.concept.fields.find(function(t){return t.name===e.name});return t?t.value:null})}),{emitEvent:!1}),this.formGroup.setControl("tags",new h.c(this.concept.tags.map(function(e){return new h.e(e)}))),this.formGroup.enable(),this.loading=!1,this.formGroup.markAsPristine();case 11:case"end":return t.stop()}},t,this,[[1,7]])}))}},{key:"cancel",value:function(){this.location.back()}},{key:"delete",value:function(){return Tc(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mt.a.fire({title:"Are you sure?",text:"You will not be able to undo this",showCancelButton:!0});case 2:if(!e.sent.value){e.next=13;break}return this.formGroup.markAsPristine(),this.formGroup.disable(),this.deleting=!0,e.prev=4,e.next=7,this.conceptService.deleteConcept(this.concept.id);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),e.t0;case 12:this.cancel();case 13:case"end":return e.stop()}},e,this,[[4,9]])}))}},{key:"save",value:function(){return Tc(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.formGroup.valid){e.next=19;break}if(this.saving=!0,e.prev=2,t=this.constructConcept(),!this.editing){e.next=9;break}return e.next=7,this.conceptService.updateConcept(t);case 7:e.next=11;break;case 9:return e.next=11,this.conceptService.createConcept(t);case 11:this.formGroup.markAsPristine(),this.cancel(),e.next=18;break;case 15:throw e.prev=15,e.t0=e.catch(2),e.t0;case 18:this.saving=!1;case 19:case"end":return e.stop()}},e,this,[[2,15]])}))}},{key:"trackField",value:function(e){return e}},{key:"getFieldConfig",value:function(e){return e.type===pe.a.CURRENCY&&(e.options={levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}),e}},{key:"editing",get:function(){return this.route.snapshot.data.editing}},{key:"name",get:function(){return this.formGroup.get("name")}},{key:"description",get:function(){return this.formGroup.get("content")}},{key:"imageId",get:function(){return this.formGroup.get("imageId")}},{key:"isContainer",get:function(){return this.formGroup.get("isContainer")}},{key:"fields",get:function(){return this.formGroup.get("fields")}},{key:"tags",get:function(){return this.formGroup.get("tags")}}]),e}()).\u0275fac=function(e){return new(e||Nc)(l.Lb(w.a),l.Lb(w.c),l.Lb(Rr.a),l.Lb(P.b),l.Lb(I.g))},Nc.\u0275cmp=l.Fb({type:Nc,selectors:[["dd-concept-editor"]],decls:5,vars:4,consts:[[1,"container","grid-xl"],[3,"error"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column"],[1,"column","col-auto"],[1,"btn","mr-2",3,"click"],[1,"icon","icon-arrow-left"],["class","btn btn-error mr-2",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","ngClass","click"],[1,"icon","icon-check"],[1,"btn","btn-error","mr-2",3,"click"],[1,"icon","icon-cross"],[3,"formGroup"],["formControlName","imageId"],["showLabel","true",3,"control","config"],[1,"form-group"],[1,"form-label"],[1,"form-checkbox"],["type","checkbox","formControlName","isContainer"],[1,"form-icon"],[1,"form-horizontal"],["class","col-12 mb-2",3,"config","control",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-12","mb-2",3,"config","control"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Mb(1,"dd-http-errors",1),l.vc(2,Ec,1,0,"div",2),l.vc(3,Mc,12,7,"div",3),l.vc(4,Oc,17,9,"div",4),l.Pb()),2&e&&(l.Ab(1),l.ec("error",t.error),l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.conceptType),l.Ab(1),l.ec("ngIf",t.conceptType))},directives:[rr.a,I.k,I.i,h.n,h.i,Et,h.m,h.g,ne.a,Lr.a,h.a,I.j,Ac],styles:[""]}),Nc);function Fc(e,t){1&e&&l.Mb(0,"div",5)}function Uc(e,t){if(1&e&&l.Mb(0,"img",16),2&e){var n=l.Zb(2);l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.concept.imageId,"",l.qc)}}function qc(e,t){1&e&&l.Mb(0,"img",17)}function Gc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",18),l.Xb("click",function(){return l.oc(n),l.Zb(2).edit()}),l.Mb(1,"i",19),l.Qb(2,"span",14),l.wc(3," Edit"),l.Pb(),l.Pb()}}function Dc(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",6),l.Qb(1,"div",7),l.vc(2,Uc,1,1,"img",8),l.vc(3,qc,1,0,"img",9),l.Pb(),l.Qb(4,"div",10),l.Qb(5,"h2",11),l.wc(6),l.Pb(),l.Pb(),l.Qb(7,"div",7),l.Qb(8,"button",12),l.Xb("click",function(){return l.oc(n),l.Zb().history()}),l.Mb(9,"i",13),l.Qb(10,"span",14),l.wc(11," History"),l.Pb(),l.Pb(),l.vc(12,Gc,4,0,"button",15),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(2),l.ec("ngIf",i.concept.imageId),l.Ab(1),l.ec("ngIf",!i.concept.imageId),l.Ab(3),l.xc(i.concept.name),l.Ab(6),l.ec("ngIf",i.editable)}}function Zc(e,t){if(1&e&&(l.Qb(0,"div",29),l.Mb(1,"img",30),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",n.concept.imageId,"",l.qc),l.ec("alt","picture of"+n.concept.name)}}function Xc(e,t){if(1&e&&l.Mb(0,"dd-quill",31),2&e){var n=l.Zb(2);l.ec("value",n.concept.content)}}function jc(e,t){1&e&&(l.Qb(0,"p",32),l.wc(1," There is nothing here... "),l.Pb())}function Hc(e,t){if(1&e&&(l.Qb(0,"div",33),l.Qb(1,"h5",34),l.wc(2),l.Pb(),l.Mb(3,"dd-quill",31),l.Pb()),2&e){var n=t.$implicit;l.Ab(2),l.xc(n.name),l.Ab(1),l.ec("value",n.value)}}function Vc(e,t){if(1&e&&(l.Qb(0,"div",37),l.wc(1),l.Pb()),2&e){var n=t.$implicit;l.Ab(1),l.yc(" ",n," ")}}function $c(e,t){if(1&e&&(l.Qb(0,"div",35),l.vc(1,Vc,2,1,"div",36),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("ngForOf",n.concept.tags)}}function Bc(e,t){if(1&e&&l.Mb(0,"span",43),2&e){var n=l.Zb().$implicit;l.ec("ddCurrency",n.field.value)}}function zc(e,t){if(1&e&&(l.Qb(0,"span"),l.wc(1),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(1),l.yc(" ",n.field.value," ")}}function Yc(e,t){if(1&e&&(l.Qb(0,"tr"),l.Qb(1,"td"),l.wc(2),l.Pb(),l.Qb(3,"td",40),l.vc(4,Bc,1,1,"span",41),l.vc(5,zc,2,1,"span",42),l.Pb(),l.Pb()),2&e){var n=t.$implicit;l.Ab(2),l.xc(n.field.name),l.Ab(1),l.ec("ngSwitch",n.config.type),l.Ab(1),l.ec("ngSwitchCase",6)}}function Wc(e,t){if(1&e&&(l.Qb(0,"table",38),l.Qb(1,"thead"),l.Qb(2,"th"),l.wc(3,"Field"),l.Pb(),l.Qb(4,"th"),l.wc(5,"Value"),l.Pb(),l.Pb(),l.Qb(6,"tbody"),l.vc(7,Yc,6,3,"tr",39),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(7),l.ec("ngForOf",n.tableFields)("ngForTrackBy",n.trackField)}}function Kc(e,t){if(1&e&&(l.Qb(0,"div",44),l.Mb(1,"img",30),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",n.concept.imageId,"",l.qc),l.ec("alt","picture of"+n.concept.name)}}var Jc=function(e,t){return{"col-8":e,"col-12":t}};function eo(e,t){if(1&e&&(l.Qb(0,"div",20),l.vc(1,Zc,2,2,"div",21),l.Qb(2,"div",22),l.vc(3,Xc,1,1,"dd-quill",23),l.vc(4,jc,2,0,"p",24),l.vc(5,Hc,4,2,"div",25),l.vc(6,$c,2,1,"div",26),l.vc(7,Wc,8,2,"table",27),l.Pb(),l.vc(8,Kc,2,2,"div",28),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngIf",n.concept.imageId),l.Ab(1),l.ec("ngClass",l.jc(8,Jc,null!==n.concept.imageId,null===n.concept.imageId)),l.Ab(1),l.ec("ngIf",n.concept.content),l.Ab(1),l.ec("ngIf",!n.concept.content),l.Ab(1),l.ec("ngForOf",n.formattedTextFields),l.Ab(1),l.ec("ngIf",n.concept.tags),l.Ab(1),l.ec("ngIf",n.tableFields.length>0),l.Ab(1),l.ec("ngIf",n.concept.imageId)}}var to,no=((to=function(){function e(t,n,i,r){d(this,e),this.route=t,this.router=n,this.campaignService=i,this.conceptService=r,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.route.paramMap.subscribe(function(t){var n=t.get("c_id"),i=t.get("ct_id");e.conceptType=e.getConceptType(i),null==e.conceptType?e.loadError={status:404}:e.load(n)})}},{key:"getConceptType",value:function(e){return this.campaignService.campaign.conceptTypes.find(function(t){return t.id===e})}},{key:"load",value:function(e){return t=this,i=regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,this.conceptService.getConcept(e);case 4:this.concept=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),this.loadError=t.t0;case 10:this.loading=!1;case 11:case"end":return t.stop()}},t,this,[[1,7]])}),new((n=void 0)||(n=Promise))(function(e,r){function c(e){try{a(i.next(e))}catch(t){r(t)}}function o(e){try{a(i.throw(e))}catch(t){r(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n(function(e){e(i)})).then(c,o)}a((i=i.apply(t,[])).next())});var t,n,i}},{key:"edit",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,this.concept.id,"edit"])}},{key:"history",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,this.concept.id,"history"])}},{key:"getFieldConfig",value:function(e){return this.conceptType.fields.find(function(t){return t.name===e.name})}},{key:"trackField",value:function(e){return e}},{key:"tableFields",get:function(){var e,t=[],n=a(this.concept.fields);try{for(n.s();!(e=n.n()).done;){var i=e.value,r=this.getFieldConfig(i);-1!==[pe.a.BOOLEAN,pe.a.ENUM,pe.a.ENUM_MULTI,pe.a.FLOAT,pe.a.INT,pe.a.STRING,pe.a.CURRENCY].indexOf(r.type)&&t.push({field:i,config:r})}}catch(c){n.e(c)}finally{n.f()}return t}},{key:"formattedTextFields",get:function(){var e,t=[],n=a(this.concept.fields);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.getFieldConfig(i).type===pe.a.TEXT_FORMATTED&&t.push(i)}}catch(r){n.e(r)}finally{n.f()}return t}},{key:"editable",get:function(){return this.campaignService.canEdit||this.conceptType&&this.conceptType.playerEditable}},{key:"user",get:function(){var e=this;if(this.concept){var t=this.campaignService.campaign.members.find(function(t){return t.userId===e.concept.userId});if(t)return t.user}return null}}]),e}()).\u0275fac=function(e){return new(e||to)(l.Lb(w.a),l.Lb(w.c),l.Lb(P.b),l.Lb(Rr.a))},to.\u0275cmp=l.Fb({type:to,selectors:[["dd-concept-view"]],decls:5,vars:4,consts:[[1,"container","grid-xl"],["class","loading loading-lg",4,"ngIf"],[3,"error"],["class","columns",4,"ngIf"],["class","columns mt-2",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column","col-auto"],["class","s-rounded","width","64","alt","Item Picture",3,"src",4,"ngIf"],["class","s-rounded","width","64","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword","alt","Item Fallback Picture",4,"ngIf"],[1,"column"],[1,"mb-0"],[1,"btn","btn-sm","mr-1",3,"click"],[1,"icon","icon-time"],[1,"hide-sm"],["class","btn btn-sm",3,"click",4,"ngIf"],["width","64","alt","Item Picture",1,"s-rounded",3,"src"],["width","64","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword","alt","Item Fallback Picture",1,"s-rounded"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-edit"],[1,"columns","mt-2"],["class","column col-4 hide-md",4,"ngIf"],[1,"column","col-md-12",3,"ngClass"],["readOnly","true",3,"value",4,"ngIf"],["class","text-italic text-center",4,"ngIf"],["class","mt-2",4,"ngFor","ngForOf"],["class","big-space",4,"ngIf"],["class","table",4,"ngIf"],["class","column col-md-8 col-xs-11 col-mx-auto show-md mt-2",4,"ngIf"],[1,"column","col-4","hide-md"],[1,"img-responsive","s-rounded",3,"src","alt"],["readOnly","true",3,"value"],[1,"text-italic","text-center"],[1,"mt-2"],[1,"mb-1"],[1,"big-space"],["class","label label-rounded mr-1 mb-1",4,"ngFor","ngForOf"],[1,"label","label-rounded","mr-1","mb-1"],[1,"table"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],[3,"ddCurrency",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"ddCurrency"],[1,"column","col-md-8","col-xs-11","col-mx-auto","show-md","mt-2"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,Fc,1,0,"div",1),l.Mb(2,"dd-http-errors",2),l.vc(3,Dc,13,4,"div",3),l.vc(4,eo,9,11,"div",4),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("error",t.loadError),l.Ab(1),l.ec("ngIf",t.concept),l.Ab(1),l.ec("ngIf",t.concept))},directives:[I.k,rr.a,I.i,I.j,fe.a,I.l,I.m,I.n,Ae.a],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),to),io=function(e){return e[e.CREATE=0]="CREATE",e[e.UPDATE=1]="UPDATE",e[e.DELETE=2]="DELETE",e[e.RESTORE=3]="RESTORE",e}({}),ro=s("bo1M"),co=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function oo(e,t){1&e&&l.Mb(0,"div",4)}function ao(e,t){if(1&e&&l.Mb(0,"dd-http-errors",5),2&e){var n=l.Zb();l.ec("error",n.loadErr)}}function so(e,t){1&e&&l.Mb(0,"i",21)}function uo(e,t){1&e&&l.Mb(0,"i",22)}function lo(e,t){1&e&&l.Mb(0,"i",23)}function bo(e,t){1&e&&l.Mb(0,"li",26),2&e&&l.ec("innerHTML",t.$implicit,l.pc)}function po(e,t){if(1&e&&(l.Qb(0,"ul",24),l.vc(1,bo,1,1,"li",25),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(1),l.ec("ngForOf",n.changes)}}var fo=function(e){return{loading:e}};function ho(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",27),l.Xb("click",function(){l.oc(n);var e=l.Zb().$implicit;return l.Zb(2).restore(e)}),l.Mb(1,"i",23),l.Qb(2,"span",28),l.wc(3," Restore"),l.Pb(),l.Pb()}if(2&e){var i=l.Zb().$implicit,r=l.Zb(2);l.ec("ngClass",l.ic(1,fo,r.restoringId===i.id))}}var vo=function(e){return{"icon-lg":e}};function mo(e,t){if(1&e&&(l.Qb(0,"div",8),l.Qb(1,"div",9),l.Qb(2,"a",10),l.vc(3,so,1,0,"i",11),l.vc(4,uo,1,0,"i",12),l.vc(5,lo,1,0,"i",13),l.Pb(),l.Pb(),l.Qb(6,"div",14),l.Qb(7,"div",15),l.Qb(8,"div",16),l.Qb(9,"strong"),l.wc(10),l.Pb(),l.wc(11),l.vc(12,po,2,1,"ul",17),l.Qb(13,"div"),l.wc(14),l.ac(15,"date"),l.Pb(),l.Mb(16,"div",18),l.Pb(),l.Qb(17,"div",19),l.vc(18,ho,4,3,"button",20),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=t.first,r=t.last,c=l.Zb(2);l.Ab(2),l.ec("ngClass",l.ic(14,vo,!i))("ngSwitch",n.actionType),l.Ab(1),l.ec("ngSwitchCase",1),l.Ab(1),l.ec("ngSwitchCase",2),l.Ab(1),l.ec("ngSwitchCase",3),l.Ab(5),l.xc(n.name),l.Ab(1),l.yc(" ",1===n.actionSource?"imported":c.getEntryActionText(n),". "),l.Ab(1),l.ec("ngIf",n.changes.length>0),l.Ab(2),l.xc(l.bc(15,11,c.getDate(n),"short")),l.Ab(2),l.ec("ddUser",c.getUser(n.userId)),l.Ab(2),l.ec("ngIf",!r&&c.editable)}}function go(e,t){if(1&e&&(l.Qb(0,"div",6),l.vc(1,mo,19,16,"div",7),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.diffedHistory)}}var yo,ko=((yo=function(){function e(t,n,i){d(this,e),this.conceptService=t,this.campaignService=n,this.route=i,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.route.paramMap.subscribe(function(t){var n=t.get("c_id");t.get("ct_id"),e.load(n)})}},{key:"load",value:function(e){return co(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,this.conceptService.getConceptHistory(e);case 4:this.conceptHistory=t.sent,this.diffedHistory=this.makeDiffedHistory(this.conceptHistory),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),this.loadErr=t.t0;case 11:this.loading=!1;case 12:case"end":return t.stop()}},t,this,[[1,8]])}))}},{key:"prefilterHistory",value:function(e,t){return-1!==["id","userId","dateTime","actionType","actionSource","conceptId","conceptTypeId"].indexOf(t)}},{key:"makeDiffedHistory",value:function(e){for(var t=[],n=0;n<e.length;n++)if(0!==n){var i=ro.diff(e[n-1],e[n],this.prefilterHistory),r=this.getHumanReadableListOfDiffChanges(i,e[n]);t.push(Object.assign(Object.assign({},e[n]),{diff:i,changes:r||[]}))}else t.push(Object.assign(Object.assign({},e[n]),{diff:null,changes:[]}));return t}},{key:"getHumanReadableListOfDiffChanges",value:function(e,t){var n=[];if(null==e)return n;var i,r=a(e);try{for(r.s();!(i=r.n()).done;){var c=i.value;if(c)switch(c.kind){case"A":if("fields"===c.path[0])switch(c.item.kind){case"N":n.push("<b>Added ".concat(c.item.rhs.name,":</b> ").concat(c.item.rhs.value));break;case"D":n.push("<b>Removed ".concat(c.item.lhs.name,"</b>"))}if("tags"===c.path[0])switch(c.item.kind){case"N":n.push("<b>Added Tag:</b> ".concat(c.item.rhs));break;case"D":n.push("<b>Removed Tag</b>: ".concat(c.item.lhs))}break;case"D":break;case"E":switch(c.path[0]){case"name":n.push("<b>Name:</b> ".concat(c.lhs," \u27a1\ufe0f ").concat(c.rhs));break;case"content":n.push("<b>Updated description</b>");break;case"fields":n.push("<b>".concat(t.fields[c.path[1]].name,":</b> ").concat(c.lhs," \u27a1\ufe0f ").concat(c.rhs));break;case"tags":n.push("<b>Removed Tag</b>: ".concat(c.lhs)),n.push("<b>Added Tag</b>: ".concat(c.rhs));break;case"imageId":n.push("<b>Changed Image</b>")}}}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"restore",value:function(e){return co(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.restoringId=e.id,t.prev=1,t.next=4,this.conceptService.restoreConcept(e.conceptId,e.id);case 4:this.load(e.conceptId),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(1),t.t0;case 10:this.restoringId=null;case 11:case"end":return t.stop()}},t,this,[[1,7]])}))}},{key:"getUser",value:function(e){var t=this.campaignService.campaign.members.find(function(t){return t.userId===e});return t?t.user:null}},{key:"getDate",value:function(e){return new Date(e.dateTime)}},{key:"getEntryActionText",value:function(e){switch(e.actionType){case io.CREATE:return"created";case io.DELETE:return"deleted";case io.UPDATE:return"updated";case io.RESTORE:return"restored"}}},{key:"editable",get:function(){return this.campaignService.canEdit}}]),e}()).\u0275fac=function(e){return new(e||yo)(l.Lb(Rr.a),l.Lb(P.b),l.Lb(w.a))},yo.\u0275cmp=l.Fb({type:yo,selectors:[["dd-concept-history"]],decls:4,vars:3,consts:[[1,"container","grid-sm"],["class","loading loading-lg",4,"ngIf"],[3,"error",4,"ngIf"],["class","timeline",4,"ngIf"],[1,"loading","loading-lg"],[3,"error"],[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],[1,"timeline-item"],[1,"timeline-left"],[1,"timeline-icon",3,"ngClass","ngSwitch"],["class","icon icon-edit",4,"ngSwitchCase"],["class","icon icon-delete",4,"ngSwitchCase"],["class","icon icon-refresh",4,"ngSwitchCase"],[1,"timeline-content"],[1,"tile"],[1,"tile-content"],["class","my-0",4,"ngIf"],[3,"ddUser"],[1,"tile-action"],["class","btn btn-sm",3,"ngClass","click",4,"ngIf"],[1,"icon","icon-edit"],[1,"icon","icon-delete"],[1,"icon","icon-refresh"],[1,"my-0"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"btn","btn-sm",3,"ngClass","click"],[1,"hide-sm"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,oo,1,0,"div",1),l.vc(2,ao,1,1,"dd-http-errors",2),l.vc(3,go,2,1,"div",3),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.loadErr),l.Ab(1),l.ec("ngIf",t.diffedHistory))},directives:[I.k,rr.a,I.j,I.i,I.l,I.m,D.a],pipes:[I.d],styles:[""]}),yo),wo=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function Po(e,t){1&e&&l.Mb(0,"div",2)}var Io=function(e){return{loading:e}};function Co(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",10),l.Qb(1,"div",11),l.Mb(2,"i",12),l.Pb(),l.Qb(3,"p",13),l.wc(4,"There are no invites"),l.Pb(),l.Qb(5,"p",14),l.wc(6,"Click the button below to create one"),l.Pb(),l.Qb(7,"div",15),l.Qb(8,"button",16),l.Xb("click",function(){return l.oc(n),l.Zb(2).createInvite()}),l.wc(9," Create invite "),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(8),l.ec("ngClass",l.ic(1,Io,i.creatingInvite))}}function xo(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",17),l.Xb("click",function(){return l.oc(n),l.Zb(2).createInvite()}),l.Mb(1,"i",18),l.Qb(2,"span",19),l.wc(3," Create Invite"),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.ec("ngClass",l.ic(1,Io,i.creatingInvite))}}function Qo(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Pending"),l.Pb())}function Ao(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Revoked"),l.Pb())}function To(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Accepted"),l.Pb())}function Eo(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"Declined"),l.Pb())}function Ro(e,t){1&e&&(l.Qb(0,"span"),l.wc(1,"N/A"),l.Pb())}function Lo(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",27),l.Xb("click",function(){l.oc(n);var e=l.Zb().$implicit;return l.Zb(3).revokeInvite(e)}),l.Mb(1,"i",28),l.wc(2,"Revoke "),l.Pb()}}function Mo(e,t){if(1&e&&(l.Qb(0,"tr"),l.Qb(1,"td"),l.Qb(2,"a",22),l.wc(3,"Link"),l.Pb(),l.Pb(),l.Qb(4,"td"),l.wc(5),l.Pb(),l.Qb(6,"td",23),l.vc(7,Qo,2,0,"span",24),l.vc(8,Ao,2,0,"span",24),l.vc(9,To,2,0,"span",24),l.vc(10,Eo,2,0,"span",24),l.Pb(),l.Qb(11,"td"),l.Mb(12,"div",25),l.vc(13,Ro,2,0,"span",1),l.Pb(),l.Qb(14,"td"),l.vc(15,Lo,3,0,"button",26),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(3);l.Ab(2),l.ec("href",i.getInviteLink(n.id),l.qc),l.Ab(3),l.xc(n.name),l.Ab(1),l.ec("ngSwitch",n.status),l.Ab(1),l.ec("ngSwitchCase",0),l.Ab(1),l.ec("ngSwitchCase",1),l.Ab(1),l.ec("ngSwitchCase",2),l.Ab(1),l.ec("ngSwitchCase",3),l.Ab(2),l.ec("ddUser",n.user),l.Ab(1),l.ec("ngIf",!n.user),l.Ab(2),l.ec("ngIf",0===n.status)}}function So(e,t){if(1&e&&(l.Qb(0,"table",20),l.Qb(1,"thead"),l.Qb(2,"tr"),l.Qb(3,"th"),l.wc(4,"Link"),l.Pb(),l.Qb(5,"th"),l.wc(6,"Name"),l.Pb(),l.Qb(7,"th"),l.wc(8,"Status"),l.Pb(),l.Qb(9,"th"),l.wc(10,"User"),l.Pb(),l.Mb(11,"th"),l.Pb(),l.Pb(),l.Qb(12,"tbody"),l.vc(13,Mo,16,10,"tr",21),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(13),l.ec("ngForOf",n.invites)}}function Oo(e,t){if(1&e&&(l.Qb(0,"div"),l.vc(1,Co,10,3,"div",3),l.Qb(2,"div",4),l.Qb(3,"div",5),l.Qb(4,"h4",6),l.wc(5,"Invites"),l.Pb(),l.Pb(),l.Qb(6,"div",7),l.vc(7,xo,4,3,"button",8),l.Pb(),l.Pb(),l.vc(8,So,14,1,"table",9),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngIf",0===n.invites.length),l.Ab(6),l.ec("ngIf",n.invites.length>0),l.Ab(1),l.ec("ngIf",n.invites.length>0)}}var No,_o=((No=function(){function e(t){d(this,e),this.campaignService=t,this.loading=!1,this.creatingInvite=!1}return p(e,[{key:"ngOnInit",value:function(){this.loadInvites()}},{key:"createInvite",value:function(){return wo(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.creatingInvite=!0,t=new R.Chance,e.prev=2,e.next=5,this.campaignService.createInvite("".concat(t.state({full:!0,territories:!0})," ").concat(t.animal()));case 5:n=e.sent,this.invites.push(n),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(2),e.t0;case 12:this.creatingInvite=!1;case 13:case"end":return e.stop()}},e,this,[[2,9]])}))}},{key:"revokeInvite",value:function(e){return wo(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=Object.assign(Object.assign({},e),{status:P.a.REVOKED}),t.next=4,this.campaignService.updateInvite(n);case 4:e.status=n.status,t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}},t,this,[[0,7]])}))}},{key:"getInviteLink",value:function(e){return"".concat(location.protocol,"//").concat(location.host,"/invite/").concat(e)}},{key:"loadInvites",value:function(){return wo(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.campaignService.getInvites();case 4:t=e.sent,this.invites=t,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:this.loading=!1;case 12:case"end":return e.stop()}},e,this,[[1,8]])}))}}]),e}()).\u0275fac=function(e){return new(e||No)(l.Lb(P.b))},No.\u0275cmp=l.Fb({type:No,selectors:[["dd-invite-manager"]],decls:2,vars:2,consts:[["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],["class","empty",4,"ngIf"],[1,"columns"],[1,"column"],[1,"mb-0"],[1,"column","col-auto"],["class","btn btn-sm",3,"ngClass","click",4,"ngIf"],["class","table",4,"ngIf"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-people","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"ngClass","click"],[1,"btn","btn-sm",3,"ngClass","click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"table"],[4,"ngFor","ngForOf"],[3,"href"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ddUser"],["class","btn btn-link btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-link","btn-sm",3,"click"],[1,"icon","icon-cross"]],template:function(e,t){1&e&&(l.vc(0,Po,1,0,"div",0),l.vc(1,Oo,9,3,"div",1)),2&e&&(l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.invites))},directives:[I.k,I.i,I.j,I.l,I.m,D.a],styles:[""]}),No);function Fo(e,t){if(1&e){var n=l.Rb();l.Qb(0,"span",11),l.Xb("click",function(){l.oc(n);var e=l.Zb().$implicit;return l.Zb().remove(e)}),l.wc(1,"Remove"),l.Pb()}}var Uo=function(e){return{faded:e}};function qo(e,t){if(1&e&&(l.Qb(0,"tr",8),l.Mb(1,"td",9),l.Qb(2,"td"),l.wc(3,"A Date"),l.Pb(),l.Qb(4,"td"),l.vc(5,Fo,2,0,"span",10),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb();l.ec("ngClass",l.ic(3,Uo,n.userId===i.campaign.userId)),l.Ab(1),l.ec("ddUser",n.user),l.Ab(4),l.ec("ngIf",n.userId!==i.campaign.userId)}}var Go,Do=((Go=function(){function e(t){d(this,e),this.campaignService=t}return p(e,[{key:"ngOnInit",value:function(){}},{key:"remove",value:function(e){return t=this,i=regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=!0,t.next=3,mt.a.fire({titleText:"Are you sure?",showCancelButton:!0});case 3:if(t.t1=t.sent.value,t.t0!==t.t1){t.next=14;break}return this.campaignService.campaign.members=this.campaignService.campaign.members.filter(function(t){return!(t.userId===e.userId&&t.campaignId===e.campaignId)}),t.prev=6,t.next=9,this.campaignService.removeMember(e);case 9:t.next=14;break;case 11:throw t.prev=11,t.t2=t.catch(6),t.t2;case 14:case"end":return t.stop()}},t,this,[[6,11]])}),new((n=void 0)||(n=Promise))(function(e,r){function c(e){try{a(i.next(e))}catch(t){r(t)}}function o(e){try{a(i.throw(e))}catch(t){r(t)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n(function(e){e(i)})).then(c,o)}a((i=i.apply(t,[])).next())});var t,n,i}},{key:"members",get:function(){return this.campaignService.campaign.members}},{key:"campaign",get:function(){return this.campaignService.campaign}}]),e}()).\u0275fac=function(e){return new(e||Go)(l.Lb(P.b))},Go.\u0275cmp=l.Fb({type:Go,selectors:[["dd-member-manager"]],decls:18,vars:1,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"mb-0"],[1,"column","col-auto"],[1,"table"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"big-space"],[3,"ngClass"],[3,"ddUser"],["class","fake-link",3,"click",4,"ngIf"],[1,"fake-link",3,"click"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"h3",3),l.wc(4,"Members"),l.Pb(),l.Pb(),l.Mb(5,"div",4),l.Pb(),l.Qb(6,"table",5),l.Qb(7,"thead"),l.Qb(8,"th"),l.wc(9,"User"),l.Pb(),l.Qb(10,"th"),l.wc(11,"Added On"),l.Pb(),l.Qb(12,"th"),l.wc(13,"Remove"),l.Pb(),l.Pb(),l.Qb(14,"tbody"),l.vc(15,qo,6,5,"tr",6),l.Pb(),l.Pb(),l.Qb(16,"div",7),l.Mb(17,"dd-invite-manager"),l.Pb(),l.Pb()),2&e&&(l.Ab(15),l.ec("ngForOf",t.members))},directives:[I.j,_o,I.i,D.a,I.k],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),Go),Zo=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function Xo(e,t){1&e&&(l.Qb(0,"div",15),l.Mb(1,"i",16),l.Pb())}function jo(e,t){1&e&&l.Mb(0,"i",21)}function Ho(e,t){1&e&&l.Mb(0,"i",22)}function Vo(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",17),l.Qb(1,"button",18),l.Xb("click",function(){l.oc(n);var e=l.Zb();return e.childrenCollapsed=!e.childrenCollapsed}),l.vc(2,jo,1,0,"i",19),l.vc(3,Ho,1,0,"i",20),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(2),l.ec("ngIf",i.childrenCollapsed),l.Ab(1),l.ec("ngIf",!i.childrenCollapsed)}}function $o(e,t){if(1&e&&l.Mb(0,"img",23),2&e){var n=l.Zb();l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.conceptEntity.concept.imageId,"",l.qc)}}function Bo(e,t){1&e&&l.Mb(0,"img",24)}function zo(e,t){if(1&e&&(l.Qb(0,"sup",25),l.wc(1),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.yc("x",n.conceptEntity.quantity,"")}}function Yo(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",26),l.Xb("click",function(){return l.oc(n),l.Zb().doRemoveFromParent()}),l.Mb(1,"i",27),l.Mb(2,"span",28),l.Pb()}}function Wo(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",29),l.Xb("click",function(){return l.oc(n),l.Zb().doAddChild()}),l.Mb(1,"i",30),l.Qb(2,"span",28),l.wc(3),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(3),l.yc(" Add to ",i.conceptEntity.concept.name,"")}}function Ko(e,t){if(1&e&&(l.Qb(0,"div",34),l.Qb(1,"div",35),l.wc(2),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(2),l.yc("This ",n.conceptEntity.concept.name," is empty")}}function Jo(e,t){1&e&&l.Mb(0,"div",39)}function ea(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",36),l.vc(1,Jo,1,0,"div",37),l.Qb(2,"dd-concept-entity-manager-list-item",38),l.Xb("selected",function(e){return l.oc(n),l.Zb(2).select(e)}),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit,r=l.Zb(2);l.Ab(2),l.ec("conceptEntity",i)("conceptType",r.conceptType)("allConceptEntities",r.allConceptEntities)("isChild",!0)}}function ta(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",31),l.Xb("cdkDropListDropped",function(e){return l.oc(n),l.Zb().conceptDropped(e)}),l.vc(1,Ko,3,1,"div",32),l.vc(2,ea,3,4,"div",33),l.Pb()}if(2&e){var i=l.Zb();l.Ab(1),l.ec("ngIf",0===i.children.length),l.Ab(1),l.ec("ngForOf",i.children)}}var na,ia=function(e){return{"bg-secondary":e}},ra=function(e){return{faded:e}},ca=function(e,t,n){return["/campaigns",e,"concepts",t,n,"view"]},oa=((na=function(){function e(t,n){d(this,e),this.campaignService=t,this.conceptService=n,this.selected=new l.n,this.addChild=new l.n,this.childrenCollapsed=!0}return p(e,[{key:"ngOnInit",value:function(){}},{key:"select",value:function(e){this.selected.emit(e)}},{key:"conceptDropped",value:function(e){return Zo(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.children,Object(b.f)(n,e.previousIndex,e.currentIndex),n.forEach(function(e,t){e.sortValue=t}),t.next=5,this.conceptService.updateConceptEntities(n,this.conceptEntity.entityId);case 5:case"end":return t.stop()}},t,this)}))}},{key:"doAddChild",value:function(){this.addChild.emit(!0)}},{key:"doRemoveFromParent",value:function(){return Zo(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.conceptEntity.parentConceptId=null,this.conceptEntity.parentEntityId=null,e.next=4,this.conceptService.updateConceptEntity(this.conceptEntity);case 4:case"end":return e.stop()}},e,this)}))}},{key:"campaign",get:function(){return this.campaignService.campaign}},{key:"quantityEnabled",get:function(){return this.conceptType.entityConfig.enabled&&this.conceptType.entityConfig.enableQuantity}},{key:"children",get:function(){var e,t=[],n=a(this.allConceptEntities);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.parentConceptId===this.conceptEntity.conceptId&&t.push(i)}}catch(r){n.e(r)}finally{n.f()}return t.sort(function(e,t){return e.sortValue-t.sortValue})}}]),e}()).\u0275fac=function(e){return new(e||na)(l.Lb(P.b),l.Lb(Rr.a))},na.\u0275cmp=l.Fb({type:na,selectors:[["dd-concept-entity-manager-list-item"]],inputs:{conceptEntity:"conceptEntity",conceptType:"conceptType",draggable:"draggable",isChild:"isChild",allConceptEntities:"allConceptEntities"},outputs:{selected:"selected",addChild:"addChild"},decls:16,vars:23,consts:[[1,"card","px-1","pt-1","my-1",3,"ngClass"],[1,"columns","col-gapless"],["class","column col-auto mr-2 c-move",4,"ngIf"],["class","column col-auto mr-1",4,"ngIf"],[1,"column","col-auto","mr-2",3,"ngClass","click"],["class","s-rounded","width","30","style","margin-bottom: -0.075rem",3,"src",4,"ngIf"],["class","s-rounded","width","30","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword","style","margin-bottom: -0.075rem",4,"ngIf"],[1,"column","c-hand","no-select",3,"ngClass","click"],["class","text-bold text-small",4,"ngIf"],[1,"column","col-auto"],["class","btn btn-sm btn-error mr-1",3,"click",4,"ngIf"],["class","btn btn-sm mr-1",3,"click",4,"ngIf"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-arrow-right"],["class","column col-12","cdkDropList","",3,"cdkDropListDropped",4,"ngIf"],[1,"column","col-auto","mr-2","c-move"],[1,"icon","icon-resize-vert"],[1,"column","col-auto","mr-1"],[1,"btn","btn-sm",3,"click"],["class","icon icon-arrow-down",4,"ngIf"],["class","icon icon-arrow-up",4,"ngIf"],[1,"icon","icon-arrow-down"],[1,"icon","icon-arrow-up"],["width","30",1,"s-rounded",2,"margin-bottom","-0.075rem",3,"src"],["width","30","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword",1,"s-rounded",2,"margin-bottom","-0.075rem"],[1,"text-bold","text-small"],[1,"btn","btn-sm","btn-error","mr-1",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[1,"btn","btn-sm","mr-1",3,"click"],[1,"icon","icon-plus"],["cdkDropList","",1,"column","col-12",3,"cdkDropListDropped"],["class","empty p-1 mb-1",4,"ngIf"],["cdkDrag","",4,"ngFor","ngForOf"],[1,"empty","p-1","mb-1"],[1,"empty-subtitle","text-italic","m-0"],["cdkDrag",""],["class","drag-placeholder",4,"cdkDragPlaceholder"],[3,"conceptEntity","conceptType","allConceptEntities","isChild","selected"],[1,"drag-placeholder"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.vc(2,Xo,2,0,"div",2),l.vc(3,Vo,4,2,"div",3),l.Qb(4,"div",4),l.Xb("click",function(){return t.select(t.conceptEntity)}),l.vc(5,$o,1,1,"img",5),l.vc(6,Bo,1,0,"img",6),l.Pb(),l.Qb(7,"div",7),l.Xb("click",function(){return t.select(t.conceptEntity)}),l.wc(8),l.vc(9,zo,2,1,"sup",8),l.Pb(),l.Qb(10,"div",9),l.vc(11,Yo,3,0,"button",10),l.vc(12,Wo,4,1,"button",11),l.Qb(13,"button",12),l.Mb(14,"i",13),l.Pb(),l.Pb(),l.vc(15,ta,3,2,"div",14),l.Pb(),l.Pb()),2&e&&(l.ec("ngClass",l.ic(13,ia,t.conceptEntity.concept.isContainer)),l.Ab(2),l.ec("ngIf",t.draggable),l.Ab(1),l.ec("ngIf",t.conceptEntity.concept.isContainer),l.Ab(1),l.ec("ngClass",l.ic(15,ra,0===t.conceptEntity.quantity)),l.Ab(1),l.ec("ngIf",t.conceptEntity.concept.imageId),l.Ab(1),l.ec("ngIf",!t.conceptEntity.concept.imageId),l.Ab(1),l.ec("ngClass",l.ic(17,ra,t.quantityEnabled&&0===t.conceptEntity.quantity)),l.Ab(1),l.yc(" ",t.conceptEntity.concept.name," "),l.Ab(1),l.ec("ngIf",t.quantityEnabled&&1!==t.conceptEntity.quantity&&null!==t.conceptEntity.quantity),l.Ab(2),l.ec("ngIf",t.isChild),l.Ab(1),l.ec("ngIf",t.conceptEntity.concept.isContainer),l.Ab(1),l.ec("routerLink",l.kc(19,ca,t.campaign.id,t.conceptType.id,t.conceptEntity.concept.id)),l.Ab(2),l.ec("ngIf",t.conceptEntity.concept.isContainer&&!t.childrenCollapsed))},directives:[I.i,I.k,w.d,b.d,I.j,b.a,b.c,na],styles:[""]}),na),aa=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},sa=["picker"],ua=["viewandedit"],la=["nestselector"],da=["searchbar"];function ba(e,t){1&e&&l.Mb(0,"i",24)}function pa(e,t){1&e&&l.Mb(0,"div",25)}function fa(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",26),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(),l.mc(1).close(e)}),l.Mb(1,"dd-concept-list-item",27),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("concept",i)("imageSize",25)}}function ha(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",26),l.Xb("click",function(){return l.oc(n),l.Zb(2).createConcept()}),l.Qb(1,"span"),l.Mb(2,"i",28),l.wc(3),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(3),l.yc(" ",i.searchControl.value,"")}}function va(e,t){if(1&e&&(l.Qb(0,"p",35),l.wc(1),l.Pb()),2&e){var n=l.Zb(3);l.Ab(1),l.yc("Click the button below to create a new ",n.conceptType.name,"")}}function ma(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",36),l.Qb(1,"button",37),l.Xb("click",function(){return l.oc(n),l.Zb(3).createConcept()}),l.wc(2),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(3);l.Ab(2),l.yc("Create ",i.searchControl.value,"")}}function ga(e,t){if(1&e&&(l.Qb(0,"div",29),l.Qb(1,"div",30),l.Mb(2,"i",31),l.Pb(),l.Qb(3,"p",32),l.wc(4,"Your search returned no results"),l.Pb(),l.vc(5,va,2,1,"p",33),l.vc(6,ma,3,1,"div",34),l.Pb()),2&e){var n=l.Zb(2);l.Ab(5),l.ec("ngIf",n.conceptTypeEditable),l.Ab(1),l.ec("ngIf",n.conceptTypeEditable)}}function ya(e,t){if(1&e&&(l.Qb(0,"dd-modal",null,13),l.Qb(2,"h4",14),l.wc(3),l.Pb(),l.Qb(4,"div",15),l.Qb(5,"div",16),l.Mb(6,"input",17,18),l.vc(8,ba,1,0,"i",19),l.vc(9,pa,1,0,"div",20),l.Pb(),l.Qb(10,"div"),l.vc(11,fa,2,2,"div",21),l.vc(12,ha,4,1,"div",22),l.Pb(),l.vc(13,ga,7,2,"div",23),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(3),l.yc("Pick ",n.conceptType.name,""),l.Ab(3),l.gc("placeholder","Search ",n.conceptType.pluralForm,""),l.ec("formControl",n.searchControl),l.Ab(2),l.ec("ngIf",!n.searchLoading),l.Ab(1),l.ec("ngIf",n.searchLoading),l.Ab(2),l.ec("ngForOf",n.searchResults)("ngForTrackBy",n.trackConcept),l.Ab(1),l.ec("ngIf",n.searchControl.value&&n.searchControl.value.trim().length>2),l.Ab(1),l.ec("ngIf",n.searchResults&&0===n.totalResults&&""!==n.searchControl.value)}}function ka(e,t){if(1&e&&(l.Qb(0,"h4",14),l.wc(1),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.yc(" ",n.selectedConceptEntity.concept.name," ")}}function wa(e,t){if(1&e&&l.Mb(0,"dd-dynamic-field",41),2&e){var n=l.Zb(2);l.ec("control",n.quantityControl)("config",n.quantityFieldConfig)}}function Pa(e,t){if(1&e&&(l.Qb(0,"div",38),l.vc(1,wa,1,2,"dd-dynamic-field",39),l.Mb(2,"div",40),l.Mb(3,"dd-dynamic-field",41),l.Pb()),2&e){var n=l.Zb();l.ec("formGroup",n.editGroup),l.Ab(1),l.ec("ngIf",n.quantityEnabled),l.Ab(2),l.ec("control",n.contentControl)("config",n.notesFieldConfig)}}function Ia(e,t){if(1&e&&(l.Qb(0,"h6"),l.wc(1," Quantity: "),l.Qb(2,"strong"),l.wc(3),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(3),l.xc(n.selectedConceptEntity.quantity||1)}}function Ca(e,t){if(1&e&&(l.Qb(0,"div",15),l.vc(1,Ia,4,1,"h6",0),l.Mb(2,"dd-quill",42),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngIf",n.quantityEnabled),l.Ab(1),l.ec("value",n.selectedConceptEntity.content)}}function xa(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",43),l.Qb(1,"button",44),l.Xb("click",function(){l.oc(n);var e=l.Zb();return e.remove(e.selectedConceptEntity)}),l.wc(2," Remove "),l.Pb(),l.Qb(3,"button",45),l.Xb("click",function(){return l.oc(n),l.Zb(),l.mc(2).close(null)}),l.wc(4,"Cancel"),l.Pb(),l.Qb(5,"button",37),l.Xb("click",function(){return l.oc(n),l.Zb().save()}),l.wc(6,"Save"),l.Pb(),l.Pb()}}function Qa(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",26),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2),l.mc(8).close(e)}),l.Mb(1,"dd-concept-list-item",27),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.ec("concept",i)("imageSize",25)}}function Aa(e,t){if(1&e&&(l.Qb(0,"div",15),l.vc(1,Qa,2,2,"div",21),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.nestableConcepts)("ngForTrackBy",n.trackConcept)}}function Ta(e,t){if(1&e&&(l.Qb(0,"span",54),l.wc(1),l.Pb()),2&e){var n=l.Zb(4);l.Ab(1),l.yc(" Reorder ",n.conceptType.pluralForm,"")}}function Ea(e,t){1&e&&(l.Qb(0,"span",54),l.wc(1," Save Order"),l.Pb())}var Ra=function(e,t){return{"icon-resize-vert":e,"icon-check":t}};function La(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",55),l.Xb("click",function(){return l.oc(n),l.Zb(3).toggleReorder()}),l.Mb(1,"i",56),l.vc(2,Ta,2,1,"span",57),l.vc(3,Ea,2,0,"span",57),l.Pb()}if(2&e){var i=l.Zb(3);l.Ab(1),l.ec("ngClass",l.jc(3,Ra,!i.draggingEnabled,i.draggingEnabled)),l.Ab(1),l.ec("ngIf",!i.draggingEnabled),l.Ab(1),l.ec("ngIf",i.draggingEnabled)}}function Ma(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",47),l.vc(1,La,4,6,"button",52),l.Qb(2,"button",53),l.Xb("click",function(){return l.oc(n),l.Zb(2).add()}),l.Mb(3,"i",28),l.Qb(4,"span",54),l.wc(5),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(1),l.ec("ngIf",i.editable),l.Ab(4),l.yc(" Add ",i.conceptType.name,"")}}var Sa=function(e,t){return["/campaigns",e,"entities",t]};function Oa(e,t){if(1&e&&(l.Qb(0,"div",46),l.Qb(1,"div",47),l.Qb(2,"button",48),l.Mb(3,"i",49),l.Pb(),l.Pb(),l.Qb(4,"div",50),l.Qb(5,"h5"),l.wc(6),l.Pb(),l.Pb(),l.vc(7,Ma,6,2,"div",51),l.Pb()),2&e){var n=l.Zb();l.Ab(2),l.ec("routerLink",l.jc(4,Sa,n.campaign.id,n.entity.id)),l.Ab(4),l.zc("",n.conceptType.pluralForm," for ",n.entity.name,""),l.Ab(1),l.ec("ngIf",n.editable)}}function Na(e,t){1&e&&l.Mb(0,"div",58)}function _a(e,t){if(1&e&&(l.Qb(0,"div",59),l.Qb(1,"p",35),l.wc(2),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(2),l.yc("No ",n.conceptType.pluralForm," here!")}}function Fa(e,t){1&e&&l.Mb(0,"div",63)}function Ua(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",60),l.vc(1,Fa,1,0,"div",61),l.Qb(2,"dd-concept-entity-manager-list-item",62),l.Xb("selected",function(e){return l.oc(n),l.Zb().select(e)})("addChild",function(){l.oc(n);var e=t.$implicit;return l.Zb().selectChildToNest(e)}),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit,r=l.Zb();l.ec("cdkDragDisabled",!r.editable||!r.draggingEnabled),l.Ab(2),l.ec("conceptEntity",i)("conceptType",r.conceptType)("draggable",r.editable&&r.draggingEnabled)("allConceptEntities",r.conceptEntities)}}var qa,Ga,Da,Za=((qa=function(){function t(e,n,i,r,c,o,a){d(this,t),this.conceptService=e,this.campaignService=n,this.entityService=i,this.updateHub=r,this.login=c,this.router=o,this.route=a,this.loading=!1,this.searchLoading=!1,this.working=!1,this.draggingEnabled=!1,this.selectedConceptEntity=null}return p(t,[{key:"entity",get:function(){return this._entity},set:function(e){this._entity=e,this.load()}},{key:"ngOnInit",value:function(){var e=this;this.searchControl=new h.e(null),this.editGroup=new h.h({quantity:new h.e(null),content:new h.e(null)}),this.searchControl.valueChanges.pipe(Object($i.a)(),Object(tc.a)(250)).subscribe(function(t){e.searchConcepts(null!=t?t.trim().toLowerCase():"")}),this.route.paramMap.subscribe(function(t){var n=t.get("ct_id"),i=t.get("ent_id");n&&i&&e.loadInitial(i,n)}),this._updateSubscription=this.updateHub.conceptEntityUpdate.subscribe(function(t){if(e.conceptEntities&&e.entity&&e.conceptType&&t.concept.conceptTypeId===e.conceptType.id&&t.entityId===e.entity.id){var n=e.conceptEntities.findIndex(function(e){return e.conceptId===t.conceptId&&e.entityId===t.entityId});-1!==n?e.conceptEntities[n]=t:e.conceptEntities.push(t),e.conceptEntities=e.conceptEntities.slice().sort(function(e,t){return e.sortValue-t.sortValue})}}),this._deleteSubscription=this.updateHub.conceptEntityDelete.subscribe(function(t){e.conceptEntities&&e.entity&&e.conceptType&&t.entityId===e.entity.id&&(e.conceptEntities=e.conceptEntities.filter(function(e){return!(e.conceptId===t.conceptId&&e.entityId===t.entityId)}))})}},{key:"ngOnDestroy",value:function(){this._updateSubscription&&this._updateSubscription.unsubscribe(),this._deleteSubscription&&this._deleteSubscription.unsubscribe()}},{key:"loadInitial",value:function(t,n){return aa(this,void 0,void 0,regeneratorRuntime.mark(function i(){var r,c,o,a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.loading=!0,i.prev=1,i.next=4,Promise.all([this.conceptService.getConceptType(n),this.entityService.getEntity(t)]);case 4:if(r=i.sent,c=e(r,2),o=c[0],a=c[1],this.conceptType=o,this.entity=a,i.t0=this.entity,!i.t0){i.next=14;break}return i.next=14,this.updateHub.unsubscribeEntities([this.entity.id]);case 14:return i.next=16,this.updateHub.subscribeEntities([this.entity.id]);case 16:i.next=21;break;case 18:i.prev=18,i.t1=i.catch(1),this.loadErr=i.t1;case 21:this.loading=!1;case 22:case"end":return i.stop()}},i,this,[[1,18]])}))}},{key:"load",value:function(){return aa(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.conceptService.getConceptEntities(this.entity.id,this.conceptType.id);case 4:this.conceptEntities=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0;case 10:this.loading=!1;case 11:case"end":return e.stop()}},e,this,[[1,7]])}))}},{key:"searchConcepts",value:function(e){return aa(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.searchLoading=!0,t.prev=1,t.next=4,this.conceptService.getConcepts(this.conceptType.id,10,0,e);case 4:n=t.sent,this.searchResults=n.concepts,this.totalResults=n.total,t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(1),t.t0;case 11:this.searchLoading=!1;case 12:case"end":return t.stop()}},t,this,[[1,8]])}))}},{key:"createConcept",value:function(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,"create"],{queryParams:{name:this.searchControl.value}})}},{key:"add",value:function(){return aa(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.searchControl.patchValue(null),this.searchConcepts(""),setTimeout(function(){i.searchInput.nativeElement.focus()},1),e.next=3,this.pickerModal.open();case 3:if(null===(t=e.sent)){e.next=16;break}return n={conceptId:t.id,concept:t,entityId:this.entity.id,quantity:this.quantityEnabled?1:null,fields:[],sortValue:this.conceptEntities.length},void 0===this.conceptEntities.find(function(e){return e.conceptId===n.conceptId&&e.entityId===n.entityId})&&this.conceptEntities.push(n),this.working=!0,e.prev=7,e.next=10,this.conceptService.updateConceptEntity(n);case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(7),e.t0;case 15:this.working=!1;case 16:case"end":return e.stop()}},e,this,[[7,12]])}))}},{key:"select",value:function(e){return aa(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.selectedConceptEntity=e,this.editGroup.patchValue({quantity:e.quantity||1,content:e.content}),this.viewAndEditModal.open().then(function(){n.selectedConceptEntity=null});case 1:case"end":return t.stop()}},t,this)}))}},{key:"save",value:function(){return aa(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.working=!0,e.prev=1,t=Object.assign(Object.assign({},this.selectedConceptEntity),{quantity:this.quantityControl.value,content:this.contentControl.value}),n=a(this.conceptEntities);try{for(n.s();!(i=n.n()).done;)(r=i.value).conceptId===t.conceptId&&r.entityId===t.entityId&&Object.assign(r,t)}catch(c){n.e(c)}finally{n.f()}return this.viewAndEditModal.close(null),e.next=8,this.conceptService.updateConceptEntity(t);case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(1),e.t0;case 13:this.working=!1;case 14:case"end":return e.stop()}},e,this,[[1,10]])}))}},{key:"remove",value:function(e){return aa(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.working=!0,t.prev=1,this.conceptEntities=this.conceptEntities.filter(function(t){return!(t.conceptId===e.conceptId&&t.entityId===e.entityId)}),this.viewAndEditModal.close(null),t.next=6,this.conceptService.deleteConceptEntity(e.entityId,e.conceptId);case 6:t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(1),t.t0;case 11:this.working=!1;case 12:case"end":return t.stop()}},t,this,[[1,8]])}))}},{key:"trackConcept",value:function(e,t){return t.id}},{key:"trackConceptEntity",value:function(e,t){return t.conceptId+t.entityId}},{key:"conceptDropped",value:function(e){var t=this.topLevelConceptEntities;Object(b.f)(t,e.previousIndex,e.currentIndex),t.forEach(function(e,t){e.sortValue=t})}},{key:"selectChildToNest",value:function(e){return aa(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.nestSelectorParent=e,t.next=3,this.nestSelector.open();case 3:if(null===(n=t.sent)){t.next=15;break}return(i=this.conceptEntities.find(function(e){return e.conceptId===n.id})).parentConceptId=e.conceptId,i.parentEntityId=e.entityId,t.prev=7,t.next=10,this.conceptService.updateConceptEntity(i);case 10:t.next=15;break;case 12:throw t.prev=12,t.t0=t.catch(7),t.t0;case 15:case"end":return t.stop()}},t,this,[[7,12]])}))}},{key:"toggleReorder",value:function(){return aa(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.draggingEnabled=!this.draggingEnabled,e.t0=!1===this.draggingEnabled,!e.t0){e.next=5;break}return e.next=5,this.conceptService.updateConceptEntities(this.topLevelConceptEntities,this.entity.id);case 5:case"end":return e.stop()}},e,this)}))}},{key:"quantityEnabled",get:function(){return this.conceptType.entityConfig.enabled&&this.conceptType.entityConfig.enableQuantity}},{key:"campaign",get:function(){return this.campaignService.campaign}},{key:"quantityControl",get:function(){return this.editGroup.get("quantity")}},{key:"contentControl",get:function(){return this.editGroup.get("content")}},{key:"conceptEntities",get:function(){return this._conceptEntities},set:function(e){this._conceptEntities=e}},{key:"topLevelConceptEntities",get:function(){if(this.conceptEntities)return this.conceptEntities.filter(function(e){return null==e.parentConceptId}).sort(function(e,t){return e.sortValue-t.sortValue})}},{key:"editable",get:function(){return!!this.entity&&(this.entity.userId===this.login.id||this.campaignService.canEdit)}},{key:"quantityFieldConfig",get:function(){return this.selectedConceptEntity&&this.entity?{name:"Quantity",description:"How many ".concat(this.selectedConceptEntity.concept.name," does ").concat(this.entity.name," have?"),type:pe.a.INT,options:{min:0}}:{name:"Quantity",type:pe.a.INT}}},{key:"notesFieldConfig",get:function(){return{name:"Notes",description:"All players will be able to see these notes",type:pe.a.TEXT_FORMATTED}}},{key:"conceptTypeEditable",get:function(){return!!this.conceptType&&(this.conceptType.playerEditable||this.campaignService.canEdit)}},{key:"nestableConcepts",get:function(){var e=this;return this.conceptEntities.filter(function(t){return t.conceptId!==e.nestSelectorParent.conceptId&&null==t.parentConceptId}).map(function(e){return e.concept})}}]),t}()).\u0275fac=function(e){return new(e||qa)(l.Lb(Rr.a),l.Lb(P.b),l.Lb(de.b),l.Lb(be.b),l.Lb(E.a),l.Lb(w.c),l.Lb(w.a))},qa.\u0275cmp=l.Fb({type:qa,selectors:[["dd-concept-entity-manager"]],viewQuery:function(e,t){var n;1&e&&(l.Ac(sa,1),l.Ac(ua,3),l.Ac(la,3),l.Ac(da,1)),2&e&&(l.lc(n=l.Yb())&&(t.pickerModal=n.first),l.lc(n=l.Yb())&&(t.viewAndEditModal=n.first),l.lc(n=l.Yb())&&(t.nestSelector=n.first),l.lc(n=l.Yb())&&(t.searchInput=n.first))},inputs:{conceptType:"conceptType",entity:"entity"},decls:16,vars:11,consts:[[4,"ngIf"],["viewandedit",""],["modal-header","","class","mb-0",4,"ngIf"],["modal-body","",3,"formGroup",4,"ngIf"],["modal-body","",4,"ngIf"],["modal-footer","",4,"ngIf"],["nestselector",""],[1,"container","grid-xl"],["class","columns",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty p-2",4,"ngIf"],["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",3,"cdkDragDisabled",4,"ngFor","ngForOf","ngForTrackBy"],["picker",""],["modal-header","",1,"mb-0"],["modal-body",""],[1,"has-icon-right"],["type","text",1,"form-input",3,"formControl","placeholder"],["searchbar",""],["class","icon icon-search form-icon",4,"ngIf"],["class","loading form-icon",4,"ngIf"],["class","card p-1 my-1 hoverable",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["class","card p-1 my-1 hoverable",3,"click",4,"ngIf"],["class","empty mt-2",4,"ngIf"],[1,"icon","icon-search","form-icon"],[1,"loading","form-icon"],[1,"card","p-1","my-1","hoverable",3,"click"],[3,"concept","imageSize"],[1,"icon","icon-plus"],[1,"empty","mt-2"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],["class","empty-action",4,"ngIf"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["modal-body","",3,"formGroup"],[3,"control","config",4,"ngIf"],[1,"my-2"],[3,"control","config"],["readOnly","true",3,"value"],["modal-footer",""],[1,"btn","btn-error","mr-1",3,"click"],[1,"btn","mr-1",3,"click"],[1,"columns"],[1,"column","col-auto"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-arrow-left"],[1,"column"],["class","column col-auto",4,"ngIf"],["class","btn btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-sm","ml-1",3,"click"],[1,"hide-xs"],[1,"btn","btn-sm",3,"click"],[1,"icon",3,"ngClass"],["class","hide-xs",4,"ngIf"],[1,"loading","loading-lg"],[1,"empty","p-2"],["cdkDrag","",3,"cdkDragDisabled"],["class","drag-placeholder",4,"cdkDragPlaceholder"],[3,"conceptEntity","conceptType","draggable","allConceptEntities","selected","addChild"],[1,"drag-placeholder"]],template:function(e,t){1&e&&(l.vc(0,ya,14,9,"dd-modal",0),l.Qb(1,"dd-modal",null,1),l.vc(3,ka,2,1,"h4",2),l.vc(4,Pa,4,4,"div",3),l.vc(5,Ca,3,2,"div",4),l.vc(6,xa,7,0,"div",5),l.Pb(),l.Qb(7,"dd-modal",null,6),l.vc(9,Aa,2,2,"div",4),l.Pb(),l.Qb(10,"div",7),l.vc(11,Oa,8,7,"div",8),l.vc(12,Na,1,0,"div",9),l.vc(13,_a,3,1,"div",10),l.Qb(14,"div",11),l.Xb("cdkDropListDropped",function(e){return t.conceptDropped(e)}),l.vc(15,Ua,3,5,"div",12),l.Pb(),l.Pb()),2&e&&(l.ec("ngIf",t.conceptType),l.Ab(3),l.ec("ngIf",t.selectedConceptEntity),l.Ab(1),l.ec("ngIf",t.editable&&t.selectedConceptEntity),l.Ab(1),l.ec("ngIf",!t.editable&&t.selectedConceptEntity),l.Ab(1),l.ec("ngIf",t.editable),l.Ab(3),l.ec("ngIf",t.nestSelectorParent),l.Ab(2),l.ec("ngIf",t.conceptType&&t.entity),l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.conceptEntities&&0===t.conceptEntities.length),l.Ab(2),l.ec("ngForOf",t.topLevelConceptEntities)("ngForTrackBy",t.trackConceptEntity))},directives:[I.k,te.a,b.d,I.j,h.b,h.m,h.f,nc,h.n,h.i,ne.a,fe.a,w.d,I.i,b.a,b.c,oa],styles:[""]}),qa),Xa=["modal"],ja=((Ga=function(){function e(){d(this,e)}return p(e,[{key:"ngOnInit",value:function(){}},{key:"close",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modal.close(!1));case 1:case"end":return e.stop()}},e,this)}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"confirm",value:function(){return this.modal.close(!0)}},{key:"deny",value:function(){return this.modal.close(!1)}},{key:"getConfirmation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Are you sure?",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Confirm";return this.title=t,this.question=e,this.modal.open()}}]),e}()).\u0275fac=function(e){return new(e||Ga)},Ga.\u0275cmp=l.Fb({type:Ga,selectors:[["dd-confirmation-modal"]],viewQuery:function(e,t){var n;1&e&&l.Ac(Xa,3),2&e&&l.lc(n=l.Yb())&&(t.modal=n.first)},decls:12,vars:2,consts:[["size","small"],["modal",""],["modal-header",""],[1,"modal-title","h5"],["modal-body",""],["modal-footer",""],[1,"btn","mr-2",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(l.Qb(0,"dd-modal",0,1),l.Qb(2,"div",2),l.Qb(3,"h5",3),l.wc(4),l.Pb(),l.Pb(),l.Qb(5,"div",4),l.wc(6),l.Pb(),l.Qb(7,"div",5),l.Qb(8,"button",6),l.Xb("click",function(){return t.confirm()}),l.wc(9,"Yes"),l.Pb(),l.Qb(10,"button",7),l.Xb("click",function(){return t.deny()}),l.wc(11,"No"),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(4),l.xc(t.title),l.Ab(2),l.xc(t.question))},directives:[te.a],styles:[""]}),Ga),Ha=[{name:"AC",description:"Armor Class",type:pe.a.INT,class:de.a.MAJOR,redacted:!1,options:{required:!0}},{name:"Init",description:"Initiative",type:pe.a.INT,class:de.a.MAJOR,redacted:!1,options:{required:!0}},{name:"Speed",description:"Speed",type:pe.a.STRING,class:de.a.MAJOR,redacted:!1,options:{required:!0}},{name:"Class",description:"Class",type:pe.a.ENUM_MULTI,class:de.a.NORMAL,redacted:!1,options:{required:!0,choices:["Barbarian","Bard","Cleric","Druid","Fighter","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"]}},{name:"Strength",description:"Strength",type:pe.a.INT,class:de.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Strength Mod",description:"Strength Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Strength"}},{name:"Dexterity",description:"Dexterity",type:pe.a.INT,class:de.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Dex Mod",description:"Dexterity Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Dexterity"}},{name:"Constitution",description:"Constitution",type:pe.a.INT,class:de.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Con Mod",description:"Constitution Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Constitution"}},{name:"Intelligence",description:"Intelligence",type:pe.a.INT,class:de.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Int Mod",description:"Intelligence Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Intelligence"}},{name:"Wisdom",description:"Wisdom",type:pe.a.INT,class:de.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Wis Mod",description:"Wisdom Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Wisdom"}},{name:"Charisma",description:"Charisma",type:pe.a.INT,class:de.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Cha Mod",description:"Charisma Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Charisma"}},{name:"Acrobatics",description:"Acrobatics",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Animal Handling",description:"Animal Handling",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Arcana",description:"Arcana",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Athletics",description:"Athletics",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Deception",description:"Deception",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"History",description:"History",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Insight",description:"Insight",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Intimidation",description:"Intimidation",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Investigation",description:"Investigation",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Medicine",description:"Medicine",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Nature",description:"Nature",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Perception",description:"Perception",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Performance",description:"Performance",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Persuasion",description:"Persuasion",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Religion",description:"Religion",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Sleight of Hand",description:"Sleight of Hand",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Stealth",description:"Stealth",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Survival",description:"Survival",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Alignment",description:"Alignment",type:pe.a.STRING,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Race",description:"Race",type:pe.a.ENUM,class:de.a.MINOR,redacted:!1,options:{required:!1,choices:["Dragonborn","Dwarf","Eladrin","Elf","Gnome","Half-elf","Half-orc","Halfling","Human","Tiefling"]}},{name:"Age",description:"Age",type:pe.a.INT,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Height",description:"Height",type:pe.a.STRING,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Weight",description:"Weight",type:pe.a.STRING,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Eyes",description:"Eyes",type:pe.a.STRING,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Skin",description:"Skin",type:pe.a.STRING,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Hair",description:"Hair",type:pe.a.STRING,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Allies & Orgs",description:"Allies & Organizations",type:pe.a.TEXT_FORMATTED,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Features & Traits",description:"Features & Traits",type:pe.a.TEXT_FORMATTED,class:de.a.MINOR,redacted:!1,options:{required:!1}},{name:"Backstory",description:"Backstory",type:pe.a.TEXT_FORMATTED,class:de.a.MINOR,redacted:!1,options:{required:!1}}],Va=[{name:"AC",description:"Armor Class",type:pe.a.INT,class:de.a.MAJOR,redacted:!0,options:{required:!0}},{name:"Init",description:"Initiative",type:pe.a.INT,class:de.a.MAJOR,redacted:!0,options:{required:!0}},{name:"Speed",description:"Speed",type:pe.a.STRING,class:de.a.MAJOR,redacted:!0,options:{required:!0}},{name:"Class",description:"Class",type:pe.a.ENUM_MULTI,class:de.a.NORMAL,redacted:!0,options:{required:!0,choices:["Barbarian","Bard","Cleric","Druid","Fighter","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"]}},{name:"Strength",description:"Strength",type:pe.a.INT,class:de.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Strength Mod",description:"Strength Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Strength"}},{name:"Dexterity",description:"Dexterity",type:pe.a.INT,class:de.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Dex Mod",description:"Dexterity Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Dexterity"}},{name:"Constitution",description:"Constitution",type:pe.a.INT,class:de.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Con Mod",description:"Constitution Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Constitution"}},{name:"Intelligence",description:"Intelligence",type:pe.a.INT,class:de.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Int Mod",description:"Intelligence Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Intelligence"}},{name:"Wisdom",description:"Wisdom",type:pe.a.INT,class:de.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Wis Mod",description:"Wisdom Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Wisdom"}},{name:"Charisma",description:"Charisma",type:pe.a.INT,class:de.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Cha Mod",description:"Charisma Modifier",type:pe.a.STRING,class:de.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Charisma"}},{name:"Extra",description:"Any extra information",type:pe.a.TEXT_FORMATTED,class:de.a.NORMAL,redacted:!0,options:{required:!1}}],$a=((Da=function(){function e(){d(this,e)}return p(e,[{key:"getPresets",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[{name:"DnD 5e",description:"Attributes from the 5th edition of DnD",fields:Ha},{name:"D&D 5e Enemy",description:"Fields for a 5e monster",fields:Va}]);case 1:case"end":return e.stop()}},e)}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}}]),e}()).\u0275fac=function(e){return new(e||Da)},Da.\u0275prov=l.Hb({token:Da,factory:Da.\u0275fac,providedIn:"root"}),Da),Ba=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})},za=["presets"],Ya=["confirmmodal"];function Wa(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",6),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb().usePreset(e)}),l.wc(1),l.Qb(2,"span",7),l.wc(3),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(1),l.yc(" ",i.name," "),l.Ab(2),l.xc(i.description)}}function Ka(e,t){1&e&&(l.Qb(0,"h3"),l.wc(1,"Create Entity Preset"),l.Pb())}function Ja(e,t){1&e&&(l.Qb(0,"h3"),l.wc(1,"Edit Entity Preset"),l.Pb())}var es=function(e){return{loading:e}};function ts(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",47),l.Xb("click",function(){return l.oc(n),l.Zb(2).delete()}),l.wc(1," Delete "),l.Pb()}if(2&e){var i=l.Zb(2);l.ec("ngClass",l.ic(1,es,i.deleting))}}function ns(e,t){1&e&&(l.Qb(0,"p",37),l.wc(1," A name is required "),l.Pb())}function is(e,t){1&e&&(l.Qb(0,"p",37),l.wc(1," Name should not have less than 3 characters "),l.Pb())}function rs(e,t){1&e&&(l.Qb(0,"p",37),l.wc(1," Name should not have more than 30 characters "),l.Pb())}function cs(e,t){1&e&&(l.Qb(0,"p",37),l.wc(1," A description is required "),l.Pb())}function os(e,t){1&e&&(l.Qb(0,"p",37),l.wc(1," The description should not have less than 3 characters "),l.Pb())}function as(e,t){if(1&e&&(l.Qb(0,"option",48),l.wc(1),l.Pb()),2&e){var n=t.$implicit;l.ec("value",n.id),l.Ab(1),l.xc(n.name)}}function ss(e,t){if(1&e&&(l.Qb(0,"div",54),l.Qb(1,"div",27),l.Qb(2,"label",59),l.wc(3,"Bar Color"),l.Pb(),l.Mb(4,"input",60),l.Pb(),l.Pb()),2&e){var n=l.Zb(3);l.ec("hidden","0"!==n.hpType.value&&0!==n.hpType.value)}}function us(e,t){if(1&e&&(l.Qb(0,"div",49),l.Qb(1,"div",10),l.Qb(2,"div",27),l.Qb(3,"label",50),l.wc(4,"Health Type"),l.Pb(),l.Qb(5,"select",51),l.Qb(6,"option",52),l.wc(7,"Normal"),l.Pb(),l.Qb(8,"option",53),l.wc(9,"Text Based"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Qb(10,"div",54),l.Qb(11,"div",27),l.Qb(12,"label",55),l.wc(13,"HP Bar Type"),l.Pb(),l.Qb(14,"select",56),l.Qb(15,"option",52),l.wc(16,"Dynamic"),l.Pb(),l.Qb(17,"option",53),l.wc(18,"Static"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.vc(19,ss,5,1,"div",57),l.Qb(20,"div",54),l.Qb(21,"div",27),l.Qb(22,"label",16),l.wc(23,"Visibility"),l.Pb(),l.Qb(24,"label",28),l.Mb(25,"input",58),l.Mb(26,"i",30),l.wc(27," Hide amount for players "),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(10),l.ec("hidden","0"!==n.hpType.value&&0!==n.hpType.value),l.Ab(9),l.ec("ngIf","1"===n.hpColorType.value||1===n.hpColorType.value),l.Ab(1),l.ec("hidden","0"!==n.hpType.value&&0!==n.hpType.value)}}function ls(e,t){1&e&&l.Mb(0,"div",73)}function ds(e,t){if(1&e&&(l.Qb(0,"div",39),l.Qb(1,"div",27),l.Qb(2,"label",28),l.Mb(3,"input",74),l.Mb(4,"i",30),l.wc(5," Redacted "),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(3),l.ec("formControl",n.get("redacted"))}}function bs(e,t){if(1&e&&(l.Qb(0,"div",39),l.Qb(1,"select",75),l.Qb(2,"option",52),l.wc(3,"Major"),l.Pb(),l.Qb(4,"option",53),l.wc(5,"Normal"),l.Pb(),l.Qb(6,"option",76),l.wc(7,"Minor"),l.Pb(),l.Qb(8,"option",77),l.wc(9,"Unimportant"),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb().$implicit;l.Ab(1),l.ec("formControl",n.get("class"))}}function ps(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",61),l.vc(1,ls,1,0,"div",62),l.Qb(2,"div",63),l.Qb(3,"div",64),l.Mb(4,"i",65),l.Pb(),l.Qb(5,"div",66),l.Qb(6,"h6",67),l.wc(7),l.Pb(),l.Pb(),l.vc(8,ds,6,1,"div",68),l.vc(9,bs,10,1,"div",68),l.Qb(10,"div",39),l.Qb(11,"button",69),l.Xb("click",function(){l.oc(n);var e=t.index;return l.Zb(2).removeField(e)}),l.Mb(12,"i",70),l.Qb(13,"span",71),l.wc(14," Remove"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Mb(15,"dd-field-definition-form",72),l.Pb()}if(2&e){var i=t.$implicit,r=l.Zb(2);l.Ab(7),l.xc(i.value.name),l.Ab(1),l.ec("ngIf",i.get("redacted")),l.Ab(1),l.ec("ngIf",i.get("class")),l.Ab(6),l.ec("formGroup",i)("otherFields",r.otherFieldNames)}}var fs=function(e){return{"has-error":e}};function hs(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",8),l.Qb(1,"div",9),l.Qb(2,"div",10),l.vc(3,Ka,2,0,"h3",11),l.vc(4,Ja,2,0,"h3",11),l.Pb(),l.Qb(5,"div",12),l.vc(6,ts,2,3,"button",13),l.Qb(7,"button",14),l.Xb("click",function(){return l.oc(n),l.Zb().save()}),l.wc(8," Save "),l.Pb(),l.Pb(),l.Pb(),l.Qb(9,"div",9),l.Qb(10,"div",15),l.Qb(11,"label",16),l.wc(12,"Icon"),l.Pb(),l.Mb(13,"dd-image-upload",17),l.Pb(),l.Qb(14,"div",18),l.Qb(15,"div",19),l.Qb(16,"label",20),l.wc(17,"Name"),l.Pb(),l.Mb(18,"input",21),l.vc(19,ns,2,0,"p",22),l.vc(20,is,2,0,"p",22),l.vc(21,rs,2,0,"p",22),l.Pb(),l.Qb(22,"div",19),l.Qb(23,"label",23),l.wc(24,"Description"),l.Pb(),l.Mb(25,"textarea",24),l.vc(26,cs,2,0,"p",22),l.vc(27,os,2,0,"p",22),l.Pb(),l.Pb(),l.Qb(28,"div",25),l.Qb(29,"h5",26),l.wc(30,"Misc"),l.Pb(),l.Qb(31,"div",9),l.Qb(32,"div",10),l.Qb(33,"div",27),l.Qb(34,"label",28),l.Mb(35,"input",29),l.Mb(36,"i",30),l.wc(37," Players can create this type of entity "),l.Pb(),l.Pb(),l.Qb(38,"div",27),l.Qb(39,"label",28),l.Mb(40,"input",31),l.Mb(41,"i",30),l.wc(42," This entity can have gold "),l.Pb(),l.Pb(),l.Qb(43,"div",27),l.Qb(44,"label",28),l.Mb(45,"input",32),l.Mb(46,"i",30),l.wc(47," This entity can have XP "),l.Pb(),l.Pb(),l.Qb(48,"div",27),l.Qb(49,"label",28),l.Mb(50,"input",33),l.Mb(51,"i",30),l.wc(52," This entity can have health "),l.Pb(),l.Pb(),l.Qb(53,"div",27),l.Qb(54,"label",34),l.wc(55,"Concept Types"),l.Pb(),l.Qb(56,"select",35),l.vc(57,as,2,2,"option",36),l.Pb(),l.Qb(58,"div",37),l.wc(59,"The entity will have these concept types enabled"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.vc(60,us,28,3,"div",38),l.Pb(),l.Pb(),l.Qb(61,"div"),l.Qb(62,"div",9),l.Qb(63,"div",10),l.Qb(64,"h3",26),l.wc(65,"Fields"),l.Pb(),l.Pb(),l.Qb(66,"div",39),l.Qb(67,"button",40),l.Xb("click",function(){return l.oc(n),l.Zb(),l.mc(3).open()}),l.wc(68," Use Preset "),l.Pb(),l.Qb(69,"button",41),l.Xb("click",function(){return l.oc(n),l.Zb().addField()}),l.Mb(70,"i",42),l.wc(71," Add Field"),l.Pb(),l.Pb(),l.Pb(),l.Qb(72,"div",43),l.Xb("cdkDropListDropped",function(e){return l.oc(n),l.Zb().drop(e)}),l.vc(73,ps,16,5,"div",44),l.Pb(),l.Pb(),l.Qb(74,"div",45),l.Qb(75,"button",46),l.Xb("click",function(){return l.oc(n),l.Zb().backToTop()}),l.wc(76,"Back to Top"),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.ec("formGroup",i.formGroup),l.Ab(3),l.ec("ngIf",!i.editing),l.Ab(1),l.ec("ngIf",i.editing),l.Ab(2),l.ec("ngIf",i.editing),l.Ab(1),l.ec("ngClass",l.ic(16,es,i.saving))("disabled",i.formGroup.invalid),l.Ab(8),l.ec("ngClass",l.ic(18,fs,i.name.invalid&&(i.name.dirty||i.name.touched))),l.Ab(4),l.ec("ngIf",i.name.invalid&&i.name.dirty&&i.name.errors.required),l.Ab(1),l.ec("ngIf",i.name.invalid&&i.name.dirty&&i.name.errors.minlength),l.Ab(1),l.ec("ngIf",i.name.invalid&&i.name.dirty&&i.name.errors.maxlength),l.Ab(1),l.ec("ngClass",l.ic(20,fs,i.description.invalid&&(i.description.dirty||i.description.touched))),l.Ab(4),l.ec("ngIf",i.description.invalid&&i.description.dirty&&i.description.errors.required),l.Ab(1),l.ec("ngIf",i.description.invalid&&i.description.dirty&&i.description.errors.minlength),l.Ab(30),l.ec("ngForOf",i.conceptTypeList),l.Ab(3),l.ec("ngIf",!0===i.isHealthEnabled.value),l.Ab(13),l.ec("ngForOf",i.fields.controls)}}var vs,ms=((vs=function(){function e(t,n,i,r,c,o){d(this,e),this.entityService=t,this.campaignService=n,this.presets=i,this.login=r,this.router=c,this.route=o,this.saving=!1,this.deleting=!1,this.loading=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.formGroup=new h.h({id:new h.e,name:new h.e(null,[h.v.required,h.v.minLength(3),h.v.maxLength(30)]),description:new h.e(null,[h.v.required,h.v.minLength(3)]),health:new h.h({type:new h.e("0"),colorType:new h.e("0"),staticColor:new h.e(null),amountHidden:new h.e(!1)}),playerCreatable:new h.e(!1),spawnable:new h.e(!1),isCurrencyEnabled:new h.e(!1),isXPEnabled:new h.e(!1),isHealthEnabled:new h.e(!1),conceptTypesEnabled:new h.e([]),imageId:new h.e(null,h.v.required),attributes:new h.c([]),fields:new h.c([])}),this.route.params.subscribe(function(t){t.ent_id&&e.loadEntityPreset(t.ent_id)}),this.presets.getPresets().then(function(t){return e.presetList=t})}},{key:"canDeactivate",value:function(){return!this.formGroup.dirty}},{key:"loadEntityPreset",value:function(e){return Ba(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,this.formGroup.disable(),t.prev=1,t.next=4,this.entityService.getEntityPreset(e);case 4:n=t.sent,this.entityPreset=n,setTimeout(function(){(n.fields||[]).forEach(function(e){var t=Hr.createFormGroup(e);t.addControl("class",new h.e(0)),t.addControl("redacted",new h.e(!1)),i.fields.push(t)}),i.formGroup.patchValue(Object.assign(Object.assign({},n),{fields:n.fields||[]}),{emitEvent:!1})},1),t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(1),t.t0;case 11:this.loading=!1,this.formGroup.enable();case 12:case"end":return t.stop()}},t,this,[[1,8]])}))}},{key:"constructEntityPreset",value:function(){var e=this.formGroup.value;e.health||(e.health={});var t={userId:this.login.id,campaignId:this.campaignService.campaign.id,name:e.name,description:e.description,health:{type:e.health.type,colorType:e.health.colorType,staticColor:e.health.staticColor,amountHidden:e.health.amountHidden},fields:e.fields,imageId:e.imageId,isCurrencyEnabled:e.isCurrencyEnabled,isXPEnabled:e.isXPEnabled,isHealthEnabled:e.isHealthEnabled,conceptTypesEnabled:e.conceptTypesEnabled,playerCreatable:e.playerCreatable};return this.editing&&(t.id=this.entityPreset.id,t.userId=this.entityPreset.userId,t.campaignId=this.entityPreset.campaignId),t}},{key:"usePreset",value:function(e){var t=this;this.fields.reset(),setTimeout(function(){e.fields.forEach(function(e){var n=Hr.createFormGroup(e);n.addControl("class",new h.e(e.class)),n.addControl("redacted",new h.e(e.redacted)),t.fields.push(n)}),t.presetsModal.close()},1)}},{key:"removeAttribute",value:function(e){this.formGroup.get("attributes").removeAt(e)}},{key:"save",value:function(){return Ba(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.formGroup.invalid){e.next=2;break}return e.abrupt("return");case 2:if(t=this.constructEntityPreset(),this.formGroup.disable(),this.saving=!0,e.prev=4,!this.editing){e.next=10;break}return e.next=8,this.entityService.updateEntityPreset(t);case 8:e.next=12;break;case 10:return e.next=12,this.entityService.createEntityPreset(t);case 12:return e.next=14,this.router.navigate(["campaigns",this.campaignService.campaign.id,"settings"],{queryParams:{refresh:!0}});case 14:e.next=19;break;case 16:throw e.prev=16,e.t0=e.catch(4),e.t0;case 19:this.formGroup.enable(),this.formGroup.markAsPristine(),this.saving=!1;case 20:case"end":return e.stop()}},e,this,[[4,16]])}))}},{key:"delete",value:function(){return Ba(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.confirmModal.getConfirmation("Are you sure you want to delete this entity? This cannot be undone");case 2:if(!e.sent){e.next=15;break}return this.deleting=!0,this.formGroup.disable(),e.prev=4,e.next=7,this.entityService.deleteEntityPreset(this.campaignService.campaign.id,"1");case 7:return e.next=9,this.router.navigate(["campaigns",this.campaignService.campaign.id,"settings"]);case 9:e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(4),e.t0;case 14:this.formGroup.enable(),this.deleting=!1;case 15:case"end":return e.stop()}},e,this,[[4,11]])}))}},{key:"addField",value:function(){var e=Hr.createFormGroup(null);e.addControl("class",new h.e(0)),e.addControl("redacted",new h.e(!1)),this.fields.push(e)}},{key:"backToTop",value:function(){document.getElementById("app-content").scrollTo(0,0)}},{key:"removeField",value:function(e){this.fields.removeAt(e),this.formGroup.markAsDirty()}},{key:"drop",value:function(e){var t=this.fields.at(e.previousIndex);this.fields.removeAt(e.previousIndex),this.fields.insert(e.currentIndex,t)}},{key:"attributeControls",get:function(){return this.formGroup.get("attributes").controls}},{key:"name",get:function(){return this.formGroup.get("name")}},{key:"description",get:function(){return this.formGroup.get("description")}},{key:"isHealthEnabled",get:function(){return this.formGroup.get("isHealthEnabled")}},{key:"hpColorType",get:function(){return this.formGroup.get("health.colorType")}},{key:"hpType",get:function(){return this.formGroup.get("health.type")}},{key:"conceptTypeList",get:function(){return this.campaignService.campaign.conceptTypes.filter(function(e){return!0===e.entityConfig.enabled})}},{key:"fields",get:function(){return this.formGroup.get("fields")}},{key:"otherFieldNames",get:function(){return this.fields.value.map(function(e){return e.name})}},{key:"editing",get:function(){return this.route.snapshot.data.editing}}]),e}()).\u0275fac=function(e){return new(e||vs)(l.Lb(de.b),l.Lb(P.b),l.Lb($a),l.Lb(E.a),l.Lb(w.c),l.Lb(w.a))},vs.\u0275cmp=l.Fb({type:vs,selectors:[["dd-entity-preset-editor"]],viewQuery:function(e,t){var n;1&e&&(l.Ac(za,3),l.Ac(Ya,3)),2&e&&(l.lc(n=l.Yb())&&(t.presetsModal=n.first),l.lc(n=l.Yb())&&(t.confirmModal=n.first))},decls:10,vars:2,consts:[["confirmmodal",""],["presets",""],["modal-header",""],["modal-body",""],["class","card p-1 mb-1 hoverable",3,"click",4,"ngFor","ngForOf"],["class","container grid-xl",3,"formGroup",4,"ngIf"],[1,"card","p-1","mb-1","hoverable",3,"click"],[1,"text-gray"],[1,"container","grid-xl",3,"formGroup"],[1,"columns"],[1,"column"],[4,"ngIf"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-error mr-2",3,"ngClass","click",4,"ngIf"],[1,"btn",3,"ngClass","disabled","click"],[1,"column","col-3","col-md-5","col-sm-12","col-mx-auto"],[1,"form-label"],["formControlName","imageId"],[1,"column","col-9","col-md-12"],[1,"form-group",3,"ngClass"],["for","name",1,"form-label"],["type","text","name","name","id","name","formControlName","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],["for","description",1,"form-label"],["name","description","id","description","rows","4","formControlName","description","placeholder","Description",1,"form-input"],[1,"column","col-12"],[1,"mt-2"],[1,"form-group"],[1,"form-checkbox"],["type","checkbox","formControlName","playerCreatable"],[1,"form-icon"],["type","checkbox","formControlName","isCurrencyEnabled"],["type","checkbox","formControlName","isXPEnabled"],["type","checkbox","formControlName","isHealthEnabled"],["for","conceptTypesEnabled",1,"form-label"],["name","conceptTypesEnabled","id","conceptTypesEnabled","formControlName","conceptTypesEnabled","multiple","",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"form-input-hint"],["formGroupName","health","class","columns mb-2",4,"ngIf"],[1,"column","col-auto"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],["cdkDropList","",3,"cdkDropListDropped"],["class","mt-2","cdkDrag","",4,"ngFor","ngForOf"],[1,"text-center"],[1,"btn","btn-link",3,"click"],[1,"btn","btn-error","mr-2",3,"ngClass","click"],[3,"value"],["formGroupName","health",1,"columns","mb-2"],["for","health-type",1,"form-label"],["name","health-type","id","health-type","formControlName","type",1,"form-input"],["value","0"],["value","1"],[1,"column",3,"hidden"],["for","bar-type",1,"form-label"],["formControlName","colorType","name","bar-type","id","bar-type",1,"form-input"],["class","column",3,"hidden",4,"ngIf"],["type","checkbox","formControlName","amountHidden"],["for","bar-color",1,"form-label"],["formControlName","staticColor","type","color","name","bar-color","id","bar-color",1,"form-input"],["cdkDrag","",1,"mt-2"],["class","drag-placeholder",4,"cdkDragPlaceholder"],[1,"columns","mb-1"],["cdkDragHandle","",1,"column","col-auto","c-move"],[1,"icon","icon-resize-vert"],[1,"column","d-flex","align-items-center"],[1,"mb-0"],["class","column col-auto",4,"ngIf"],[1,"btn","btn-sm","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[3,"formGroup","otherFields"],[1,"drag-placeholder"],["type","checkbox",3,"formControl"],[1,"form-input","input-sm",3,"formControl"],["value","2"],["value","3"]],template:function(e,t){1&e&&(l.Mb(0,"dd-confirmation-modal",null,0),l.Qb(2,"dd-modal",null,1),l.Qb(4,"div",2),l.Qb(5,"h4"),l.wc(6,"Attribute Presets"),l.Pb(),l.Pb(),l.Qb(7,"div",3),l.vc(8,Wa,4,2,"div",4),l.Pb(),l.Pb(),l.vc(9,hs,77,22,"div",5)),2&e&&(l.Ab(8),l.ec("ngForOf",t.presetList),l.Ab(1),l.ec("ngIf",t.entityPreset||!t.editing))},directives:[ja,te.a,I.j,I.k,h.n,h.i,I.i,Et,h.m,h.g,h.b,h.a,h.u,b.d,h.p,h.w,h.j,h.t,b.a,b.c,b.b,Hr,h.f],styles:[""]}),vs),gs=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function ys(e,t){1&e&&l.Mb(0,"div",4)}function ks(e,t){if(1&e){var n=l.Rb();l.Qb(0,"button",11),l.Xb("click",function(){return l.oc(n),l.Zb(2).delete()}),l.wc(1," Delete "),l.Pb()}}var ws=function(e){return{loading:e}};function Ps(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",5),l.Qb(1,"div",6),l.Qb(2,"h3"),l.wc(3),l.Pb(),l.Pb(),l.Qb(4,"div",7),l.Qb(5,"button",8),l.Xb("click",function(){return l.oc(n),l.Zb().cancel()}),l.wc(6,"Cancel"),l.Pb(),l.vc(7,ks,2,0,"button",9),l.Qb(8,"button",10),l.Xb("click",function(){return l.oc(n),l.Zb().save()}),l.wc(9," Save "),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(3),l.zc("",i.editing?"Edit":"Create"," ",i.preset.name,""),l.Ab(4),l.ec("ngIf",i.editing),l.Ab(1),l.ec("ngClass",l.ic(5,ws,i.saving))("disabled",i.formGroup.invalid)}}function Is(e,t){1&e&&(l.Qb(0,"p",34),l.wc(1," An XP value is required "),l.Pb())}function Cs(e,t){1&e&&(l.Qb(0,"p",34),l.wc(1," Can't have negative XP :/ "),l.Pb())}var xs=function(e,t){return{"has-error":e,"has-success":t}};function Qs(e,t){if(1&e&&(l.Qb(0,"div",17),l.Qb(1,"label",32),l.wc(2,"XP "),l.Qb(3,"span",19),l.wc(4,"*"),l.Pb(),l.Pb(),l.Mb(5,"input",33),l.vc(6,Is,2,0,"p",21),l.vc(7,Cs,2,0,"p",21),l.Pb()),2&e){var n=l.Zb(2);l.ec("ngClass",l.jc(3,xs,n.xp.invalid&&(n.xp.touched||n.xp.dirty),n.xp.valid&&(n.xp.touched||n.xp.dirty))),l.Ab(6),l.ec("ngIf",n.xp.invalid&&(n.xp.touched||n.xp.dirty)&&n.xp.errors.required),l.Ab(1),l.ec("ngIf",n.xp.invalid&&(n.xp.touched||n.xp.dirty)&&n.xp.errors.min)}}function As(e,t){1&e&&(l.Qb(0,"p",34),l.wc(1," A name is required "),l.Pb())}function Ts(e,t){1&e&&(l.Qb(0,"p",34),l.wc(1," The name can't be shorter than 2 characters "),l.Pb())}function Es(e,t){1&e&&(l.Qb(0,"p",34),l.wc(1," The name can't be longer than 20 characters "),l.Pb())}function Rs(e,t){if(1&e&&(l.Qb(0,"div",22),l.Qb(1,"label",35),l.Mb(2,"input",36),l.Mb(3,"i",37),l.wc(4),l.Pb(),l.Qb(5,"p",34),l.wc(6),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(4),l.yc(" This ",n.preset.name," is spawnable "),l.Ab(2),l.yc("Turns this ",n.preset.name," into a preset that can be quickly spawned into game sessions.")}}function Ls(e,t){if(1&e&&l.Mb(0,"dd-dynamic-field",38),2&e){var n=l.Zb(2);l.ec("config",n.currencyConfig)("control",n.currency)}}function Ms(e,t){1&e&&(l.Qb(0,"p",47),l.wc(1," A value is required for current health "),l.Pb())}function Ss(e,t){1&e&&(l.Qb(0,"p",47),l.wc(1," A value is required for max health "),l.Pb())}function Os(e,t){if(1&e&&(l.Qb(0,"div",39),l.Qb(1,"label",40),l.wc(2,"Health "),l.Qb(3,"span",41),l.wc(4,"*"),l.Pb(),l.Pb(),l.Qb(5,"div",42),l.Mb(6,"input",43),l.Qb(7,"span",44),l.wc(8,"/"),l.Pb(),l.Mb(9,"input",45),l.Pb(),l.vc(10,Ms,2,0,"p",46),l.vc(11,Ss,2,0,"p",46),l.Pb()),2&e){var n=l.Zb(2);l.ec("ngClass",l.jc(3,xs,n.health.invalid&&(n.health.dirty||n.health.touched),n.health.valid&&(n.health.dirty||n.health.touched))),l.Ab(10),l.ec("ngIf",n.hpCurrent.invalid&&(n.hpMax.dirty||n.hpMax.touched||n.hpCurrent.dirty||n.hpCurrent.touched)&&n.hpCurrent.errors.required),l.Ab(1),l.ec("ngIf",n.hpMax.invalid&&(n.hpMax.dirty||n.hpMax.touched||n.hpCurrent.dirty||n.hpCurrent.touched)&&n.hpMax.errors.required)}}function Ns(e,t){if(1&e&&(l.Qb(0,"div",54),l.Qb(1,"p",55),l.wc(2),l.Pb(),l.Pb()),2&e){var n=l.Zb(3);l.Ab(2),l.yc("This ",n.preset.name," has no health text yet, (players will see nothing)")}}function _s(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",12),l.Qb(1,"div",5),l.Qb(2,"div",56),l.Qb(3,"div",42),l.Mb(4,"input",57),l.Qb(5,"div",44),l.wc(6," % "),l.Pb(),l.Pb(),l.Pb(),l.Qb(7,"div",6),l.Mb(8,"input",58),l.Pb(),l.Qb(9,"div",49),l.Qb(10,"button",59),l.Xb("click",function(){l.oc(n);var e=t.index;return l.Zb(3).removeHealthText(e)}),l.Mb(11,"i",60),l.Pb(),l.Pb(),l.Pb(),l.Pb()}2&e&&l.ec("formGroup",t.$implicit)}function Fs(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",48),l.Qb(1,"div",5),l.Qb(2,"div",6),l.Qb(3,"label",40),l.wc(4,"Health Text"),l.Pb(),l.Pb(),l.Qb(5,"div",49),l.Qb(6,"button",50),l.Xb("click",function(){return l.oc(n),l.Zb(2).addHealthText()}),l.Mb(7,"div",51),l.Pb(),l.Pb(),l.Pb(),l.vc(8,Ns,3,1,"div",52),l.vc(9,_s,12,1,"div",53),l.Pb()}if(2&e){var i=l.Zb(2);l.Ab(8),l.ec("ngIf",0===i.hpTextLevels.length),l.Ab(1),l.ec("ngForOf",i.hpTextLevels.controls)}}function Us(e,t){1&e&&(l.Qb(0,"h3",61),l.wc(1,"Custom Attributes"),l.Pb())}function qs(e,t){if(1&e&&l.Mb(0,"dd-dynamic-field-horizontal",62),2&e){var n=t.$implicit,i=t.index,r=l.Zb(2);l.ec("config",r.getFieldConfig(n))("control",r.fields.controls[i])}}function Gs(e,t){if(1&e&&(l.Qb(0,"div",12),l.Qb(1,"div",5),l.Qb(2,"div",13),l.Mb(3,"dd-image-upload",14),l.vc(4,Qs,8,6,"div",15),l.Pb(),l.Qb(5,"div",16),l.Qb(6,"div",17),l.Qb(7,"label",18),l.wc(8,"Name "),l.Qb(9,"span",19),l.wc(10,"*"),l.Pb(),l.Pb(),l.Mb(11,"input",20),l.vc(12,As,2,0,"p",21),l.vc(13,Ts,2,0,"p",21),l.vc(14,Es,2,0,"p",21),l.Pb(),l.Qb(15,"div",22),l.Qb(16,"label",23),l.wc(17,"Description"),l.Pb(),l.Mb(18,"dd-quill",24),l.Pb(),l.vc(19,Rs,7,2,"div",25),l.vc(20,Ls,1,2,"dd-dynamic-field",26),l.vc(21,Os,12,6,"div",27),l.vc(22,Fs,10,2,"div",28),l.Pb(),l.Pb(),l.vc(23,Us,2,0,"h3",29),l.Qb(24,"div",30),l.vc(25,qs,1,2,"dd-dynamic-field-horizontal",31),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.ec("formGroup",n.formGroup),l.Ab(4),l.ec("ngIf",n.preset.isXPEnabled),l.Ab(2),l.ec("ngClass",l.jc(13,xs,n.name.invalid&&(n.name.touched||n.name.dirty),n.name.valid&&(n.name.touched||n.name.dirty))),l.Ab(6),l.ec("ngIf",n.name.invalid&&(n.name.touched||n.name.dirty)&&n.name.errors.required),l.Ab(1),l.ec("ngIf",n.name.invalid&&(n.name.touched||n.name.dirty)&&n.name.errors.minlength),l.Ab(1),l.ec("ngIf",n.name.invalid&&(n.name.touched||n.name.dirty)&&n.name.errors.maxlength),l.Ab(5),l.ec("ngIf",n.campaignEditable),l.Ab(1),l.ec("ngIf",n.preset.isCurrencyEnabled),l.Ab(1),l.ec("ngIf",n.preset.isHealthEnabled),l.Ab(1),l.ec("ngIf",n.preset.isHealthEnabled&&1===n.preset.health.type),l.Ab(1),l.ec("ngIf",n.preset.fields&&n.preset.fields.length>0),l.Ab(2),l.ec("ngForOf",n.preset.fields)("ngForTrackBy",n.trackField)}}var Ds,Zs,Xs,js=((Xs=function(){function e(t,n,i,r,c,o){d(this,e),this.route=t,this.router=n,this.entityService=i,this.campaignService=r,this.login=c,this.location=o,this.loading=!1,this.saving=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this._entTypeId=this.route.snapshot.paramMap.get("ent_type_id"),this.formGroup=new h.h({name:new h.e(null,[h.v.required,h.v.minLength(2),h.v.maxLength(20)]),content:new h.e(null),spawnable:new h.e(!1),xp:new h.e(0,[h.v.min(0)]),currency:new h.e(null,[h.v.min(0)]),health:new h.h({max:new h.e(null,[h.v.min(1)]),current:new h.e(null,[h.v.min(0)]),textDamageLevels:new h.c([])}),fields:new h.c([]),imageId:new h.e("uncertainty"),imageColor1:new h.e("#fff"),imageColor2:new h.e("#000")}),this.route.paramMap.subscribe(function(t){var n=t.get("ent_id");e._entTypeId=t.get("ent_type_id"),e.editing&&e.loadEntity(n),e.fields.reset(),(e.preset.fields||[]).forEach(function(){e.fields.push(new h.e(null))})}),this.editing||(this.setFormValidators(),"true"===this.route.snapshot.queryParamMap.get("spawnable")&&this.formGroup.patchValue({spawnable:!0}))}},{key:"canDeactivate",value:function(){return this.formGroup.pristine}},{key:"setFormValidators",value:function(){this.preset.isXPEnabled&&this.formGroup.get("xp").setValidators([h.v.min(0),h.v.required]),this.preset.isHealthEnabled&&(this.formGroup.get("health.max").setValidators([h.v.min(1),h.v.required]),this.formGroup.get("health.current").setValidators([h.v.min(0),h.v.required]))}},{key:"constructEntity",value:function(){var e=this,t=this.formGroup.value,n=null;this.preset.isHealthEnabled&&this.preset.health.type===de.d.TEXT_BASED&&(n={},this.hpTextLevels.controls.forEach(function(e){n[e.value.percent]=e.value.text}));var i={id:this.entity?this.entity.id:"",name:t.name,content:t.content,xp:t.xp,imageId:t.imageId,imageColor1:t.imageColor1,imageColor2:t.imageColor2,currency:t.currency,spawnable:t.spawnable,fields:this.fields.value.map(function(t,n){return{name:e.preset.fields[n].name,value:t}}).filter(function(e){return null!=e.value&&""!==e.value}),health:{max:t.health.max,current:t.health.current,textDamageLevels:n},userId:this.editing?this.entity.userId:this.login.id,campaignId:this.campaignService.campaign.id,entityPresetId:this.preset.id,mapId:this.entity?this.entity.mapId:void 0,lat:this.entity?this.entity.lat:void 0,lng:this.entity?this.entity.lng:void 0,spawnedFromId:this.entity?this.entity.spawnedFromId:void 0};return this.preset.isHealthEnabled||(i.health=null),i}},{key:"loadEntity",value:function(e){return gs(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,this.entity=null,this.formGroup.disable(),t.prev=1,t.next=4,this.entityService.getEntity(e);case 4:n=t.sent,this.entity=n,this.setFormValidators(),this.entity.health&&this.entity.health.textDamageLevels&&Object.keys(this.entity.health.textDamageLevels).forEach(function(){i.addHealthText()}),setTimeout(function(){var e=Object.assign({},n);if(e.fields=(i.preset.fields||[]).map(function(e){var t=(i.entity.fields||[]).find(function(t){return t.name===e.name});return t?t.value:null}),e.health&&e.health.textDamageLevels){var t=Object.keys(e.health.textDamageLevels).map(function(t){return{percent:t,text:e.health.textDamageLevels[t]}});e.health.textDamageLevels=t}else e.health&&(e.health.textDamageLevels=[]);null===n.health&&(n.health={max:1,current:0}),i.formGroup.patchValue(e)},1),t.next=11;break;case 8:throw t.prev=8,t.t0=t.catch(1),t.t0;case 11:this.formGroup.enable(),this.loading=!1;case 12:case"end":return t.stop()}},t,this,[[1,8]])}))}},{key:"save",value:function(){return gs(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.constructEntity(),this.saving=!0,this.formGroup.disable(),!this.editing){e.next=14;break}return e.prev=2,e.next=5,this.entityService.updateEntity(t);case 5:this.formGroup.markAsPristine(),this.cancel(),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(2),e.t0;case 12:e.next=24;break;case 14:return e.prev=14,e.next=17,this.entityService.createEntity(t);case 17:n=e.sent,this.formGroup.markAsPristine(),this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",n.id]),e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(14),e.t1;case 24:this.formGroup.enable(),this.saving=!1;case 25:case"end":return e.stop()}},e,this,[[2,9],[14,21]])}))}},{key:"delete",value:function(){return gs(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mt.a.fire({title:"Are you sure?",text:"This cannot be undone!",type:"question",showCancelButton:!0,showConfirmButton:!0});case 2:if(!0!==e.sent.value){e.next=14;break}return e.prev=5,e.next=8,this.entityService.deleteEntity(this.entity.id);case 8:this.router.navigate(["campaigns",this.campaignService.campaign.id,"overview"]),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),e.t0;case 14:case"end":return e.stop()}},e,this,[[5,11]])}))}},{key:"addHealthText",value:function(){this.hpTextLevels.push(new h.h({percent:new h.e(null,[h.v.required,h.v.min(0),h.v.max(100)]),text:new h.e(null,[h.v.required,h.v.maxLength(150)])}))}},{key:"removeHealthText",value:function(e){this.hpTextLevels.removeAt(e)}},{key:"trackField",value:function(e){return e}},{key:"getFieldConfig",value:function(e){return e.type===pe.a.CURRENCY&&(e.options={levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}),e}},{key:"cancel",value:function(){this.location.back()}},{key:"preset",get:function(){var e=this;return this.campaignService.campaign.entityPresets.find(function(t){return t.id===(e._entTypeId||e.route.snapshot.paramMap.get("ent_type_id"))})}},{key:"name",get:function(){return this.formGroup.get("name")}},{key:"content",get:function(){return this.formGroup.get("content")}},{key:"xp",get:function(){return this.formGroup.get("xp")}},{key:"currency",get:function(){return this.formGroup.get("currency")}},{key:"health",get:function(){return this.formGroup.get("health")}},{key:"hpMax",get:function(){return this.formGroup.get("health.max")}},{key:"hpCurrent",get:function(){return this.formGroup.get("health.current")}},{key:"hpTextLevels",get:function(){return this.formGroup.get("health.textDamageLevels")}},{key:"campaignEditable",get:function(){return this.campaignService.canEdit}},{key:"editing",get:function(){return this.route.snapshot.data.editing}},{key:"currencyConfig",get:function(){return{name:"Money",type:pe.a.CURRENCY,options:{levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}}}},{key:"fields",get:function(){return this.formGroup.get("fields")}}]),e}()).\u0275fac=function(e){return new(e||Xs)(l.Lb(w.a),l.Lb(w.c),l.Lb(de.b),l.Lb(P.b),l.Lb(E.a),l.Lb(I.g))},Xs.\u0275cmp=l.Fb({type:Xs,selectors:[["dd-entity-editor"]],decls:4,vars:3,consts:[[1,"container","grid-xl"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],[1,"btn","mr-2",3,"click"],["class","btn btn-error mr-2",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"ngClass","disabled","click"],[1,"btn","btn-error","mr-2",3,"click"],[3,"formGroup"],[1,"column","col-3","col-md-12"],["formControlName","imageId"],["class","form-group",3,"ngClass",4,"ngIf"],[1,"column","col-9","col-md-12"],[1,"form-group",3,"ngClass"],["for","name",1,"form-lable"],[1,"text-large","text-bold","text-primary"],["type","text","name","name","id","name","formControlName","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],[1,"form-group"],["for","description",1,"form-label"],["simple","true","formControlName","content","placeholder","Description"],["class","form-group",4,"ngIf"],[3,"config","control",4,"ngIf"],["class","form-group","formGroupName","health",3,"ngClass",4,"ngIf"],["class","form-group","formGroupName","health",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"form-horizontal"],["class","col-12 mb-2",3,"config","control",4,"ngFor","ngForOf","ngForTrackBy"],["for","xp",1,"form-label"],["type","number","name","xp","id","xp","placeholder","XP","formControlName","xp",1,"form-input"],[1,"form-input-hint"],[1,"form-checkbox"],["type","checkbox","formControlName","spawnable"],[1,"form-icon"],[3,"config","control"],["formGroupName","health",1,"form-group",3,"ngClass"],[1,"form-label"],[1,"text-primary","text-large","text-bold"],[1,"input-group"],["type","number","name","current-hp","formControlName","current","id","current-hp","placeholder","Current HP",1,"form-input"],[1,"input-group-addon"],["type","number","name","current-hp","formControlName","max","placeholder","Max HP","id","current-hp",1,"form-input"],["class","form-input-hint mb-0",4,"ngIf"],[1,"form-input-hint","mb-0"],["formGroupName","health",1,"form-group"],[1,"column","col-auto"],[1,"button","btn","btn-sm",3,"click"],[1,"i","icon","icon-plus"],["class","empty p-2",4,"ngIf"],[3,"formGroup",4,"ngFor","ngForOf"],[1,"empty","p-2"],[1,"empty-subtitle"],[1,"column","col-2","form-group"],["type","number","min","0","max","100","placeholder","80","formControlName","percent",1,"form-input"],["type","text","placeholder","Looking a little bit sad","formControlName","text",1,"form-input"],[1,"btn","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"mt-2"],[1,"col-12","mb-2",3,"config","control"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,ys,1,0,"div",1),l.vc(2,Ps,10,7,"div",2),l.vc(3,Gs,26,16,"div",3),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.entity||!t.editing),l.Ab(1),l.ec("ngIf",t.entity||!t.editing))},directives:[I.k,I.i,h.n,h.i,Et,h.m,h.g,h.b,fe.a,I.j,h.q,h.a,ne.a,h.j,Ac],styles:[""]}),Xs),Hs=((Zs=function(){function e(t,n){d(this,e),this.login=t,this.router=n}return p(e,[{key:"canActivate",value:function(e,t){return n=this,r=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.login.isLoggedIn;case 2:if(e.t0=!e.sent,e.t0){e.next=5;break}e.t0=(this.router.navigate(["home"]),!1);case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}},e,this)}),new((i=void 0)||(i=Promise))(function(e,t){function c(e){try{a(r.next(e))}catch(n){t(n)}}function o(e){try{a(r.throw(e))}catch(n){t(n)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i(function(e){e(n)})).then(c,o)}a((r=r.apply(n,[])).next())});var n,i,r}}]),e}()).\u0275fac=function(e){return new(e||Zs)(l.Ub(E.a),l.Ub(w.c))},Zs.\u0275prov=l.Hb({token:Zs,factory:Zs.\u0275fac,providedIn:"root"}),Zs),Vs=((Ds=function(){function e(t){d(this,e),this.http=t}return p(e,[{key:"getPurchases",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r="";return i&&(r="&entityId=".concat(i)),this.http.get("".concat(k.a.apiURL,"/purchases?limit=").concat(t,"&offset=").concat(n,"&campaignId=").concat(e).concat(r)).toPromise()}}]),e}()).\u0275fac=function(e){return new(e||Ds)(l.Ub(f.b))},Ds.\u0275prov=l.Hb({token:Ds,factory:Ds.\u0275fac,providedIn:"root"}),Ds),$s=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function Bs(e,t){1&e&&l.Mb(0,"div",6)}var zs=function(e,t){return["/campaigns",e,"entities",t]};function Ys(e,t){if(1&e&&(l.Qb(0,"div",7),l.Qb(1,"div",8),l.Qb(2,"button",9),l.Mb(3,"i",10),l.Pb(),l.Pb(),l.Qb(4,"div",11),l.Qb(5,"h5"),l.wc(6),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(2),l.ec("routerLink",l.jc(2,zs,n.campaign.id,n.entity.id)),l.Ab(4),l.yc("Purchases for ",n.entity.name,"")}}function Ws(e,t){if(1&e&&(l.Qb(0,"div",12),l.Qb(1,"div",13),l.Mb(2,"i",14),l.Pb(),l.Qb(3,"p",15),l.wc(4),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(4),l.yc("",n.entity.name," has not made any purchases")}}var Ks=function(e,t,n){return["/campaigns",e,"concepts",t,n,"view"]},Js=function(e,t){return["/campaigns",e,"articles",t]};function eu(e,t){if(1&e&&(l.Qb(0,"div",18),l.Qb(1,"div",19),l.Mb(2,"a",20),l.Pb(),l.Qb(3,"div",21),l.Qb(4,"div"),l.Qb(5,"b"),l.wc(6),l.Pb(),l.wc(7," purchased "),l.Qb(8,"b"),l.wc(9),l.Pb(),l.Qb(10,"a",22),l.wc(11),l.Pb(),l.wc(12," from "),l.Qb(13,"a",22),l.wc(14),l.Pb(),l.Pb(),l.Qb(15,"div"),l.Mb(16,"div",23),l.Qb(17,"div"),l.wc(18),l.ac(19,"date"),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(2);l.Ab(6),l.xc(i.entity.name),l.Ab(3),l.yc("",n.quantity,"x "),l.Ab(1),l.ec("routerLink",l.kc(11,Ks,i.campaign.id,n.concept.conceptTypeId,n.concept.id)),l.Ab(1),l.xc(n.concept.name),l.Ab(2),l.ec("routerLink",l.jc(15,Js,i.campaign.id,n.article.id)),l.Ab(1),l.xc(n.article.name),l.Ab(2),l.ec("ddCurrency",n.totalCurrencyCost),l.Ab(2),l.xc(l.bc(19,8,n.dateTime,"short"))}}function tu(e,t){if(1&e&&(l.Qb(0,"div",16),l.vc(1,eu,20,18,"div",17),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("ngForOf",n.purchases)}}function nu(e,t){if(1&e){var n=l.Rb();l.Qb(0,"dd-paginator",24),l.Xb("pageChange",function(e){return l.oc(n),l.Zb().setPage(e)}),l.Pb()}if(2&e){var i=l.Zb();l.ec("totalItems",i.totalPurchases)("autoHide",!1)("page",i.page)}}var iu,ru,cu,ou=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"invite/:invite_id",component:Ui},{path:"about",component:Hi},{path:"login",component:G,canActivate:[Hs]},{path:"register",component:Ai},{path:"callback",component:G},{path:"account",canActivate:[ee,qi],loadChildren:function(){return Promise.resolve().then(s.bind(null,"zrcO")).then(function(e){return e.UsersModule})}},{path:"campaigns/list",component:W,canActivate:[ee,qi]},{path:"home",component:K,canActivate:[ee,qi]},{path:"campaigns/create",component:An,canActivate:[ee,qi],data:{editing:!1}},{path:"campaigns/:id",component:T,canActivate:[ee,qi],children:[{path:"",pathMatch:"full",redirectTo:"landing"},{path:"landing",component:Ii,data:{suggestable:!0}},{path:"entities",component:Vi,children:[{path:":ent_id",component:dt,data:{suggestable:!0}},{path:":ent_id/purchases",component:(iu=function(){function e(t,n,i,r,c){d(this,e),this.route=t,this.router=n,this.purchaseService=i,this.campaignService=r,this.entityService=c,this.loading=!1,this.page=1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.route.paramMap.subscribe(function(t){e.load(t.get("ent_id"))})}},{key:"load",value:function(e){return $s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,Promise.all([this.loadPurchases(e),this.loadEntity(e)]);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:this.loading=!1;case 10:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"loadEntity",value:function(e){return $s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entityService.getEntity(e);case 2:this.entity=t.sent;case 3:case"end":return t.stop()}},t,this)}))}},{key:"loadPurchases",value:function(e){return $s(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.purchaseService.getPurchases(this.campaignService.campaign.id,10,10*(this.page-1),e);case 2:n=t.sent,this.totalPurchases=n.total,this.purchases=n.purchases;case 4:case"end":return t.stop()}},t,this)}))}},{key:"setPage",value:function(e){this.entity&&(this.page=e,this.load(this.entity.id))}},{key:"campaign",get:function(){return this.campaignService.campaign}}]),e}(),iu.\u0275fac=function(e){return new(e||iu)(l.Lb(w.a),l.Lb(w.c),l.Lb(Vs),l.Lb(P.b),l.Lb(de.b))},iu.\u0275cmp=l.Fb({type:iu,selectors:[["dd-entity-purchase-list"]],decls:6,vars:5,consts:[[1,"container","grid-lg"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],["class","empty mt-2",4,"ngIf"],["class","timeline",4,"ngIf"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column","col-auto"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-arrow-left"],[1,"column"],[1,"empty","mt-2"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],[1,"timeline-item"],[1,"timeline-left"],[1,"timeline-icon"],[1,"timeline-content"],[3,"routerLink"],[1,"label","label-warning","mt-1","text-dark",3,"ddCurrency"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.vc(1,Bs,1,0,"div",1),l.vc(2,Ys,7,5,"div",2),l.vc(3,Ws,5,1,"div",3),l.vc(4,tu,2,1,"div",4),l.vc(5,nu,1,3,"dd-paginator",5),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",t.loading&&!t.purchases),l.Ab(1),l.ec("ngIf",t.entity&&t.purchases),l.Ab(1),l.ec("ngIf",t.entity&&t.purchases&&0===t.totalPurchases),l.Ab(1),l.ec("ngIf",t.entity&&t.purchases),l.Ab(1),l.ec("ngIf",t.entity&&t.purchases&&t.totalPurchases>0))},directives:[I.k,w.d,I.j,w.e,Ae.a,ic.a],pipes:[I.d],styles:[""]}),iu),data:{suggestable:!0}},{path:":ent_id/ct/:ct_id",component:Za},{path:":ent_type_id/create",component:js,canDeactivate:[Er.a],data:{editing:!1}},{path:":ent_type_id/:ent_id/edit",component:js,canDeactivate:[Er.a],data:{editing:!0}}]},{path:"notes",loadChildren:function(){return Promise.resolve().then(s.bind(null,"reMG")).then(function(e){return e.NotesModule})}},{path:"concepttypes/create",component:ec,canDeactivate:[Er.a],data:{editing:!1}},{path:"concepttypes/:ct_id/edit",component:ec,canDeactivate:[Er.a],data:{editing:!0}},{path:"concepts/:ct_id/manage",component:yc,data:{suggestable:!0}},{path:"concepts/:ct_id/create",component:_c,data:{editing:!1}},{path:"concepts/:ct_id/:c_id/edit",component:_c,data:{editing:!0}},{path:"concepts/:ct_id/:c_id/view",component:no,data:{suggestable:!0}},{path:"concepts/:ct_id/:c_id/history",component:ko,data:{suggestable:!0}},{path:"entitytypes/create",component:ms,data:{editing:!1}},{path:"entitytypes/:ent_id/edit",component:ms,data:{editing:!0}},{path:"spawnables",component:Tr},{path:"settings",component:An,canDeactivate:[Er.a],data:{editing:!0}},{path:"overview",loadChildren:function(){return s.e(8).then(s.bind(null,"h0u9")).then(function(e){return e.OverviewModule})}},{path:"quests",component:jn,data:{suggestable:!0}},{path:"quests/create",component:nr,canDeactivate:[Er.a],data:{editing:!1}},{path:"quests/:q_id/edit",component:nr,canDeactivate:[Er.a],data:{editing:!0}},{path:"quests/:q_id",component:vr,data:{suggestable:!0}},{path:"maps",loadChildren:function(){return Promise.resolve().then(s.bind(null,"HboH")).then(function(e){return e.MappingModule})}},{path:"articles",loadChildren:function(){return s.e(7).then(s.bind(null,"+mPt")).then(function(e){return e.ArticlesModule})}},{path:"members",component:Do},{path:"sketchpad",loadChildren:function(){return s.e(6).then(s.bind(null,"qd9+")).then(function(e){return e.SketchpadModule})}}]}],au=((cu=function e(){d(this,e)}).\u0275mod=l.Jb({type:cu}),cu.\u0275inj=l.Ib({factory:function(e){return new(e||cu)},imports:[[w.f.forRoot(ou,{relativeLinkResolution:"legacy"})],w.f]}),cu),su=((ru=function(){function e(t){var n=this;d(this,e),this.router=t,this._sidebarOpen=!1,t.events.subscribe(function(e){n.sidebarOpen=!1})}return p(e,[{key:"toggle",value:function(){this.sidebarOpen=!this.sidebarOpen}},{key:"sidebarOpen",get:function(){return this._sidebarOpen},set:function(e){this._sidebarOpen=e}}]),e}()).\u0275fac=function(e){return new(e||ru)(l.Ub(w.c))},ru.\u0275prov=l.Hb({token:ru,factory:ru.\u0275fac,providedIn:"root"}),ru),uu=s("nzV2"),lu=function(){return["login"]};function du(e,t){1&e&&(l.Qb(0,"a",1),l.wc(1,"Login"),l.Pb()),2&e&&l.ec("routerLink",l.hc(1,lu))}var bu=function(){return["home"]},pu=function(){return["campaigns","list"]},fu=function(){return["/account"]};function hu(e,t){if(1&e){var n=l.Rb();l.Qb(0,"li",4),l.Qb(1,"a",1),l.wc(2,"Me"),l.Pb(),l.Qb(3,"ul",7),l.Qb(4,"li",4),l.Qb(5,"a",1),l.wc(6,"Campaigns"),l.Pb(),l.Pb(),l.Qb(7,"li",4),l.Qb(8,"a",1),l.wc(9,"Account"),l.Pb(),l.Pb(),l.Qb(10,"li",4),l.Qb(11,"a",8),l.Xb("click",function(){return l.oc(n),l.Zb().logOut()}),l.wc(12,"Logout"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}2&e&&(l.Ab(1),l.ec("routerLink",l.hc(3,bu)),l.Ab(4),l.ec("routerLink",l.hc(4,pu)),l.Ab(3),l.ec("routerLink",l.hc(5,fu)))}var vu=function(e,t){return["campaigns",e,"concepts",t,"manage"]};function mu(e,t){if(1&e&&(l.Qb(0,"li",4),l.Qb(1,"a",1),l.wc(2),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(2);l.Ab(1),l.ec("routerLink",l.jc(2,vu,i.campaign.id,n.id)),l.Ab(1),l.xc(n.pluralForm)}}var gu=function(e){return["campaigns",e,"spawnables"]};function yu(e,t){if(1&e&&(l.Qb(0,"li",4),l.Qb(1,"a",1),l.wc(2,"Spawnables"),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("routerLink",l.ic(1,gu,n.campaign.id))}}var ku=function(e,t){return["campaigns",e,"entities",t,"create"]};function wu(e,t){if(1&e&&(l.Qb(0,"li",4),l.Qb(1,"a",1),l.wc(2),l.Pb(),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(2);l.Ab(1),l.ec("routerLink",l.jc(2,ku,i.campaign.id,n.id)),l.Ab(1),l.yc("Create ",n.name,"")}}var Pu=function(e){return["campaigns",e,"settings"]};function Iu(e,t){if(1&e&&(l.Qb(0,"li",4),l.Qb(1,"a",1),l.wc(2,"Settings"),l.Pb(),l.Pb()),2&e){var n=l.Zb(2);l.Ab(1),l.ec("routerLink",l.ic(1,Pu,n.campaign.id))}}var Cu=function(e){return["campaigns",e,"landing"]},xu=function(e){return["campaigns",e,"articles"]},Qu=function(e){return["campaigns",e,"quests"]},Au=function(e){return["campaigns",e,"notes"]},Tu=function(e){return["campaigns",e,"overview"]},Eu=function(e){return["campaigns",e,"maps"]};function Ru(e,t){if(1&e&&(l.Qb(0,"li",4),l.Qb(1,"a",1),l.wc(2),l.ac(3,"truncate"),l.Pb(),l.Qb(4,"ul",7),l.Qb(5,"li",4),l.Qb(6,"a",1),l.wc(7,"Articles"),l.Pb(),l.Pb(),l.Qb(8,"li",4),l.Qb(9,"a",1),l.wc(10,"Quests"),l.Pb(),l.Pb(),l.Qb(11,"li",4),l.Qb(12,"a",1),l.wc(13,"Notebook"),l.Pb(),l.Pb(),l.Qb(14,"li",4),l.Qb(15,"a",1),l.wc(16,"Overview"),l.Pb(),l.Pb(),l.Qb(17,"li",4),l.Qb(18,"a",1),l.wc(19,"Maps"),l.Pb(),l.Pb(),l.vc(20,mu,3,5,"li",9),l.vc(21,yu,3,3,"li",6),l.vc(22,wu,3,5,"li",9),l.vc(23,Iu,3,3,"li",6),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(1),l.ec("routerLink",l.ic(14,Cu,n.campaign.id)),l.Ab(1),l.yc(" ",l.bc(3,11,n.campaign.name,20)," "),l.Ab(4),l.ec("routerLink",l.ic(16,xu,n.campaign.id)),l.Ab(3),l.ec("routerLink",l.ic(18,Qu,n.campaign.id)),l.Ab(3),l.ec("routerLink",l.ic(20,Au,n.campaign.id)),l.Ab(3),l.ec("routerLink",l.ic(22,Tu,n.campaign.id)),l.Ab(3),l.ec("routerLink",l.ic(24,Eu,n.campaign.id)),l.Ab(2),l.ec("ngForOf",n.conceptTypes),l.Ab(1),l.ec("ngIf",n.campaignEditable),l.Ab(1),l.ec("ngForOf",n.entityPresets),l.Ab(1),l.ec("ngIf",n.campaignEditable)}}var Lu,Mu=function(){return["about"]},Su=((Lu=function(){function e(t,n,i){d(this,e),this.campaignService=t,this.login=n,this.router=i}return p(e,[{key:"ngOnInit",value:function(){}},{key:"logOut",value:function(){this.login.logout(),this.router.navigate(["login"]),this.campaignService.campaign=void 0}},{key:"entityPresets",get:function(){if(this.campaign)return this.campaignService.canEdit?this.campaign.entityPresets:this.campaign.entityPresets.filter(function(e){return e.playerCreatable})}},{key:"loadingCampaign",get:function(){return this.campaignService.loadingCampaign}},{key:"campaign",get:function(){return this.campaignService.campaign}},{key:"navEntities",get:function(){var e=this;return this.campaign.entities.filter(function(t){return!t.spawnable&&null===t.spawnedFromId&&t.userId===e.login.id})}},{key:"conceptTypes",get:function(){return this.campaign.conceptTypes.filter(function(e){return!0===e.isShownInNavigationMenu})}},{key:"loggedIn",get:function(){return this.login.isLoggedIn}},{key:"campaignEditable",get:function(){return this.campaignService.canEdit}}]),e}()).\u0275fac=function(e){return new(e||Lu)(l.Lb(P.b),l.Lb(E.a),l.Lb(w.c))},Lu.\u0275cmp=l.Fb({type:Lu,selectors:[["dd-nav-sidebar"]],decls:11,vars:7,consts:[[1,"brand","text-center","mt-2"],[3,"routerLink"],["src","/assets/icons/android-chrome-72x72.png","width","32"],[1,"nav","ml-2"],[1,"nav-item"],[3,"routerLink",4,"ngIf"],["class","nav-item",4,"ngIf"],[1,"nav"],[1,"c-hand",3,"click"],["class","nav-item",4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(l.Qb(0,"div",0),l.Qb(1,"a",1),l.Mb(2,"img",2),l.Pb(),l.Pb(),l.Qb(3,"ul",3),l.Qb(4,"li",4),l.vc(5,du,2,2,"a",5),l.Pb(),l.vc(6,hu,13,6,"li",6),l.vc(7,Ru,24,26,"li",6),l.Qb(8,"li",4),l.Qb(9,"a",1),l.wc(10,"About"),l.Pb(),l.Pb(),l.Pb()),2&e&&(l.Ab(1),l.ec("routerLink",l.hc(5,bu)),l.Ab(4),l.ec("ngIf",!t.loggedIn),l.Ab(1),l.ec("ngIf",t.loggedIn),l.Ab(1),l.ec("ngIf",t.campaign),l.Ab(2),l.ec("routerLink",l.hc(6,Mu)))},directives:[w.e,I.k,I.j],pipes:[g.a],styles:[".brand[_ngcontent-%COMP%]{display:flex}.brand[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}"]}),Lu),Ou=s("S36L"),Nu=s("pLZG"),_u=s("lJxs");function Fu(e,t){1&e&&l.Mb(0,"div",2)}function Uu(e,t){1&e&&(l.Qb(0,"div",9),l.Qb(1,"div",10),l.Mb(2,"i",11),l.Pb(),l.Qb(3,"p",12),l.wc(4,"You have no new notifications"),l.Pb(),l.Qb(5,"p",13),l.wc(6,"Don't worry, they'll show up one day :)"),l.Pb(),l.Pb())}function qu(e,t){if(1&e&&l.Mb(0,"div",26),2&e){var n=l.Zb().$implicit;l.ec("ddUser",n.suggestedBy)}}function Gu(e,t){if(1&e){var n=l.Rb();l.Qb(0,"li",27),l.Xb("click",function(){l.oc(n);var e=l.Zb().$implicit;return l.Zb(2).viewSuggestion(e)}),l.Qb(1,"div"),l.wc(2,"View Suggestion "),l.Mb(3,"i",28),l.Pb(),l.Pb()}}function Du(e,t){if(1&e){var n=l.Rb();l.Qb(0,"li",27),l.Xb("click",function(){l.oc(n);var e=l.Zb().$implicit;return l.Zb(2).viewCampaign(e)}),l.Qb(1,"div"),l.wc(2),l.Mb(3,"i",28),l.Pb(),l.Pb()}if(2&e){var i=l.Zb().$implicit;l.Ab(2),l.yc("",i.campaign.name," ")}}function Zu(e,t){if(1&e){var n=l.Rb();l.Qb(0,"li",27),l.Xb("click",function(){l.oc(n);var e=l.Zb().$implicit;return l.Zb(2).viewMap(e)}),l.Qb(1,"div"),l.wc(2,"View Map "),l.Mb(3,"i",28),l.Pb(),l.Pb()}}function Xu(e,t){if(1&e){var n=l.Rb();l.Qb(0,"li",27),l.Xb("click",function(){l.oc(n);var e=l.Zb().$implicit;return l.Zb(2).viewQuest(e)}),l.Qb(1,"div"),l.wc(2,"View Quest "),l.Mb(3,"i",28),l.Pb(),l.Pb()}}function ju(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",14),l.Qb(1,"div",15),l.Qb(2,"div",16),l.Qb(3,"button",17),l.Xb("click",function(){l.oc(n);var e=t.$implicit;return l.Zb(2).clearNotification(e)}),l.Mb(4,"i",18),l.Pb(),l.Pb(),l.Qb(5,"div",19),l.wc(6),l.vc(7,qu,1,1,"div",20),l.Pb(),l.Qb(8,"div",16),l.Qb(9,"div",21),l.Qb(10,"button",22),l.Mb(11,"i",23),l.Pb(),l.Qb(12,"ul",24),l.vc(13,Gu,4,0,"li",25),l.vc(14,Du,4,1,"li",25),l.vc(15,Zu,4,0,"li",25),l.vc(16,Xu,4,0,"li",25),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&e){var i=t.$implicit;l.Ab(6),l.yc(" ",i.message," "),l.Ab(1),l.ec("ngIf",i.suggestedBy),l.Ab(6),l.ec("ngIf",null!=i.suggestionURL),l.Ab(1),l.ec("ngIf",null!=i.campaign),l.Ab(1),l.ec("ngIf",null!=i.mapId),l.Ab(1),l.ec("ngIf",null!=i.questId)}}var Hu=function(e){return{"big-space":e}};function Vu(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",3),l.Qb(1,"button",4),l.Xb("click",function(){return l.oc(n),l.Zb().clearAll()}),l.Mb(2,"i",5),l.Qb(3,"span",6),l.wc(4," Clear All"),l.Pb(),l.Pb(),l.vc(5,Uu,7,0,"div",7),l.vc(6,ju,17,6,"div",8),l.Pb()}if(2&e){var i=l.Zb();l.ec("ngClass",l.ic(3,Hu,i.notifications&&i.notifications.length>0)),l.Ab(5),l.ec("ngIf",0===i.notifications.length),l.Ab(1),l.ec("ngForOf",i.notifications)}}var $u,Bu=(($u=function(){function e(t,n){d(this,e),this.notificationService=t,this.router=n,this.done=new l.n}return p(e,[{key:"ngOnInit",value:function(){}},{key:"clearNotification",value:function(e){this.notificationService.removeNotification(e)}},{key:"viewCampaign",value:function(e){this.notificationService.removeNotification(e),this.router.navigate(["campaigns",e.campaignId,"landing"]),this.done.emit(!0)}},{key:"viewMap",value:function(e){this.notificationService.removeNotification(e),this.router.navigate(["campaigns",e.campaignId,"maps",e.mapId]),this.done.emit(!0)}},{key:"viewQuest",value:function(e){this.notificationService.removeNotification(e),this.router.navigate(["campaigns",e.campaignId,"quests",e.questId]),this.done.emit(!0)}},{key:"viewSuggestion",value:function(e){this.notificationService.removeNotification(e),this.router.navigateByUrl(e.suggestionURL),this.done.emit(!0)}},{key:"clearAll",value:function(){this.notificationService.clearAll()}},{key:"notifications",get:function(){return this.notificationService.notifications}},{key:"loading",get:function(){return this.notificationService.loading}}]),e}()).\u0275fac=function(e){return new(e||$u)(l.Lb(Ou.a),l.Lb(w.c))},$u.\u0275cmp=l.Fb({type:$u,selectors:[["dd-notifications"]],outputs:{done:"done"},decls:3,vars:2,consts:[["class","loading",4,"ngIf"],[3,"ngClass",4,"ngIf"],[1,"loading"],[3,"ngClass"],[1,"btn","btn-sm","mb-2",3,"click"],[1,"icon","icon-delete"],[1,"hide-sm"],["class","empty",4,"ngIf"],["class","card p-2 mb-2",4,"ngFor","ngForOf"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-flag","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"card","p-2","mb-2"],[1,"columns","col-gapless"],[1,"column","col-auto"],["aria-label","Close",1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-cross"],[1,"column"],[3,"ddUser",4,"ngIf"],[1,"dropdown","dropdown-right"],["tabindex","0",1,"btn","btn-sm","dropdown-toggle"],[1,"icon","icon-menu"],[1,"menu"],["class","menu-item",3,"click",4,"ngIf"],[3,"ddUser"],[1,"menu-item",3,"click"],[1,"icon","icon-arrow-right"]],template:function(e,t){1&e&&(l.Qb(0,"div"),l.vc(1,Fu,1,0,"div",0),l.vc(2,Vu,7,5,"div",1),l.Pb()),2&e&&(l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",t.notifications))},directives:[I.k,I.i,I.j,D.a],styles:[".big-space[_ngcontent-%COMP%]{margin-bottom:6rem}"]}),$u);function zu(e,t){if(1&e){var n=l.Rb();l.Qb(0,"div",12),l.Qb(1,"button",16),l.Xb("click",function(){return l.oc(n),l.Zb(2).suggest()}),l.Mb(2,"i",17),l.Pb(),l.Pb()}}var Yu=function(e,t){return["/campaigns",e,"entities",t]};function Wu(e,t){if(1&e&&(l.Qb(0,"figure",18),l.Mb(1,"img",19),l.Pb()),2&e){var n=t.$implicit,i=l.Zb(2);l.ec("routerLink",l.jc(3,Yu,i.campaign.id,n.id)),l.Bb("data-tooltip",n.name),l.Ab(1),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.imageId,"",l.qc)}}function Ku(e,t){if(1&e){var n=l.Rb();l.Qb(0,"section",10),l.vc(1,zu,3,0,"div",11),l.Qb(2,"div",12),l.vc(3,Wu,2,6,"figure",13),l.Pb(),l.Qb(4,"button",14),l.Xb("click",function(){return l.oc(n),l.Zb(),l.mc(1).open()}),l.Mb(5,"i",15),l.Pb(),l.Pb()}if(2&e){var i=l.Zb();l.Ab(1),l.ec("ngIf",i.campaign&&i.suggestable),l.Ab(2),l.ec("ngForOf",i.navEntities)("ngForTrackBy",i.trackEntity),l.Ab(1),l.Bb("data-badge",i.notificationText)}}var Ju=function(){return["login"]};function el(e,t){1&e&&(l.Qb(0,"section"),l.Qb(1,"a",20),l.wc(2,"Login"),l.Pb(),l.Pb()),2&e&&(l.Ab(1),l.ec("routerLink",l.hc(1,Ju)))}var tl,nl=((tl=function(){function e(t,n,i,r,c,o){d(this,e),this.campaignService=t,this.login=n,this.sidebar=i,this.notificationService=r,this.router=c,this.route=o,this.suggestable=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.router.events.pipe(Object(Nu.a)(function(e){return e instanceof w.b}),Object(_u.a)(function(){for(var t=e.route.firstChild;t;){if(!t.firstChild)return t.snapshot.data?t.snapshot.data:null;t=t.firstChild}return null})).subscribe(function(t){e.suggestable=!0===t.suggestable})}},{key:"toggle",value:function(){this.sidebar.toggle()}},{key:"trackEntity",value:function(e,t){return t.id}},{key:"suggest",value:function(){return e=this,n=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.campaign){e.next=9;break}return e.prev=1,e.next=4,this.notificationService.suggestCurrentURL();case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),e.t0;case 9:case"end":return e.stop()}},e,this,[[1,6]])}),new((t=void 0)||(t=Promise))(function(i,r){function c(e){try{a(n.next(e))}catch(t){r(t)}}function o(e){try{a(n.throw(e))}catch(t){r(t)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(c,o)}a((n=n.apply(e,[])).next())});var e,t,n}},{key:"loadingCampaign",get:function(){return this.campaignService.loadingCampaign}},{key:"campaign",get:function(){return this.campaignService.campaign}},{key:"loggedIn",get:function(){return this.login.isLoggedIn}},{key:"navEntities",get:function(){var e=this;return this.loggedIn&&this.campaign?this.campaign.entities.filter(function(t){return!t.spawnable&&null===t.spawnedFromId&&t.userId===e.login.id}):null}},{key:"notificationText",get:function(){return this.notificationService.notifications?this.notificationService.notifications.length:"..."}}]),e}()).\u0275fac=function(e){return new(e||tl)(l.Lb(P.b),l.Lb(E.a),l.Lb(su),l.Lb(Ou.a),l.Lb(w.c),l.Lb(w.a))},tl.\u0275cmp=l.Fb({type:tl,selectors:[["dd-nav"]],decls:13,vars:2,consts:[["notifmodal",""],["modal-header","",1,"mb-0"],["modal-body","",3,"done"],[1,"bg-light"],[1,"p-2"],[1,"navbar"],[1,"off-canvas-toggle","btn","btn-link","btn-action",3,"click"],[1,"icon","icon-menu"],["class","navbar-section p-1",4,"ngIf"],[4,"ngIf"],[1,"navbar-section","p-1"],["class","mr-2",4,"ngIf"],[1,"mr-2"],["class","avatar mx-1 entity-hover tooltip tooltip-bottom",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],[1,"btn","badge",3,"click"],[1,"icon","icon-flag"],["data-tooltip","Suggest this",1,"btn","s-circle","tooltip","tooltip-bottom",3,"click"],[1,"icon","icon-share"],[1,"avatar","mx-1","entity-hover","tooltip","tooltip-bottom",3,"routerLink"],["alt","Avatar",3,"src"],[1,"btn","btn-link",3,"routerLink"]],template:function(e,t){if(1&e){var n=l.Rb();l.Qb(0,"dd-modal",null,0),l.Qb(2,"h4",1),l.wc(3,"Notifications"),l.Pb(),l.Qb(4,"dd-notifications",2),l.Xb("done",function(){return l.oc(n),l.mc(1).close(null)}),l.Pb(),l.Pb(),l.Qb(5,"div",3),l.Qb(6,"div",4),l.Qb(7,"header",5),l.Qb(8,"section"),l.Qb(9,"a",6),l.Xb("click",function(){return t.toggle()}),l.Mb(10,"i",7),l.Pb(),l.Pb(),l.vc(11,Ku,6,4,"section",8),l.vc(12,el,3,2,"section",9),l.Pb(),l.Pb(),l.Pb()}2&e&&(l.Ab(11),l.ec("ngIf",t.loggedIn),l.Ab(1),l.ec("ngIf",!t.loggedIn))},directives:[te.a,Bu,I.k,I.j,w.d,w.e],styles:[".entity-hover[_ngcontent-%COMP%]{transition:all .2s;-webkit-tap-highlight-color:rgba(255,255,255,0);-webkit-tap-highlight-color:transparent}.entity-hover[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{border:1px solid #6362dc}.entity-hover[_ngcontent-%COMP%]:active, .entity-hover[_ngcontent-%COMP%]:hover{transform:scale(1.3);cursor:pointer}.entity-hover[_ngcontent-%COMP%]:active > img[_ngcontent-%COMP%], .entity-hover[_ngcontent-%COMP%]:hover > img[_ngcontent-%COMP%]{border:2px solid #5755d9}.entity-hover.active[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{border:2px dashed #5755d9}"]}),tl);function il(e,t){1&e&&(l.Qb(0,"div",6),l.wc(1,"Not Connected"),l.Pb())}function rl(e,t){1&e&&(l.Qb(0,"div",6),l.wc(1,"Connected"),l.Pb())}function cl(e,t){1&e&&(l.Qb(0,"div",6),l.wc(1,"Disconnected"),l.Pb())}function ol(e,t){1&e&&(l.Qb(0,"div",6),l.wc(1," Connecting ... "),l.Pb())}function al(e,t){1&e&&(l.Qb(0,"div",6),l.wc(1,"Authenticating"),l.Pb())}function sl(e,t){if(1&e&&(l.Qb(0,"div",1),l.Qb(1,"div",2),l.wc(2," \ud83d\udc4c DD "),l.Qb(3,"div",3),l.Qb(4,"div",4),l.vc(5,il,2,0,"div",5),l.vc(6,rl,2,0,"div",5),l.vc(7,cl,2,0,"div",5),l.vc(8,ol,2,0,"div",5),l.vc(9,al,2,0,"div",5),l.Pb(),l.Pb(),l.Pb(),l.Pb()),2&e){var n=l.Zb();l.Ab(4),l.ec("ngSwitch",n.connectionStatus),l.Ab(1),l.ec("ngSwitchCase",0),l.Ab(1),l.ec("ngSwitchCase",1),l.Ab(1),l.ec("ngSwitchCase",2),l.Ab(1),l.ec("ngSwitchCase",3),l.Ab(1),l.ec("ngSwitchCase",4)}}var ul,ll,dl,bl,pl,fl,hl=((ul=function(){function e(t,n,i){d(this,e),this.route=t,this.router=n,this.hub=i,this.hidden=!1}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.route.data.subscribe(function(t){e.hidden=!1===t.footer})}},{key:"connectionStatus",get:function(){return this.hub.state}}]),e}()).\u0275fac=function(e){return new(e||ul)(l.Lb(w.a),l.Lb(w.c),l.Lb(be.b))},ul.\u0275cmp=l.Fb({type:ul,selectors:[["dd-footer"]],decls:1,vars:1,consts:[["class","bg-secondary",4,"ngIf"],[1,"bg-secondary"],[1,"container","grid-xl","text-center","footer-container"],[1,"connection-status","text-center"],[1,"mt-2",3,"ngSwitch"],["class","label label-secondary",4,"ngSwitchCase"],[1,"label","label-secondary"]],template:function(e,t){1&e&&l.vc(0,sl,10,6,"div",0),2&e&&l.ec("ngIf",!t.hidden)},directives:[I.k,I.l,I.m],styles:["[_nghost-%COMP%]{margin-top:auto}.footer-container[_ngcontent-%COMP%]{margin-top:3rem;padding-top:1rem;padding-bottom:3rem}"]}),ul),vl=function(e){return{active:e}},ml=((dl=function(){function e(t){d(this,e),this.sidebar=t,this.title="ui"}return p(e,[{key:"toggle",value:function(){this.sidebar.toggle()}},{key:"sidebarOpen",get:function(){return this.sidebar.sidebarOpen}}]),e}()).\u0275fac=function(e){return new(e||dl)(l.Lb(su))},dl.\u0275cmp=l.Fb({type:dl,selectors:[["dd-root"]],decls:9,vars:3,consts:[[1,"body-container","off-canvas","off-canvas-sidebar-show"],["id","sidebar-id",1,"off-canvas-sidebar",3,"ngClass"],[1,"off-canvas-overlay",3,"click"],["id","app-content",1,"off-canvas-content","content","d-flex","flex-col","p-0"]],template:function(e,t){1&e&&(l.Mb(0,"dd-note-editor"),l.Qb(1,"div",0),l.Qb(2,"div",1),l.Mb(3,"dd-nav-sidebar"),l.Pb(),l.Qb(4,"a",2),l.Xb("click",function(){return t.toggle()}),l.Pb(),l.Qb(5,"div",3),l.Mb(6,"dd-nav"),l.Mb(7,"router-outlet"),l.Mb(8,"dd-footer"),l.Pb(),l.Pb()),2&e&&(l.Ab(2),l.ec("ngClass",l.ic(1,vl,t.sidebarOpen)))},directives:[uu.a,I.i,Su,nl,w.g,hl],styles:[".body-container[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]{height:100vh}.content[_ngcontent-%COMP%]{overflow-y:auto}.h-100[_ngcontent-%COMP%]{height:100vh}"]}),dl),gl=((ll=function(){function e(t){d(this,e),this.login=t}return p(e,[{key:"intercept",value:function(e,t){var n=this.login.token;if(n){var i=e.clone({headers:e.headers.set("Authorization","Bearer ".concat(n))});return t.handle(i)}return t.handle(e)}}]),e}()).\u0275fac=function(e){return new(e||ll)(l.Ub(E.a))},ll.\u0275prov=l.Hb({token:ll,factory:ll.\u0275fac}),ll),yl=s("wC5x"),kl=s("EA6F"),wl=s("vkgz"),Pl=s("nYR2"),Il=((bl=function(){function e(t,n){d(this,e),this.router=t,this.login=n,this.silenceErrors=!1}return p(e,[{key:"intercept",value:function(e,t){var n,i=this;return t.handle(e).pipe(Object(wl.a)(function(){},function(e){return n=e}),Object(Pl.a)(function(){return t=i,c=regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n){t.next=35;break}if(!this.silenceErrors){t.next=3;break}return t.abrupt("return");case 3:if(!(n instanceof f.d)){t.next=32;break}t.t0=n.status,t.next=401===t.t0?7:404===t.t0?15:400===t.t0?20:403===t.t0?22:0===t.t0?25:28;break;case 7:return this.silenceErrors=!0,this.login.logout(),console.log("REDIR TO",this.router.url),t.next=12,mt.a.fire({title:"Session Expired",text:"Your login session has expired, you will be redirected to the login page",type:"warning",confirmButtonText:"Okay"});case 12:return t.next=14,this.router.navigate(["login"]);case 14:return t.abrupt("break",30);case 15:if(t.t1=-1!==e.url.indexOf("/users/"),t.t1){t.next=19;break}return t.next=19,mt.a.fire({title:"Not Found",text:"The resource you requested could not be found! Sorry about that.",type:"error",confirmButtonText:"Okay"});case 19:return t.abrupt("break",30);case 20:return this.handleBadRequest(n),t.abrupt("break",30);case 22:return t.next=24,mt.a.fire({title:"No Permissions",text:"Looks like you don't have permission for that!",type:"error",confirmButtonText:"Shucks"});case 24:return t.abrupt("break",30);case 25:return t.next=27,mt.a.fire({title:"Could Not Connect",text:"A connection to the server could not be established. Please make sure you are connected to the internet",type:"error",confirmButtonText:"Okay"});case 27:return t.abrupt("break",30);case 28:return t.next=30,mt.a.fire({title:"Unknown Error!",text:"An unknown error occured. Maybe this will help: "+n.message,type:"error",confirmButtonText:"Okay"});case 30:t.next=33;break;case 32:console.log("UNKNOWN ERR",n);case 33:t.next=36;break;case 35:this.silenceErrors=!1;case 36:case"end":return t.stop()}},t,this)}),new((r=void 0)||(r=Promise))(function(e,n){function i(e){try{a(c.next(e))}catch(t){n(t)}}function o(e){try{a(c.throw(e))}catch(t){n(t)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,o)}a((c=c.apply(t,[])).next())});var t,r,c}))}},{key:"handleBadRequest",value:function(e){var t=e.error,n=t;switch(t){case"already in campaign":n="You are already a member of this campaign!"}mt.a.fire({type:"error",confirmButtonText:"\xaf\\_(\u30c4)_/\xaf",title:"Oh Dear",text:n})}}]),e}()).\u0275fac=function(e){return new(e||bl)(l.Ub(w.c),l.Ub(E.a))},bl.\u0275prov=l.Hb({token:bl,factory:bl.\u0275fac}),bl),Cl=s("HboH"),xl=s("reMG"),Ql=((pl=function(){function e(){d(this,e)}return p(e,[{key:"handleError",value:function(e){console.log("Handling Error",e.name,e.message,e),Ti.captureException(e.originalError||e)}}]),e}()).\u0275fac=function(e){return new(e||pl)},pl.\u0275prov=l.Hb({token:pl,factory:pl.\u0275fac}),pl),Al=s("zrcO"),Tl=((fl=function e(){d(this,e)}).\u0275mod=l.Jb({type:fl,bootstrap:[ml]}),fl.\u0275inj=l.Ib({factory:function(e){return new(e||fl)},providers:[{provide:f.a,useClass:gl,multi:!0},{provide:f.a,useClass:Il,multi:!0},{provide:l.m,useClass:Ql}],imports:[[u.a,au,h.s,h.k,v.a,y.a.forRoot({positionClass:"toast-top-center"}),g.b,f.c,xl.NotesModule,b.e,Cl.MappingModule,yl.a,kl.a,Al.UsersModule,m.a.register("ngsw-worker.js",{enabled:k.a.production})]]}),fl);k.a.production&&(Object(l.T)(),Ti.init({dsn:k.a.sentryDSN,enabled:k.a.production,environment:k.a.production?"Production":"Development",release:"REPLACE_GIT_HASH"})),u.c().bootstrapModule(Tl).catch(function(e){return console.error(e)})},zn8P:function(e,t){function n(e){return Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"},zrcO:function(e,t,n){"use strict";n.r(t),n.d(t,"UsersModule",function(){return I});var i=n("ofXK"),r=n("tyNb"),c=n("xdv0"),o=n("edGd"),a=n("3Pt+"),s=n("fXoL"),u=function(e,t,n,i){return new(n||(n=Promise))(function(r,c){function o(e){try{s(i.next(e))}catch(t){c(t)}}function a(e){try{s(i.throw(e))}catch(t){c(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(o,a)}s((i=i.apply(e,t||[])).next())})};function l(e,t){1&e&&s.Mb(0,"div",3)}function b(e,t){if(1&e){var n=s.Rb();s.Qb(0,"h3"),s.wc(1),s.Qb(2,"button",12),s.Xb("click",function(){s.oc(n);var e=s.Zb(2);return e.editUsername=!e.editUsername}),s.Mb(3,"i",13),s.Pb(),s.Pb()}if(2&e){var i=s.Zb(2);s.Ab(1),s.yc(" ",i.user.username," ")}}function f(e,t){if(1&e){var n=s.Rb();s.Qb(0,"div",14),s.Mb(1,"input",15),s.Qb(2,"button",16),s.Xb("click",function(){return s.oc(n),s.Zb(2).editUsername=!1}),s.Mb(3,"i",17),s.Pb(),s.Pb()}if(2&e){var i=s.Zb(2);s.Ab(1),s.ec("formControl",i.username)}}var h=function(e){return{loading:e}};function v(e,t){if(1&e){var n=s.Rb();s.Qb(0,"div",5),s.Qb(1,"button",18),s.Xb("click",function(){return s.oc(n),s.Zb(2).save()}),s.wc(2," Save "),s.Pb(),s.Pb()}if(2&e){var i=s.Zb(2);s.Ab(1),s.ec("disabled",i.formGroup.invalid)("ngClass",s.ic(2,h,i.saving))}}function m(e,t){if(1&e&&(s.Qb(0,"div",4),s.Qb(1,"div",5),s.Qb(2,"figure",6),s.Mb(3,"img",7),s.Pb(),s.Pb(),s.Qb(4,"div",8),s.vc(5,b,4,1,"h3",9),s.vc(6,f,4,1,"div",10),s.Pb(),s.vc(7,v,3,4,"div",11),s.Pb()),2&e){var n=s.Zb();s.Ab(3),s.ec("src",n.user.pictureURL,s.qc),s.Ab(2),s.ec("ngIf",!n.editUsername),s.Ab(1),s.ec("ngIf",n.editUsername),s.Ab(1),s.ec("ngIf",n.dirty)}}var g,y,k,w=[{path:"",component:(g=function(){function e(t,n){d(this,e),this.userService=t,this.login=n,this.loading=!1,this.saving=!1,this.editUsername=!1}return p(e,[{key:"ngOnInit",value:function(){this.formGroup=new a.h({username:new a.e(null,[a.v.required,a.v.minLength(3),a.v.maxLength(30)])}),this.load()}},{key:"load",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.userService.getUser(this.login.currentUser.id);case 4:this.user=e.sent,this.patchForm(),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(1),e.t0;case 11:this.loading=!1;case 12:case"end":return e.stop()}},e,this,[[1,8]])}))}},{key:"patchForm",value:function(){this.formGroup.patchValue(this.user)}},{key:"save",value:function(){return u(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.formGroup.invalid){e.next=11;break}return this.user.username=this.username.value,this.saving=!0,e.prev=2,e.next=5,this.userService.updateUser(this.user);case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),e.t0;case 10:this.editUsername=!1,this.formGroup.markAsPristine(),this.saving=!1;case 11:case"end":return e.stop()}},e,this,[[2,7]])}))}},{key:"username",get:function(){return this.formGroup.get("username")}},{key:"dirty",get:function(){return this.formGroup.dirty}}]),e}(),g.\u0275fac=function(e){return new(e||g)(s.Lb(c.a),s.Lb(o.a))},g.\u0275cmp=s.Fb({type:g,selectors:[["dd-account-settings"]],decls:3,vars:2,consts:[[1,"container","grid-xl"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column","col-auto"],[1,"avatar","avatar-xl"],[3,"src"],[1,"column","d-flex","align-items-center"],[4,"ngIf"],["class","form-group",4,"ngIf"],["class","column col-auto",4,"ngIf"],[1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-edit"],[1,"form-group"],["type","text","name","username","id","username",1,"form-input","input-lg",3,"formControl"],[1,"btn","mt-2",3,"click"],[1,"icon","icon-cross"],[1,"btn","btn-sm",3,"disabled","ngClass","click"]],template:function(e,t){1&e&&(s.Qb(0,"div",0),s.vc(1,l,1,0,"div",1),s.vc(2,m,8,4,"div",2),s.Pb()),2&e&&(s.Ab(1),s.ec("ngIf",t.loading),s.Ab(1),s.ec("ngIf",t.user))},directives:[i.k,a.b,a.m,a.f,i.i],styles:[""]}),g)}],P=((k=function e(){d(this,e)}).\u0275mod=s.Jb({type:k}),k.\u0275inj=s.Ib({factory:function(e){return new(e||k)},imports:[[r.f.forChild(w)],r.f]}),k),I=((y=function e(){d(this,e)}).\u0275mod=s.Jb({type:y}),y.\u0275inj=s.Ib({factory:function(e){return new(e||y)},imports:[[i.b,P,a.s]]}),y)}},[[0,0,5]]])}();