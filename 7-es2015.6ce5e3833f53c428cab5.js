(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"+mPt":function(t,e,i){"use strict";i.r(e),i.d(e,"ArticlesModule",function(){return Me});var c=i("ofXK"),n=i("tyNb"),r=i("rZgH"),o=i("uCWu"),a=i("3Pt+"),s=i("Kj3r"),l=i("fXoL"),u=i("MICr");function b(t,e){if(1&t&&(l.Qb(0,"div",10),l.Mb(1,"img",11),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("src",t.imgSrc,l.qc)}}function d(t,e){1&t&&(l.Qb(0,"span",12),l.wc(1,"Hidden"),l.Pb())}function p(t,e){if(1&t&&(l.Qb(0,"div",13),l.Mb(1,"img",14),l.Pb()),2&t){const t=e.$implicit;l.Ab(1),l.ec("src",t,l.qc)}}function h(t,e){1&t&&(l.Qb(0,"div",15),l.Mb(1,"i",16),l.Pb())}function f(t,e){1&t&&(l.Qb(0,"div",15),l.Mb(1,"i",17),l.Pb())}function g(t,e){if(1&t&&(l.Qb(0,"div",18),l.wc(1),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.xc(t.subtitleText)}}const m=function(t){return{"bg-gray":t}},v=function(t){return{"p-2":t}},y=function(t,e){return{h5:t,h6:e}};let I=(()=>{class t{constructor(t,e,i){this.router=t,this.campaignService=e,this.iconService=i,this.mini=!1}ngOnInit(){}get subtitleText(){return this.article.tags?this.article.tags.join(", "):""}get imgSrc(){return this.article.imageURLs&&this.article.imageURLs.length>0?`https://res.cloudinary.com/dqhk8k6iv/image/fetch/c_fill,g_auto:faces,h_250,w_500/${this.article.imageURLs[0]}`:null}get iconSources(){return this.article?this.article.conceptTypeIds.map(t=>this.campaignService.campaign.conceptTypes.find(e=>e.id===t)).filter(t=>null!=t&&t.icon).map(t=>this.iconService.getIconSrc(t.icon)):[]}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(n.c),l.Lb(o.b),l.Lb(u.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-article-view-card"]],inputs:{article:"article",mini:"mini"},decls:12,vars:17,consts:[[1,"card","hoverable",3,"ngClass"],["class","card-image",4,"ngIf"],[1,"card-header",3,"ngClass"],[1,"columns"],[1,"column"],[1,"card-title",3,"ngClass"],["class","label label-secondary",4,"ngIf"],["class","column col-auto d-flex align-items-center",4,"ngFor","ngForOf"],["class","column col-auto",4,"ngIf"],["class","card-subtitle text-gray",4,"ngIf"],[1,"card-image"],["width","500",1,"img-responsive",3,"src"],[1,"label","label-secondary"],[1,"column","col-auto","d-flex","align-items-center"],["width","20",3,"src"],[1,"column","col-auto"],[1,"icon","icon-flag"],[1,"icon","icon-location"],[1,"card-subtitle","text-gray"]],template:function(t,e){1&t&&(l.Qb(0,"div",0),l.vc(1,b,2,1,"div",1),l.Qb(2,"div",2),l.Qb(3,"div",3),l.Qb(4,"div",4),l.Qb(5,"div",5),l.wc(6),l.vc(7,d,2,0,"span",6),l.Pb(),l.Pb(),l.vc(8,p,2,1,"div",7),l.vc(9,h,2,0,"div",8),l.vc(10,f,2,0,"div",8),l.Pb(),l.vc(11,g,2,1,"div",9),l.Pb(),l.Pb()),2&t&&(l.ec("ngClass",l.ic(10,m,e.mini&&!e.article.published)),l.Ab(1),l.ec("ngIf",null!==e.imgSrc&&!e.mini),l.Ab(1),l.ec("ngClass",l.ic(12,v,e.mini)),l.Ab(3),l.ec("ngClass",l.jc(14,y,!e.mini,e.mini)),l.Ab(1),l.yc(" ",e.article.name," "),l.Ab(1),l.ec("ngIf",!e.article.published&&!e.mini),l.Ab(1),l.ec("ngForOf",e.iconSources),l.Ab(1),l.ec("ngIf",e.article.hasQuests),l.Ab(1),l.ec("ngIf",null!==e.article.mapId),l.Ab(1),l.ec("ngIf",!e.mini))},directives:[c.i,c.k,c.j],styles:[".card[_ngcontent-%COMP%]{box-shadow:0 .25rem 1rem rgba(48,55,66,.15);border:0}"]}),t})();var A=function(t,e,i,c){return new(i||(i=Promise))(function(n,r){function o(t){try{s(c.next(t))}catch(e){r(e)}}function a(t){try{s(c.throw(t))}catch(e){r(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}s((c=c.apply(t,e||[])).next())})};function w(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div",9),l.Qb(1,"button",10),l.Xb("click",function(){return l.oc(t),l.Zb().createArticle()}),l.Mb(2,"i",11),l.Qb(3,"span",12),l.wc(4," New Article"),l.Pb(),l.Pb(),l.Pb()}}function Q(t,e){1&t&&l.Mb(0,"div",13)}function P(t,e){1&t&&l.Mb(0,"i",18)}function C(t,e){1&t&&l.Mb(0,"i",19)}function k(t,e){if(1&t&&(l.Qb(0,"div",14),l.Mb(1,"input",15),l.vc(2,P,1,0,"i",16),l.vc(3,C,1,0,"i",17),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("formControl",t.searchControl),l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",!t.loading)}}function S(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div",21),l.Qb(1,"div",22),l.Qb(2,"dd-article-view-card",23),l.Xb("click",function(){l.oc(t);const i=e.$implicit;return l.Zb(2).viewArticle(i)}),l.Pb(),l.Pb(),l.Pb()}if(2&t){const t=e.$implicit;l.Ab(2),l.ec("article",t)}}function x(t,e){if(1&t&&(l.Qb(0,"div",1),l.vc(1,S,3,1,"div",20),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngForOf",t.popularArticles)("ngForTrackBy",t.trackArticle)}}function O(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div",26),l.Qb(1,"dd-article-view-card",27),l.Xb("click",function(){l.oc(t);const i=e.$implicit;return l.Zb(2).viewArticle(i)}),l.Pb(),l.Pb()}if(2&t){const t=e.$implicit;l.Ab(1),l.ec("article",t)}}function M(t,e){if(1&t&&(l.Qb(0,"div",24),l.vc(1,O,2,1,"div",25),l.Pb()),2&t){const t=e.$implicit,i=l.Zb();l.Ab(1),l.ec("ngForOf",t)("ngForTrackBy",i.trackArticle)}}function q(t,e){1&t&&(l.Qb(0,"p",34),l.wc(1," Click the button to create one "),l.Pb())}function Z(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div",35),l.Qb(1,"button",36),l.Xb("click",function(){return l.oc(t),l.Zb(2).createArticle()}),l.wc(2," Create Article "),l.Pb(),l.Pb()}}function T(t,e){if(1&t&&(l.Qb(0,"div",28),l.Qb(1,"div",29),l.Mb(2,"i",30),l.Pb(),l.Qb(3,"p",31),l.wc(4,"There are no articles for this campaign"),l.Pb(),l.vc(5,q,2,0,"p",32),l.vc(6,Z,3,0,"div",33),l.Pb()),2&t){const t=l.Zb();l.Ab(5),l.ec("ngIf",t.editable),l.Ab(1),l.ec("ngIf",t.editable)}}function F(t,e){1&t&&(l.Qb(0,"div",28),l.Qb(1,"div",29),l.Mb(2,"i",30),l.Pb(),l.Qb(3,"p",31),l.wc(4,"Your search contained no results"),l.Pb(),l.Pb())}let E=(()=>{class t{constructor(t,e,i,c){this.campaignService=t,this.articleService=e,this.router=i,this.route=c,this.loading=!1,this.search=null}ngOnInit(){this.loadPopular(),this.loadFromSearch(),this.searchControl=new a.e(this.route.snapshot.queryParamMap.has("search")?this.route.snapshot.queryParamMap.get("search"):null),this.searchControl.valueChanges.pipe(Object(s.a)(250)).subscribe(t=>{t.trim().length>0?this.search=t:(this.search=null,0===this.articles.length&&(this.articles=void 0)),this.loadFromSearch()})}loadFromSearch(){return A(this,void 0,void 0,function*(){this.loading=!0;try{this.articles=yield this.articleService.getArticles(this.campaignService.campaign.id,10,0,this.search)}catch(t){throw t}this.loading=!1})}loadPopular(){return A(this,void 0,void 0,function*(){this.loading=!0;try{this.popularArticles=yield this.articleService.getPopular(this.campaignService.campaign.id)}catch(t){throw t}this.loading=!1})}createArticle(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"articles","create"])}trackArticle(t,e){return e.id}trackIdx(t){return t}viewArticle(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"articles",t.id])}get splitArticles(){if(!this.articles)return[];const t=[];for(let i=0;i<3;i++)t[i]=[];let e=0;return this.articles.forEach(i=>{t[e].push(i),2===e?e=0:e++}),t}get editable(){return this.campaignService.canEdit}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(o.b),l.Lb(r.a),l.Lb(n.c),l.Lb(n.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-article-manager"]],decls:13,vars:8,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],["class","column col-auto",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","has-icon-right",4,"ngIf"],["class","columns",4,"ngIf"],["class","column col-sm-12",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty mt-2",4,"ngIf"],[1,"column","col-auto"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"loading","loading-lg"],[1,"has-icon-right"],["type","text","placeholder","Search",1,"form-input",3,"formControl"],["class","form-icon loading",4,"ngIf"],["class","form-icon icon icon-search",4,"ngIf"],[1,"form-icon","loading"],[1,"form-icon","icon","icon-search"],["class","column col-2 col-md-3 col-sm-4 col-xs-6",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-2","col-md-3","col-sm-4","col-xs-6"],[1,"py-1"],["mini","true",3,"article","click"],[1,"column","col-sm-12"],["class","py-2",4,"ngFor","ngForOf","ngForTrackBy"],[1,"py-2"],[3,"article","click"],[1,"empty","mt-2"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],["class","empty-action",4,"ngIf"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"]],template:function(t,e){1&t&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"h3"),l.wc(4,"Articles"),l.Pb(),l.Pb(),l.vc(5,w,5,0,"div",3),l.Pb(),l.vc(6,Q,1,0,"div",4),l.vc(7,k,4,3,"div",5),l.vc(8,x,2,2,"div",6),l.Qb(9,"div",1),l.vc(10,M,2,2,"div",7),l.Pb(),l.vc(11,T,7,2,"div",8),l.vc(12,F,5,0,"div",8),l.Pb()),2&t&&(l.Ab(5),l.ec("ngIf",e.editable),l.Ab(1),l.ec("ngIf",e.loading&&!e.articles),l.Ab(1),l.ec("ngIf",e.articles),l.Ab(1),l.ec("ngIf",e.popularArticles&&!e.search),l.Ab(2),l.ec("ngForOf",e.splitArticles)("ngForTrackBy",e.trackIdx),l.Ab(1),l.ec("ngIf",e.articles&&0===e.articles.length&&null===e.search),l.Ab(1),l.ec("ngIf",e.articles&&0===e.articles.length&&null!==e.search))},directives:[c.k,c.j,a.b,a.m,a.f,I],styles:[""]}),t})();var L=i("edGd"),_=i("PSD3"),R=i.n(_),X=i("tk/3"),N=i("WNRK"),$=i("HRrE"),G=i("kNgC"),j=i("wNqa"),B=i("/uUt");const D=["input"];function H(t,e){1&t&&l.Mb(0,"i",8)}function U(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div",9),l.Xb("click",function(){return l.oc(t),l.Zb().closeMenu()}),l.Pb()}}function K(t,e){1&t&&(l.Qb(0,"div",13),l.Qb(1,"p",14),l.wc(2,"Your search returned no results"),l.Pb(),l.Pb())}function Y(t,e){if(1&t){const t=l.Rb();l.Qb(0,"li",15),l.Qb(1,"span",16),l.Xb("click",function(){l.oc(t);const i=e.$implicit;return l.Zb(2).select(i)}),l.wc(2),l.Pb(),l.Pb()}if(2&t){const t=e.$implicit,i=l.Zb(2);l.Ab(1),l.ec("innerHTML",i.createItem(t),l.pc),l.Ab(1),l.yc(" ",t.value," ")}}function J(t,e){if(1&t&&(l.Qb(0,"ul",10),l.vc(1,K,3,0,"div",11),l.vc(2,Y,3,2,"li",12),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngIf",0===t.items.length),l.Ab(1),l.ec("ngForOf",t.items)("ngForTrackBy",t.trackItem)}}const V=function(t){return{"is-focused":t}},z=function(t){return{"has-icon-left":t}};let W=(()=>{class t{constructor(){this.selection=new l.n,this.menuShown=!1,this.loading=!1,this.focused=!1}ngOnInit(){this.createItem||(this.createItem=t=>t.value),this.control=new a.e(null),this.control.valueChanges.pipe(Object(s.a)(250),Object(B.a)()).subscribe(t=>{if(null!=t){const e=t.trim();this.performSearch(e)}})}performSearch(t){return e=this,void 0,c=function*(){this.loading=!0;try{const e=yield this.doSearch(t);this.items=e,this.items.length>0&&(this.menuShown=!0)}catch(e){throw e}this.loading=!1},new((i=void 0)||(i=Promise))(function(t,n){function r(t){try{a(c.next(t))}catch(e){n(e)}}function o(t){try{a(c.throw(t))}catch(e){n(e)}}function a(e){var c;e.done?t(e.value):(c=e.value,c instanceof i?c:new i(function(t){t(c)})).then(r,o)}a((c=c.apply(e,[])).next())});var e,i,c}trackItem(t){return t}focus(t){!1===this.focused&&!0===t&&this.performSearch(""),this.focused=t}focusInput(){this.input.nativeElement.focus()}select(t){this.selection.emit(t),this.menuShown=!1,this.control.setValue(null)}closeMenu(){this.menuShown=!1}get placeholderText(){return void 0!==this.placeholder?this.placeholder:""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-autocomplete"]],viewQuery:function(t,e){if(1&t&&l.Ac(D,3),2&t){let t;l.lc(t=l.Yb())&&(e.input=t.first)}},inputs:{placeholder:"placeholder",doSearch:"doSearch",createItem:"createItem"},outputs:{selection:"selection"},decls:8,vars:11,consts:[[1,"form-autocomplete"],[1,"form-autocomplete-input","form-input","search-cursor",3,"ngClass","click"],[3,"ngClass"],["type","text",1,"form-input",3,"formControl","placeholder","focus","focusout"],["input",""],["class","form-icon loading",4,"ngIf"],["class","menu-overlay",3,"click",4,"ngIf"],["class","menu",4,"ngIf"],[1,"form-icon","loading"],[1,"menu-overlay",3,"click"],[1,"menu"],["class","empty p-2",4,"ngIf"],["class","menu-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"empty","p-2"],[1,"empty-title","h5"],[1,"menu-item"],[3,"innerHTML","click"]],template:function(t,e){1&t&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Xb("click",function(){return e.focusInput()}),l.Qb(2,"div",2),l.Qb(3,"input",3,4),l.Xb("focus",function(){return e.focus(!0)})("focusout",function(){return e.focus(!1)}),l.Pb(),l.vc(5,H,1,0,"i",5),l.Pb(),l.Pb(),l.vc(6,U,1,0,"div",6),l.vc(7,J,3,3,"ul",7),l.Pb()),2&t&&(l.Ab(1),l.ec("ngClass",l.ic(7,V,!0===e.focused)),l.Ab(1),l.ec("ngClass",l.ic(9,z,e.loading)),l.Ab(1),l.ec("formControl",e.control)("placeholder",e.placeholderText),l.Ab(2),l.ec("ngIf",e.loading),l.Ab(1),l.ec("ngIf",e.menuShown),l.Ab(1),l.ec("ngIf",e.menuShown))},directives:[c.i,a.b,a.m,a.f,c.k,c.j],styles:[".search-cursor[_ngcontent-%COMP%]{cursor:text}.menu-overlay[_ngcontent-%COMP%]{position:fixed;bottom:0;cursor:default;display:block;top:0;left:0;right:0;z-index:1}"]}),t})();var tt=function(t,e,i,c){return new(i||(i=Promise))(function(n,r){function o(t){try{s(c.next(t))}catch(e){r(e)}}function a(t){try{s(c.throw(t))}catch(e){r(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}s((c=c.apply(t,e||[])).next())})};function et(t,e){1&t&&l.Mb(0,"div",4)}function it(t,e){if(1&t){const t=l.Rb();l.Qb(0,"dd-autocomplete",5),l.Xb("selection",function(e){return l.oc(t),l.Zb().questSelected(e)}),l.Pb()}if(2&t){const t=l.Zb();l.ec("doSearch",t.doQuestSearch)("createItem",t.createAutocompleteItem)}}function ct(t,e){1&t&&(l.Qb(0,"div",6),l.Qb(1,"p",7),l.wc(2,"This article has no quests"),l.Pb(),l.Pb())}function nt(t,e){1&t&&l.Mb(0,"i",21)}function rt(t,e){1&t&&l.Mb(0,"i",22)}function ot(t,e){1&t&&l.Mb(0,"i",23)}function at(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",24),l.Xb("click",function(){l.oc(t);const e=l.Zb().$implicit;return l.Zb().remove(e)}),l.Mb(1,"i",25),l.Pb()}}function st(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",24),l.Xb("click",function(){l.oc(t);const e=l.Zb().$implicit;return l.Zb().edit(e)}),l.Mb(1,"i",26),l.Pb()}}function lt(t,e){if(1&t&&(l.Qb(0,"div",27),l.Mb(1,"dd-quill",28),l.Pb()),2&t){const t=l.Zb().$implicit;l.Ab(1),l.ec("value",t.quest.content)}}function ut(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div",8),l.Qb(1,"div",9),l.Qb(2,"div",10),l.Qb(3,"button",11),l.Xb("click",function(){l.oc(t);const i=e.$implicit;return l.Zb().expandArticleQuest(i)}),l.vc(4,nt,1,0,"i",12),l.vc(5,rt,1,0,"i",13),l.Pb(),l.Pb(),l.Qb(6,"div",14),l.vc(7,ot,1,0,"i",15),l.wc(8),l.Pb(),l.Qb(9,"div",16),l.vc(10,at,2,0,"button",17),l.vc(11,st,2,0,"button",17),l.Qb(12,"button",18),l.Xb("click",function(){l.oc(t);const i=e.$implicit;return l.Zb().viewQuest(i.questId)}),l.Mb(13,"i",19),l.Pb(),l.Pb(),l.vc(14,lt,2,1,"div",20),l.Pb(),l.Pb()}if(2&t){const t=e.$implicit,i=l.Zb();l.Ab(4),l.ec("ngIf",t.questId!==i.expandedQuest),l.Ab(1),l.ec("ngIf",t.questId===i.expandedQuest),l.Ab(2),l.ec("ngIf",t.quest.accepted),l.Ab(1),l.yc(" ",t.quest.name,""),l.Ab(2),l.ec("ngIf",i.editable),l.Ab(1),l.ec("ngIf",i.editable),l.Ab(3),l.ec("ngIf",t.questId===i.expandedQuest)}}let bt=(()=>{class t{constructor(t,e,i,c){this.articleService=t,this.questService=e,this.campaignService=i,this.router=c,this.viewOnly=!0,this.loading=!1}ngOnInit(){this.doQuestSearch=t=>this.searchQuests(t),this.articleQuests||this.load()}load(){return tt(this,void 0,void 0,function*(){this.loading=!0;try{this.articleQuests=yield this.articleService.getArticleQuests(this.article.id)}catch(t){throw t}this.loading=!1})}searchQuests(t){return tt(this,void 0,void 0,function*(){const e=(yield this.questService.getQuests(this.campaignService.campaign.id,t,5,0,this.articleQuests.map(t=>t.questId))).map(t=>Object.assign(Object.assign({},t),{value:t.name}));return t.trim().length>=3&&e.unshift({id:"create-new-quest",value:t}),e})}createAutocompleteItem(t){return"create-new-quest"===t.id?`<i class="icon icon-plus"></i> ${t.value}`:t.name}remove(t){return tt(this,void 0,void 0,function*(){this.articleQuests=this.articleQuests.filter(e=>e!==t),yield this.articleService.deleteArticleQuest(t)})}edit(t){return tt(this,void 0,void 0,function*(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",t.questId,"edit"])})}questSelected(t){return tt(this,void 0,void 0,function*(){if("create-new-quest"===t.id){if(!0!==(yield R.a.fire({title:"Create new quest?",text:`This will create a new blank quest and attach it to ${this.article.name}`,showCancelButton:!0})).value)return;const e=t.value,i=yield this.questService.createQuest({name:e,accepted:!1,available:!1,visible:!1,status:j.b.NONE,campaignId:this.campaignService.campaign.id});yield this.questSelected(i)}else{if(void 0!==this.articleQuests.find(e=>e.questId===t.id))return;this.articleQuests.push({articleId:this.article.id,questId:t.id,quest:t}),yield this.articleService.updateArticleQuest({articleId:this.article.id,questId:t.id})}})}viewQuest(t){return tt(this,void 0,void 0,function*(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",t])})}trackArticleQuest(t,e){return e.questId+e.articleId}expandArticleQuest(t){this.expandedQuest=this.expandedQuest===t.questId?null:t.questId}get editable(){return this.campaignService.canEdit&&!this.viewOnly}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(r.a),l.Lb(j.a),l.Lb(o.b),l.Lb(n.c))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-article-quest-manager"]],inputs:{article:"article",viewOnly:"viewOnly",articleQuests:"articleQuests"},decls:6,vars:5,consts:[["class","loading",4,"ngIf"],["placeholder","Add Quest",3,"doSearch","createItem","selection",4,"ngIf"],["class","empty mt-2 p-2",4,"ngIf"],["class","card p-1 pl-2 mt-1",4,"ngFor","ngForOf","ngForTrackBy"],[1,"loading"],["placeholder","Add Quest",3,"doSearch","createItem","selection"],[1,"empty","mt-2","p-2"],[1,"empty-title","h5"],[1,"card","p-1","pl-2","mt-1"],[1,"columns","col-gapless"],[1,"column","col-auto","mr-2"],[1,"btn","btn-sm",3,"click"],["class","icon icon-arrow-down",4,"ngIf"],["class","icon icon-arrow-up",4,"ngIf"],[1,"column"],["class","icon icon-flag",4,"ngIf"],[1,"column","col-auto"],["class","btn btn-sm btn-link",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-link","ml-1",3,"click"],[1,"icon","icon-arrow-right"],["class","column col-12",4,"ngIf"],[1,"icon","icon-arrow-down"],[1,"icon","icon-arrow-up"],[1,"icon","icon-flag"],[1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-cross"],[1,"icon","icon-edit"],[1,"column","col-12"],["readOnly","true",3,"value"]],template:function(t,e){1&t&&(l.Qb(0,"div"),l.vc(1,et,1,0,"div",0),l.vc(2,it,1,2,"dd-autocomplete",1),l.vc(3,ct,3,0,"div",2),l.Qb(4,"div"),l.vc(5,ut,15,7,"div",3),l.Pb(),l.Pb()),2&t&&(l.Ab(1),l.ec("ngIf",e.loading),l.Ab(1),l.ec("ngIf",e.editable),l.Ab(1),l.ec("ngIf",e.articleQuests&&0===e.articleQuests.length),l.Ab(2),l.ec("ngForOf",e.articleQuests)("ngForTrackBy",e.trackArticleQuest))},directives:[c.k,c.j,W,N.a],styles:[""]}),t})();var dt=i("/fvA"),pt=i("dtdw"),ht=i("pLZG"),ft=i("btaL"),gt=i("DwCd"),mt=i("5eHb"),vt=i("0ezk"),yt=i("lD+H"),It=function(t,e,i,c){return new(i||(i=Promise))(function(n,r){function o(t){try{s(c.next(t))}catch(e){r(e)}}function a(t){try{s(c.throw(t))}catch(e){r(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}s((c=c.apply(t,e||[])).next())})};function At(t,e){1&t&&l.Mb(0,"i",19)}function wt(t,e){1&t&&l.Mb(0,"i",20)}function Qt(t,e){if(1&t&&l.Mb(0,"img",21),2&t){const t=l.Zb();l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.articleConcept.concept.imageId,"",l.qc)}}function Pt(t,e){1&t&&l.Mb(0,"img",22)}function Ct(t,e){if(1&t&&(l.Qb(0,"sup",23),l.wc(1),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.yc("x",t.articleConcept.quantity,"")}}function kt(t,e){1&t&&(l.Qb(0,"div",24),l.Mb(1,"div",25),l.Pb())}function St(t,e){if(1&t&&(l.Qb(0,"div",26),l.Mb(1,"span",27),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ddCurrency",t.articleConcept.currencyCost)}}function xt(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",28),l.Xb("click",function(){return l.oc(t),l.Zb().doRemove()}),l.Mb(1,"i",29),l.Pb()}}function Ot(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",28),l.Xb("click",function(){return l.oc(t),l.Zb().edit()}),l.Mb(1,"i",30),l.Pb()}}function Mt(t,e){if(1&t&&(l.Qb(0,"div",31),l.Mb(1,"dd-dynamic-field",32),l.Mb(2,"div",33),l.Mb(3,"dd-dynamic-field",32),l.Qb(4,"div",34),l.Qb(5,"div",35),l.Mb(6,"dd-dynamic-field",32),l.Pb(),l.Qb(7,"div",35),l.Mb(8,"dd-dynamic-field",32),l.Pb(),l.Pb(),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("config",t.currencyFieldConfig)("control",t.currencyCost),l.Ab(2),l.ec("config",t.quantityFieldConfig)("control",t.quantity),l.Ab(3),l.ec("config",t.isPurchasableFieldConfig)("control",t.isPurchasable),l.Ab(2),l.ec("config",t.trackOnEntityFieldConfig)("control",t.trackOnEntity)}}function qt(t,e){if(1&t&&l.Mb(0,"dd-quill",38),2&t){const t=l.Zb(2);l.ec("value",t.articleConcept.concept.content)}}function Zt(t,e){1&t&&(l.Qb(0,"div",39),l.wc(1," There is nothing here... "),l.Pb())}function Tt(t,e){if(1&t&&(l.Qb(0,"div",31),l.vc(1,qt,1,1,"dd-quill",36),l.vc(2,Zt,2,0,"div",37),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngIf",t.articleConcept.concept.content),l.Ab(1),l.ec("ngIf",!t.articleConcept.concept.content)}}function Ft(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div"),l.Qb(1,"button",42),l.Xb("click",function(){l.oc(t);const i=e.$implicit;return l.Zb(2).buy(i)}),l.Qb(2,"figure",43),l.Mb(3,"img",44),l.Pb(),l.wc(4),l.Pb(),l.Pb()}if(2&t){const t=e.$implicit,i=l.Zb(2);l.Ab(1),l.ec("disabled",!i.canAfford(t)||0===i.articleConcept.quantity),l.Ab(2),l.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.imageId,"",l.qc),l.Ab(1),l.yc(" Buy for ",t.name," ")}}function Et(t,e){if(1&t&&(l.Qb(0,"div",40),l.vc(1,Ft,5,3,"div",41),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngForOf",t.entities)}}const Lt=function(t){return{faded:t}};let _t=(()=>{class t{constructor(t,e,i,c,n,r){this.router=t,this.campaignService=e,this.articleService=i,this.login=c,this.currencyService=n,this.toastrService=r,this.remove=new l.n,this.saving=!1,this.expanded=!1}ngOnInit(){this.formGroup=new a.h({quantity:new a.e(this.articleConcept.quantity),currencyCost:new a.e(this.articleConcept.currencyCost),isPurchasable:new a.e(this.articleConcept.isPurchasable),trackOnEntity:new a.e(this.articleConcept.trackOnEntity)}),this.formGroup.valueChanges.pipe(Object(B.a)(),Object(s.a)(400)).subscribe(t=>{this.formGroup.valid&&(this.articleConcept.isPurchasable=t.isPurchasable,this.articleConcept.quantity=t.quantity,this.articleConcept.currencyCost=t.currencyCost,this.articleConcept.trackOnEntity=t.trackOnEntity,this.save(),this.formGroup.markAsPristine())}),this.currencyFieldConfig={name:"Cost",type:gt.a.CURRENCY,options:{levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}},this.quantityFieldConfig={name:"Quantity (stock)",type:gt.a.INT,options:{min:0}},this.isPurchasableFieldConfig={name:"Is Purchasable",type:gt.a.BOOLEAN},this.trackOnEntityFieldConfig={name:"Track on entity",type:gt.a.BOOLEAN}}save(){return It(this,void 0,void 0,function*(){this.saving=!0;try{yield this.articleService.updateArticleConcept(this.articleConcept)}catch(t){throw t}this.saving=!1})}doRemove(){this.remove.emit()}edit(){return It(this,void 0,void 0,function*(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.articleConcept.concept.conceptTypeId,this.articleConcept.conceptId,"edit"])})}viewConcept(){return It(this,void 0,void 0,function*(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.articleConcept.concept.conceptTypeId,this.articleConcept.conceptId,"view"])})}canAfford(t){return!!this.isPurchasable&&this.currencyService.hasResources(t.currency,this.articleConcept.currencyCost,this.campaignService.campaign.currencyMap||this.currencyService.defaultCurrencyMap,this.campaignService.campaign.trackCoins)}buy(t){return It(this,void 0,void 0,function*(){try{yield this.articleService.buyArticleConcept(this.articleConcept,1,t.id),this.toastrService.info(`${t.name} purchased 1x ${this.articleConcept.concept.name}`).onTap.subscribe(()=>{this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",t.id,"ct",this.articleConcept.concept.conceptTypeId])})}catch(e){throw e}})}get currencyCost(){return this.formGroup.get("currencyCost")}get quantity(){return this.formGroup.get("quantity")}get isPurchasable(){return this.formGroup.get("isPurchasable")}get trackOnEntity(){return this.formGroup.get("trackOnEntity")}get entities(){return this.campaignService.campaign.entities.filter(t=>!t.spawnable&&null===t.spawnedFromId&&t.userId===this.login.id&&t.preset.isCurrencyEnabled)}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(n.c),l.Lb(o.b),l.Lb(r.a),l.Lb(L.a),l.Lb(ft.a),l.Lb(mt.b))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-article-concept-manager-list-item"]],inputs:{articleConcept:"articleConcept",editable:"editable"},outputs:{remove:"remove"},decls:22,vars:19,consts:[[1,"card","p-1","mt-1"],[1,"columns","col-gapless"],[1,"column","col-auto","mr-2"],[1,"btn","btn-sm",3,"click"],["class","icon icon-arrow-down",4,"ngIf"],["class","icon icon-arrow-up",4,"ngIf"],[1,"column","col-auto","mr-2",3,"ngClass"],["class","s-rounded","width","28","style","margin-bottom: -0.26rem; margin-top: 0.04rem",3,"src",4,"ngIf"],["class","s-rounded","width","28","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword","style","margin-bottom: -0.26rem; margin-top: 0.04rem",4,"ngIf"],[1,"column",3,"ngClass"],["class","bold",4,"ngIf"],["class","d-inline-block ml-2",4,"ngIf"],["class","column col-auto mr-2 d-flex align-items-center","style","line-height: 0",4,"ngIf"],[1,"column","col-auto"],["class","btn btn-sm btn-link",3,"click",4,"ngIf"],[1,"btn","btn-sm","btn-link","ml-1",3,"click"],[1,"icon","icon-arrow-right"],["class","column col-12",4,"ngIf"],["class","column col-auto col-ml-auto mt-2",4,"ngIf"],[1,"icon","icon-arrow-down"],[1,"icon","icon-arrow-up"],["width","28",1,"s-rounded",2,"margin-bottom","-0.26rem","margin-top","0.04rem",3,"src"],["width","28","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword",1,"s-rounded",2,"margin-bottom","-0.26rem","margin-top","0.04rem"],[1,"bold"],[1,"d-inline-block","ml-2"],[1,"loading"],[1,"column","col-auto","mr-2","d-flex","align-items-center",2,"line-height","0"],[3,"ddCurrency"],[1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-cross"],[1,"icon","icon-edit"],[1,"column","col-12"],[3,"config","control"],[1,"mt-2"],[1,"columns"],[1,"column"],["readOnly","true",3,"value",4,"ngIf"],["class","text-center text-italic",4,"ngIf"],["readOnly","true",3,"value"],[1,"text-center","text-italic"],[1,"column","col-auto","col-ml-auto","mt-2"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","ml-2",2,"line-height","1",3,"disabled","click"],[1,"avatar","avatar-xs"],["alt","",3,"src"]],template:function(t,e){1&t&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"button",3),l.Xb("click",function(){return e.expanded=!e.expanded}),l.vc(4,At,1,0,"i",4),l.vc(5,wt,1,0,"i",5),l.Pb(),l.Pb(),l.Qb(6,"div",6),l.vc(7,Qt,1,1,"img",7),l.vc(8,Pt,1,0,"img",8),l.Pb(),l.Qb(9,"div",9),l.wc(10),l.vc(11,Ct,2,1,"sup",10),l.vc(12,kt,2,0,"div",11),l.Pb(),l.vc(13,St,2,1,"div",12),l.Qb(14,"div",13),l.vc(15,xt,2,0,"button",14),l.vc(16,Ot,2,0,"button",14),l.Qb(17,"button",15),l.Xb("click",function(){return e.viewConcept()}),l.Mb(18,"i",16),l.Pb(),l.Pb(),l.vc(19,Mt,9,8,"div",17),l.vc(20,Tt,3,2,"div",17),l.vc(21,Et,2,1,"div",18),l.Pb(),l.Pb()),2&t&&(l.Ab(4),l.ec("ngIf",!e.expanded),l.Ab(1),l.ec("ngIf",e.expanded),l.Ab(1),l.ec("ngClass",l.ic(15,Lt,0===e.articleConcept.quantity)),l.Ab(1),l.ec("ngIf",e.articleConcept.concept.imageId),l.Ab(1),l.ec("ngIf",!e.articleConcept.concept.imageId),l.Ab(1),l.ec("ngClass",l.ic(17,Lt,0===e.articleConcept.quantity)),l.Ab(1),l.yc(" ",e.articleConcept.concept.name," "),l.Ab(1),l.ec("ngIf",null!=e.articleConcept.quantity),l.Ab(1),l.ec("ngIf",e.saving),l.Ab(1),l.ec("ngIf",e.articleConcept.isPurchasable),l.Ab(2),l.ec("ngIf",e.editable),l.Ab(1),l.ec("ngIf",e.editable),l.Ab(3),l.ec("ngIf",e.expanded&&e.editable),l.Ab(1),l.ec("ngIf",e.expanded),l.Ab(1),l.ec("ngIf",e.articleConcept.isPurchasable&&e.expanded))},directives:[c.k,c.i,vt.a,yt.a,N.a,c.j],styles:[""]}),t})();var Rt=function(t,e,i,c){return new(i||(i=Promise))(function(n,r){function o(t){try{s(c.next(t))}catch(e){r(e)}}function a(t){try{s(c.throw(t))}catch(e){r(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}s((c=c.apply(t,e||[])).next())})};function Xt(t,e){1&t&&l.Mb(0,"div",4)}function Nt(t,e){if(1&t){const t=l.Rb();l.Qb(0,"dd-autocomplete",5),l.Xb("selection",function(e){return l.oc(t),l.Zb().conceptSelected(e)}),l.Pb()}if(2&t){const t=l.Zb();l.gc("placeholder","Add ",t.conceptType.name,""),l.ec("doSearch",t.doConceptSearch)("createItem",t.createAutocompleteItem)}}function $t(t,e){if(1&t&&(l.Qb(0,"div",6),l.Qb(1,"p",7),l.wc(2),l.Pb(),l.Pb()),2&t){const t=l.Zb();l.Ab(2),l.yc("This article has no ",t.conceptType.pluralForm,"")}}function Gt(t,e){if(1&t){const t=l.Rb();l.Qb(0,"dd-article-concept-manager-list-item",8),l.Xb("remove",function(){l.oc(t);const i=e.$implicit;return l.Zb().remove(i)}),l.Pb()}if(2&t){const t=e.$implicit,i=l.Zb();l.ec("articleConcept",t)("editable",i.editable)}}let jt=(()=>{class t{constructor(t,e,i,c,n){this.articleService=t,this.conceptService=e,this.router=i,this.campaignService=c,this.update=n,this.viewOnly=!0,this.loading=!1}ngOnInit(){this.doConceptSearch=t=>this.searchConcepts(t),this._conceptArticleDeleteSubscription=this.update.conceptArticleDelete.subscribe(t=>{this.articleConcepts&&(this.articleConcepts=this.articleConcepts.filter(e=>!(e.articleId===t.articleId&&e.conceptId===t.conceptId)))}),this._conceptArticleUpdateSubscription=this.update.conceptArticleUpdate.pipe(Object(ht.a)(t=>t.articleId===this.article.id&&t.concept.conceptTypeId===this.conceptType.id)).subscribe(t=>{if(this.articleConcepts){const e=this.articleConcepts.find(e=>e.conceptId===t.conceptId&&e.articleId===t.articleId);void 0!==e?Object.assign(e,t):this.articleConcepts.push(t)}}),this.load(this.conceptType.id)}ngOnDestroy(){this._conceptArticleDeleteSubscription&&this._conceptArticleDeleteSubscription.unsubscribe(),this._conceptArticleUpdateSubscription&&this._conceptArticleUpdateSubscription.unsubscribe()}load(t){return Rt(this,void 0,void 0,function*(){this.loading=!0;try{this.articleConcepts=yield this.articleService.getArticleConcepts(this.article.id,t)}catch(e){throw e}this.loading=!1})}createNewConcept(t){return Rt(this,void 0,void 0,function*(){return this.conceptService.createConcept({name:t,userId:"fake",fields:[],tags:["TODO"],isContainer:!1,conceptTypeId:this.conceptType.id})})}searchConcepts(t){return Rt(this,void 0,void 0,function*(){const e=(yield this.conceptService.getConcepts(this.conceptType.id,5,0,t)).concepts.map(t=>Object.assign(Object.assign({},t),{value:t.name}));return t.trim().length>0&&e.push({value:t,id:"create-new-concept"}),e})}createAutocompleteItem(t){return"create-new-concept"===t.id?`<span><i class="icon icon-plus"></i> ${t.value}</span>`:t.name}remove(t){return Rt(this,void 0,void 0,function*(){this.articleConcepts=this.articleConcepts.filter(e=>e!==t),yield this.articleService.deleteArticleConcept(t)})}conceptSelected(t){return Rt(this,void 0,void 0,function*(){if("create-new-concept"===t.id){const e=yield this.createNewConcept(t.value);yield this.conceptSelected(e)}else{if(void 0!==this.articleConcepts.find(e=>e.conceptId===t.id))return;this.articleConcepts.push({articleId:this.article.id,conceptId:t.id,concept:t,isPurchasable:!1,trackOnEntity:!0}),yield this.articleService.updateArticleConcept({articleId:this.article.id,conceptId:t.id,isPurchasable:!1,trackOnEntity:!0})}})}trackArticleConcept(t,e){return e.conceptId+e.articleId}get editable(){return this.campaignService.canEdit&&!this.viewOnly}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(r.a),l.Lb(dt.a),l.Lb(n.c),l.Lb(o.b),l.Lb(pt.b))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-article-concept-manager"]],inputs:{conceptType:"conceptType",article:"article",articleConcepts:"articleConcepts",viewOnly:"viewOnly"},decls:6,vars:5,consts:[["class","loading",4,"ngIf"],[3,"placeholder","doSearch","createItem","selection",4,"ngIf"],["class","empty mt-2 p-2",4,"ngIf"],[3,"articleConcept","editable","remove",4,"ngFor","ngForOf","ngForTrackBy"],[1,"loading"],[3,"placeholder","doSearch","createItem","selection"],[1,"empty","mt-2","p-2"],[1,"empty-title","h5"],[3,"articleConcept","editable","remove"]],template:function(t,e){1&t&&(l.Qb(0,"div"),l.vc(1,Xt,1,0,"div",0),l.vc(2,Nt,1,3,"dd-autocomplete",1),l.vc(3,$t,3,1,"div",2),l.Qb(4,"div"),l.vc(5,Gt,1,2,"dd-article-concept-manager-list-item",3),l.Pb(),l.Pb()),2&t&&(l.Ab(1),l.ec("ngIf",e.loading),l.Ab(1),l.ec("ngIf",e.editable),l.Ab(1),l.ec("ngIf",e.articleConcepts&&0===e.articleConcepts.length),l.Ab(2),l.ec("ngForOf",e.articleConcepts)("ngForTrackBy",e.trackArticleConcept))},directives:[c.k,c.j,W,_t],styles:[""]}),t})();var Bt=function(t,e,i,c){return new(i||(i=Promise))(function(n,r){function o(t){try{s(c.next(t))}catch(e){r(e)}}function a(t){try{s(c.throw(t))}catch(e){r(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,a)}s((c=c.apply(t,e||[])).next())})};const Dt=function(t){return{loading:t}};function Ht(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",23),l.Xb("click",function(){return l.oc(t),l.Zb().makeCopy()}),l.wc(1," Make Copy "),l.Pb()}if(2&t){const t=l.Zb();l.ec("ngClass",l.ic(2,Dt,t.copying))("disabled",t.loading||t.saving)}}function Ut(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",24),l.Xb("click",function(){return l.oc(t),l.Zb().delete()}),l.wc(1," Delete "),l.Pb()}if(2&t){const t=l.Zb();l.ec("disabled",t.loading||t.saving)}}function Kt(t,e){1&t&&(l.Qb(0,"p",25),l.wc(1," A name is required "),l.Pb())}function Yt(t,e){1&t&&(l.Qb(0,"p",25),l.wc(1," The name cannot be more than 30 characters long "),l.Pb())}function Jt(t,e){if(1&t&&(l.Qb(0,"div",12),l.Qb(1,"label",18),l.wc(2,"Quests"),l.Pb(),l.Mb(3,"dd-article-quest-manager",26),l.Pb()),2&t){const t=l.Zb();l.Ab(3),l.ec("article",t.article)("viewOnly",!1)}}function Vt(t,e){if(1&t&&(l.Qb(0,"div",12),l.Qb(1,"label",18),l.wc(2),l.Pb(),l.Mb(3,"dd-article-concept-manager",28),l.Pb()),2&t){const t=e.$implicit,i=l.Zb(2);l.Ab(2),l.xc(t.pluralForm),l.Ab(1),l.ec("conceptType",t)("article",i.article)("viewOnly",!1)}}function zt(t,e){if(1&t&&(l.Qb(0,"div"),l.vc(1,Vt,4,4,"div",27),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngForOf",t.conceptTypes)}}const Wt=function(t){return{"has-error":t}};let te=(()=>{class t{constructor(t,e,i,c,n,r,o){this.campaignSerivce=t,this.articleService=e,this.login=i,this.route=c,this.router=n,this.location=r,this.http=o,this.saving=!1,this.loading=!1,this.copying=!1}ngOnInit(){this.formGroup=new a.h({name:new a.e(null,[a.v.required,a.v.maxLength(30)]),content:new a.e(null),published:new a.e(!1),tags:new a.c([]),icon:new a.e(null)}),this.editing&&(this.formGroup.disable(),this.route.paramMap.subscribe(t=>{this.load(t.get("a_id"))}))}canDeactivate(){return!this.formGroup.dirty}constructArticle(){const t=this.formGroup.value,e={name:t.name,content:t.content,published:t.published,campaignId:this.campaignSerivce.campaign.id,userId:this.login.id,tags:t.tags||[],icon:t.icon};return this.editing&&(e.id=this._article.id,e.userId=this._article.userId,e.mapId=this._article.mapId,e.lat=this._article.lat,e.lng=this._article.lng),e}load(t){return Bt(this,void 0,void 0,function*(){this.loading=!0;try{this._article=yield this.articleService.getArticle(t)}catch(e){throw e}null===this._article.tags&&(this._article.tags=[]),this.formGroup.patchValue(this._article),this._article.tags&&(this.formGroup.get("tags").controls=this._article.tags.map(t=>new a.e(t))),this.formGroup.enable(),this.loading=!1})}save(){return Bt(this,void 0,void 0,function*(){this.formGroup.disable(),this.saving=!0;try{const t=this.constructArticle();this.editing?yield this.articleService.updateArticle(t):yield this.articleService.createArticle(t)}catch(t){throw t}this.saving=!1,this.formGroup.enable(),this.formGroup.markAsPristine(),this.router.navigate(["campaigns",this.campaignSerivce.campaign.id,"articles"])})}delete(){return Bt(this,void 0,void 0,function*(){if(!0===(yield R.a.fire({title:"Are you sure?",showCancelButton:!0})).value)try{yield this.articleService.deleteArticle(this._article.id),this.router.navigate(["campaigns",this.campaignSerivce.campaign.id,"articles"])}catch(t){throw t}})}makeCopy(){return Bt(this,void 0,void 0,function*(){if(this.canDeactivate()||!0===(yield R.a.fire({title:"Are you sure?",text:"You have unsaved changes!",showCancelButton:!0})).value){this.copying=!0;try{const t=yield this.articleService.makeCopy(this.article.id);this.router.navigate(["campaigns",this.campaignSerivce.campaign.id,"articles",t.id,"edit"])}catch(t){throw t}this.copying=!1}})}cancel(){this.location.back()}get editing(){return this.route.snapshot.data.editing}get name(){return this.formGroup.get("name")}get icon(){return this.formGroup.get("icon")}get article(){return this._article}get conceptTypes(){return this.campaignSerivce.campaign.conceptTypes.filter(t=>!0===t.isLinkableToArticles)}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(o.b),l.Lb(r.a),l.Lb(L.a),l.Lb(n.a),l.Lb(n.c),l.Lb(c.g),l.Lb(X.b))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-article-editor"]],decls:36,vars:17,consts:[[1,"container","grid-xl","p-2",3,"formGroup"],[1,"columns"],[1,"column"],[1,"column","col-auto"],["class","btn mr-2",3,"ngClass","disabled","click",4,"ngIf"],["class","btn btn-error mr-2",3,"disabled","click",4,"ngIf"],[1,"btn","mr-2",3,"disabled","click"],[1,"btn",3,"ngClass","disabled","click"],[1,"form-group",3,"ngClass"],["for","name",1,"form-label"],["type","text","name","name","id","name","placeholder","Name","formControlName","name",1,"form-input"],["class","form-input-hint",4,"ngIf"],[1,"form-group"],["for","text",1,"form-label"],["formControlName","content"],[1,"form-switch"],["type","checkbox","formControlName","published"],[1,"form-icon"],[1,"form-label"],[3,"formGroup"],["formControlName","icon"],["class","form-group",4,"ngIf"],[4,"ngIf"],[1,"btn","mr-2",3,"ngClass","disabled","click"],[1,"btn","btn-error","mr-2",3,"disabled","click"],[1,"form-input-hint"],[3,"article","viewOnly"],["class","form-group",4,"ngFor","ngForOf"],[3,"conceptType","article","viewOnly"]],template:function(t,e){1&t&&(l.Qb(0,"div",0),l.Qb(1,"div",1),l.Qb(2,"div",2),l.Qb(3,"h3"),l.wc(4),l.Pb(),l.Pb(),l.Qb(5,"div",3),l.vc(6,Ht,2,4,"button",4),l.vc(7,Ut,2,1,"button",5),l.Qb(8,"button",6),l.Xb("click",function(){return e.cancel()}),l.wc(9," Cancel "),l.Pb(),l.Qb(10,"button",7),l.Xb("click",function(){return e.save()}),l.wc(11," Save "),l.Pb(),l.Pb(),l.Pb(),l.Qb(12,"div",8),l.Qb(13,"label",9),l.wc(14,"Name"),l.Pb(),l.Mb(15,"input",10),l.vc(16,Kt,2,0,"p",11),l.vc(17,Yt,2,0,"p",11),l.Pb(),l.Qb(18,"div",12),l.Qb(19,"label",13),l.wc(20,"Content"),l.Pb(),l.Mb(21,"dd-quill",14),l.Pb(),l.Qb(22,"div",12),l.Qb(23,"label",15),l.Mb(24,"input",16),l.Mb(25,"i",17),l.wc(26," This article is published (players can view it) "),l.Pb(),l.Pb(),l.Qb(27,"label",18),l.wc(28,"Tags"),l.Pb(),l.Mb(29,"dd-tag-editor",19),l.Qb(30,"div",12),l.Qb(31,"label",18),l.wc(32,"Icon"),l.Pb(),l.Mb(33,"dd-icon-picker",20),l.Pb(),l.vc(34,Jt,4,2,"div",21),l.vc(35,zt,2,1,"div",22),l.Pb()),2&t&&(l.ec("formGroup",e.formGroup),l.Ab(4),l.yc("",e.editing?"Edit":"Create"," Article"),l.Ab(2),l.ec("ngIf",e.editing),l.Ab(1),l.ec("ngIf",e.editing),l.Ab(1),l.ec("disabled",e.loading||e.saving),l.Ab(2),l.ec("ngClass",l.ic(13,Dt,e.saving))("disabled",e.loading||e.saving||e.formGroup.invalid),l.Ab(2),l.ec("ngClass",l.ic(15,Wt,e.name.invalid&&(e.name.dirty||e.name.touched))),l.Ab(4),l.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.required),l.Ab(1),l.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.maxlength),l.Ab(12),l.ec("formGroup",e.formGroup),l.Ab(5),l.ec("ngIf",e.editing&&e.article),l.Ab(1),l.ec("ngIf",e.editing&&e.article))},directives:[a.n,a.i,c.k,c.i,a.b,a.m,a.g,N.a,a.a,$.a,G.a,bt,c.j,jt],styles:[""]}),t})();var ee=i("8Qhy"),ie=i("a8fi"),ce=i("/AKn"),ne=i("Kjs6");function re(t,e){1&t&&l.Mb(0,"div",8)}function oe(t,e){if(1&t&&l.Mb(0,"dd-http-errors",9),2&t){const t=l.Zb();l.ec("error",t.loadError)}}function ae(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",18),l.Xb("click",function(){return l.oc(t),l.Zb(2).viewOnMap()}),l.Mb(1,"i",19),l.Qb(2,"span",16),l.wc(3," Map"),l.Pb(),l.Pb()}}function se(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",14),l.Xb("click",function(){return l.oc(t),l.Zb(2).edit()}),l.Mb(1,"i",20),l.Qb(2,"span",16),l.wc(3," Edit"),l.Pb(),l.Pb()}}function le(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div"),l.Qb(1,"div",10),l.Qb(2,"div",11),l.Qb(3,"h3"),l.wc(4),l.Pb(),l.Pb(),l.Qb(5,"div",12),l.vc(6,ae,4,0,"button",13),l.Qb(7,"button",14),l.Xb("click",function(){return l.oc(t),l.Zb().addNote()}),l.Mb(8,"i",15),l.Qb(9,"span",16),l.wc(10," Add Note"),l.Pb(),l.Pb(),l.vc(11,se,4,0,"button",17),l.Pb(),l.Pb(),l.Pb()}if(2&t){const t=l.Zb();l.Ab(4),l.xc(t.article.name),l.Ab(2),l.ec("ngIf",null!==t.article.mapId),l.Ab(5),l.ec("ngIf",t.editable)}}function ue(t,e){if(1&t&&l.Mb(0,"dd-quill",21),2&t){const t=l.Zb();l.ec("value",t.article.content)}}function be(t,e){1&t&&(l.Qb(0,"div",22),l.Qb(1,"p",23),l.wc(2,"This article has no content"),l.Pb(),l.Pb())}function de(t,e){1&t&&(l.Qb(0,"h4"),l.wc(1,"Quests"),l.Pb())}function pe(t,e){if(1&t){const t=l.Rb();l.Qb(0,"span",24),l.Xb("click",function(){return l.oc(t),l.Zb().questsExpanded=!0}),l.wc(1,"Show Quests"),l.Pb()}}function he(t,e){if(1&t&&l.Mb(0,"dd-article-quest-manager",26),2&t){const t=l.Zb(2);l.ec("article",t.article)("articleQuests",t.article.articleQuests)}}function fe(t,e){if(1&t&&(l.Qb(0,"div"),l.vc(1,he,1,2,"dd-article-quest-manager",25),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngIf",t.article)}}function ge(t,e){if(1&t){const t=l.Rb();l.Qb(0,"span",24),l.Xb("click",function(){return l.oc(t),l.Zb().questsExpanded=!1}),l.wc(1,"Hide Quests"),l.Pb()}}function me(t,e){if(1&t){const t=l.Rb();l.Qb(0,"span",24),l.Xb("click",function(){l.oc(t);const e=l.Zb().$implicit;return l.Zb().conceptTypesExpanded[e.id]=!0}),l.wc(1),l.Pb()}if(2&t){const t=l.Zb().$implicit;l.Ab(1),l.yc("Show ",t.pluralForm,"")}}function ve(t,e){if(1&t&&l.Mb(0,"dd-article-concept-manager",28),2&t){const t=l.Zb().$implicit,e=l.Zb();l.ec("conceptType",t)("article",e.article)}}function ye(t,e){if(1&t){const t=l.Rb();l.Qb(0,"span",24),l.Xb("click",function(){l.oc(t);const e=l.Zb().$implicit;return l.Zb().conceptTypesExpanded[e.id]=!1}),l.wc(1),l.Pb()}if(2&t){const t=l.Zb().$implicit;l.Ab(1),l.yc("Hide ",t.pluralForm,"")}}function Ie(t,e){if(1&t&&(l.Qb(0,"div"),l.Qb(1,"h4"),l.wc(2),l.Pb(),l.vc(3,me,2,1,"span",6),l.vc(4,ve,1,2,"dd-article-concept-manager",27),l.vc(5,ye,2,1,"span",6),l.Pb()),2&t){const t=e.$implicit,i=l.Zb();l.Ab(2),l.xc(t.pluralForm),l.Ab(1),l.ec("ngIf",!i.conceptTypesExpanded[t.id]),l.Ab(1),l.ec("ngIf",!0===i.conceptTypesExpanded[t.id]),l.Ab(1),l.ec("ngIf",!0===i.conceptTypesExpanded[t.id])}}function Ae(t,e){if(1&t){const t=l.Rb();l.Qb(0,"span",24),l.Xb("click",function(){return l.oc(t),l.Zb(2).notesExpanded=!0}),l.wc(1,"Show Notes"),l.Pb()}}function we(t,e){if(1&t&&l.Mb(0,"dd-note-list",30),2&t){const t=l.Zb(2);l.ec("notes",t.notes)}}function Qe(t,e){if(1&t){const t=l.Rb();l.Qb(0,"span",24),l.Xb("click",function(){return l.oc(t),l.Zb(2).notesExpanded=!1}),l.wc(1,"Hide Notes"),l.Pb()}}function Pe(t,e){if(1&t&&(l.Qb(0,"div"),l.Qb(1,"h4"),l.wc(2,"Notes"),l.Pb(),l.vc(3,Ae,2,0,"span",6),l.vc(4,we,1,1,"dd-note-list",29),l.vc(5,Qe,2,0,"span",6),l.Pb()),2&t){const t=l.Zb();l.Ab(3),l.ec("ngIf",!0!==t.notesExpanded),l.Ab(1),l.ec("ngIf",t.notesExpanded),l.Ab(1),l.ec("ngIf",!0===t.notesExpanded)}}const Ce=[{path:"",component:E},{path:"create",component:te,canDeactivate:[ee.a],data:{editing:!1,breadcrumb:"Create Article"}},{path:":a_id/edit",component:te,canDeactivate:[ee.a],data:{editing:!0,breadcrumb:"Edit Article"}},{path:":a_id",component:(()=>{class t{constructor(t,e,i,c,n,r){this.articleService=t,this.route=e,this.router=i,this.campaignService=c,this.updateHub=n,this.noteService=r,this.loading=!1,this.questsExpanded=!1,this.notesExpanded=!1,this.conceptTypesExpanded={}}ngOnInit(){this.route.paramMap.subscribe(t=>{t.has("a_id")&&(this.article&&this.updateHub.unsubscribeArticles([this.article.id]),this.updateHub.subscribeArticles([t.get("a_id")]),this.article=void 0,this.load(t.get("a_id")))}),this._updateSubscription=this.updateHub.articleUpdated.pipe(Object(ht.a)(t=>t.id===this.article.id)).subscribe(t=>{this.article=t}),this.updateHub.stateUpdate.pipe(Object(ht.a)(t=>t===pt.a.CONNECTED)).subscribe(()=>{this.updateHub.subscribeArticles([this.route.snapshot.paramMap.get("a_id")])})}ngOnDestroy(){this._updateSubscription&&this._updateSubscription.unsubscribe()}load(t){return e=this,void 0,c=function*(){this.loading=!0;try{this.article=yield this.articleService.getArticle(t),this.noteService.getNotes(this.campaignService.campaign.id,{articleId:this.article.id})}catch(e){this.loadError=e,console.log(e)}this.loading=!1},new((i=void 0)||(i=Promise))(function(t,n){function r(t){try{a(c.next(t))}catch(e){n(e)}}function o(t){try{a(c.throw(t))}catch(e){n(e)}}function a(e){var c;e.done?t(e.value):(c=e.value,c instanceof i?c:new i(function(t){t(c)})).then(r,o)}a((c=c.apply(e,[])).next())});var e,i,c}edit(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"articles",this.article.id,"edit"])}viewOnMap(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",this.article.mapId],{queryParams:{lat:this.article.lat,lng:this.article.lng,article:this.article.id}})}addNote(){this.noteService.addNote({type:ie.b.ARTICLE,articleId:this.article.id})}get editable(){return this.campaignService.canEdit}get conceptTypes(){if(this.article){const t={};return this.article.articleConcepts.forEach(e=>{t[e.concept.conceptTypeId]||(t[e.concept.conceptTypeId]=this.campaignService.campaign.conceptTypes.find(t=>t.id===e.concept.conceptTypeId))}),Object.values(t)}return[]}get notes(){return this.article?this.noteService.getArticleNotes(this.article.id):[]}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(r.a),l.Lb(n.a),l.Lb(n.c),l.Lb(o.b),l.Lb(pt.b),l.Lb(ie.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-article-view"]],decls:12,vars:11,consts:[[1,"container","grid-lg"],["class","loading loading-lg",4,"ngIf"],[3,"error",4,"ngIf"],[4,"ngIf"],["readOnly","true",3,"value",4,"ngIf"],["class","empty",4,"ngIf"],["class","fake-link",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"loading","loading-lg"],[3,"error"],[1,"columns"],[1,"column"],[1,"column","col-auto"],["class","btn btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-sm","ml-2",3,"click"],[1,"icon","icon-link"],[1,"hide-sm"],["class","btn btn-sm ml-2",3,"click",4,"ngIf"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-location"],[1,"icon","icon-edit"],["readOnly","true",3,"value"],[1,"empty"],[1,"empty-subtitle"],[1,"fake-link",3,"click"],[3,"article","articleQuests",4,"ngIf"],[3,"article","articleQuests"],[3,"conceptType","article",4,"ngIf"],[3,"conceptType","article"],[3,"notes",4,"ngIf"],[3,"notes"]],template:function(t,e){1&t&&(l.Qb(0,"div",0),l.vc(1,re,1,0,"div",1),l.vc(2,oe,1,1,"dd-http-errors",2),l.vc(3,le,12,3,"div",3),l.vc(4,ue,1,1,"dd-quill",4),l.vc(5,be,3,0,"div",5),l.vc(6,de,2,0,"h4",3),l.vc(7,pe,2,0,"span",6),l.vc(8,fe,2,1,"div",3),l.vc(9,ge,2,0,"span",6),l.vc(10,Ie,6,4,"div",7),l.vc(11,Pe,6,3,"div",3),l.Pb()),2&t&&(l.Ab(1),l.ec("ngIf",e.loading),l.Ab(1),l.ec("ngIf",e.loadError),l.Ab(1),l.ec("ngIf",e.article),l.Ab(1),l.ec("ngIf",e.article),l.Ab(1),l.ec("ngIf",!(void 0===e.article||e.article.content&&e.article.content.ops)),l.Ab(1),l.ec("ngIf",e.article&&e.article.articleQuests.length>0),l.Ab(1),l.ec("ngIf",e.article&&e.article.articleQuests.length>0&&!e.questsExpanded),l.Ab(1),l.ec("ngIf",e.article&&e.article.articleQuests.length>0&&e.questsExpanded),l.Ab(1),l.ec("ngIf",e.article&&e.article.articleQuests.length>0&&e.questsExpanded),l.Ab(1),l.ec("ngForOf",e.conceptTypes),l.Ab(1),l.ec("ngIf",e.notes.length>0))},directives:[c.k,c.j,ce.a,N.a,bt,jt,ne.a],styles:[""]}),t})(),data:{breadcrumb:"Article View",suggestable:!0}}];let ke=(()=>{class t{}return t.\u0275mod=l.Jb({type:t}),t.\u0275inj=l.Ib({factory:function(e){return new(e||t)},imports:[[n.f.forChild(Ce)],n.f]}),t})();var Se=i("wC5x"),xe=i("reMG"),Oe=i("EA6F");let Me=(()=>{class t{}return t.\u0275mod=l.Jb({type:t}),t.\u0275inj=l.Ib({factory:function(e){return new(e||t)},imports:[[c.b,ke,Se.a,xe.NotesModule,a.s,Oe.a]]}),t})()}}]);