<div class="container grid-lg">
  <div class="loading loading-lg" *ngIf="loading"></div>
  <dd-http-errors [error]="loadError" *ngIf="loadError"></dd-http-errors>

  <!-- Display -->
  <div *ngIf="article">
    <div class="columns">
      <!-- Name -->
      <div class="column">
        <h3>{{ article.name }}</h3>
      </div>

      <div class="column col-auto">
        <!-- View On Map -->
        <button class="btn btn-sm" *ngIf="article.mapId !== null" (click)="viewOnMap()">
          <i class="icon icon-location"></i>
          <span class="hide-sm"> Map</span>
        </button>

        <button class="btn btn-sm ml-2" (click)="addNote()"><i class="icon icon-link"></i> <span class="hide-sm"> Add Note</span></button>

        <button class="btn btn-sm ml-2" (click)="edit()" *ngIf="editable">
          <i class="icon icon-edit"></i><span class="hide-sm"> Edit</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Article Content -->
  <dd-quill readOnly="true" [value]="article.content" *ngIf="article"></dd-quill>

  <div class="empty" *ngIf="article !== undefined && (!article.content || !article.content.ops)">
    <p class="empty-subtitle">This article has no content</p>
  </div>

  <!-- Quest View -->
  <h4 *ngIf="article && article.articleQuests.length > 0">Quests</h4>
  <span class="fake-link" *ngIf="article && article.articleQuests.length > 0 && !questsExpanded" (click)="questsExpanded = true"
    >Show Quests</span
  >
  <div *ngIf="article && article.articleQuests.length > 0 && questsExpanded">
    <dd-article-quest-manager [article]="article" [articleQuests]="article.articleQuests" *ngIf="article"></dd-article-quest-manager>
  </div>
  <span class="fake-link" *ngIf="article && article.articleQuests.length > 0 && questsExpanded" (click)="questsExpanded = false"
    >Hide Quests</span
  >

  <!-- Concept View -->
  <div *ngFor="let ct of conceptTypes">
    <h4>{{ ct.pluralForm }}</h4>
    <span class="fake-link" *ngIf="!conceptTypesExpanded[ct.id]" (click)="conceptTypesExpanded[ct.id] = true"
      >Show {{ ct.pluralForm }}</span
    >
    <dd-article-concept-manager
      [conceptType]="ct"
      [article]="article"
      *ngIf="conceptTypesExpanded[ct.id] === true"
    ></dd-article-concept-manager>
    <span class="fake-link" *ngIf="conceptTypesExpanded[ct.id] === true" (click)="conceptTypesExpanded[ct.id] = false"
      >Hide {{ ct.pluralForm }}</span
    >
  </div>

  <!-- Notes -->
  <div *ngIf="notes.length > 0">
    <h4>Notes</h4>
    <span class="fake-link" *ngIf="notesExpanded !== true" (click)="notesExpanded = true">Show Notes</span>
    <dd-note-list [notes]="notes" *ngIf="notesExpanded"></dd-note-list>
    <span class="fake-link" *ngIf="notesExpanded === true" (click)="notesExpanded = false">Hide Notes</span>
  </div>
</div>
