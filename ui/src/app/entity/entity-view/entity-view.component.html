<div class="loading loading-lg" *ngIf="loading"></div>

<dd-entity-attribute-editor-modal
  #attributemodal
></dd-entity-attribute-editor-modal>

<!-- Background container -->
<div
  class="player-bg d-flex"
  *ngIf="entity"
  [style.background-image]="backgroundCSS(entity.imageId)"
>
  <div id="head-container">
    <!-- Top row -->
    <div class="container grid-xl mb-auto">
      <div class="columns text-gray">
        <div class="column" *ngIf="saving">Saving...</div>
      </div>
    </div>

    <!-- Bottom Row -->
    <div class="container grid-xl">
      <div class="columns text-light">
        <div class="column text-light mb-1">
          <h3
            class="mb-0 text-bold"
            [ngClass]="{ 'c-hand': editable }"
            (click)="editName()"
          >
            {{ entity.name }}
            <a class="text-light" *ngIf="editable" [routerLink]="['edit']"
              ><i class="icon icon-edit"></i
            ></a>
          </h3>
          <span class="text-italic no-select">{{ entity.preset.name }}</span>
        </div>
        <div
          class="column col-auto d-flex justify-end align-items-end col-ml-auto"
          *ngIf="preset.isXPEnabled"
        >
          <span [ngClass]="{ 'c-hand': editable }" (click)="editXP()">
            <span class="h5 no-select">LV. </span>
            <span class="h3 text-bold">{{ level }}</span>
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container grid-xl" *ngIf="entity">
  <!-- Major attributes -->
  <dd-attribute-row-view
    *ngIf="majorAttributes.length > 0"
    [attributes]="majorAttributes"
    [editable]="editable"
    (edit)="editAttribute($event)"
  ></dd-attribute-row-view>

  <div class="divider" *ngIf="majorAttributes.length > 0"></div>

  <!-- Normal Attributes -->
  <dd-attribute-row-view
    *ngIf="normalAttributes.length > 0"
    [attributes]="normalAttributes"
    [editable]="editable"
    (edit)="editAttribute($event)"
    mode="normal"
  ></dd-attribute-row-view>
  <div class="divider" *ngIf="normalAttributes.length > 0"></div>

  <!-- Health/Currency -->
  <div class="columns">
    <!-- Health -->
    <div
      class="column"
      [ngClass]="{
        'col-9 col-md-7 col-sm-12': preset.isCurrencyEnabled,
        'col-12 mt-2': !preset.isCurrencyEnabled
      }"
      *ngIf="preset.isHealthEnabled"
    >
      <div class="card h-100">
        <dd-health-display
          [editable]="editable"
          [preset]="entity.preset.health"
          [health]="entity.health"
          (healthChange)="onHPEdit($event)"
        ></dd-health-display>
      </div>
    </div>

    <!-- Currency -->
    <!-- Currency Desktop -->
    <div class="column col-3 col-md-5 hide-sm" *ngIf="preset.isCurrencyEnabled">
      <div
        class="card h-100 p-1 currency-box text-center"
        (click)="editCurrency()"
        [ngClass]="{ 'c-hand': editable }"
      >
        <div class="columns col-gapless">
          <div class="column">
            <h4 class="mb-0 text-bold">{{ formattedCurrency }}</h4>
          </div>
          <div class="column col-auto">
            <img
              src="/assets/metal-disc.png"
              style="margin-bottom: -0.45rem"
              width="30"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Currency Mobile -->
    <div class="column col-12 show-sm mt-2" *ngIf="preset.isCurrencyEnabled">
      <div
        class="card p-1 currency-box text-center"
        (click)="editCurrency()"
        [ngClass]="{ 'c-hand': editable }"
      >
        <div class="columns col-gapless">
          <div class="column">
            <h4 class="mb-0 text-bold">{{ formattedCurrency }}</h4>
          </div>
          <div class="column col-auto">
            <img src="/assets/metal-disc.png" class="coin-icon" width="25" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="divider" *ngIf="preset.isCurrencyEnabled"></div>

  <!-- Inventory Management -->
  <dd-inventory-manager
    class="mt-2"
    [entityId]="entity.id"
    [editable]="editable"
    *ngIf="entity && preset.isInventoryEnabled"
  ></dd-inventory-manager>

  <!-- Spellset Management -->
  <div class="divider"></div>
  <dd-spellset-manager
    [editable]="editable"
    *ngIf="entity"
  ></dd-spellset-manager>

  <div class="columns">
    <!-- Image and description -->
    <div class="column col-8 col-md-6 col-sm-12 hide-sm">
      <div
        class="divider text-center"
        [attr.data-content]="'About ' + entity.name"
      ></div>
      <markdown [data]="entity.description"></markdown>
      <img
        class="img-responsive s-rounded"
        src="https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/{{
          entity.imageId
        }}"
      />

      <!-- Big description fields -->
      <div class="divider" *ngIf="bigTextAttributes.length > 0"></div>

      <div *ngFor="let bta of bigTextAttributes">
        <h3>{{ bta.attr.name }}</h3>
        <markdown [data]="bta.attr.data"></markdown>
      </div>
    </div>

    <!-- Minor Attributes -->
    <div
      class="column col-4 col-md-6 col-sm-12 col-ml-auto"
      *ngIf="minorAttributes.length > 0"
    >
      <dd-attribute-table-view
        *ngIf="minorAttributes.length > 0"
        [attributes]="minorAttributes"
        [editable]="editable"
        (edit)="editAttribute($event)"
      ></dd-attribute-table-view>
    </div>

    <!-- Image and description lower -->
    <div class="column col-12 show-sm mt-2">
      <div
        class="divider text-center"
        [attr.data-content]="'About ' + entity.name"
      ></div>
      <markdown [data]="entity.description"></markdown>
      <img
        class="img-responsive s-rounded"
        src="https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/{{
          entity.imageId
        }}"
      />

      <!-- Big description fields -->
      <div class="divider" *ngIf="bigTextAttributes.length > 0"></div>

      <div *ngFor="let bta of bigTextAttributes">
        <h3>{{ bta.attr.name }}</h3>
        <markdown [data]="bta.attr.data"></markdown>
      </div>
    </div>
  </div>
</div>
