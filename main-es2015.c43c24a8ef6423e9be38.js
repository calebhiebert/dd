(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+awi":function(t,e,i){"use strict";i.d(e,"a",function(){return d});var n=i("fXoL"),c=i("ofXK");function o(t,e){if(1&t&&(n.Qb(0,"p",1),n.wc(1),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.yc(" ",t.config.name," is required\n")}}function r(t,e){if(1&t&&(n.Qb(0,"p",1),n.wc(1),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.zc(" ",t.config.name," can't be lower than ",t.config.options.min,"\n")}}function a(t,e){if(1&t&&(n.Qb(0,"p",1),n.wc(1),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.zc(" ",t.config.name," can't be higher than ",t.config.options.max,"\n")}}function s(t,e){if(1&t&&(n.Qb(0,"p",1),n.wc(1),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.zc(" ",t.config.name," cannot have less than ",t.config.options.minLength," characters\n")}}function l(t,e){if(1&t&&(n.Qb(0,"p",1),n.wc(1),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.zc(" ",t.config.name," cannot have more than ",t.config.options.maxLength," characters\n")}}let d=(()=>{class t{constructor(){}ngOnInit(){}get errors(){return this.control.errors}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-dynamic-validation-errors"]],inputs:{control:"control",config:"config"},decls:5,vars:5,consts:[["class","form-input-hint mb-1",4,"ngIf"],[1,"form-input-hint","mb-1"]],template:function(t,e){1&t&&(n.vc(0,o,2,1,"p",0),n.vc(1,r,2,2,"p",0),n.vc(2,a,2,2,"p",0),n.vc(3,s,2,2,"p",0),n.vc(4,l,2,2,"p",0)),2&t&&(n.ec("ngIf",e.control.invalid&&(e.control.dirty||e.control.touched)&&e.errors.required),n.Ab(1),n.ec("ngIf",e.control.invalid&&(e.control.dirty||e.control.touched)&&e.errors.min),n.Ab(1),n.ec("ngIf",e.control.invalid&&(e.control.dirty||e.control.touched)&&e.errors.max),n.Ab(1),n.ec("ngIf",e.control.invalid&&(e.control.dirty||e.control.touched)&&e.errors.minlength),n.Ab(1),n.ec("ngIf",e.control.invalid&&(e.control.dirty||e.control.touched)&&e.errors.maxlength))},directives:[c.k],styles:[""]}),t})()},"/AKn":function(t,e,i){"use strict";i.d(e,"a",function(){return s});var n=i("fXoL"),c=i("ofXK");let o=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-error-page"]],inputs:{header:"header",text:"text"},decls:6,vars:2,consts:[[1,"container","grid-xl"],[1,"error-container","w-100","d-flex","align-items-center","justify-content-center","flex-col"],[1,"error-code-text","mb-2"],[1,"error-subtitle-text"]],template:function(t,e){1&t&&(n.Qb(0,"div",0),n.Qb(1,"div",1),n.Qb(2,"h1",2),n.wc(3),n.Pb(),n.Qb(4,"p",3),n.wc(5),n.Pb(),n.Pb(),n.Pb()),2&t&&(n.Ab(3),n.xc(e.header),n.Ab(2),n.xc(e.text))},styles:[".error-container[_ngcontent-%COMP%]{background-image:url(https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto/v1552332874/error-background.png);background-repeat:no-repeat;background-position:50%;background-size:contain;height:50vh}.error-code-text[_ngcontent-%COMP%]{font-size:15vw;color:#181819}.error-subtitle-text[_ngcontent-%COMP%]{margin-top:1rem;font-size:3.5vw;font-weight:700;color:#181819;text-align:center}"]}),t})();function r(t,e){if(1&t&&n.Mb(0,"dd-error-page",1),2&t){const t=n.Zb();n.ec("header",t.title)("text",t.text)}}var a=function(t){return t[t.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",t[t.HTTP_404=1]="HTTP_404",t[t.HTTP_403=2]="HTTP_403",t}({});let s=(()=>{class t{constructor(){}ngOnInit(){this.parseError(this.error)}parseError(t){null!=t&&(t.status&&404===t.status?this.errType=a.HTTP_404:t.status&&403===t.status?this.errType=a.HTTP_403:console.log(t))}get title(){switch(this.errType){case a.HTTP_404:return"404";case a.HTTP_403:return"403";case a.UNKNOWN_ERROR:return"Oh Dear";default:return""}}get text(){switch(this.errType){case a.HTTP_404:return"The thing you are looking for appears to be missing";case a.HTTP_403:return"You're not allowed to do whatever it is you are trying to do";case a.UNKNOWN_ERROR:return"Not sure what went wrong here";default:return""}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-http-errors"]],inputs:{error:"error"},decls:1,vars:1,consts:[[3,"header","text",4,"ngIf"],[3,"header","text"]],template:function(t,e){1&t&&n.vc(0,r,1,2,"dd-error-page",0),2&t&&n.ec("ngIf",e.errType)},directives:[c.k,o],styles:[""]}),t})()},"/fvA":function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i("AytR"),c=i("fXoL"),o=i("tk/3"),r=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};let a=(()=>{class t{constructor(t){this.http=t}getConceptType(t){return this.http.get(`${n.a.apiURL}/concepttypes/${t}`).toPromise()}createConceptType(t){return this.http.post(`${n.a.apiURL}/concepttypes`,t).toPromise()}updateConceptType(t){return this.http.put(`${n.a.apiURL}/concepttypes/${t.id}`,t).toPromise()}deleteConceptType(t){return this.http.delete(`${n.a.apiURL}/concepttypes/${t}`).toPromise()}getConcept(t){return this.http.get(`${n.a.apiURL}/concepts/${t}`).toPromise()}getConcepts(t,e,i,c,o,r){null==e||e<=0?e=10:e>50&&(e=50),(null==i||i<0)&&(i=0);let a="";null!=c&&c.trim().length>0&&(a=`&search=${encodeURIComponent(c)}`);let s="";r&&r.forEach(t=>{s+=`&only=${t}`});let l="";return o&&o.forEach(t=>{l+=`&except=${t}`}),this.http.get(`${n.a.apiURL}/concepts?type=${t}&limit=${e}&offset=${i}${a}${s}${l}`).toPromise()}getConceptHistory(t){return this.http.get(`${n.a.apiURL}/concepts/${t}/history`).toPromise()}restoreConcept(t,e){return this.http.post(`${n.a.apiURL}/concepts/${t}/restore/${e}`,null).toPromise()}createConcept(t){return this.http.post(`${n.a.apiURL}/concepts`,Object.assign(Object.assign({},t),{conceptType:void 0})).toPromise()}updateConcept(t){return this.http.put(`${n.a.apiURL}/concepts/${t.id}`,Object.assign(Object.assign({},t),{conceptType:void 0})).toPromise()}deleteConcept(t){return this.http.delete(`${n.a.apiURL}/concepts/${t}`).toPromise()}getConceptEntities(t,e){return r(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/conceptentities?entityId=${t}&conceptTypeId=${e}`).toPromise()})}updateConceptEntity(t){return r(this,void 0,void 0,function*(){return this.http.put(`${n.a.apiURL}/conceptentities`,t).toPromise()})}updateConceptEntities(t,e){return r(this,void 0,void 0,function*(){return this.http.put(`${n.a.apiURL}/conceptentities/multi`,{conceptEntities:t,entityId:e}).toPromise()})}deleteConceptEntity(t,e){return r(this,void 0,void 0,function*(){return this.http.delete(`${n.a.apiURL}/conceptentities/${t}/concept/${e}`).toPromise()})}getArticlesForConcept(t){return r(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/articleconcepts/articles/${t}`).toPromise()})}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(o.b))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},0:function(t,e,i){t.exports=i("zUnb")},"0ezk":function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i("btaL"),c=i("uCWu"),o=i("fXoL");let r=(()=>{class t{constructor(t,e){this.currencyService=t,this.campaignService=e,this.blankValue="nothing"}get sortedLevels(){return this.levels?this.levels.sort((t,e)=>e.value-t.value):[]}get text(){if(!this.currency)return`<span class="currency-text">${this.blankValue}</span>`;let t;return t=!0===this.trackCoins?this.currencyService.mapCoinValues(this.sortedLevels,this.currency.values):this.currencyService.mapCurrencyValues(this.sortedLevels,this.currency.value),0===t.length?`<span class="currency-text">${this.blankValue}</span>`:this.currencyService.getCurrencyHTMLString(t)}get levels(){return this.campaignService.campaign.currencyMap||[{value:1,name:"gp",useInConversions:!0}]}get trackCoins(){return this.campaignService.campaign.trackCoins}}return t.\u0275fac=function(e){return new(e||t)(o.Lb(n.a),o.Lb(c.b))},t.\u0275dir=o.Gb({type:t,selectors:[["","ddCurrency",""]],hostVars:1,hostBindings:function(t,e){2&t&&o.Tb("innerHTML",e.text,o.pc)},inputs:{currency:["ddCurrency","currency"],blankValue:"blankValue"}}),t})()},"8Qhy":function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i("PSD3"),c=i.n(n),o=i("fXoL");let r=(()=>{class t{canDeactivate(t,e,i,n){return o=this,void 0,a=function*(){return!!(yield Promise.resolve(t.canDeactivate()))||!0===(yield c.a.fire({title:"Are you sure?",text:"You have unsaved changes, are you sure you want to leave?",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Yes"})).value},new((r=void 0)||(r=Promise))(function(t,e){function i(t){try{c(a.next(t))}catch(i){e(i)}}function n(t){try{c(a.throw(t))}catch(i){e(i)}}function c(e){var c;e.done?t(e.value):(c=e.value,c instanceof r?c:new r(function(t){t(c)})).then(i,n)}c((a=a.apply(o,[])).next())});var o,r,a}handleUnload(t){return alert("test"),t.returnValue=!1,!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=o.Gb({type:t,hostBindings:function(t,e){1&t&&o.Xb("beforeunload",function(t){return e.handleUnload(t)},!1,o.nc)}}),t.\u0275prov=o.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},AxCL:function(t,e,i){"use strict";i.d(e,"b",function(){return a}),i.d(e,"a",function(){return s}),i.d(e,"d",function(){return l}),i.d(e,"c",function(){return d});var n=i("AytR"),c=i("fXoL"),o=i("tk/3"),r=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};let a=(()=>{class t{constructor(t){this.http=t}updateEntityPreset(t){return r(this,void 0,void 0,function*(){return this.http.put(`${n.a.apiURL}/entitypresets/${t.id}`,t).toPromise()})}createEntityPreset(t){return r(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/entitypresets`,Object.assign(Object.assign({},t),{id:void 0})).toPromise()})}getEntityPreset(t){return r(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/entitypresets/${t}`).toPromise()})}deleteEntityPreset(t,e){return r(this,void 0,void 0,function*(){})}getEntity(t){return r(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/entities/${t}`).toPromise()})}getEntities(t,e=!1){return r(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/entities?campaignId=${t}&spawnable=${e}`).toPromise()})}createEntity(t){return r(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/entities`,Object.assign(Object.assign({},t),{id:void 0,campign:void 0,spawnedFrom:void 0,preset:void 0})).toPromise()})}updateEntity(t){return r(this,void 0,void 0,function*(){return this.http.put(`${n.a.apiURL}/entities/${t.id}`,Object.assign(Object.assign({},t),{campign:void 0,spawnedFrom:void 0,preset:void 0})).toPromise()})}deleteEntity(t){return r(this,void 0,void 0,function*(){return this.http.delete(`${n.a.apiURL}/entities/${t}`).toPromise()})}spawnSpawnable(t,e){return r(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/entities/spawn/${t}?count=${e}`,null).toPromise()})}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(o.b))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var s=function(t){return t[t.MAJOR=0]="MAJOR",t[t.NORMAL=1]="NORMAL",t[t.MINOR=2]="MINOR",t[t.UNIMPORTANT=3]="UNIMPORTANT",t}({}),l=function(t){return t[t.NORMAL=0]="NORMAL",t[t.TEXT_BASED=1]="TEXT_BASED",t}({}),d=function(t){return t[t.DYNAMIC=0]="DYNAMIC",t[t.STATIC=1]="STATIC",t}({})},AytR:function(t,e,i){"use strict";i.d(e,"a",function(){return n});const n={production:!0,auth0Domain:"panch-dd.auth0.com",auth0ClientId:"9vKGU44oDoiGxliIyFL7hjWQQSdmvWEz",apiURL:"https://panch-dd.herokuapp.com/api",hubURL:"https://panch-dd.herokuapp.com/hub",tileURL:"https://d2z1tfzzgmqozf.cloudfront.net/api",gitHash:"REPLACE_GIT_HASH",gitTag:"REPLACE_GIT_TAG",sentryDSN:"https://afdf2c17948049938e2f1d3151093cc1@sentry.io/1378358"}},CYb2:function(t,e,i){"use strict";i.d(e,"a",function(){return c}),i.d(e,"b",function(){return o});var n=i("fXoL");let c=(()=>{class t{constructor(){}load(){const t=localStorage.getItem("action-queue");this._queue=t?JSON.parse(t):[]}save(){if(this._queue){const t={};this._queue=this._queue.filter(e=>void 0===t[e.type]&&(t[e.type]=!0,!0)),localStorage.setItem("action-queue",JSON.stringify(this._queue))}}get queue(){return this.load(),this._queue}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var o=function(t){return t[t.ACCOUNT_SETUP=0]="ACCOUNT_SETUP",t[t.INVITE=1]="INVITE",t[t.REDIRECT=2]="REDIRECT",t}({})},DwCd:function(t,e,i){"use strict";i.d(e,"a",function(){return n});var n=function(t){return t[t.STRING=0]="STRING",t[t.INT=1]="INT",t[t.FLOAT=2]="FLOAT",t[t.ENUM=3]="ENUM",t[t.ENUM_MULTI=4]="ENUM_MULTI",t[t.TEXT_FORMATTED=5]="TEXT_FORMATTED",t[t.CURRENCY=6]="CURRENCY",t[t.BOOLEAN=7]="BOOLEAN",t}({})},EA6F:function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("ofXK"),c=i("fXoL");let o=(()=>{class t{}return t.\u0275mod=c.Jb({type:t}),t.\u0275inj=c.Ib({factory:function(e){return new(e||t)},imports:[[n.b]]}),t})()},HRrE:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var n=i("3Pt+"),c=i("fXoL"),o=i("ofXK");const r=["input"];function a(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",7),c.wc(1),c.Qb(2,"a",8),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb().removeTag(i)}),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(1),c.yc(" ",t," ")}}let s=(()=>{class t{constructor(){this.controlName="tags",this._currentValue="",this._previousValue=""}ngOnInit(){this.formGroup.contains(this.controlName)||this.formGroup.addControl(this.controlName,new n.c([]))}removeTag(t){const e=this.formArray.value.indexOf(t);-1!==e&&(this.formArray.removeAt(e),this.formGroup.markAsDirty())}onInputEvent(t){switch(t.key){case"Enter":this._currentValue.trim().length>0&&-1===this.formArray.value.indexOf(this._currentValue.trim())&&(this.formArray.push(new n.e(this._currentValue.trim())),this.formGroup.markAsDirty(),this.input.nativeElement.value="",this._previousValue=this._currentValue.trim(),this._currentValue="");break;case"Backspace":if(""===this._currentValue&&""===this._previousValue&&this.formArray.length>0){console.log(this._previousValue);const t=this.formArray.controls[this.formArray.controls.length-1];this.formArray.removeAt(this.formArray.length-1),this.formGroup.markAsDirty(),this.input.nativeElement.value=t.value,this._previousValue=this._currentValue.trim(),this._currentValue=t.value}else this._previousValue=""}}onInputChanged(t){this._previousValue=this._currentValue,this._currentValue=t.target.value}get formArray(){return this.formGroup.get(this.controlName)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-tag-editor"]],viewQuery:function(t,e){if(1&t&&c.Ac(r,3),2&t){let t;c.lc(t=c.Yb())&&(e.input=t.first)}},inputs:{formGroup:"formGroup",controlName:"controlName"},decls:8,vars:1,consts:[[1,"form-group"],[1,"form-autocomplete"],[1,"form-autocomplete-input","form-input"],["class","chip",4,"ngFor","ngForOf"],["type","text","name","tag","id","tag",1,"form-input",3,"input","keyup"],["input",""],[1,"form-input-hint","mb-0"],[1,"chip"],["aria-label","Close","role","button",1,"btn","btn-clear",3,"click"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"div",2),c.vc(3,a,3,1,"div",3),c.Qb(4,"input",4,5),c.Xb("input",function(t){return e.onInputChanged(t)})("keyup",function(t){return e.onInputEvent(t)}),c.Pb(),c.Pb(),c.Pb(),c.Qb(6,"p",6),c.wc(7,"Type some text and hit enter to add a tag"),c.Pb(),c.Pb()),2&t&&(c.Ab(3),c.ec("ngForOf",e.formArray.value))},directives:[o.j],styles:[""]}),t})()},HboH:function(t,e,i){"use strict";i.r(e),i.d(e,"MappingModule",function(){return Nt});var n=i("ofXK"),c=i("tyNb"),o=i("AytR"),r=i("fXoL"),a=i("tk/3");let s=(()=>{class t{constructor(t){this.http=t}getMaps(t,e=10,i=0,n){let c="";return n&&(c=`&search=${encodeURIComponent(n)}`),this.http.get(`${o.a.apiURL}/maps?campaignId=${t}&limit=${e}&offset=${i}${c}`).toPromise()}getMap(t){return this.http.get(`${o.a.apiURL}/maps/${t}`).toPromise()}deleteMap(t){return this.http.delete(`${o.a.apiURL}/maps/${t}`).toPromise()}updateMap(t){return this.http.put(`${o.a.apiURL}/maps/${t.id}`,t).toPromise()}}return t.\u0275fac=function(e){return new(e||t)(r.Ub(a.b))},t.\u0275prov=r.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var l=function(t){return t[t.POLYLINE=0]="POLYLINE",t[t.CIRCLE=1]="CIRCLE",t[t.MARKER=2]="MARKER",t[t.POLYGON=3]="POLYGON",t[t.RECTANGLE=4]="RECTANGLE",t}({}),d=i("uCWu"),u=i("PSD3"),b=i.n(u),p=i("y4Wg"),h=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function m(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",7),r.Qb(1,"button",8),r.Xb("click",function(){return r.oc(t),r.Zb().newMap()}),r.Mb(2,"i",9),r.Qb(3,"span",10),r.wc(4," New Map"),r.Pb(),r.Pb(),r.Pb()}}function g(t,e){1&t&&r.Mb(0,"div",11)}function f(t,e){1&t&&(r.Qb(0,"p",18),r.wc(1," Click the button to create one. "),r.Pb())}function v(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",19),r.Qb(1,"button",20),r.Xb("click",function(){return r.oc(t),r.Zb(2).newMap()}),r.wc(2,"New Map"),r.Pb(),r.Pb()}}function y(t,e){if(1&t&&(r.Qb(0,"div",12),r.Qb(1,"div",13),r.Mb(2,"i",14),r.Pb(),r.Qb(3,"p",15),r.wc(4,"There are no maps"),r.Pb(),r.vc(5,f,2,0,"p",16),r.vc(6,v,3,0,"div",17),r.Pb()),2&t){const t=r.Zb();r.Ab(5),r.ec("ngIf",t.editable),r.Ab(1),r.ec("ngIf",t.editable)}}function P(t,e){if(1&t&&(r.Qb(0,"div",2),r.Qb(1,"h5",28),r.wc(2),r.Pb(),r.Pb()),2&t){const t=r.Zb().$implicit;r.Ab(2),r.yc("",t.name," (Processing)")}}function w(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",29),r.Xb("click",function(){r.oc(t);const e=r.Zb().$implicit;return r.Zb(2).selectMap(e)}),r.Qb(1,"h5"),r.wc(2),r.Pb(),r.Pb()}if(2&t){const t=r.Zb().$implicit;r.Ab(2),r.xc(t.name)}}function I(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",7),r.Qb(1,"button",30),r.Xb("click",function(){r.oc(t);const e=r.Zb().$implicit;return r.Zb(2).delete(e)}),r.Mb(2,"i",31),r.Qb(3,"span",10),r.wc(4," Delete"),r.Pb(),r.Pb(),r.Qb(5,"button",32),r.Mb(6,"i",33),r.Qb(7,"span",10),r.wc(8," Edit"),r.Pb(),r.Pb(),r.Pb()}}const C=function(t){return{hoverable:t}};function Q(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",23),r.Qb(1,"div",1),r.Qb(2,"div",24),r.Xb("click",function(){r.oc(t);const i=e.$implicit;return r.Zb(2).selectMap(i)}),r.Mb(3,"img",25),r.Pb(),r.vc(4,P,3,1,"div",26),r.vc(5,w,3,1,"div",27),r.vc(6,I,9,0,"div",3),r.Pb(),r.Pb()}if(2&t){const t=e.$implicit,i=r.Zb(2);r.ec("ngClass",r.ic(4,C,1===t.status)),r.Ab(4),r.ec("ngIf",0===t.status),r.Ab(1),r.ec("ngIf",1===t.status),r.Ab(1),r.ec("ngIf",i.editable)}}function A(t,e){if(1&t){const t=r.Rb();r.Qb(0,"dd-paginator",34),r.Xb("pageChange",function(e){return r.oc(t),r.Zb(2).page=e}),r.Pb()}if(2&t){const t=r.Zb(2);r.ec("totalItems",t.totalMaps)("autoHide",!1)("page",t.page)}}function k(t,e){if(1&t&&(r.Qb(0,"div"),r.vc(1,Q,7,6,"div",21),r.vc(2,A,1,3,"dd-paginator",22),r.Pb()),2&t){const t=r.Zb();r.Ab(1),r.ec("ngForOf",t.maps),r.Ab(1),r.ec("ngIf",t.maps&&t.maps.length>0)}}let x=(()=>{class t{constructor(t,e,i){this.mapService=t,this.campaignService=e,this.router=i,this.loading=!1,this.page=1}ngOnInit(){this.load()}load(){return h(this,void 0,void 0,function*(){this.loading=!0;try{const t=yield this.mapService.getMaps(this.campaignService.campaign.id,10,10*(this.page-1));this.maps=t.maps,this.totalMaps=t.total}catch(t){throw t}this.loading=!1})}selectMap(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",t.id])}newMap(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps","upload"])}delete(t){return h(this,void 0,void 0,function*(){if(!0===(yield b.a.fire({title:"Are you sure?",showCancelButton:!0})).value)try{yield this.mapService.deleteMap(t.id),this.load()}catch(e){throw e}})}setPage(t){this.page=t,this.load()}get editable(){return this.campaignService.canEdit}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(s),r.Lb(d.b),r.Lb(c.c))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-map-manager"]],decls:9,vars:4,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],["class","column col-auto",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty",4,"ngIf"],[4,"ngIf"],[1,"column","col-auto"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"loading","loading-lg"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],["class","empty-action",4,"ngIf"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["class","card p-2 mb-2",3,"ngClass",4,"ngFor","ngForOf"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange",4,"ngIf"],[1,"card","p-2","mb-2",3,"ngClass"],[1,"column","col-auto",3,"click"],["width","32","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/map-default","alt","Map Fallback Picture",1,"s-rounded"],["class","column",4,"ngIf"],["class","column",3,"click",4,"ngIf"],[1,"text-gray"],[1,"column",3,"click"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"icon","icon-delete"],["disabled","",1,"btn","btn-sm"],[1,"icon","icon-edit"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange"]],template:function(t,e){1&t&&(r.Qb(0,"div",0),r.Qb(1,"div",1),r.Qb(2,"div",2),r.Qb(3,"h3"),r.wc(4,"Maps"),r.Pb(),r.Pb(),r.vc(5,m,5,0,"div",3),r.Pb(),r.vc(6,g,1,0,"div",4),r.vc(7,y,7,2,"div",5),r.vc(8,k,3,2,"div",6),r.Pb()),2&t&&(r.Ab(5),r.ec("ngIf",e.editable),r.Ab(1),r.ec("ngIf",e.loading),r.Ab(1),r.ec("ngIf",e.maps&&0===e.maps.length),r.Ab(1),r.ec("ngIf",e.maps))},directives:[n.k,n.j,n.i,p.a],styles:[""]}),t})();var T=i("edGd"),E=i("3Pt+");function L(t,e){1&t&&(r.Qb(0,"p",10),r.wc(1," A name is required "),r.Pb())}function M(t,e){if(1&t&&(r.Qb(0,"p",10),r.wc(1),r.Pb()),2&t){const t=r.Zb(2);r.Ab(1),r.yc(" ",t.fileError," ")}}const S=function(t){return{"has-error":t}};function O(t,e){if(1&t){const t=r.Rb();r.Qb(0,"form",3),r.Xb("ngSubmit",function(){return r.oc(t),r.Zb().submit()}),r.Qb(1,"div",4),r.Mb(2,"input",5),r.vc(3,L,2,0,"p",6),r.Pb(),r.Qb(4,"div",4),r.Qb(5,"label",7),r.wc(6,"Choose Image"),r.Pb(),r.Qb(7,"input",8),r.Xb("change",function(e){return r.oc(t),r.Zb().onFileChange(e)}),r.Pb(),r.vc(8,M,2,1,"p",6),r.Pb(),r.Qb(9,"button",9),r.wc(10,"Upload"),r.Pb(),r.Pb()}if(2&t){const t=r.Zb();r.ec("formGroup",t.formGroup),r.Ab(1),r.ec("ngClass",r.ic(5,S,t.name.invalid&&(t.name.touched||t.name.dirty))),r.Ab(2),r.ec("ngIf",t.name.invalid&&(t.name.touched||t.name.dirty)&&t.name.errors.required),r.Ab(1),r.ec("ngClass",r.ic(7,S,t.fileControl.invalid&&(t.fileControl.touched||t.fileControl.dirty)||null!==t.fileError)),r.Ab(4),r.ec("ngIf",null!==t.fileError)}}function N(t,e){1&t&&(r.Qb(0,"h5"),r.wc(1,"Uploading Map"),r.Pb())}function _(t,e){1&t&&(r.Qb(0,"h5"),r.wc(1,"Getting Ready"),r.Pb())}function R(t,e){if(1&t&&r.Mb(0,"progress",13),2&t){const t=r.Zb(2);r.ec("value",t.uploadProgress)}}function F(t,e){1&t&&r.Mb(0,"progress",14)}function U(t,e){if(1&t&&(r.Qb(0,"div"),r.vc(1,N,2,0,"h5",2),r.vc(2,_,2,0,"h5",2),r.vc(3,R,1,1,"progress",11),r.vc(4,F,1,0,"progress",12),r.Pb()),2&t){const t=r.Zb();r.Ab(1),r.ec("ngIf",t.uploadProgress<100),r.Ab(1),r.ec("ngIf",100===t.uploadProgress),r.Ab(1),r.ec("ngIf",t.uploadProgress<100),r.Ab(1),r.ec("ngIf",100===t.uploadProgress)}}function q(t,e){1&t&&(r.Qb(0,"div"),r.Qb(1,"h5"),r.wc(2,"Your map is processing!"),r.Pb(),r.Qb(3,"p"),r.wc(4," You will receive a notification when it is ready "),r.Pb(),r.Pb())}let G=(()=>{class t{constructor(t,e,i){this.campaignService=t,this.loginService=e,this.router=i,this.fileError=null,this.isUploading=!1,this.mapId=null}ngOnInit(){this.formGroup=new E.h({name:new E.e(null,[E.v.required]),file:new E.e(null,[E.v.required])})}viewMap(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",this.mapId])}onFileChange(t){this.fileError=null;const e=t.target.files;e.length>0&&(this.file=e[0],this.file.size>5e7?this.fileError="Size cannot exceed 50mb":-1===["image/png","image/jpg","image/jpeg"].indexOf(this.file.type)&&(this.fileError="Image file must be a .png or a .jpg"))}submit(){this.formGroup.invalid||this.handleFileUpload(this.file)}handleFileUpload(t){if(this.fileError=null,this.uploadProgress=null,!t.type.startsWith("image/"))return void(this.fileError="Incorrect file type! Only images are accepted");this.file=t;const e=new FormData;e.append("file",this.file),e.append("name",this.name.value),this.campaignService.campaign&&e.append("campaignId",this.campaignService.campaign.id);const i=new XMLHttpRequest;i.open("POST",`${o.a.apiURL}/maps`,!0),i.setRequestHeader("Authorization",`Bearer ${this.loginService.token}`),i.onload=t=>{const e=JSON.parse(i.responseText);this.mapId=e.id,this.isUploading=!1,this.file=null},i.upload.addEventListener("progress",t=>{this.uploadProgress=t.loaded/t.total*100}),this.isUploading=!0,i.send(e)}get fileControl(){return this.formGroup.get("file")}get name(){return this.formGroup.get("name")}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(d.b),r.Lb(T.a),r.Lb(c.c))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-map-upload"]],decls:8,vars:3,consts:[[1,"container","grid-xl"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"form-group",3,"ngClass"],["type","text","name","name","id","name","formControlName","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],["for","map-upload",1,"form-label"],["type","file","accept","image/*","name","map-upload","formControlName","file",1,"form-input",3,"change"],[1,"btn","btn-primary","mt-2"],[1,"form-input-hint"],["class","progress","max","100",3,"value",4,"ngIf"],["class","progress","max","100",4,"ngIf"],["max","100",1,"progress",3,"value"],["max","100",1,"progress"]],template:function(t,e){1&t&&(r.Qb(0,"div",0),r.Qb(1,"h3"),r.wc(2,"Create Map"),r.Pb(),r.Qb(3,"p"),r.wc(4," A map can be any .png or .jpg image. Maps can be up to 30,000px wide, and 30,000px tall. The image file can be up to 50mb. "),r.Pb(),r.vc(5,O,11,9,"form",1),r.vc(6,U,5,4,"div",2),r.vc(7,q,5,0,"div",2),r.Pb()),2&t&&(r.Ab(5),r.ec("ngIf",!e.isUploading&&!e.mapId),r.Ab(1),r.ec("ngIf",e.isUploading),r.Ab(1),r.ec("ngIf",e.mapId))},directives:[n.k,E.x,E.n,E.i,n.i,E.b,E.m,E.g],styles:[""]}),t})();var D=i("4R65"),Z=i.n(D),$=i("ygrl");const X=["modal"];function H(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",3),r.Xb("click",function(){return r.oc(t),r.Zb().updateEntityPosition()}),r.wc(1," Put me Here "),r.Pb()}}function j(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",3),r.Xb("click",function(){return r.oc(t),r.Zb().linkArticle()}),r.wc(1," Link Article "),r.Pb()}}var V=function(t){return t[t.NONE=0]="NONE",t[t.PLACE_NOTE=1]="PLACE_NOTE",t[t.UPDATE_ENTITY_POSITION=2]="UPDATE_ENTITY_POSITION",t[t.LINK_ARTICLE=3]="LINK_ARTICLE",t[t.PLACE_SHAPELY_NOTE=4]="PLACE_SHAPELY_NOTE",t}({});let z=(()=>{class t{constructor(t){this.campaignService=t}ngOnInit(){}showMenu(){const t=new Promise((t,e)=>{this._opResolver=t});return this.modal.open().then(()=>{this._opResolver&&this._opResolver(null)}),t}placeNote(){this._opResolver({type:V.PLACE_NOTE}),this.modal.close(null)}placeShapelyNote(){this._opResolver({type:V.PLACE_SHAPELY_NOTE}),this.modal.close(null)}updateEntityPosition(){this._opResolver({type:V.UPDATE_ENTITY_POSITION}),this.modal.close(null)}linkArticle(){this._opResolver({type:V.LINK_ARTICLE}),this.modal.close(null)}get canUpdateEntityPosition(){return this.campaignService.editableEntities.length>0}get campaignEditable(){return this.campaignService.canEdit}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(d.b))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-map-editor-menu"]],viewQuery:function(t,e){if(1&t&&r.Ac(X,3),2&t){let t;r.lc(t=r.Yb())&&(e.modal=t.first)}},decls:12,vars:2,consts:[["modal",""],["modal-header",""],["modal-body",""],[1,"card","p-2","hoverable","mb-2",3,"click"],["class","card p-2 hoverable mb-2",3,"click",4,"ngIf"]],template:function(t,e){1&t&&(r.Qb(0,"dd-modal",null,0),r.Qb(2,"div",1),r.Qb(3,"span"),r.wc(4,"Map Editor"),r.Pb(),r.Pb(),r.Qb(5,"div",2),r.Qb(6,"div",3),r.Xb("click",function(){return e.placeNote()}),r.wc(7,"Make Note"),r.Pb(),r.Qb(8,"div",3),r.Xb("click",function(){return e.placeShapelyNote()}),r.wc(9," Make Shapely Note "),r.Pb(),r.vc(10,H,2,0,"div",4),r.vc(11,j,2,0,"div",4),r.Pb(),r.Pb()),2&t&&(r.Ab(10),r.ec("ngIf",e.canUpdateEntityPosition),r.Ab(1),r.ec("ngIf",e.campaignEditable))},directives:[$.a,n.k],styles:["[_nghost-%COMP%]{z-index:400}"]}),t})();var B=i("a8fi"),Y=i("pLZG"),W=i("AxCL"),K=i("dtdw"),J=(i("INa4"),i("W/nz")),tt=i("qcJQ");function et(t,e){if(1&t&&(r.Qb(0,"span"),r.wc(1),r.Pb()),2&t){const t=r.Zb();r.Ab(1),r.yc(" LV ",t.level,"")}}function it(t,e){1&t&&(r.Qb(0,"span",16),r.wc(1," \u2022 "),r.Pb())}function nt(t,e){if(1&t&&(r.Qb(0,"div",17),r.Mb(1,"dd-health-display",18),r.Pb()),2&t){const t=r.Zb();r.Ab(1),r.ec("editable",!1)("health",t.entity.health)("preset",t.entity.preset.health)("mini",!0)}}const ct=function(t){return{loading:t}};let ot=(()=>{class t{constructor(t,e,i,n){this.campaignService=t,this.login=e,this.router=i,this.entityService=n,this.removing=!1}ngOnInit(){}viewMore(){this.router.navigate(["campaigns",this.entity.campaignId,"entities",this.entity.id])}removeFromMap(){return t=this,void 0,i=function*(){this.removing=!0;try{yield this.entityService.updateEntity(Object.assign(Object.assign({},this.entity),{mapId:null,lat:null,lng:null}))}catch(t){throw t}this.removing=!1},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}get editable(){return this.entity.userId===this.login.id||this.campaignService.canEdit}get level(){return this.entity&&this.entity.preset&&this.entity.preset.isXPEnabled?this.campaignService.calculateLevel(this.entity.xp):null}get user(){return this.campaignService.campaign.members.find(t=>t.userId===this.entity.userId).user}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(d.b),r.Lb(T.a),r.Lb(c.c),r.Lb(W.b))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-entity-view-mini"]],inputs:{entity:"entity"},decls:22,vars:11,consts:[[3,"src","alt"],[1,"columns"],[1,"column"],[1,"mt-0","mb-1"],[1,"column","text-right"],[4,"ngIf"],["class","text-gray",4,"ngIf"],[1,"text-italic"],["class","mb-2",4,"ngIf"],[1,"column","col-auto","mt-auto"],[3,"ddUser"],[1,"column","col-auto","col-ml-auto"],["data-tooltip","Remove from map",1,"btn","btn-sm","btn-error","mr-1","tooltip",3,"ngClass","click"],[1,"icon","icon-cross"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-arrow-right"],[1,"text-gray"],[1,"mb-2"],[3,"editable","health","preset","mini"]],template:function(t,e){1&t&&(r.Qb(0,"div"),r.Qb(1,"div"),r.Mb(2,"img",0),r.Pb(),r.Qb(3,"div",1),r.Qb(4,"div",2),r.Qb(5,"h5",3),r.wc(6),r.Pb(),r.Pb(),r.Qb(7,"div",4),r.vc(8,et,2,1,"span",5),r.vc(9,it,2,0,"span",6),r.Qb(10,"span",7),r.wc(11),r.Pb(),r.Pb(),r.Pb(),r.vc(12,nt,2,4,"div",8),r.Qb(13,"div",1),r.Qb(14,"div",9),r.Mb(15,"div",10),r.Pb(),r.Qb(16,"div",11),r.Qb(17,"button",12),r.Xb("click",function(){return e.removeFromMap()}),r.Mb(18,"i",13),r.Pb(),r.Qb(19,"button",14),r.Xb("click",function(){return e.viewMore()}),r.wc(20,"More "),r.Mb(21,"i",15),r.Pb(),r.Pb(),r.Pb(),r.Pb()),2&t&&(r.Ab(2),r.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/bo_1px_solid_rgb:000000,c_lfill,g_faces:auto,h_20,r_0,w_250/",e.entity.imageId,"",r.qc),r.gc("alt","Picture Of ",e.entity.name,""),r.Ab(4),r.xc(e.entity.name),r.Ab(2),r.ec("ngIf",e.entity.preset.isXPEnabled),r.Ab(1),r.ec("ngIf",e.entity.preset.isXPEnabled),r.Ab(2),r.xc(e.entity.preset.name),r.Ab(1),r.ec("ngIf",e.entity.preset.isHealthEnabled),r.Ab(3),r.ec("ddUser",e.user),r.Ab(2),r.ec("ngClass",r.ic(9,ct,e.removing)))},directives:[n.k,J.a,n.i,tt.a],styles:[""]}),t})();var rt=i("rZgH"),at=i("MICr"),st=i("n10a"),lt=i("Pqmk"),dt=i("WNRK");function ut(t,e){if(1&t&&(r.Qb(0,"div",8),r.Qb(1,"figure",9),r.Mb(2,"img",10),r.Pb(),r.Pb()),2&t){const t=r.Zb();r.Ab(2),r.ec("src",t.user.pictureURL,r.qc)}}function bt(t,e){if(1&t&&(r.Qb(0,"div",11),r.Qb(1,"span"),r.wc(2),r.Pb(),r.Pb()),2&t){const t=r.Zb();r.Ab(2),r.xc(t.user.username)}}function pt(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",12),r.Qb(1,"a",13),r.Xb("click",function(){return r.oc(t),r.Zb().edit()}),r.wc(2,"Edit"),r.Pb(),r.Pb()}}let ht=(()=>{class t{constructor(t,e,i){this.campaignService=t,this.login=e,this.noteService=i}ngOnInit(){this.noteService.noteUpdate.pipe(Object(Y.a)(t=>this.note&&t.id===this.note.id)).subscribe(t=>{this.note=t})}edit(){this.noteService.editNote(this.note)}get user(){if(!this.note)return null;if(this.note.user)return this.note.user;const t=this.campaignService.campaign.members.find(t=>t.userId===this.note.userId);return t&&t.user?t.user:void 0}get editable(){return this.note.userId===this.login.id||this.note.publicEdit}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(d.b),r.Lb(T.a),r.Lb(B.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-note-view-mini"]],inputs:{note:"note"},decls:9,vars:4,consts:[["readOnly","true",3,"value"],[1,"columns"],[1,"column"],[1,"columns","col-gapless","mt-2"],["class","column col-auto pr-1 d-flex align-items-center",4,"ngIf"],["class","column d-flex align-items-center",4,"ngIf"],[1,"column","col-auto","col-ml-auto"],["class","mt-2",4,"ngIf"],[1,"column","col-auto","pr-1","d-flex","align-items-center"],[1,"avatar","avatar-xs"],["alt","User Image",3,"src"],[1,"column","d-flex","align-items-center"],[1,"mt-2"],[1,"c-hand",3,"click"]],template:function(t,e){1&t&&(r.Qb(0,"div"),r.Mb(1,"dd-quill",0),r.Qb(2,"div",1),r.Qb(3,"div",2),r.Qb(4,"div",3),r.vc(5,ut,3,1,"div",4),r.vc(6,bt,3,1,"div",5),r.Pb(),r.Pb(),r.Qb(7,"div",6),r.vc(8,pt,3,0,"div",7),r.Pb(),r.Pb(),r.Pb()),2&t&&(r.Ab(1),r.ec("value",e.note.content),r.Ab(4),r.ec("ngIf",e.user),r.Ab(1),r.ec("ngIf",e.user),r.Ab(2),r.ec("ngIf",e.editable))},directives:[dt.a,n.k],styles:[".note-display[_ngcontent-%COMP%]{white-space:pre-line}"]}),t})();var mt=i("5eHb"),gt=i("S36L");function ft(t,e){1&t&&r.Mb(0,"div",6)}let vt=(()=>{class t{constructor(t,e){this.location=t,this.notificationService=e}ngOnInit(){}back(){this.location.back()}suggest(){this.notificationService.suggestCurrentURL()}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(n.g),r.Lb(gt.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-map-toolbar"]],inputs:{title:"title",loading:"loading"},decls:8,vars:2,consts:[[1,"card","p-1","mt-2"],[1,"btn","btn-link","btn-sm",3,"click"],[1,"icon","icon-arrow-left"],[1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-share"],["class","loading",4,"ngIf"],[1,"loading"]],template:function(t,e){1&t&&(r.Qb(0,"div",0),r.Qb(1,"div"),r.Qb(2,"button",1),r.Xb("click",function(){return e.back()}),r.Mb(3,"i",2),r.Pb(),r.Qb(4,"button",3),r.Xb("click",function(){return e.suggest()}),r.Mb(5,"i",4),r.Pb(),r.wc(6),r.vc(7,ft,1,0,"div",5),r.Pb(),r.Pb()),2&t&&(r.Ab(6),r.yc(" ",e.title," "),r.Ab(1),r.ec("ngIf",e.loading))},directives:[n.k],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:0;right:0;margin:0 auto;width:128px;height:64px;z-index:350}"]}),t})();var yt=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const Pt=["map"],wt=["editor"],It=["entityselect"],Ct=["articleselect"];function Qt(t,e){1&t&&(r.Qb(0,"div",16),r.wc(1," Click the button below to create a new article "),r.Pb())}function At(t,e){if(1&t&&r.Mb(0,"dd-map-toolbar",17),2&t){const t=r.Zb();r.ec("title",t.mapObj.name)("loading",t.loading)}}function kt(t,e){1&t&&r.Mb(0,"div",18)}const xt=Z.a.icon({iconUrl:"/assets/note-icon.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-20]}),Tt=Z.a.icon({iconUrl:"/assets/note-icon-2.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[0,-20]});let Et;const Lt=[{path:"",component:x},{path:"upload",component:G},{path:":m_id",component:(()=>{class t{constructor(t,e,i,n,c,o,r,a,s,l,d,u){this.route=t,this.router=e,this.mapService=i,this.campaignService=n,this.noteService=c,this.login=o,this.entityService=r,this.componentService=a,this.updateHub=s,this.toast=l,this.articleService=d,this.iconService=u,this._entityLayerGroups={},this._entityComponents=[],this._noteComponents=[],this.loading=!1,this.loadSelectItems=t=>this.getArticleSelectionList(t)}ngAfterViewInit(){this._noteCreateSubscription=this.noteService.noteCreate.pipe(Object(Y.a)(t=>t.mapId===this._map.id)).subscribe(t=>{this.addNoteToMap(t)}),this._noteDeleteSubscription=this.noteService.noteDelete.pipe(Object(Y.a)(t=>t.mapId===this._map.id)).subscribe(t=>{for(const e of[...this._notesLayerGroup.getLayers(),...this._shapelyNotesLayerGroup.getLayers()])if(e._noteId===t.id){const t=e._noteComponent;this._noteComponents=this._noteComponents.filter(e=>e!==t),t.destroy(),this._notesLayerGroup.removeLayer(e),this._shapelyNotesLayerGroup.removeLayer(e)}}),this._noteUpdateSubscription=this.noteService.noteUpdate.pipe(Object(Y.a)(t=>t.mapId===this._map.id)).subscribe(t=>{void 0===[...this._notesLayerGroup.getLayers(),...this._shapelyNotesLayerGroup.getLayers()].find(e=>e._noteId===t.id)&&this.addNoteToMap(t)}),this._entityUpdateSubscription=this.updateHub.entityUpdated.subscribe(t=>{if(t.mapId===this._map.id){if(!this._entityLayerGroups[t.preset.name])return void this.addEntityToMap(t);const e=this._entityLayerGroups[t.preset.name].getLayers().find(e=>e._entity.id===t.id);e?(e.setLatLng([t.lat,t.lng]),e._entityComponent.instance.entity=t):this.addEntityToMap(t)}else this.removeEntityFromMap(t)}),this._articleUpdateSubscription=this.updateHub.articleUpdated.subscribe(t=>{t.mapId===this._map.id?this.addArticleToMap(t):this.removeArticleFromMap(t)}),this._articleDeleteSubscription=this.updateHub.articleDeleted.pipe(Object(Y.a)(t=>t.mapId===this._map.id)).subscribe(t=>{this.removeArticleFromMap(t)}),this.route.paramMap.subscribe(t=>{(this._map&&this._map.id!==t.get("m_id")||!this._map)&&this.loadMap(t.get("m_id"))})}ngOnDestroy(){for(const t of this._noteComponents)t.destroy();for(const t of this._entityComponents)t.destroy();this._noteCreateSubscription&&this._noteCreateSubscription.unsubscribe(),this._noteDeleteSubscription&&this._noteDeleteSubscription.unsubscribe(),this._noteUpdateSubscription&&this._noteUpdateSubscription.unsubscribe(),this._entityUpdateSubscription&&this._entityUpdateSubscription.unsubscribe(),this._articleUpdateSubscription&&this._articleUpdateSubscription.unsubscribe(),this._articleDeleteSubscription&&this._articleDeleteSubscription.unsubscribe()}loadMap(t){return yt(this,void 0,void 0,function*(){this.loading=!0,yield this.load(t),this.constructMap(),this.createNotesLayer(),this.createArticlesLayer(),yield this.loadNotes(t),yield this.loadArticles(),this.loading=!1;for(const t of this.campaignService.campaign.entities)if(t.mapId===this._map.id&&t.lat&&t.lng){const e=this.route.snapshot.queryParamMap.get("entity");this.addEntityToMap(t,t.id===e)}})}loadArticles(){return yt(this,void 0,void 0,function*(){try{this._articles=yield this.articleService.getMapArticles(this._map.id)}catch(t){throw t}if(this._articles){const t=this.route.snapshot.queryParamMap.get("article");for(const e of this._articles)this.addArticleToMap(e,e.id===t)}})}load(t){return yt(this,void 0,void 0,function*(){try{this._map=yield this.mapService.getMap(t)}catch(e){throw e}})}loadNotes(t){return yt(this,void 0,void 0,function*(){try{this._notes=yield this.noteService.getNotes(this.campaignService.campaign.id,{mapId:t})}catch(e){throw e}})}constructMap(){Et=Z.a.map(this.map.nativeElement,{crs:Z.a.CRS.Simple,maxBounds:[[0,0],[-256,256]],zoomSnap:.5});const t=this.route.snapshot.queryParamMap,e=t.get("zoom"),i=t.get("lat"),n=t.get("lng");null==e||isNaN(e)?Et.setZoom(1):Et.setZoom(e),null===i||null===n||void 0===i||void 0===n||isNaN(i)||isNaN(n)?Et.fitBounds([[-10,10],[-246,246]]):Et.setView({lat:i,lng:n},e||this._map.maxZoom),Et.on("contextmenu",t=>{this.editor.showMenu().then(e=>{null!=e&&this.handleEditorOperation(e,t)})}),Et.on("zoomend",()=>{this.writeMapStateToURL(Et)}),Et.on("moveend",()=>{this.writeMapStateToURL(Et)});const c=Z.a.tileLayer(`${o.a.tileURL}/maps/{id}/tile/{z}/{x}/{y}`,{maxZoom:this._map.maxZoom+2,minZoom:this._map.minZoom,minNativeZoom:1,maxNativeZoom:this._map.maxZoom,bounds:[[0,0],[-256,256]],id:this._map.id}).addTo(Et);this._mapLayerControl=Z.a.control.layers().addTo(Et),this._mapLayerControl.addBaseLayer(c,"Base")}writeMapStateToURL(t){this.router.navigate([],{replaceUrl:!0,queryParams:{zoom:t.getZoom(),lat:t.getCenter().lat,lng:t.getCenter().lng}})}addArticleToMap(t,e=!1){const i=this._articlesLayerGroup.getLayers();for(const n of i)if(n._article&&n._article.id===t.id)return n._article=t,n.setLatLng([t.lat,t.lng]),void(n._articleComponent.instance.article=t);if(t.lat&&t.lng){const i=Z.a.marker([t.lat,t.lng]);i.setIcon(Z.a.icon(null!=t.icon?{iconUrl:this.iconService.getIconSrc(t.icon),iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20]}:{iconUrl:"/assets/position-marker.png",iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]})),i._article=t,this._articlesLayerGroup.addLayer(i);const n=Z.a.popup({minWidth:150});n.setContent(this.createArticlePopupContent(t)),i.bindPopup(n),e&&i.openPopup()}}createArticlePopupContent(t){const e=document.createElement("div"),i=document.createElement("h5");i.innerText=t.name,e.appendChild(i);const n=document.createElement("button");return n.classList.add("btn","btn-sm"),n.innerText="More",n.addEventListener("click",()=>{this.router.navigate(["campaigns",this.campaignService.campaign.id,"articles",t.id])}),e.appendChild(n),e}removeArticleFromMap(t){const e=this._articlesLayerGroup.getLayers();for(const i of e)i._article&&i._article.id===t.id&&this._articlesLayerGroup.removeLayer(i)}getDrawnShape(){if(void 0!==this._drawControls)throw new Error("Cannot have multiple draw controls!");return new Promise((t,e)=>{this._drawControls=new Z.a.Control.Draw({position:"topleft",draw:{polygon:{allowIntersection:!1,drawError:{color:"#e1e100",message:"<strong>Oh snap!<strong> you can't draw that!"}},circlemarker:!1,marker:!1},edit:!1}),Et.addControl(this._drawControls),Et.on("draw:created",e=>{this._drawControls&&(Et.removeControl(this._drawControls),this._drawControls=void 0);const i=e.layer;if(i instanceof Z.a.Circle)t({type:l.CIRCLE,lat:i.getLatLng().lat,lng:i.getLatLng().lng,radius:i.getRadius()});else if(i instanceof Z.a.Rectangle){const e=i.getLatLngs()[0];t({type:l.RECTANGLE,points:e.map(t=>[t.lat,t.lng])})}else i instanceof Z.a.Polygon?t({type:l.POLYGON,points:i.getLatLngs()[0].map(t=>[t.lat,t.lng])}):i instanceof Z.a.Polyline&&t({type:l.POLYLINE,points:i.getLatLngs().map(t=>[t.lat,t.lng])})})})}createNotesLayer(){this._notesLayerGroup=Z.a.layerGroup(),this._notesLayerGroup.addTo(Et),this._mapLayerControl.addOverlay(this._notesLayerGroup,"Notes"),this._shapelyNotesLayerGroup=Z.a.layerGroup(),this._shapelyNotesLayerGroup.addTo(Et),this._mapLayerControl.addOverlay(this._shapelyNotesLayerGroup,"Shapely Notes")}createArticlesLayer(){this._articlesLayerGroup=Z.a.layerGroup(),this._articlesLayerGroup.addTo(Et),this._mapLayerControl.addOverlay(this._articlesLayerGroup,"Articles")}createEntityLayer(t){const e=Z.a.layerGroup();this._entityLayerGroups[t]=e,e.addTo(Et),this._mapLayerControl.addOverlay(e,t)}addNoteToMap(t){if(t.mapShape){let e;const i=t.mapShape;switch(i.type){case l.CIRCLE:e=Z.a.circle([i.lat,i.lng],{radius:i.radius});break;case l.POLYGON:e=Z.a.polygon(i.points);break;case l.POLYLINE:e=Z.a.polyline(i.points);break;case l.RECTANGLE:e=Z.a.rectangle(i.points)}e._noteId=t.id;const n=this.componentService.getComponent(ht);n.instance.note=t,this._noteComponents.push(n),e._noteComponent=n;const c=Z.a.popup({minWidth:150});c.setContent(this.componentService.getRootNode(n)),e.bindPopup(c),this._shapelyNotesLayerGroup.addLayer(e)}else if(t.lat&&t.lng){const e=Z.a.marker([t.lat,t.lng],{icon:t.userId===this.login.id?xt:Tt});e._noteId=t.id;const i=this.componentService.getComponent(ht);i.instance.note=t,this._noteComponents.push(i),e._noteComponent=i;const n=Z.a.popup({minWidth:150});n.setContent(this.componentService.getRootNode(i)),e.bindPopup(n),this._notesLayerGroup.addLayer(e)}}addEntityToMap(t,e=!1){if(t.lat&&t.lng){const i=Z.a.marker([t.lat,t.lng],{icon:Z.a.icon({iconUrl:`https://res.cloudinary.com/dqhk8k6iv/image/upload/bo_2px_solid_rgb:303742,c_lfill,g_faces:auto,h_40,r_20,w_40,f_png/${t.imageId}.png`,iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20]})});i._entity=t;const n=this.componentService.getComponent(ot);n.instance.entity=t,this._entityComponents.push(n),i._entityComponent=n,this._entityLayerGroups[t.preset.name]||this.createEntityLayer(t.preset.name),this._entityLayerGroups[t.preset.name].addLayer(i);const c=Z.a.popup({minWidth:250});c.setContent(this.componentService.getRootNode(n)),i.bindPopup(c),e&&i.openPopup()}}removeEntityFromMap(t){if(this._entityLayerGroups[t.preset.name]){const e=this._entityLayerGroups[t.preset.name].getLayers().find(e=>e._entity.id===t.id);e&&(this._entityLayerGroups[t.preset.name].removeLayer(e),this._entityComponents=this._entityComponents.filter(t=>t!==e._entityComponent),e._entityComponent.destroy())}}handleEditorOperation(t,e){return yt(this,void 0,void 0,function*(){switch(t.type){case V.PLACE_NOTE:this.noteService.addNote({type:B.b.MAP,mapId:this._map.id,lat:e.latlng.lat,lng:e.latlng.lng});break;case V.UPDATE_ENTITY_POSITION:const t=this.campaignService.editableEntities;let i;if(1===t.length)i=t[0];else{const t=this.campaignService.editableEntities.slice().filter(t=>!1===t.spawnable),e=yield this.entitySelect.openSelector(t.map(t=>({value:t,displayHtml:t.name})));e&&(i=e.value)}i&&(yield this.entityService.updateEntity(Object.assign(Object.assign({},i),{user:void 0,preset:void 0,spawnedFrom:void 0,mapId:this._map.id,lat:e.latlng.lat,lng:e.latlng.lng})),this.toast.info(`Updated ${i.name}'s position`));break;case V.LINK_ARTICLE:const n=yield this.articleSelect.openSelector();if("create-new-article"===n.value.id){const t=yield this.articleService.createArticle({name:n.value.name,content:null,campaignId:this.campaignService.campaign.id,userId:"fake",published:!1,tags:["TODO"],mapId:this._map.id,lat:e.latlng.lat,lng:e.latlng.lng});this.addArticleToMap(t),this.toast.info(`Created and linked article ${t.name}`)}else{const t=yield this.articleService.getArticle(n.value.id);null!==n&&(yield this.articleService.updateArticle(Object.assign(Object.assign({},t),{mapId:this._map.id,lat:e.latlng.lat,lng:e.latlng.lng})),this.toast.info(`Linked article ${n.value.name}`))}break;case V.PLACE_SHAPELY_NOTE:const c=yield this.getDrawnShape();null!==c&&this.noteService.addNote({type:B.b.MAP,mapId:this._map.id,lat:e.latlng.lat,lng:e.latlng.lng,mapShape:c})}})}getArticleSelectionList(t){return yt(this,void 0,void 0,function*(){const e=(yield this.articleService.getArticles(this.campaignService.campaign.id,6,0,t)).map(t=>({value:t,displayHtml:t.name}));return t&&t.trim().length>2&&e.length>0&&e.push({displayHtml:`<span><i class="icon icon-plus"></i> ${t}</span>`,value:{id:"create-new-article",name:t}}),e})}createNewArticle(t){return yt(this,void 0,void 0,function*(){const e=yield this.articleService.createArticle({name:t,content:null,campaignId:this.campaignService.campaign.id,userId:"fake",published:!1,tags:["TODO"]});this.articleSelect.select({displayHtml:"",value:e})})}get notes(){return this._notes}set notes(t){this._notes=t}get editable(){return this.campaignService.canEdit}get mapObj(){return this._map}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(c.a),r.Lb(c.c),r.Lb(s),r.Lb(d.b),r.Lb(B.a),r.Lb(T.a),r.Lb(W.b),r.Lb(st.a),r.Lb(K.b),r.Lb(mt.b),r.Lb(rt.a),r.Lb(at.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-map"]],viewQuery:function(t,e){if(1&t&&(r.Ac(Pt,3),r.Ac(wt,3),r.Ac(It,3),r.Ac(Ct,3)),2&t){let t;r.lc(t=r.Yb())&&(e.map=t.first),r.lc(t=r.Yb())&&(e.editor=t.first),r.lc(t=r.Yb())&&(e.entitySelect=t.first),r.lc(t=r.Yb())&&(e.articleSelect=t.first)}},decls:20,vars:6,consts:[[3,"searchable","loadSelectItems"],["articleselect",""],["empty",""],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["entityselect",""],[1,"map-container"],[3,"title","loading",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["editor",""],[1,"map"],["map",""],[1,"empty-subtitle"],[3,"title","loading"],[1,"loading","loading-lg"]],template:function(t,e){if(1&t){const t=r.Rb();r.Qb(0,"dd-selector-popup",0,1),r.Qb(2,"div",2),r.Qb(3,"div",3),r.Mb(4,"i",4),r.Pb(),r.Qb(5,"div",5),r.wc(6,"There's nothing here"),r.Pb(),r.vc(7,Qt,2,0,"div",6),r.Qb(8,"div",7),r.Qb(9,"button",8),r.Xb("click",function(){r.oc(t);const i=r.mc(1);return e.createNewArticle(i.search)}),r.wc(10),r.Pb(),r.Pb(),r.Pb(),r.Pb(),r.Mb(11,"dd-selector-popup",null,9),r.Qb(13,"div",10),r.vc(14,At,1,2,"dd-map-toolbar",11),r.vc(15,kt,1,0,"div",12),r.Mb(16,"dd-map-editor-menu",null,13),r.Mb(18,"div",14,15),r.Pb()}if(2&t){const t=r.mc(1),i=r.mc(19);r.ec("searchable",!0)("loadSelectItems",e.loadSelectItems),r.Ab(7),r.ec("ngIf",e.editable),r.Ab(3),r.yc("Create ",t.search,""),r.Ab(4),r.ec("ngIf",e.mapObj),r.Ab(1),r.ec("ngIf",!i)}},directives:[lt.a,n.k,z,vt],styles:[".map[_ngcontent-%COMP%]{z-index:100;height:100%}.map-container[_ngcontent-%COMP%]{top:0;left:0;position:fixed;z-index:300;background-color:#fff;height:100vh;width:100vw}"]}),t})()}];let Mt=(()=>{class t{}return t.\u0275mod=r.Jb({type:t}),t.\u0275inj=r.Ib({factory:function(e){return new(e||t)},imports:[[c.f.forChild(Lt)],c.f]}),t})();var St=i("wC5x"),Ot=i("zrcO");let Nt=(()=>{class t{}return t.\u0275mod=r.Jb({type:t}),t.\u0275inj=r.Ib({factory:function(e){return new(e||t)},imports:[[n.b,Mt,St.a,E.s,Ot.UsersModule]]}),t})()},Kjs6:function(t,e,i){"use strict";i.d(e,"a",function(){return b});var n=i("a8fi"),c=i("uCWu"),o=i("edGd"),r=i("fXoL"),a=i("ofXK"),s=i("W/nz");function l(t,e){1&t&&(r.Qb(0,"div",9),r.Mb(1,"i",10),r.Pb())}function d(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",2),r.Xb("click",function(){r.oc(t);const i=e.$implicit;return r.Zb(2).noteSelected(i)}),r.Qb(1,"div",3),r.Qb(2,"div",4),r.wc(3),r.Pb(),r.Qb(4,"div",5),r.Mb(5,"div",6),r.Pb(),r.Qb(6,"div",7),r.Mb(7,"div",6),r.Pb(),r.vc(8,l,2,0,"div",8),r.Pb(),r.Pb()}if(2&t){const t=e.$implicit,i=r.Zb(2);r.Ab(3),r.xc(t.title),r.Ab(2),r.ec("ddUser",i.user(t.userId)),r.Ab(2),r.ec("ddUser",i.user(t.userId)),r.Ab(1),r.ec("ngIf",t.publicEdit)}}function u(t,e){if(1&t&&(r.Qb(0,"div"),r.vc(1,d,9,4,"div",1),r.Pb()),2&t){const t=r.Zb();r.Ab(1),r.ec("ngForOf",t.notes)}}let b=(()=>{class t{constructor(t,e,i){this.noteService=t,this.campaignService=e,this.loginService=i}ngOnInit(){}noteSelected(t){this.noteService.editNote(t)}isEditable(t){return t.userId===this.loginService.id||t.publicEdit}user(t){return this.campaignService.getUser(t).user}}return t.\u0275fac=function(e){return new(e||t)(r.Lb(n.a),r.Lb(c.b),r.Lb(o.a))},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-note-list"]],inputs:{notes:"notes"},decls:1,vars:1,consts:[[4,"ngIf"],["class","card mb-1 p-1 hoverable",3,"click",4,"ngFor","ngForOf"],[1,"card","mb-1","p-1","hoverable",3,"click"],[1,"columns","col-gapless"],[1,"column"],[1,"column","col-auto","text-gray","text-italic","text-right","hide-sm"],[3,"ddUser"],[1,"column","text-gray","text-italic","show-sm","col-12"],["class","column col-auto d-flex align-items-center ml-1",4,"ngIf"],[1,"column","col-auto","d-flex","align-items-center","ml-1"],[1,"icon","icon-edit"]],template:function(t,e){1&t&&r.vc(0,u,2,1,"div",0),2&t&&r.ec("ngIf",e.notes)},directives:[a.k,a.j,s.a],styles:[""]}),t})()},MICr:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var n=i("fXoL");let c=(()=>{class t{constructor(){this.srcPrefix="/assets/article-icons/",this.srcPostfix=".png",this.icons=["hanging-sign","mushroom-gills","pointy-sword","round-bottom-flask","shirt","virtual-marker","falling-leaf","brutal-helm","graduate-cap","uncertainty","hazard-sign","drakkar","pig","sharp-shuriken","swap-bag","radar-sweep","ship-wheel","coffee-cup","cheese-wedge","cancel","donut","grave-flowers","mustache","imperial-crown","magick-trick","barrel"]}getIcons(){return this.icons.map(t=>({id:t,src:this.getIconSrc(t)}))}getIconSrc(t){return`${this.srcPrefix}${t}${this.srcPostfix}`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},Pqmk:function(t,e,i){"use strict";i.d(e,"a",function(){return m});var n=i("3Pt+"),c=i("ygrl"),o=i("Kj3r"),r=i("fXoL"),a=i("ofXK");const s=["modal"];function l(t,e){1&t&&r.Mb(0,"i",9)}function d(t,e){if(1&t&&(r.Qb(0,"div",6),r.Mb(1,"input",7),r.vc(2,l,1,0,"i",8),r.Pb()),2&t){const t=r.Zb();r.Ab(1),r.ec("formControl",t.searchControl),r.Ab(1),r.ec("ngIf",t.loading)}}function u(t,e){if(1&t){const t=r.Rb();r.Qb(0,"div",10),r.Xb("click",function(){r.oc(t);const i=e.$implicit;return r.Zb().select(i)}),r.Pb()}2&t&&r.ec("innerHTML",e.$implicit.displayHtml,r.pc)}function b(t,e){1&t&&(r.Qb(0,"div",11),r.cc(1),r.Pb())}const p=[[["","empty",""]]],h=["[empty]"];let m=(()=>{class t{constructor(){this.title="Pick One!",this.loading=!1}ngOnInit(){this.searchControl=new n.e(null),this.searchControl.valueChanges.pipe(Object(o.a)(250)).subscribe(t=>{this.search=t,this.load()}),this.selectItems||this.load()}load(){return t=this,void 0,i=function*(){if(this.loading=!0,this.loadSelectItems){try{this.selectItems=yield this.loadSelectItems(this.search)}catch(t){throw t}this.loading=!1}else console.warn("No function provided to load select items")},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}select(t){this._selectResolver?this._selectResolver(t):console.warn("Item was selected but no resolver was present");try{this.modal.close(null)}catch(e){}}openSelector(t){return this.selectItems=t,this.searchControl.setValue(null),this.selectItems||(this.search="",this.load()),this.modal.open().then(()=>{this._selectResolver&&(this._selectResolver(null),this._selectResolver=void 0)}),new Promise(t=>{this._selectResolver=t})}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-selector-popup"]],viewQuery:function(t,e){if(1&t&&r.Ac(s,3),2&t){let t;r.lc(t=r.Yb())&&(e.modal=t.first)}},inputs:{searchable:"searchable",title:"title",loadSelectItems:"loadSelectItems"},ngContentSelectors:h,decls:8,vars:4,consts:[["modal",""],["modal-header",""],["modal-body",""],["class","has-icon-right mb-1",4,"ngIf"],["class","card p-1 hoverable mb-1",3,"innerHTML","click",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"has-icon-right","mb-1"],["type","text","placeholder","Search",1,"form-input",3,"formControl"],["class","form-icon loading",4,"ngIf"],[1,"form-icon","loading"],[1,"card","p-1","hoverable","mb-1",3,"innerHTML","click"],[1,"empty"]],template:function(t,e){1&t&&(r.dc(p),r.Qb(0,"dd-modal",null,0),r.Qb(2,"h5",1),r.wc(3),r.Pb(),r.Qb(4,"div",2),r.vc(5,d,3,2,"div",3),r.vc(6,u,1,1,"div",4),r.vc(7,b,2,0,"div",5),r.Pb(),r.Pb()),2&t&&(r.Ab(3),r.yc(" ",e.title," "),r.Ab(2),r.ec("ngIf",e.searchable),r.Ab(1),r.ec("ngForOf",e.selectItems),r.Ab(1),r.ec("ngIf",e.selectItems&&0===e.selectItems.length))},directives:[c.a,a.k,a.j,n.b,n.m,n.f],styles:[""]}),t})()},S36L:function(t,e,i){"use strict";i.d(e,"a",function(){return b});var n=i("uCWu"),c=i("AytR"),o=i("edGd"),r=i("dtdw"),a=i("fXoL"),s=i("tk/3"),l=i("5eHb"),d=i("tyNb"),u=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};let b=(()=>{class t{constructor(t,e,i,n,c,r){this.http=t,this.toast=e,this.router=c,this.campignService=r,this._loading=!1,i.loginStatus.subscribe(t=>{t===o.b.LOGGED_IN&&this.loadNotifications()}),n.notificationUpdate.subscribe(()=>{this.loadNotifications()}),i.isLoggedIn&&this.loadNotifications()}getNewNotifications(t,e){let i=[];if(t)for(const n of e)void 0===t.find(t=>t.id===n.id)&&i.push(n);else i=e;return i}makeNotificationToasts(t){for(const e of t)if(e.suggestionURL){let t,i;this.campignService.campaign&&(t=this.campignService.campaign.members.find(t=>t.userId===e.suggestedById)),i=t&&t.user?`${t.user.username} suggested something! ${e.message}`:`A suggestion was made. ${e.message}`,this.toast.info(i).onTap.subscribe(()=>{this.router.navigateByUrl(e.suggestionURL),this.removeNotification(e)})}else this.toast.info(e.message)}loadNotifications(){return u(this,void 0,void 0,function*(){this._loading=!0;try{const t=yield this.getNotifications(),e=this.getNewNotifications(this._notifications,t);this._notifications=t,this.makeNotificationToasts(e)}catch(t){throw t}this._loading=!1})}removeNotification(t){return u(this,void 0,void 0,function*(){this._notifications=this._notifications.filter(e=>t!==e);try{yield this.deleteNotification(t.id)}catch(e){throw e}})}clearAll(){return u(this,void 0,void 0,function*(){return this._notifications=[],this.http.delete(`${c.a.apiURL}/notifications/clearall`).toPromise()})}getNotifications(){return this.http.get(`${c.a.apiURL}/notifications`).toPromise()}deleteNotification(t){return this.http.delete(`${c.a.apiURL}/notifications/${t}`).toPromise()}makeSuggestion(t){return this.http.post(`${c.a.apiURL}/notifications/suggest`,t).toPromise()}suggestCurrentURL(){if(this.campignService.campaign)return this.makeSuggestion({url:this.router.url,message:"Look!",campaignId:this.campignService.campaign.id})}get notifications(){return this._notifications}get loading(){return this._loading}}return t.\u0275fac=function(e){return new(e||t)(a.Ub(s.b),a.Ub(l.b),a.Ub(o.a),a.Ub(r.b),a.Ub(d.c),a.Ub(n.b))},t.\u0275prov=a.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"W/nz":function(t,e,i){"use strict";i.d(e,"a",function(){return o});var n=i("fXoL"),c=i("jhN1");let o=(()=>{class t{constructor(t){this.sanitize=t}static buildHTML(t){return t?`<div class="columns col-gapless">\n      <div class="column col-auto mr-1 d-flex align-items-center">\n        <figure class="avatar avatar-xs">\n          <img src="${t.pictureURL}" alt="avatar" />\n        </figure>\n      </div>\n      <div class="column col-auto">${t.username}</div>\n    </div>`:""}get html(){return this.user?this.sanitize.bypassSecurityTrustHtml(`<div class="columns col-gapless">\n      <div class="column col-auto mr-1 d-flex align-items-center">\n        <figure class="avatar avatar-xs">\n          <img src="${this.user.pictureURL}" alt="avatar" />\n        </figure>\n      </div>\n      <div class="column col-auto">${this.user.username}</div>\n    </div>`):""}}return t.\u0275fac=function(e){return new(e||t)(n.Lb(c.b))},t.\u0275dir=n.Gb({type:t,selectors:[["","ddUser",""]],hostVars:1,hostBindings:function(t,e){2&t&&n.Tb("innerHTML",e.html,n.pc)},inputs:{user:["ddUser","user"]}}),t})()},WNRK:function(t,e,i){"use strict";i.d(e,"a",function(){return E});var n=i("fXoL"),c=i("kzlf"),o=i.n(c),r=i("3Pt+"),a=i("PSD3"),s=i.n(a),l=i("sSWQ"),d=i("AytR"),u=i("nmfD"),b=i("uCWu"),p=i("rZgH"),h=i("edGd"),m=i("tk/3");let g=(()=>{class t{constructor(t,e){this.campaignService=t,this.http=e}search(t){return this.http.get(`${d.a.apiURL}/search?campaignId=${this.campaignService.campaign.id}&search=${encodeURIComponent(t)}`).toPromise()}}return t.\u0275fac=function(e){return new(e||t)(n.Ub(b.b),n.Ub(m.b))},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=function(t){return t[t.ENTITY=0]="ENTITY",t[t.LEGACY_SPELL=1]="LEGACY_SPELL",t[t.LEGACY_ITEM=2]="LEGACY_ITEM",t[t.ARTICLE=3]="ARTICLE",t[t.MAP=4]="MAP",t[t.QUEST=5]="QUEST",t[t.USER=6]="USER",t[t.CONCEPT=7]="CONCEPT",t}({}),v=i("n10a"),y=i("MICr"),P=i("xCX2"),w=i.n(P),I=i("BSgo"),C=i("El1G"),Q=i("X607"),A=i.n(Q),k=i("tyNb"),x=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const T=["container"];o.a.register("modules/blotFormatter",w.a),o.a.register("modules/mention",I.a),o.a.register("modules/imageUploader",C.a),o.a.register("modules/cursors",A.a);let E=(()=>{class t{constructor(t,e,i,c,o,r,a,s){this.campaignService=t,this.articleService=e,this.login=i,this.router=c,this.http=o,this.searchService=r,this.componentService=a,this.iconService=s,this.textChange=new n.n,this.selectionChange=new n.n,this._cursorCollection={},this._writeQueue=[]}set value(t){this.writeValue(t)}ngOnInit(){}ngAfterContentInit(){if(this.readOnly)this._container.nativeElement.classList.add("ql-editor"),this._container.nativeElement.classList.add("p-0");else{for(this._quill=new o.a(this._container.nativeElement,this.getQuillSettings()),this._cursors=this._quill.getModule("cursors"),this._quill.on("text-change",(t,e,i)=>{if(("user"===i||"api"===i)&&this._onChange){const e=this._quill.getContents();e.ops&&e.ops.length>0&&"\n"!==e.ops[0].insert?(this._onChange(e),this.textChange.emit(t)):this._onChange(null)}}),this._quill.on("selection-change",(t,e,i)=>{"user"!==i&&"api"!==i||!this._onTouched||(this._onTouched(),this.selectionChange.emit(t))});this._writeQueue.length>0;)this.writeValue(this._writeQueue.pop());this.cursorUpdates&&this.cursorUpdates.subscribe(t=>{if(!this._cursorCollection[t.id]&&t.range){const e=new u.Chance(t.id);this._cursorCollection[t.id]=this._cursors.createCursor(t.id,t.displayName,e.color({format:"hex"}))}t.range?this._cursors.moveCursor(t.id,t.range):this._cursorCollection[t.id]&&this._cursors.removeCursor(t.id)}),this.deltaUpdates&&this.deltaUpdates.subscribe(t=>{this._quill&&this._quill.updateContents(t.ops,"colab")}),this._selectionUpdateInterval=setInterval(()=>{this.selectionChange.emit(this._quill.getSelection())},1500)}}writeValue(t){if(this._quill||this.readOnly)if(this.readOnly){if(null==t)return;this.renderQuillHTML(t).then(t=>{this._container.nativeElement.innerHTML=t,setTimeout(()=>{this.setupMentions(),this.setupImages()},1)})}else this._quill.setContents(null!=t?t.ops:[],"form");else this._writeQueue.push(t)}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){}getEntityPreset(t){return this.campaignService.campaign.entityPresets.find(e=>e.id===t)}getQuillSettings(){const t={placeholder:this.placeholder,modules:{blotFormatter:{},toolbar:[["bold","italic","underline","strike"],["blockquote","code-block","image","link"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],["clean"]],mention:{mentionDenotationChars:["@"],allowedChars:/^[A-Za-z0-9\s'_\-"]*$/,source:(t,e,i)=>x(this,void 0,void 0,function*(){const i=(yield this.searchService.search(t)).map(t=>{switch(t.type){case f.ARTICLE:return{id:t.article.id,value:t.article.name,obj:t.article,type:t.type};case f.ENTITY:return{id:t.entity.id,value:t.entity.name,obj:t.entity,type:t.type};case f.MAP:return{id:t.map.id,value:t.map.name,obj:t.map,type:t.type};case f.QUEST:return{id:t.quest.id,value:t.quest.name,obj:t.quest,type:t.type};case f.USER:return{id:t.user.id,value:t.user.username,obj:t.user,type:t.type};case f.CONCEPT:return{id:t.concept.id,value:t.concept.name,concepttypeid:t.concept.conceptTypeId,obj:t.concept,type:t.type}}});t.trim().length>=3&&this.campaignService.canEdit&&i.push({id:"create-empty-article",value:t,type:"create-article"}),e(i)}),renderItem:(t,e)=>{let i="<div>";function n(t){return`<span class="label">${t}</span>`}switch(t.type){case f.ARTICLE:i+=`<span><i class="icon icon-bookmark"></i> ${t.obj.name} ${t.obj.published?"":n("Hidden")}</span>`;break;case f.ENTITY:const e=this.getEntityPreset(t.obj.entityPresetId);i+=e&&e.imageId?`<span><img width="16" src="https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/${e.imageId}"> ${t.obj.name}</span>`:`<span><i class="icon icon-emoji"></i> ${t.obj.name}</span>`;break;case f.MAP:i+=`<span><i class="icon icon-location"></i> ${t.obj.name} ${t.obj.playerVisible?"":n("Hidden")}</span>`;break;case f.QUEST:i+=`<span><i class="icon icon-flag"></i> ${t.obj.name} ${t.obj.visible?"":" "+n("Hidden")}${t.obj.visible?"":" "+n("Unavailable")}</span>`;break;case f.USER:i+=`<span><i class="icon icon-people"></i> ${t.obj.username}</span>`;break;case f.CONCEPT:i+=t.obj.conceptType&&t.obj.conceptType.icon?`<span><img width="16" src="${this.iconService.getIconSrc(t.obj.conceptType.icon)}"> ${t.obj.name}</span>`:`<span>${t.obj.name}</span>`;break;case"create-article":i+=`<span><i class="icon icon-plus"></i> ${t.value}</span>`}return i+="</div>",i},onSelect:(t,e)=>x(this,void 0,void 0,function*(){switch(t.type){case f.ARTICLE:case f.ENTITY:case f.MAP:case f.QUEST:t.value=t.value.name;break;case f.USER:t.value=t.value.username;break;case f.CONCEPT:t.value=t.value.name,t.concepttypeid=t.value.concepttypeid;break;case"create-article":if(!0===(yield s.a.fire({title:"Create new article?",text:`A new article with the name ${t.value} will be created`,showCancelButton:!0})).value){const i=yield this.articleService.createArticle({name:t.value.trim(),published:!1,campaignId:this.campaignService.campaign.id,userId:this.login.id,tags:["ToDo"],content:{}});t.id=i.id,t.type=f.ARTICLE,e(t)}return}e(t)}),showDenotationChar:!1,listItemClass:"menu-item",mentionListClass:"menu",dataAttributes:["id","value","type","concepttypeid"]}},readOnly:this.readOnly};return this.readOnly?(t.modules.toolbar=!1,t.modules.theme=void 0,t.modules.mention=!1):(t.theme="snow",t.modules.cursors=!0,this.simple?t.modules.toolbar=[["bold","italic","underline","strike",{list:"ordered"},{list:"bullet"},"blockquote"]]:t.modules.imageUploader={upload:t=>x(this,void 0,void 0,function*(){const e=new FormData;return e.append("file",t),e.append("campaignId",this.campaignService.campaign.id),(yield this.http.post(`${d.a.apiURL}/upload`,e).toPromise()).secure_url})}),t}renderQuillHTML(t){return new Promise((e,i)=>{const n=document.createElement("div");new o.a(n,this.getQuillSettings()).setContents(t.ops),setTimeout(()=>{e(n.firstChild.innerHTML)},1)})}setupMentions(){this._container.nativeElement.querySelectorAll(`[data-type="${f.ARTICLE}"]`).forEach(t=>{const e=t.dataset.id;t.addEventListener("click",()=>{this.router.navigate(["campaigns",this.campaignService.campaign.id,"articles",e])})}),this._container.nativeElement.querySelectorAll(`[data-type="${f.ENTITY}"]`).forEach(t=>{const e=t.dataset.id;t.addEventListener("click",()=>{this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",e])})}),this._container.nativeElement.querySelectorAll(`[data-type="${f.CONCEPT}"]`).forEach(t=>{const e=t.dataset.id,i=t.dataset.concepttypeid;t.addEventListener("click",()=>{this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",i,e,"view"])})}),this._container.nativeElement.querySelectorAll(`[data-type="${f.MAP}"]`).forEach(t=>{const e=t.dataset.id;t.addEventListener("click",()=>{this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",e])})}),this._container.nativeElement.querySelectorAll(`[data-type="${f.QUEST}"]`).forEach(t=>{const e=t.dataset.id;t.addEventListener("click",()=>{this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",e])})}),this._container.nativeElement.querySelectorAll(`[data-type="${f.USER}"]`).forEach(t=>{const e=t.dataset.id,i=this.campaignService.campaign.members.find(t=>t.userId===e);i&&new l.a(t,{trigger:"click hover",html:!0,title:"Top",placement:"top-end",template:'<div class="tooltip-on-top card" role="tooltip">\n          <div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',popperOptions:{placement:"top-end",modifiers:{flip:{behavior:["bottom","top","left","right"]},preventOverflow:{boundariesElement:document.getElementById("app-content")}}}}).updateTitleContent(`<div class="p-1"><h5>${i.user.username}</h5></div>`)})}setupImages(){this._container.nativeElement.querySelectorAll("img").forEach(t=>{t.classList.add("img-responsive")})}}return t.\u0275fac=function(e){return new(e||t)(n.Lb(b.b),n.Lb(p.a),n.Lb(h.a),n.Lb(k.c),n.Lb(m.b),n.Lb(g),n.Lb(v.a),n.Lb(y.a))},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-quill"]],viewQuery:function(t,e){if(1&t&&n.Ac(T,3),2&t){let t;n.lc(t=n.Yb())&&(e._container=t.first)}},inputs:{readOnly:"readOnly",simple:"simple",placeholder:"placeholder",value:"value",cursorUpdates:"cursorUpdates",deltaUpdates:"deltaUpdates"},outputs:{textChange:"textChange",selectionChange:"selectionChange"},features:[n.zb([{provide:r.l,useExisting:Object(n.U)(()=>t),multi:!0}])],decls:3,vars:0,consts:[["container",""]],template:function(t,e){1&t&&(n.Qb(0,"div"),n.Mb(1,"div",null,0),n.Pb())},styles:[""]}),t})()},a8fi:function(t,e,i){"use strict";i.d(e,"a",function(){return a}),i.d(e,"b",function(){return s});var n=i("fXoL"),c=i("AytR"),o=i("edGd"),r=i("tk/3");let a=(()=>{class t{constructor(t,e){this.http=t,this.login=e,this._noteUpdate=new n.n,this._noteCreate=new n.n,this._noteDelete=new n.n,this.clearNoteCache()}setNoteEditor(t){this._noteEditor=t}addNote(t){this._noteEditor.addNote(t)}editNote(t){this._noteEditor.editNote(t)}clearNoteCache(){if(this._noteCache)for(const t of this._noteCache)this._noteDelete.emit(t);this._noteCache=[]}getQuestNotes(t){return this._noteCache.filter(e=>e.questId===t)}getMapNotes(t){return this._noteCache.filter(e=>e.mapId===t)}getArticleNotes(t){return this._noteCache.filter(e=>e.articleId===t)}getNotes(t,e){let i=`?campaignId=${t}`;return e.questId&&(i+=`&questId=${e.questId}`),e.mapId&&(i+=`&mapId=${e.mapId}`),e.articleId&&(i+=`&articleId=${e.articleId}`),this.http.get(`${c.a.apiURL}/notes${i}`).toPromise().then(t=>(this.addOrUpdateCacheNotes(t),t))}getNote(t){return this.http.get(`${c.a.apiURL}/notes/${t}`).toPromise().then(t=>(this.addOrUpdateCacheNotes([t]),t))}createNote(t){return this.http.post(`${c.a.apiURL}/notes`,t).toPromise().then(t=>(this.addOrUpdateCacheNotes([t]),t))}updateNote(t){return this.http.put(`${c.a.apiURL}/notes/${t.id}`,t).toPromise().then(()=>{this.addOrUpdateCacheNotes([t])})}deleteNote(t){return this.http.delete(`${c.a.apiURL}/notes/${t}`).toPromise().then(()=>{this.removeNoteFromCache(t)})}addOrUpdateCacheNotes(t){for(const e of t){const t=this._noteCache.find(t=>t.id===e.id);void 0!==t?e.userId!==this.login.id&&!1===e.publicView?this.removeNoteFromCache(e.id):(Object.assign(t,e),this._noteUpdate.emit(t)):(this._noteCache.push(Object.assign({},e)),this._noteCreate.emit(e))}}removeNoteFromCache(t){this._noteCache=this._noteCache.filter(e=>e.id!==t||(this._noteDelete.emit(e),!1))}get noteDelete(){return this._noteDelete}get noteCreate(){return this._noteCreate}get noteUpdate(){return this._noteUpdate}}return t.\u0275fac=function(e){return new(e||t)(n.Ub(r.b),n.Ub(o.a))},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var s=function(t){return t[t.QUEST=0]="QUEST",t[t.MAP=1]="MAP",t[t.ARTICLE=2]="ARTICLE",t}({})},btaL:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var n=i("fXoL");let c=(()=>{class t{constructor(){}mapCurrencyValues(t,e){null==t&&(t=[{value:1,name:"gp",useInConversions:!0}]),null==e?e=0:e*=100;const i=t.filter(t=>t.useInConversions).map(t=>Object.assign(Object.assign({},t),{value:100*t.value})).sort((t,e)=>e.value-t.value),n=[];for(const c of i){const t=Math.round(e-e%c.value)/c.value;if(t>0&&n.push({name:c.name,amount:t}),(e-=t*c.value)<=0)break}return n}mapCoinValues(t,e){e||(e={}),null==t&&(t=[{value:1,name:"gp",useInConversions:!0}]);const i=t.map(t=>Object.assign(Object.assign({},t),{value:100*t.value})).sort((t,e)=>e.value-t.value),n=[];for(const c of i){const t=e[c.name];t&&n.push({name:c.name,amount:t})}return n}hasResources(t,e,i,n){if(null==t||null==e)return!1;if(!n)return null!=t.value&&t.value>=e.value;if(null==t.values||null==e.values)return!1;const c=this.getTotalValue(i,e,n);return this.getTotalValue(i,t,n)>=c}getTotalValue(t,e,i){if(i){let i=0;e.values||(e.values={});for(const n of t)e.values[n.name]&&(i+=e.values[n.name]*n.value);return i}return e.value}subtract(t,e,i){if(i){t.values||(t.values={}),e.values||(e.values={});const i={value:null,values:{}};for(const n of Object.keys(e))i.values[n]=t.values[n]?t.values[n]-e.values[n]:-e.values[n];return i}return{value:t.value-e.value,values:null}}getCurrencyString(t){return t.map(t=>`${t.amount}${t.name}`).join(" ")}getCurrencyHTMLString(t){return t.map(t=>`${t.amount}<span class="currency-text">${t.name}</span>`).join(" ")}get defaultCurrencyMap(){return[{name:"gp",value:1,useInConversions:!0}]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},dtdw:function(t,e,i){"use strict";i.d(e,"a",function(){return d}),i.d(e,"b",function(){return u});var n=i("fXoL"),c=i("Gpoy"),o=i("AytR"),r=i("edGd"),a=i("a8fi"),s=i("5eHb"),l=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})},d=function(t){return t[t.NOT_CONNECTED=0]="NOT_CONNECTED",t[t.CONNECTED=1]="CONNECTED",t[t.CLOSED=2]="CLOSED",t[t.CONNECTING=3]="CONNECTING",t[t.AUTHENTICATING=4]="AUTHENTICATING",t}({});let u=(()=>{class t{constructor(t,e,i){this.login=t,this.noteService=e,this.toastr=i,this.entityUpdated=new n.n,this.entityCreated=new n.n,this.entityDeleted=new n.n,this.campaignUpdated=new n.n,this.campaignRefresh=new n.n,this.articleCreated=new n.n,this.articleUpdated=new n.n,this.articleDeleted=new n.n,this.cursorUpdate=new n.n,this.noteDeltaUpdate=new n.n,this.stateUpdate=new n.n,this.conceptEntityUpdate=new n.n,this.conceptEntityDelete=new n.n,this.conceptArticleUpdate=new n.n,this.conceptArticleDelete=new n.n,this.overviewStateUpdate=new n.n,this.notificationUpdate=new n.n,this._state=d.NOT_CONNECTED,this.stateUpdate.emit(this._state),this.login.loginStatus.subscribe(t=>{t===r.b.LOGGED_IN?this.start():t===r.b.NOT_LOGGED_IN&&this.stop()}),this.login.isLoggedIn&&this.start()}setup(){return l(this,void 0,void 0,function*(){this.connection.onclose(t=>{this._state!==d.NOT_CONNECTED&&(this._state=d.CLOSED,this.stateUpdate.emit(this._state),this.start())}),this.connection.on("AuthenticateComplete",()=>this.authComplete()),this.connection.on("CampaignUpdate",t=>this.campaignUpdated.emit(t)),this.connection.on("Notify",()=>{this.notificationUpdate.emit(!0)}),this.connection.on("EventNotify",t=>{this.toastr.info(t.message)}),this.connection.on("EntityUpdate",t=>{this.entityUpdated.emit(t)}),this.connection.on("EntityCreate",t=>{this.entityCreated.emit(t)}),this.connection.on("EntityDelete",t=>{this.entityDeleted.emit(t)}),this.connection.on("NoteCreate",t=>{this.noteService.addOrUpdateCacheNotes([t])}),this.connection.on("NoteUpdate",t=>{this.noteService.addOrUpdateCacheNotes([t])}),this.connection.on("NoteDelete",t=>{this.noteService.removeNoteFromCache(t.id)}),this.connection.on("ArticleCreate",t=>{this.articleCreated.emit(t)}),this.connection.on("ArticleUpdate",t=>{this.articleUpdated.emit(t)}),this.connection.on("ArticleDelete",t=>{this.articleDeleted.emit(t)}),this.connection.on("NoteCursorUpdate",t=>{this.cursorUpdate.emit(t)}),this.connection.on("NoteDeltaUpdate",t=>{this.noteDeltaUpdate.emit(t)}),this.connection.on("ConceptEntityUpdate",t=>{this.conceptEntityUpdate.emit(t)}),this.connection.on("ConceptEntityDelete",t=>{this.conceptEntityDelete.emit(t)}),this.connection.on("RefreshCurrentCampaign",()=>{this.campaignRefresh.emit(!0)}),this.connection.on("ConceptArticleUpdate",t=>{this.conceptArticleUpdate.emit(t)}),this.connection.on("ConceptArticleDelete",t=>{this.conceptArticleDelete.emit(t)}),this.connection.on("OverviewStateUpdate",t=>{this.overviewStateUpdate.emit(t)}),yield this.authenticate()})}authenticate(){return l(this,void 0,void 0,function*(){this._state=d.AUTHENTICATING,this.stateUpdate.emit(this._state);try{yield this.connection.invoke("Authenticate")}catch(t){throw t}})}start(){return l(this,void 0,void 0,function*(){if(-1!==[d.CLOSED,d.NOT_CONNECTED].indexOf(this.state)){this.connection=(new c.a).withUrl(`${o.a.hubURL}`,{accessTokenFactory:()=>this.login.token}).configureLogging(o.a.production?c.b.Critical:c.b.Information).build();try{this._state=d.CONNECTING,this.stateUpdate.emit(this._state),yield this.connection.start(),this._state=d.CONNECTED,this.stateUpdate.emit(this._state),yield this.setup()}catch(t){this._state=d.CLOSED,this.stateUpdate.emit(this._state),this._retryTimeout=window.setTimeout(()=>{this.start()},5e3)}}})}stop(){return l(this,void 0,void 0,function*(){this.connection&&(clearTimeout(this._retryTimeout),this._state=d.NOT_CONNECTED,this.stateUpdate.emit(this._state),yield this.connection.stop())})}authComplete(){this._state=d.CONNECTED,this.stateUpdate.emit(this._state)}subscribeCampaign(t){return l(this,void 0,void 0,function*(){if(this.state===d.CONNECTED)try{yield this.connection.invoke("SubscribeCampaign",t)}catch(e){throw e}else console.warn("Not in connected state")})}unsubscribeCampaign(t){return l(this,void 0,void 0,function*(){if(this.state===d.CONNECTED)try{yield this.connection.invoke("UnsubscribeCampaign",t)}catch(e){throw e}else console.warn("Not in connected state")})}subscribeEntities(t){return l(this,void 0,void 0,function*(){if(this.state===d.CONNECTED)try{yield this.connection.invoke("SubscribeEntities",t)}catch(e){throw e}else console.warn("Not in connected state")})}unsubscribeEntities(t){return l(this,void 0,void 0,function*(){if(this.state===d.CONNECTED)try{yield this.connection.invoke("UnsubscribeEntities",t)}catch(e){throw e}else console.warn("Not in connected state")})}subscribeNote(t){return l(this,void 0,void 0,function*(){if(this.state===d.CONNECTED)try{yield this.connection.invoke("SubscribeNote",t)}catch(e){throw e}else console.warn("Not in connected state")})}unsubscribeNote(t){return l(this,void 0,void 0,function*(){if(this.state===d.CONNECTED)try{yield this.connection.invoke("UnsubscribeNote",t)}catch(e){throw e}else console.warn("Not in connected state")})}sendNoteCursorUpdate(t,e){return l(this,void 0,void 0,function*(){this.state===d.CONNECTED?yield this.connection.invoke("NoteCursorUpdate",t,{range:e}):console.warn("Not in connected state")})}sendNoteDeltaUpdate(t,e){return l(this,void 0,void 0,function*(){this.state===d.CONNECTED?yield this.connection.invoke("NoteDeltaUpdate",t,e):console.warn("Not in connected state")})}subscribeArticles(t){return l(this,void 0,void 0,function*(){this.state===d.CONNECTED?yield this.connection.invoke("SubscribeArticles",t):console.warn("Not in connected state")})}unsubscribeArticles(t){return l(this,void 0,void 0,function*(){this.state===d.CONNECTED?yield this.connection.invoke("UnsubscribeArticles",t):console.warn("Not in connected state")})}get state(){return this._state}}return t.\u0275fac=function(e){return new(e||t)(n.Ub(r.a),n.Ub(a.a),n.Ub(s.b))},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},edGd:function(t,e,i){"use strict";i.d(e,"b",function(){return h}),i.d(e,"a",function(){return m});var n=i("fXoL"),c=i("sK8x"),o=i("AytR"),r=i("xdv0"),a=i("tk/3"),s=i("CYb2"),l=i("abTI"),d=i("PSD3"),u=i.n(d),b=i("tyNb"),p=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})},h=function(t){return t[t.LOGGED_IN=0]="LOGGED_IN",t[t.LOGGING_IN=1]="LOGGING_IN",t[t.NOT_LOGGED_IN=2]="NOT_LOGGED_IN",t}({});let m=(()=>{class t{constructor(t,e,i){this.userService=t,this.router=e,this.actions=i,this.busy=!1,this.loginStatus=new n.n,this._loginData=this.loadLoginData(),this.isLoggedIn&&(this._loginData.expiresAt-Math.floor((new Date).getTime()/1e3)<60?(this._loginData.profile&&this.saveLastUsedLogin(this._loginData.profile),this.logout()):this.checkSession())}get id(){return this._loginData&&this._loginData.profile?this._loginData.profile.sub:null}get userProfile(){return this._loginData&&this._loginData.profile?this._loginData.profile:null}get currentUser(){return this._loginData&&this._loginData.user?this._loginData.user:null}get token(){return this._loginData&&this._loginData.token?this._loginData.token:null}get isLoggedIn(){return!(!this._loginData||!this._loginData.user)}getAuth(){return void 0===this._auth&&(this._auth=new c.a({domain:o.a.auth0Domain,clientID:o.a.auth0ClientId,responseType:"token",redirectUri:`${location.protocol}//${location.host}/callback`,audience:"https://dd.panchem.io",scope:"openid profile email"})),this._auth}getUserInfo(t){const e=this.getAuth();return new Promise((i,n)=>{e.client.userInfo(t,(t,e)=>{null!==t?n(t):i(e)})})}checkSession(){this.getAuth().checkSession({domain:o.a.auth0Domain,clientID:o.a.auth0ClientId,responseType:"token",redirectUri:`${location.protocol}//${location.host}/callback`,audience:"https://dd.panchem.io",scope:"openid profile email"},(t,e)=>{t?l.captureException(t):(this._loginData.token=e.accessToken,this._loginData.expiresAt=Math.floor((new Date).getTime()/1e3)+e.expiresIn,this.saveLoginData(this._loginData))}),setTimeout(()=>{this.checkSession()},9e5)}saveLoginData(t){this._loginData=t,localStorage.setItem("login-data",JSON.stringify(t))}clearLoginData(){localStorage.removeItem("login-data")}loadLoginData(){const t=localStorage.getItem("login-data");return t?JSON.parse(t):null}saveLastUsedLogin(t){localStorage.setItem("last-used-login",JSON.stringify(t))}loadLastUsedLogin(){return localStorage.getItem("last-used-login")?JSON.parse(localStorage.getItem("last-used-login")):null}parseHash(t,e){const i=this.getAuth();return new Promise((n,c)=>{i.parseHash({hash:t,state:e},(t,e)=>{t?c(t):n(e)})})}authorize(t,e){const i=this.getAuth(),n={connection:t};e&&(n.login_hint=e),i.authorize(n)}logout(){return p(this,void 0,void 0,function*(){this.clearLoginData(),l.configureScope(t=>{t.setUser(null)}),this._loginData=null,this.loginStatus.emit(h.NOT_LOGGED_IN)})}processLoginCallback(t){return p(this,void 0,void 0,function*(){this.busy=!0,this.loginStatus.emit(h.LOGGING_IN);try{try{const e=yield this.parseHash(t,null),i=Math.floor((new Date).getTime()/1e3)+e.expiresIn;this.saveLoginData({token:e.accessToken,expiresAt:i})}catch(e){e&&"invalid_token"===e.error?(this.logout(),this.router.navigate(["login"])):(console.log(e),u.a.fire({title:"Oh dear.",text:"Something went wrong while logging you in, please try again."}).then(()=>{this.logout(),this.router.navigate(["login"])}))}const i=yield this.getUserInfo(this._loginData.token);this._loginData.profile=i,this.saveLoginData(this._loginData),this.saveLastUsedLogin(i);try{const t=yield this.userService.getUser(i.sub);this._loginData.user=t,this.saveLoginData(this._loginData),this.loginStatus.emit(h.LOGGED_IN)}catch(e){if(e instanceof a.d&&404===e.status)return this.actions.queue.push({type:s.b.ACCOUNT_SETUP,data:null}),this.actions.save(),void this.router.navigate(["register"],{replaceUrl:!0});throw console.log(e),e}}catch(e){e&&"invalid_token"===e.error?(yield this.logout(),this.router.navigate(["login"])):(console.log("ERR",e),u.a.fire({title:"Whoops",text:"Something went wrong while logging you in, please try again."}).then(()=>{this.router.navigate(["login"])}))}setTimeout(()=>{this.checkSession()},9e5),this.router.navigate(["home"],{replaceUrl:!0}),this.busy=!1})}setUser(t){if(!this._loginData)throw new Error("Cannot set user when login data missing");this._loginData.user=t,this.saveLoginData(this._loginData)}get lastUsedLogin(){return this.loadLastUsedLogin()}}return t.\u0275fac=function(e){return new(e||t)(n.Ub(r.a),n.Ub(b.c),n.Ub(s.a))},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},hEiF:function(t,e,i){"use strict";i.d(e,"a",function(){return Q});var n=i("fXoL"),c=i("ofXK"),o=i("3Pt+"),r=i("WNRK"),a=i("/uUt");function s(t,e){if(1&t&&(n.Qb(0,"div",2),n.Mb(1,"input",3),n.Qb(2,"div",4),n.wc(3),n.Pb(),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.ec("formControl",t.formControl)("placeholder",t.singleInputName),n.Ab(2),n.xc(t.singleInputName)}}function l(t,e){if(1&t&&(n.Qb(0,"div",9),n.Qb(1,"div",2),n.Mb(2,"input",10),n.Qb(3,"div",4),n.wc(4),n.Pb(),n.Pb(),n.Pb()),2&t){const t=e.$implicit,i=e.index,c=n.Zb(2);n.Ab(2),n.ec("formControl",t)("placeholder",c.levels[i].name),n.Ab(2),n.xc(c.levels[i].name)}}function d(t,e){if(1&t){const t=n.Rb();n.Qb(0,"div",5),n.vc(1,l,5,3,"div",6),n.Qb(2,"div",7),n.Qb(3,"button",8),n.Xb("click",function(){return n.oc(t),n.Zb().reset()}),n.wc(4,"Clear Coin Values"),n.Pb(),n.Pb(),n.Pb()}if(2&t){const t=n.Zb();n.Ab(1),n.ec("ngForOf",t.controls)("ngForTrackBy",t.trackLevel)}}let u=(()=>{class t{constructor(){}ngOnInit(){this.config.trackCoins?(this.formArray=this.createFormArray(this.config.levels),this.formArray.valueChanges.pipe(Object(a.a)((t,e)=>null==t?t===e:!t.some((t,i)=>e[i]!==t))).subscribe(t=>{this._onChange&&this._onChange({values:this.convertCurrencyArrayToObject(t,this.config.levels),value:0})})):(this.formControl=new o.e(null),this.formControl.valueChanges.pipe(Object(a.a)()).subscribe(t=>{this._onChange&&this._onChange({values:{},value:t})}))}createFormArray(t){return new o.c(t.map(()=>new o.e(null)))}convertCurrencyArrayToObject(t,e){const i={};return t.forEach((t,n)=>{const c=e[n];c&&c.name&&(i[c.name]=t)}),i}mapCurrencyValuesToConfig(t,e){return null==t&&(t={}),e.map(e=>t[e.name]||0)}reset(){this._onChange&&this._onChange(null),this.config.trackCoins?this.formArray.patchValue(this.controls.map(()=>null),{emitEvent:!1}):this.formControl.patchValue(null,{emitEvent:!1})}writeValue(t){null!=t&&(this.config.trackCoins?this.formArray.setValue(this.mapCurrencyValuesToConfig(t.values,this.config.levels)):(this.formControl.setValue(t.value),this.formControl.markAsPristine()))}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.formArray&&(t?this.formArray.disable():this.formArray.enable()),this.formControl&&(t?this.formControl.disable():this.formControl.enable())}trackLevel(t){return t}get levels(){return(this.config.levels||[{name:"gp",value:1,useInConversions:!0}]).sort((t,e)=>e.value-t.value)}get controls(){if(this.formArray)return this.formArray.controls}get singleInputName(){const t=this.levels.find(t=>1===t.value);return t?t.name:"gp"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-currency-input"]],inputs:{config:"config"},features:[n.zb([{provide:o.l,useExisting:Object(n.U)(()=>t),multi:!0}])],decls:3,vars:2,consts:[["class","input-group",4,"ngIf"],["class","columns col-gapless",4,"ngIf"],[1,"input-group"],["type","text",1,"form-input",3,"formControl","placeholder"],[1,"input-group-addon"],[1,"columns","col-gapless"],["class","col-3 col-sm-12 p-1",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-auto"],[1,"btn","btn-link","mt-1",3,"click"],[1,"col-3","col-sm-12","p-1"],["type","number",1,"form-input",3,"formControl","placeholder"]],template:function(t,e){1&t&&(n.Qb(0,"div"),n.vc(1,s,4,3,"div",0),n.vc(2,d,5,2,"div",1),n.Pb()),2&t&&(n.Ab(1),n.ec("ngIf",e.formControl),n.Ab(1),n.ec("ngIf",e.formArray))},directives:[c.k,o.b,o.m,o.f,c.j,o.q],styles:[""]}),t})();function b(t,e){if(1&t&&n.Mb(0,"input",10),2&t){const t=n.Zb();n.ec("placeholder",t.config.name)("formControl",t.control)}}function p(t,e){if(1&t&&n.Mb(0,"input",11),2&t){const t=n.Zb();n.ec("placeholder",t.config.name)("formControl",t.control)}}function h(t,e){if(1&t&&n.Mb(0,"input",12),2&t){const t=n.Zb();n.ec("placeholder",t.config.name)("formControl",t.control)("step",t.config.options.step||.01)}}function m(t,e){if(1&t&&(n.Qb(0,"option",15),n.wc(1),n.Pb()),2&t){const t=e.$implicit;n.ec("value",t),n.Ab(1),n.xc(t)}}function g(t,e){if(1&t&&(n.Qb(0,"select",13),n.vc(1,m,2,2,"option",14),n.Pb()),2&t){const t=n.Zb();n.ec("formControl",t.control),n.Ab(1),n.ec("ngForOf",t.config.options.choices)}}function f(t,e){if(1&t&&(n.Qb(0,"option",15),n.wc(1),n.Pb()),2&t){const t=e.$implicit;n.ec("value",t),n.Ab(1),n.xc(t)}}function v(t,e){if(1&t&&(n.Qb(0,"select",16),n.vc(1,f,2,2,"option",14),n.Pb()),2&t){const t=n.Zb();n.ec("formControl",t.control),n.Ab(1),n.ec("ngForOf",t.config.options.choices)}}function y(t,e){if(1&t&&n.Mb(0,"dd-quill",17),2&t){const t=n.Zb();n.ec("placeholder",t.config.name)("formControl",t.control)}}function P(t,e){if(1&t&&n.Mb(0,"dd-currency-input",18),2&t){const t=n.Zb();n.ec("config",t.config.options)("formControl",t.control)}}function w(t,e){if(1&t&&(n.Qb(0,"div",19),n.Qb(1,"label",20),n.Mb(2,"input",21),n.Mb(3,"i",22),n.wc(4),n.Pb(),n.Pb()),2&t){const t=n.Zb();n.Ab(2),n.ec("formControl",t.control),n.Ab(2),n.yc(" ",t.config.name," ")}}function I(t,e){if(1&t&&(n.Qb(0,"figure",23),n.Mb(1,"img",24),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.config.imageId,"",n.qc)}}const C=function(t){return{"has-icon-left":t}};let Q=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-dynamic-input"]],inputs:{control:"control",config:"config"},decls:10,vars:13,consts:[[3,"ngClass","ngSwitch"],["type","text","name","attr","class","form-input",3,"placeholder","formControl",4,"ngSwitchCase"],["type","number","name","attr","class","form-input",3,"placeholder","formControl",4,"ngSwitchCase"],["type","number","name","attr","class","form-input",3,"placeholder","formControl","step",4,"ngSwitchCase"],["class","form-select","name","attr",3,"formControl",4,"ngSwitchCase"],["class","form-select","name","attr","multiple","true",3,"formControl",4,"ngSwitchCase"],["simple","true",3,"placeholder","formControl",4,"ngSwitchCase"],[3,"config","formControl",4,"ngSwitchCase"],["class","form-group",4,"ngSwitchCase"],["class","form-icon avatar",4,"ngIf"],["type","text","name","attr",1,"form-input",3,"placeholder","formControl"],["type","number","name","attr",1,"form-input",3,"placeholder","formControl"],["type","number","name","attr",1,"form-input",3,"placeholder","formControl","step"],["name","attr",1,"form-select",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["name","attr","multiple","true",1,"form-select",3,"formControl"],["simple","true",3,"placeholder","formControl"],[3,"config","formControl"],[1,"form-group"],[1,"form-checkbox"],["type","checkbox",3,"formControl"],[1,"form-icon"],[1,"form-icon","avatar"],[3,"src"]],template:function(t,e){1&t&&(n.Qb(0,"div",0),n.vc(1,b,1,2,"input",1),n.vc(2,p,1,2,"input",2),n.vc(3,h,1,3,"input",3),n.vc(4,g,2,2,"select",4),n.vc(5,v,2,2,"select",5),n.vc(6,y,1,2,"dd-quill",6),n.vc(7,P,1,2,"dd-currency-input",7),n.vc(8,w,5,2,"div",8),n.vc(9,I,2,1,"figure",9),n.Pb()),2&t&&(n.ec("ngClass",n.ic(11,C,e.config.imageId))("ngSwitch",e.config.type),n.Ab(1),n.ec("ngSwitchCase",0),n.Ab(1),n.ec("ngSwitchCase",1),n.Ab(1),n.ec("ngSwitchCase",2),n.Ab(1),n.ec("ngSwitchCase",3),n.Ab(1),n.ec("ngSwitchCase",4),n.Ab(1),n.ec("ngSwitchCase",5),n.Ab(1),n.ec("ngSwitchCase",6),n.Ab(1),n.ec("ngSwitchCase",7),n.Ab(1),n.ec("ngIf",e.config.imageId))},directives:[c.i,c.l,c.m,c.k,o.b,o.m,o.f,o.q,o.t,c.j,o.p,o.w,o.u,r.a,u,o.a],styles:[""]}),t})()},kNgC:function(t,e,i){"use strict";i.d(e,"a",function(){return b});var n=i("fXoL"),c=i("3Pt+"),o=i("MICr"),r=i("ygrl"),a=i("ofXK");const s=["modal"];function l(t,e){if(1&t){const t=n.Rb();n.Qb(0,"div",9),n.Xb("click",function(){n.oc(t);const i=e.$implicit;return n.Zb().selectIcon(i)}),n.Mb(1,"img",10),n.Pb()}if(2&t){const t=e.$implicit;n.Ab(1),n.ec("src",t.src,n.qc)}}function d(t,e){if(1&t&&n.Mb(0,"img",10),2&t){const t=n.Zb();n.ec("src",t.selectedIconSrc,n.qc)}}const u=function(t){return{disabled:t}};let b=(()=>{class t{constructor(t){this.iconService=t,this.selected=new n.n,this.isDisabled=!1}ngOnInit(){}writeValue(t){this._icon=t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.isDisabled=t}trackIcon(t,e){return e.id}openPicker(){this._onTouched&&this._onTouched(),this._modal.open()}selectIcon(t){this.selected.emit(t),this._onChange&&this._onChange(t.id),this._icon=t.id;try{this._modal.close(null)}catch(e){}}clear(){this.selected.emit(null),this._icon=null,this._onChange&&this._onChange(null);try{this._modal.close(null)}catch(t){}}get icons(){return this.iconService.getIcons()}get selectedIconSrc(){return this._icon?this.iconService.getIconSrc(this._icon):null}}return t.\u0275fac=function(e){return new(e||t)(n.Lb(o.a))},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-icon-picker"]],viewQuery:function(t,e){if(1&t&&n.Ac(s,3),2&t){let t;n.lc(t=n.Yb())&&(e._modal=t.first)}},outputs:{selected:"selected"},features:[n.zb([{provide:c.l,useExisting:Object(n.U)(()=>t),multi:!0}])],decls:10,vars:6,consts:[["size","small"],["modal",""],["modal-header",""],[1,"fake-link",3,"click"],["modal-body",""],[1,"columns"],["class","column col-3 hoverable text-center",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"picker-box",3,"ngClass","click"],[3,"src",4,"ngIf"],[1,"column","col-3","hoverable","text-center",3,"click"],[3,"src"]],template:function(t,e){1&t&&(n.Qb(0,"dd-modal",0,1),n.Qb(2,"div",2),n.Qb(3,"span",3),n.Xb("click",function(){return e.clear()}),n.wc(4,"Clear Icon"),n.Pb(),n.Pb(),n.Qb(5,"div",4),n.Qb(6,"div",5),n.vc(7,l,2,1,"div",6),n.Pb(),n.Pb(),n.Pb(),n.Qb(8,"div",7),n.Xb("click",function(){return e.openPicker()}),n.vc(9,d,1,1,"img",8),n.Pb()),2&t&&(n.Ab(7),n.ec("ngForOf",e.icons)("ngForTrackBy",e.trackIcon),n.Ab(1),n.ec("ngClass",n.ic(4,u,e.isDisabled)),n.Ab(1),n.ec("ngIf",e.selectedIconSrc))},directives:[r.a,a.j,a.i,a.k],styles:[".picker-box[_ngcontent-%COMP%]{width:50px;height:50px;padding:5px;border:.05rem solid #dadee4;border-radius:.1rem;cursor:pointer}.picker-box.disabled[_ngcontent-%COMP%]{background-color:#f7f7f9}"]}),t})()},"lD+H":function(t,e,i){"use strict";i.d(e,"a",function(){return b});var n=i("nXDu"),c=i("fXoL"),o=i("ofXK"),r=i("hEiF"),a=i("+awi");function s(t,e){1&t&&(c.Qb(0,"span",7),c.wc(1,"*"),c.Pb())}function l(t,e){if(1&t&&(c.Qb(0,"label",5),c.wc(1),c.vc(2,s,2,0,"span",6),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.yc("",t.fieldConfig.name," "),c.Ab(1),c.ec("ngIf",t.options.required)}}function d(t,e){if(1&t&&(c.Qb(0,"p",8),c.wc(1),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.yc(" ",t.fieldConfig.description," ")}}const u=function(t,e){return{"has-error":t,"has-success":e}};let b=(()=>{class t extends n.a{constructor(){super()}ngOnInit(){super.ngOnInit()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-dynamic-field"]],inputs:{showLabel:"showLabel"},features:[c.xb],decls:5,vars:10,consts:[[1,"form-group",3,"ngClass"],["class","form-label",4,"ngIf"],[3,"control","config"],["class","form-input-hint mb-0",4,"ngIf"],[3,"config","control"],[1,"form-label"],["class","text-primary text-large text-bold",4,"ngIf"],[1,"text-primary","text-large","text-bold"],[1,"form-input-hint","mb-0"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,l,3,2,"label",1),c.Mb(2,"dd-dynamic-input",2),c.vc(3,d,2,1,"p",3),c.Mb(4,"dd-dynamic-validation-errors",4),c.Pb()),2&t&&(c.ec("ngClass",c.jc(7,u,e.control.invalid&&(e.control.dirty||e.control.touched),e.control.valid&&(e.control.dirty||e.control.touched))),c.Ab(1),c.ec("ngIf",e.showLabel),c.Ab(1),c.ec("control",e.control)("config",e.fieldConfig),c.Ab(1),c.ec("ngIf",e.fieldConfig.description),c.Ab(1),c.ec("config",e.fieldConfig)("control",e.control))},directives:[o.i,o.k,r.a,a.a],styles:[""]}),t})()},n10a:function(t,e,i){"use strict";i.d(e,"a",function(){return c});var n=i("fXoL");let c=(()=>{class t{constructor(t,e,i){this.resolver=t,this.injector=e,this.appRef=i}getComponent(t){const e=this.resolver.resolveComponentFactory(t).create(this.injector);return this.appRef.attachView(e.hostView),e}getRootNode(t){return t.hostView.rootNodes[0]}}return t.\u0275fac=function(e){return new(e||t)(n.Ub(n.j),n.Ub(n.s),n.Ub(n.g))},t.\u0275prov=n.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},nXDu:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i("3Pt+"),c=function(t){return t[t.STRING=0]="STRING",t[t.NUMBER=1]="NUMBER",t[t.ENUM=2]="ENUM",t[t.BIG_TEXT=3]="BIG_TEXT",t[t.SELECT_MULTI=4]="SELECT_MULTI",t}({}),o=i("DwCd"),r=i("fXoL");let a=(()=>{class t{constructor(){}set attribute(t){null!=t&&(this._attribute=t,this._fieldConfigCache=void 0,this.control.setValidators(this.getValidators(this.fieldConfig)))}get attribute(){return this._attribute}set config(t){null!=t&&(this._config=t,this._fieldConfigCache=void 0,this.control&&this.control.setValidators(this.getValidators(this.fieldConfig)))}get config(){return this._config}ngOnInit(){this.control.setValidators(this.getValidators(this.fieldConfig))}getValidators(t){const e=[],i=t.options||this.getDefaultSettings();if(t.type===o.a.STRING){const t=i;null!=t.minLength&&e.push(n.v.minLength(t.minLength)),t.maxLength&&null!=t.maxLength&&e.push(n.v.maxLength(t.maxLength)),t.pattern&&e.push(n.v.pattern(t.pattern))}else if(t.type===o.a.INT||t.type===o.a.FLOAT){const t=i;null!=t.min&&e.push(n.v.min(t.min)),null!=t.max&&e.push(n.v.max(t.max))}return i.required&&e.push(n.v.required),e}mapAttributeTypeToFieldConfigType(t){switch(t){case c.BIG_TEXT:return o.a.TEXT_FORMATTED;case c.ENUM:return o.a.ENUM;case c.NUMBER:return o.a.INT;case c.SELECT_MULTI:return o.a.ENUM_MULTI;case c.STRING:return o.a.STRING}}mapAttributeOptionsToFieldConfigOptions(t){const e=this.getDefaultSettings(),i=this.mapAttributeTypeToFieldConfigType(t.type);if(i===o.a.STRING){const i=e;i.minLength=t.min,i.maxLength=t.max}else if(i===o.a.INT||i===o.a.FLOAT){const i=e;i.step=.01,i.max=t.max,i.min=t.min}else i!==o.a.ENUM&&i!==o.a.ENUM_MULTI||(e.choices=t.options);return e.required=t.required,e}getDefaultSettings(){return{}}get errors(){return this.control.errors}get fieldConfig(){return this.config||this._fieldConfigCache||!this.attribute||(this._fieldConfigCache={name:this.attribute.name,description:this.attribute.description,imageId:this.attribute.imageId,defaultValue:this.attribute.defaultValue,type:this.mapAttributeTypeToFieldConfigType(this.attribute.type),options:this.mapAttributeOptionsToFieldConfigOptions(this.attribute)}),this.config?this.config:this._fieldConfigCache}get options(){return this.fieldConfig.options||{}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Fb({type:t,selectors:[["dd-field-base"]],inputs:{control:"control",attribute:"attribute",config:"config"},decls:1,vars:0,template:function(t,e){1&t&&r.wc(0,"NO UI!")},encapsulation:2}),t})()},nzV2:function(t,e,i){"use strict";i.d(e,"a",function(){return T});var n=i("a8fi"),c=i("uCWu"),o=i("edGd"),r=i("pLZG"),a=i("PSD3"),s=i.n(a),l=(i("ygrl"),i("rpEA"),i("fXoL")),d=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const u=["modal"],b=["noteform"];function p(t,e){1&t&&(l.Qb(0,"div",8),l.Mb(1,"div",9),l.Pb())}function h(t,e){1&t&&l.Mb(0,"i",10)}function m(t,e){1&t&&l.Mb(0,"i",11)}function g(t,e){if(1&t&&(l.Qb(0,"div",4),l.vc(1,p,2,0,"div",5),l.vc(2,h,1,0,"i",6),l.vc(3,m,1,0,"i",7),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngIf",t.loading),l.Ab(1),l.ec("ngIf",!t.loading&&!t.unsaved),l.Ab(1),l.ec("ngIf",!t.loading&&t.unsaved)}}function f(t,e){if(1&t){const t=l.Rb();l.Qb(0,"dd-note-form",14,15),l.Xb("noteChange",function(e){return l.oc(t),l.Zb(2).onNoteChange(e)}),l.Pb()}if(2&t){const t=l.Zb(2);l.ec("note",t.note)("editable",t.editable)("advancedEditable",t.advancedEditable)}}function v(t,e){if(1&t&&(l.Qb(0,"div",12),l.vc(1,f,2,3,"dd-note-form",13),l.Pb()),2&t){const t=l.Zb();l.Ab(1),l.ec("ngIf",t.note)}}function y(t,e){if(1&t&&(l.Qb(0,"div",24),l.Mb(1,"div",25),l.Pb()),2&t){const t=l.Zb(2);l.Ab(1),l.ec("ddUser",t.user)}}const P=function(t,e){return["/campaigns",t,"articles",e]};function w(t,e){if(1&t&&(l.Qb(0,"button",26),l.Mb(1,"i",27),l.wc(2),l.Pb()),2&t){const t=l.Zb(2);l.ec("routerLink",l.jc(2,P,t.campaign.id,t.note.articleId)),l.Ab(2),l.yc(" ",t.note.article.name," ")}}const I=function(t,e){return["/campaigns",t,"quests",e]};function C(t,e){if(1&t&&(l.Qb(0,"button",26),l.Mb(1,"i",28),l.wc(2),l.Pb()),2&t){const t=l.Zb(2);l.ec("routerLink",l.jc(2,I,t.campaign.id,t.note.questId)),l.Ab(2),l.yc(" ",t.note.quest.name," ")}}const Q=function(t,e){return["/campaigns",t,"maps",e]};function A(t,e){if(1&t&&(l.Qb(0,"button",26),l.Mb(1,"i",29),l.wc(2),l.Pb()),2&t){const t=l.Zb(2);l.ec("routerLink",l.jc(2,Q,t.campaign.id,t.note.mapId)),l.Ab(2),l.yc(" ",t.note.map.name," ")}}function k(t,e){if(1&t){const t=l.Rb();l.Qb(0,"button",30),l.Xb("click",function(){return l.oc(t),l.Zb(2).delete()}),l.wc(1," Delete "),l.Pb()}}function x(t,e){if(1&t){const t=l.Rb();l.Qb(0,"div",16),l.Qb(1,"div",17),l.vc(2,y,2,1,"div",18),l.Qb(3,"div",19),l.vc(4,w,3,5,"button",20),l.vc(5,C,3,5,"button",20),l.vc(6,A,3,5,"button",20),l.Pb(),l.Qb(7,"div",21),l.vc(8,k,2,0,"button",22),l.Qb(9,"button",23),l.Xb("click",function(){return l.oc(t),l.Zb(),l.mc(1).close(null)}),l.wc(10,"Close"),l.Pb(),l.Pb(),l.Pb(),l.Pb()}if(2&t){const t=l.Zb();l.Ab(2),l.ec("ngIf",t.user),l.Ab(2),l.ec("ngIf",null!==t.note.article),l.Ab(1),l.ec("ngIf",null!==t.note.quest),l.Ab(1),l.ec("ngIf",null!==t.note.map),l.Ab(2),l.ec("ngIf",t.note&&t.editable)}}let T=(()=>{class t{constructor(t,e,i){this.noteService=t,this.campaignService=e,this.loginService=i,this.loading=!1,this.unsaved=!1,this._autosaveInterval=1500,this._lastAutosave=0,this._autosavePromise=null,t.setNoteEditor(this)}ngOnInit(){this.noteService.noteUpdate.pipe(Object(r.a)(t=>this.note&&t.id===this.note.id)).subscribe(t=>{this.editable||(this.note=t,this._noteForm&&(this._noteForm.note=t))})}createNote(t){return d(this,void 0,void 0,function*(){this.loading=!0;const e={title:"UNNAMED_NOTE",userId:this.loginService.id,content:null,campaignId:this.campaignService.campaign.id,publicEdit:!1,publicView:!1};switch(t.type){case n.b.QUEST:e.questId=t.questId;break;case n.b.MAP:e.mapId=t.mapId,e.lat=t.lat,e.lng=t.lng,e.mapShape=t.mapShape;break;case n.b.ARTICLE:e.articleId=t.articleId}try{this.note=yield this.noteService.createNote(e),this.note.title=""}catch(i){throw i}this.loading=!1})}saveNote(){return d(this,void 0,void 0,function*(){null!==this._autosavePromise&&(yield this._autosavePromise),this.loading=!0;try{this._autosavePromise=this.noteService.updateNote(this.note),yield this._autosavePromise,this._autosavePromise=null}catch(t){throw t}this._lastAutosave=Date.now(),this.loading=!1,this.unsaved=!1})}onNoteChange(t){this.editable&&(Date.now()>this._lastAutosave+this._autosaveInterval?(this.note=t,this.saveNote()):(this.unsaved=!0,void 0!==this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=window.setTimeout(()=>{this.note=t,this.saveNote(),this._saveTimeout=void 0},this._autosaveInterval)))}addNote(t){return d(this,void 0,void 0,function*(){yield this.createNote(t),this.modal.open().then(()=>{null===this.note.content&&""===this.note.title&&this.noteService.deleteNote(this.note.id),this.note=void 0})})}editNote(t){return d(this,void 0,void 0,function*(){this.modal.open().then(()=>{this.note=void 0}),this.loading=!0;try{this.note=yield this.noteService.getNote(t.id)}catch(e){throw e}this.loading=!1})}delete(){return d(this,void 0,void 0,function*(){if(this.note&&!0===(yield s.a.fire({text:"Are you sure?",showCancelButton:!0})).value)try{yield this.noteService.deleteNote(this.note.id),this.modal.close(null)}catch(t){if(-1===t.message.indexOf("Cannot close modal"))throw t}})}get editable(){return this.note.userId===this.loginService.id||this.note.publicEdit}get advancedEditable(){return this.note.userId===this.loginService.id}get user(){if(!this.note)return null;if(this.note.user)return this.note.user;const t=this.campaignService.campaign.members.find(t=>t.userId===this.note.userId);return t&&t.user?t.user:void 0}get campaign(){return this.campaignService.campaign}}return t.\u0275fac=function(e){return new(e||t)(l.Lb(n.a),l.Lb(c.b),l.Lb(o.a))},t.\u0275cmp=l.Fb({type:t,selectors:[["dd-note-editor"]],viewQuery:function(t,e){if(1&t&&(l.Ac(u,3),l.Ac(b,1)),2&t){let t;l.lc(t=l.Yb())&&(e.modal=t.first),l.lc(t=l.Yb())&&(e._noteForm=t.first)}},decls:5,vars:3,consts:[["modal",""],["modal-header","",4,"ngIf"],["modal-body","",4,"ngIf"],["modal-footer","",4,"ngIf"],["modal-header",""],["class","d-inline-block ml-2",4,"ngIf"],["class","icon icon-check",4,"ngIf"],["class","icon icon-cross",4,"ngIf"],[1,"d-inline-block","ml-2"],[1,"loading"],[1,"icon","icon-check"],[1,"icon","icon-cross"],["modal-body",""],[3,"note","editable","advancedEditable","noteChange",4,"ngIf"],[3,"note","editable","advancedEditable","noteChange"],["noteform",""],["modal-footer",""],[1,"columns","col-gapless","mt-2"],["class","column col-auto d-flex align-items-center mr-2",4,"ngIf"],[1,"column","col-auto","d-flex","align-items-center"],["class","btn btn-sm",3,"routerLink",4,"ngIf"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-error mr-2",3,"click",4,"ngIf"],[1,"btn",3,"click"],[1,"column","col-auto","d-flex","align-items-center","mr-2"],[3,"ddUser"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-bookmark"],[1,"icon","icon-flag"],[1,"icon","icon-location"],[1,"btn","btn-error","mr-2",3,"click"]],template:function(t,e){1&t&&(l.Qb(0,"dd-modal",null,0),l.vc(2,g,4,3,"div",1),l.vc(3,v,2,1,"div",2),l.vc(4,x,11,5,"div",3),l.Pb()),2&t&&(l.Ab(2),l.ec("ngIf",e.note&&e.editable),l.Ab(1),l.ec("ngIf",e.note),l.Ab(1),l.ec("ngIf",e.note))},styles:[".note-display[_ngcontent-%COMP%]{white-space:pre-line}"]}),t})()},qcJQ:function(t,e,i){"use strict";i.d(e,"a",function(){return k});var n=i("fXoL"),c=i("AxCL"),o=i("3Pt+"),r=i("uCWu"),a=i("ygrl"),s=i("ofXK");const l=["editmodal"],d=["hpinput"];function u(t,e){if(1&t){const t=n.Rb();n.Qb(0,"dd-modal",null,2),n.Qb(2,"div",3),n.wc(3,"Edit Health"),n.Pb(),n.Qb(4,"div",4),n.Qb(5,"form",5),n.Xb("ngSubmit",function(){return n.oc(t),n.Zb().submitEdit()}),n.Qb(6,"div",6),n.Qb(7,"label",7),n.wc(8,"HP"),n.Pb(),n.Mb(9,"input",8,9),n.Pb(),n.Pb(),n.Mb(11,"dd-health-display",10),n.Qb(12,"input",11),n.Xb("change",function(e){return n.oc(t),n.Zb().onSliderChange(e)}),n.Pb(),n.Pb(),n.Qb(13,"div",12),n.Qb(14,"button",13),n.Xb("click",function(){return n.oc(t),n.mc(1).close(null)}),n.wc(15,"Cancel"),n.Pb(),n.Qb(16,"button",14),n.Xb("click",function(){return n.oc(t),n.Zb().submitEdit()}),n.wc(17,"Save"),n.Pb(),n.Pb(),n.Pb()}if(2&t){const t=n.Zb();n.Ab(9),n.ec("formControl",t.operationControl),n.Ab(2),n.ec("editable",!1)("health",t.hpAfterOperation)("disableAnimation",!0)("forceShowBar",!0)("preset",t.preset),n.Ab(1),n.ec("max",t.health.max)("formControl",t.sliderControl)}}function b(t,e){if(1&t&&(n.Qb(0,"h5",24),n.wc(1),n.Pb()),2&t){const t=n.Zb().$implicit;n.Ab(1),n.zc("",t.current," / ",t.max,"")}}function p(t,e){1&t&&(n.Qb(0,"h5",25),n.wc(1," . "),n.Pb())}function h(t,e){1&t&&(n.Qb(0,"h5",25),n.wc(1," . "),n.Pb())}function m(t,e){if(1&t&&(n.Qb(0,"div"),n.wc(1),n.Pb()),2&t){const t=n.Zb().$implicit;n.Ab(1),n.zc("",t.current," / ",t.max,"")}}function g(t,e){1&t&&(n.Qb(0,"div",26),n.wc(1," . "),n.Pb())}function f(t,e){1&t&&(n.Qb(0,"div",26),n.wc(1," . "),n.Pb())}function v(t,e){if(1&t&&(n.Qb(0,"div",27),n.Qb(1,"h5",24),n.wc(2),n.Pb(),n.Pb()),2&t){const t=n.Zb().$implicit;n.Ab(2),n.zc("",t.current," / ",t.max,"")}}function y(t,e){if(1&t&&(n.Qb(0,"div",28),n.Qb(1,"div"),n.wc(2),n.Pb(),n.Pb()),2&t){const t=n.Zb().$implicit;n.Ab(2),n.zc("",t.current," / ",t.max,"")}}const P=function(t){return{"c-hand":t}},w=function(t,e){return{"bar-animated":t,"p-1":e}};function I(t,e){if(1&t){const t=n.Rb();n.Qb(0,"div",17),n.Xb("click",function(){return n.oc(t),n.Zb(2).editHP()}),n.Qb(1,"div",18),n.vc(2,b,2,2,"h5",19),n.vc(3,p,2,0,"h5",20),n.vc(4,h,2,0,"h5",20),n.vc(5,m,2,2,"div",0),n.vc(6,g,2,0,"div",21),n.vc(7,f,2,0,"div",21),n.Pb(),n.vc(8,v,3,2,"div",22),n.vc(9,y,3,2,"div",23),n.Pb()}if(2&t){const t=e.$implicit,i=n.Zb(2);n.ec("ngClass",n.ic(14,P,i.editable)),n.Ab(1),n.tc("width",t.percentCSS)("background-color",t.colorCSS),n.ec("ngClass",n.jc(16,w,!i.disableAnimation,!i.mini)),n.Ab(1),n.ec("ngIf",i.hpPercent>50&&!i.mini&&i.amountVisible),n.Ab(1),n.ec("ngIf",i.hpPercent<=50&&!i.mini&&i.amountVisible),n.Ab(1),n.ec("ngIf",!i.mini&&!i.amountVisible),n.Ab(1),n.ec("ngIf",i.hpPercent>50&&i.mini&&i.amountVisible),n.Ab(1),n.ec("ngIf",i.hpPercent<=50&&i.mini&&i.amountVisible),n.Ab(1),n.ec("ngIf",!i.amountVisible&&i.mini),n.Ab(1),n.ec("ngIf",i.hpPercent<=50&&!i.mini&&i.amountVisible),n.Ab(1),n.ec("ngIf",i.hpPercent<=50&&i.mini&&i.amountVisible)}}function C(t,e){if(1&t&&(n.Qb(0,"div"),n.vc(1,I,10,19,"div",15),n.Qb(2,"div",16),n.wc(3),n.Pb(),n.Pb()),2&t){const t=n.Zb();n.Ab(1),n.ec("ngForOf",t.bars)("ngForTrackBy",t.trackBarElement),n.Ab(2),n.xc(t.hpText)}}function Q(t,e){if(1&t&&(n.Qb(0,"div",29),n.Qb(1,"h5",30),n.wc(2),n.Pb(),n.Pb()),2&t){const t=n.Zb();n.Ab(2),n.xc(t.hpText)}}var A=function(t){return t[t.ADD=0]="ADD",t[t.SUBTRACT=1]="SUBTRACT",t[t.DIVIDE=2]="DIVIDE",t[t.MULTIPLY=3]="MULTIPLY",t[t.FILL=4]="FILL",t[t.SET=5]="SET",t}({});let k=(()=>{class t{constructor(t){this.campaignService=t,this.disableAnimation=!1,this.mini=!1,this.forceShowBar=!1,this.healthChange=new n.n,this.operationRegex=/^(\+([0-9]+))|(-([0-9]+))|(\/([0-9]+))|(\*([0-9]+))|(\+\+)|([0-9]+)$/}ngOnInit(){this.operationControl=new o.e(null),this.sliderControl=new o.e(this.health.current),this.sliderControl.valueChanges.subscribe(t=>{this.updateOperationFromSliderValue(t)})}updateOperationFromSliderValue(t){let e="";t===this.health.current?e=t:t<this.health.current?e="-"+(this.health.current-t):t>this.health.current&&(e="+"+(t-this.health.current)),this.operationControl.setValue(e)}onSliderChange(t){setTimeout(()=>{this.updateOperationFromSliderValue(this.sliderControl.value)},1)}editHP(){this.editable&&(this.sliderControl.setValue(this.health.current),this.editModal.open().then(t=>{null!==t&&this.healthChange.emit(t)}),setTimeout(()=>{this.operationControl.reset(),this.hpInput.nativeElement.focus()},1))}submitEdit(){this.editModal.close(this.hpAfterOperation)}parseOperation(t){const e=this.operationRegex.exec(t);if(null===e)return null;const i={type:A.ADD,amount:10},[n,c,o,r,a,s,l,d,u,b,p]=e;return c?(i.type=A.ADD,i.amount=parseInt(o,10)):r?(i.type=A.SUBTRACT,i.amount=parseInt(a,10)):s?(i.type=A.DIVIDE,i.amount=parseInt(l,10)):d?(i.type=A.MULTIPLY,i.amount=parseInt(u,10)):b?(i.type=A.FILL,i.amount=0):p&&(i.type=A.SET,i.amount=parseInt(p,10)),i}applyOperation(t,e){const i=Object.assign({},e);switch(t.type){case A.ADD:i.current+=t.amount;break;case A.SUBTRACT:i.current-=t.amount;break;case A.SET:i.current=t.amount;break;case A.DIVIDE:i.current=Math.round(i.current/t.amount);break;case A.MULTIPLY:i.current=Math.round(i.current*t.amount);break;case A.FILL:i.current=i.max}return i.current<0?i.current=0:i.current>i.max&&(i.current=i.max),i}trackBarElement(t,e){return t.toString()}get hpAfterOperation(){if(!this.health||this.operationControl.invalid)return null;const t=this.parseOperation(this.operationControl.value);return null===t?this.health:this.applyOperation(t,this.health)}get hpPercent(){return this.health?this.health.current/this.health.max*100:0}get bars(){let t;const e=this.hpPercent;switch(this.preset.colorType){case c.c.DYNAMIC:t=e>80?"#64ad53":e>60?"#84bb47":e>40?"#d2ae2b":e>20?"#d86e54":"#d8545b";break;case c.c.STATIC:t=this.preset.staticColor||"#5755d9"}return[{max:this.health.max,current:this.health.current,percentCSS:e.toFixed(2)+"%",colorCSS:t}]}get sliderTooltip(){return`${this.sliderControl.value}/${this.health.max}`}get amountVisible(){return!this.preset.amountHidden||this.editable||this.forceShowBar}get textOnly(){return this.preset.type===c.d.TEXT_BASED&&!this.editable&&!this.forceShowBar}get hpText(){if(this.health&&this.preset&&this.preset.type===c.d.TEXT_BASED&&this.health.textDamageLevels){const t=Object.keys(this.health.textDamageLevels).map(t=>({percent:parseInt(t,10),text:this.health.textDamageLevels[t]})).sort((t,e)=>t.percent-e.percent);for(const e of t)if(this.hpPercent<=e.percent)return e.text;return""}return""}}return t.\u0275fac=function(e){return new(e||t)(n.Lb(r.b))},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-health-display"]],viewQuery:function(t,e){if(1&t&&(n.Ac(l,1),n.Ac(d,1)),2&t){let t;n.lc(t=n.Yb())&&(e.editModal=t.first),n.lc(t=n.Yb())&&(e.hpInput=t.first)}},inputs:{editable:"editable",health:"health",preset:"preset",disableAnimation:"disableAnimation",mini:"mini",forceShowBar:"forceShowBar"},outputs:{healthChange:"healthChange"},decls:3,vars:3,consts:[[4,"ngIf"],["class","text-center",4,"ngIf"],["editmodal",""],["modal-header",""],["modal-body",""],[1,"mb-2",3,"ngSubmit"],[1,"form-group"],["for","operation",1,"form-label"],["type","tel","name","operation","id","operation","placeholder","HP",1,"form-input",3,"formControl"],["hpinput",""],[3,"editable","health","disableAnimation","forceShowBar","preset"],["type","range","min","0","name","hp-slider",1,"slider","mt-1",3,"max","formControl","change"],["modal-footer",""],[1,"btn",3,"click"],[1,"btn","btn-primary","ml-2",3,"click"],["class","bar h-100 no-select",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"form-input-hint","text-center"],[1,"bar","h-100","no-select",3,"ngClass","click"],[1,"bar-item","d-flex","align-items-center","justify-content-center",3,"ngClass"],["class","mb-1 text-bold",4,"ngIf"],["class","mb-1 text-bold","style","opacity: 0;",4,"ngIf"],["style","opacity: 0;",4,"ngIf"],["class","d-flex justify-content-center align-items-center p-1",4,"ngIf"],["class","d-flex justify-content-center align-items-center pl-1","style","line-height: 0.8rem",4,"ngIf"],[1,"mb-1","text-bold"],[1,"mb-1","text-bold",2,"opacity","0"],[2,"opacity","0"],[1,"d-flex","justify-content-center","align-items-center","p-1"],[1,"d-flex","justify-content-center","align-items-center","pl-1",2,"line-height","0.8rem"],[1,"text-center"],[1,"mb-2"]],template:function(t,e){1&t&&(n.vc(0,u,18,8,"dd-modal",0),n.vc(1,C,4,3,"div",0),n.vc(2,Q,3,1,"div",1)),2&t&&(n.ec("ngIf",e.editable),n.Ab(1),n.ec("ngIf",!e.textOnly),n.Ab(1),n.ec("ngIf",e.textOnly))},directives:[s.k,a.a,o.x,o.n,o.o,o.b,o.m,o.f,t,o.r,s.j,s.i],styles:[".bar-animated[_ngcontent-%COMP%]{transition:all .4s ease-in-out!important}[_nghost-%COMP%]{height:100%}.bar-item.d-flex[_ngcontent-%COMP%]{display:flex}.bar-item[_ngcontent-%COMP%]{background-image:url(/assets/hp-pattern.png);background-repeat:repeat;background-blend-mode:multiply}"]}),t})()},rZgH:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var n=i("AytR"),c=i("fXoL"),o=i("tk/3"),r=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};let a=(()=>{class t{constructor(t){this.http=t}getArticle(t){return this.http.get(`${n.a.apiURL}/articles/${t}`).toPromise()}getArticles(t,e=10,i=0,c){const o=c?`&search=${encodeURIComponent(c)}`:"";return this.http.get(`${n.a.apiURL}/articles?campaignId=${t}&limit=${e}&offset=${i}${o}`).toPromise()}createArticle(t){return this.http.post(`${n.a.apiURL}/articles`,t).toPromise()}updateArticle(t){return this.http.put(`${n.a.apiURL}/articles/${t.id}`,t).toPromise()}getMapArticles(t){return this.http.get(`${n.a.apiURL}/articles/map/${t}`).toPromise()}deleteArticle(t){return this.http.delete(`${n.a.apiURL}/articles/${t}`).toPromise()}getArticleQuests(t){return this.http.get(`${n.a.apiURL}/articlequests/?articleId=${t}`).toPromise()}updateArticleQuest(t){return this.http.put(`${n.a.apiURL}/articlequests`,t).toPromise()}deleteArticleQuest(t){return this.http.delete(`${n.a.apiURL}/articlequests?articleId=${t.articleId}&questId=${t.questId}`).toPromise()}getArticleConcepts(t,e){return this.http.get(`${n.a.apiURL}/articleconcepts/?articleId=${t}&conceptTypeId=${e}`).toPromise()}updateArticleConcept(t){return this.http.put(`${n.a.apiURL}/articleconcepts`,t).toPromise()}deleteArticleConcept(t){return this.http.delete(`${n.a.apiURL}/articleconcepts?articleId=${t.articleId}&conceptId=${t.conceptId}`).toPromise()}buyArticleConcept(t,e,i){return r(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/articleconcepts/buy?quantity=${e}&entityId=${i}`,t).toPromise()})}getPopular(t){return r(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/articles/popular?campaignId=${t}`).toPromise()})}makeCopy(t){return r(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/articles/makecopy/${t}`,null).toPromise()})}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(o.b))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},reMG:function(t,e,i){"use strict";i.r(e),i.d(e,"NotesModule",function(){return L});var n=i("ofXK"),c=i("wC5x"),o=i("3Pt+"),r=i("EA6F"),a=i("tyNb"),s=i("uCWu"),l=i("a8fi"),d=i("fXoL"),u=i("/AKn"),b=i("W/nz");function p(t,e){1&t&&d.Mb(0,"i",10)}function h(t,e){1&t&&d.Mb(0,"i",11)}function m(t,e){1&t&&d.Mb(0,"i",12)}function g(t,e){1&t&&d.Mb(0,"i",13)}let f=(()=>{class t{constructor(t){this.campaignService=t,this.select=new d.n}ngOnInit(){}doSelect(){this.select.emit(this.note)}get user(){return this.campaignService.campaign.members.find(t=>t.userId===this.note.userId).user}}return t.\u0275fac=function(e){return new(e||t)(d.Lb(s.b))},t.\u0275cmp=d.Fb({type:t,selectors:[["dd-note-list-item"]],inputs:{note:"note"},outputs:{select:"select"},decls:11,vars:6,consts:[[1,"card","p-1","hoverable",3,"click"],[1,"columns","col-gapless"],[1,"column"],[1,"column","col-auto","d-flex","align-items-center","ml-1"],["class","icon icon-edit ml-1",4,"ngIf"],["class","icon icon-bookmark ml-1",4,"ngIf"],["class","icon icon-flag ml-1",4,"ngIf"],["class","icon icon-location ml-1",4,"ngIf"],[1,"column","col-auto","text-gray","text-italic","text-right","ml-1"],[3,"ddUser"],[1,"icon","icon-edit","ml-1"],[1,"icon","icon-bookmark","ml-1"],[1,"icon","icon-flag","ml-1"],[1,"icon","icon-location","ml-1"]],template:function(t,e){1&t&&(d.Qb(0,"div",0),d.Xb("click",function(){return e.doSelect()}),d.Qb(1,"div",1),d.Qb(2,"div",2),d.wc(3),d.Pb(),d.Qb(4,"div",3),d.vc(5,p,1,0,"i",4),d.vc(6,h,1,0,"i",5),d.vc(7,m,1,0,"i",6),d.vc(8,g,1,0,"i",7),d.Pb(),d.Qb(9,"div",8),d.Mb(10,"div",9),d.Pb(),d.Pb(),d.Pb()),2&t&&(d.Ab(3),d.xc(e.note.title),d.Ab(2),d.ec("ngIf",e.note.publicEdit),d.Ab(1),d.ec("ngIf",e.note.articleId),d.Ab(1),d.ec("ngIf",e.note.questId),d.Ab(1),d.ec("ngIf",e.note.mapId),d.Ab(2),d.ec("ddUser",e.user))},directives:[n.k,b.a],styles:[""]}),t})();function v(t,e){1&t&&d.Mb(0,"div",10)}function y(t,e){if(1&t&&d.Mb(0,"dd-http-errors",11),2&t){const t=d.Zb();d.ec("error",t.loadErr)}}function P(t,e){if(1&t){const t=d.Rb();d.Qb(0,"div",14),d.Qb(1,"dd-note-list-item",15),d.Xb("select",function(e){return d.oc(t),d.Zb(2).selectNote(e)}),d.Pb(),d.Pb()}if(2&t){const t=e.$implicit;d.Ab(1),d.ec("note",t)}}function w(t,e){if(1&t&&(d.Qb(0,"div",12),d.vc(1,P,2,1,"div",13),d.Pb()),2&t){const t=d.Zb();d.Ab(1),d.ec("ngForOf",t.sortedNotes.other)}}function I(t,e){if(1&t){const t=d.Rb();d.Qb(0,"div",14),d.Qb(1,"dd-note-list-item",15),d.Xb("select",function(e){return d.oc(t),d.Zb(2).selectNote(e)}),d.Pb(),d.Pb()}if(2&t){const t=e.$implicit;d.Ab(1),d.ec("note",t)}}function C(t,e){if(1&t&&(d.Qb(0,"div",12),d.vc(1,I,2,1,"div",13),d.Pb()),2&t){const t=d.Zb();d.Ab(1),d.ec("ngForOf",t.sortedNotes.quest)}}function Q(t,e){if(1&t){const t=d.Rb();d.Qb(0,"div",14),d.Qb(1,"dd-note-list-item",15),d.Xb("select",function(e){return d.oc(t),d.Zb(2).selectNote(e)}),d.Pb(),d.Pb()}if(2&t){const t=e.$implicit;d.Ab(1),d.ec("note",t)}}function A(t,e){if(1&t&&(d.Qb(0,"div",12),d.vc(1,Q,2,1,"div",13),d.Pb()),2&t){const t=d.Zb();d.Ab(1),d.ec("ngForOf",t.sortedNotes.article)}}function k(t,e){if(1&t){const t=d.Rb();d.Qb(0,"div",14),d.Qb(1,"dd-note-list-item",15),d.Xb("select",function(e){return d.oc(t),d.Zb(2).selectNote(e)}),d.Pb(),d.Pb()}if(2&t){const t=e.$implicit;d.Ab(1),d.ec("note",t)}}function x(t,e){if(1&t&&(d.Qb(0,"div",12),d.vc(1,k,2,1,"div",13),d.Pb()),2&t){const t=d.Zb();d.Ab(1),d.ec("ngForOf",t.sortedNotes.map)}}const T=[{path:"",component:(()=>{class t{constructor(t,e){this.campaignService=t,this.noteService=e,this.loading=!1}ngOnInit(){this.load()}load(){return t=this,void 0,i=function*(){this.loading=!0;try{this.notes=yield this.noteService.getNotes(this.campaignService.campaign.id,{})}catch(t){this.loadErr=t}this.loading=!1},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}selectNote(t){this.noteService.editNote(t)}get sortedNotes(){if(!this.notes)return null;const t={quest:[],article:[],map:[],other:[]};return this.notes.forEach(e=>{null!=e.questId?t.quest.push(e):null!=e.articleId?t.article.push(e):null!=e.mapId?t.map.push(e):t.other.push(e)}),t}}return t.\u0275fac=function(e){return new(e||t)(d.Lb(s.b),d.Lb(l.a))},t.\u0275cmp=d.Fb({type:t,selectors:[["dd-note-manager"]],decls:15,vars:6,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto"],["class","loading loading-lg",4,"ngIf"],[3,"error",4,"ngIf"],["class","columns col-gapless",4,"ngIf"],["data-content","Quest Notes",1,"divider","text-center"],["data-content","Article Notes",1,"divider","text-center"],["data-content","Map Notes",1,"divider","text-center"],[1,"loading","loading-lg"],[3,"error"],[1,"columns","col-gapless"],["class","column col-3 col-md-4 col-sm-6 p-1 col-xs-12",4,"ngFor","ngForOf"],[1,"column","col-3","col-md-4","col-sm-6","p-1","col-xs-12"],[3,"note","select"]],template:function(t,e){1&t&&(d.Qb(0,"div",0),d.Qb(1,"div",1),d.Qb(2,"div",2),d.Qb(3,"h3"),d.wc(4,"Notebook"),d.Pb(),d.Pb(),d.Mb(5,"div",3),d.Pb(),d.vc(6,v,1,0,"div",4),d.vc(7,y,1,1,"dd-http-errors",5),d.vc(8,w,2,1,"div",6),d.Mb(9,"div",7),d.vc(10,C,2,1,"div",6),d.Mb(11,"div",8),d.vc(12,A,2,1,"div",6),d.Mb(13,"div",9),d.vc(14,x,2,1,"div",6),d.Pb()),2&t&&(d.Ab(6),d.ec("ngIf",e.loading),d.Ab(1),d.ec("ngIf",e.loadErr),d.Ab(1),d.ec("ngIf",e.sortedNotes),d.Ab(2),d.ec("ngIf",e.sortedNotes),d.Ab(2),d.ec("ngIf",e.sortedNotes),d.Ab(2),d.ec("ngIf",e.sortedNotes))},directives:[n.k,u.a,n.j,f],styles:[""]}),t})()}];let E=(()=>{class t{}return t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({factory:function(e){return new(e||t)},imports:[[a.f.forChild(T)],a.f]}),t})(),L=(()=>{class t{}return t.\u0275mod=d.Jb({type:t}),t.\u0275inj=d.Ib({factory:function(e){return new(e||t)},imports:[[E,n.b,c.a,o.s,r.a]]}),t})()},rpEA:function(t,e,i){"use strict";i.d(e,"a",function(){return u});var n=i("fXoL"),c=i("3Pt+"),o=i("edGd"),r=i("dtdw"),a=i("pLZG");function s(t,e){1&t&&(n.Qb(0,"div",2),n.Mb(1,"input",4),n.Pb())}function l(t,e){1&t&&(n.Qb(0,"div",2),n.Qb(1,"label",5),n.Mb(2,"input",6),n.Mb(3,"i",7),n.wc(4," This note is publicly visible "),n.Pb(),n.Pb())}function d(t,e){1&t&&(n.Qb(0,"div",2),n.Qb(1,"label",5),n.Mb(2,"input",8),n.Mb(3,"i",7),n.wc(4," This note is publicly editable "),n.Pb(),n.Pb())}let u=(()=>{class t{constructor(t,e){this.login=t,this.updateHub=e,this.cursorUpdates=new n.n,this.deltaUpdates=new n.n,this.noteChange=new n.n,this.editable=!1,this.advancedEditable=!1}set note(t){this._note=t,this.formGroup&&this.formGroup.patchValue(t)}get note(){return this._note}ngOnInit(){this.formGroup=new c.h({content:new c.e(this.note.content),title:new c.e(this.note.title),publicView:new c.e(this.note.publicView),publicEdit:new c.e(this.note.publicEdit)}),this.note.title="Placeholder",this.formGroup.valueChanges.subscribe(t=>{this.note.title=t.title||"Placeholder",this.note.publicEdit=t.publicEdit,this.note.publicView=t.publicView,this.note.content=t.content,this.noteChange.emit(this.note)}),this.updateHub.subscribeNote(this.note.id),this.updateHub.stateUpdate.subscribe(t=>{t===r.a.CONNECTED&&this.updateHub.subscribeNote(this.note.id)}),this.updateHub.cursorUpdate.pipe(Object(a.a)(t=>t.noteId===this.note.id)).subscribe(t=>{this.cursorUpdates.emit(t)}),this.updateHub.noteDeltaUpdate.pipe(Object(a.a)(t=>t.id===this.note.id)).subscribe(t=>{this.deltaUpdates.emit(t.delta)})}ngOnDestroy(){this.updateHub.sendNoteCursorUpdate(this.note.id,null),this.updateHub.unsubscribeNote(this.note.id)}textChange(t){this.note.publicEdit&&this.updateHub.sendNoteDeltaUpdate(this.note.id,t)}selectionChange(t){this.note.publicEdit&&this.updateHub.sendNoteCursorUpdate(this.note.id,t)}}return t.\u0275fac=function(e){return new(e||t)(n.Lb(o.a),n.Lb(r.b))},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-note-form"]],inputs:{note:"note",editable:"editable",advancedEditable:"advancedEditable"},outputs:{noteChange:"noteChange"},decls:6,vars:7,consts:[[3,"formGroup"],["class","form-group",4,"ngIf"],[1,"form-group"],["simple","true","formControlName","content",3,"readOnly","cursorUpdates","deltaUpdates","textChange","selectionChange"],["type","text","formControlName","title","placeholder","Title",1,"form-input","input-sm"],[1,"form-switch"],["type","checkbox","formControlName","publicView"],[1,"form-icon"],["type","checkbox","formControlName","publicEdit"]],template:function(t,e){1&t&&(n.Qb(0,"form",0),n.vc(1,s,2,0,"div",1),n.Qb(2,"div",2),n.Qb(3,"dd-quill",3),n.Xb("textChange",function(t){return e.textChange(t)})("selectionChange",function(t){return e.selectionChange(t)}),n.Pb(),n.Pb(),n.vc(4,l,5,0,"div",1),n.vc(5,d,5,0,"div",1),n.Pb()),2&t&&(n.ec("formGroup",e.formGroup),n.Ab(1),n.ec("ngIf",e.editable),n.Ab(2),n.ec("readOnly",!e.editable)("cursorUpdates",e.cursorUpdates)("deltaUpdates",e.deltaUpdates),n.Ab(1),n.ec("ngIf",e.advancedEditable),n.Ab(1),n.ec("ngIf",e.advancedEditable))},styles:[""]}),t})()},uCWu:function(t,e,i){"use strict";i.d(e,"b",function(){return l}),i.d(e,"a",function(){return d});var n=i("AytR"),c=i("edGd"),o=i("dtdw"),r=i("fXoL"),a=i("tk/3"),s=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};let l=(()=>{class t{constructor(t,e,i){this.http=t,this.login=e,this.updateHub=i,this._campaign=null,this.loadingCampaign=!1,this.updateHub.stateUpdate.subscribe(t=>{t===o.a.CONNECTED&&this._campaign&&this.updateHub.subscribeCampaign(this._campaign.id)}),this.updateHub.campaignUpdated.subscribe(t=>{this._campaign&&this._campaign.id===t.id&&(this._campaign.name=t.name,this._campaign.content=t.content,this._campaign.imageId=t.imageId,this._campaign.experienceTable=t.experienceTable,this._campaign.itemTypes=t.itemTypes,this._campaign.currencyMap=t.currencyMap)}),this.updateHub.campaignRefresh.subscribe(()=>{this.refreshCurrentCampaign()}),this.updateHub.entityUpdated.subscribe(t=>{this._campaign&&(t.preset=this._campaign.entityPresets.find(e=>e.id===t.entityPresetId),t.user=this._campaign.members.find(e=>e.userId===t.userId).user,this._campaign.entities.forEach((e,i)=>{e.id===t.id&&(this._campaign.entities[i]=Object.assign(Object.assign({},e),t))}))}),this.updateHub.entityDeleted.subscribe(t=>{this._campaign&&(this._campaign.entities=this._campaign.entities.filter(e=>e.id!==t))}),this.updateHub.entityCreated.subscribe(t=>{this._campaign&&(t.preset=this._campaign.entityPresets.find(e=>e.id===t.entityPresetId),t.user=this._campaign.members.find(e=>e.userId===t.userId).user,this._campaign.entities.push(t))})}setSelection(t){return s(this,void 0,void 0,function*(){if(null==t)return null!=this.campaign&&(this.previousCampaignId=this.campaign.id,this.updateHub.unsubscribeCampaign(this.previousCampaignId)),void(this.campaign=null);this.updateHub.subscribeCampaign(t),this.campaign=null,this.loadingCampaign=!0;try{const e=yield this.getCampaign(t);this.campaign=e,document.title=this.campaign.name}catch(e){throw e}this.loadingCampaign=!1})}refreshCurrentCampaign(){return s(this,void 0,void 0,function*(){if(this.campaign)try{const t=yield this.getCampaign(this.campaign.id);Object.assign(this.campaign,t),document.title=this.campaign.name}catch(t){throw t}})}getCampaigns(){return s(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/campaigns`).toPromise()})}getCampaign(t){return s(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/campaigns/${t}`).toPromise()})}createCampaign(t){return s(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/campaigns`,Object.assign(Object.assign({},t),{id:void 0})).toPromise()})}updateCampaign(t){return s(this,void 0,void 0,function*(){return this.http.put(`${n.a.apiURL}/campaigns/${t.id}`,t).toPromise()})}deleteCampaign(t){return s(this,void 0,void 0,function*(){return this.http.delete(`${n.a.apiURL}/campaigns/${t.id}`).toPromise()})}getInvites(){return s(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/campaigninvites?campaignId=${this.campaign.id}`).toPromise()})}getInvite(t){return s(this,void 0,void 0,function*(){return this.http.get(`${n.a.apiURL}/campaigninvites/${t}`).toPromise()})}createInvite(t){return s(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/campaigninvites`,{campaignId:this.campaign.id,name:t}).toPromise()})}updateInvite(t){return s(this,void 0,void 0,function*(){return this.http.put(`${n.a.apiURL}/campaigninvites/${t.id}`,t).toPromise()})}deleteInvite(t){return s(this,void 0,void 0,function*(){return this.http.delete(`${n.a.apiURL}/campaigninvites/${t}`).toPromise()})}acceptInvite(t){return s(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/campaigninvites/${t}/accept`,{}).toPromise()})}denyInvite(t){return s(this,void 0,void 0,function*(){return this.http.post(`${n.a.apiURL}/campaigninvites/${t}/decline`,{}).toPromise()})}removeMember(t){return s(this,void 0,void 0,function*(){return this.http.delete(`${n.a.apiURL}/campaigns/${t.campaignId}/member/${t.userId}`).toPromise()})}calculateLevel(t){if(!this.campaign)throw new Error("No campaign present");const e=this.campaign.experienceTable||[];let i=1;for(let n=0;n<e.length&&t>=e[n];n++)i++;return i}getXPToNextLevel(t){const e=this.campaign.experienceTable||[];for(let i=0;i<e.length;i++){const n=e[i];if(t<n)return n-t}return-1}getEntityPreset(t){return this.campaign&&this.campaign.entityPresets.find(e=>e.id===t)||null}getUser(t){return this.campaign&&this.campaign.members.find(e=>e.userId===t)||null}get canEdit(){return!!this.campaign&&this.login.id===this.campaign.userId}get editableEntities(){return this.campaign?this.canEdit?this.campaign.entities:this.campaign.entities.filter(t=>t.userId===this.login.id):[]}get campaign(){return this._campaign}set campaign(t){this._campaign=t}}return t.\u0275fac=function(e){return new(e||t)(r.Ub(a.b),r.Ub(c.a),r.Ub(o.b))},t.\u0275prov=r.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var d=function(t){return t[t.PENDING=0]="PENDING",t[t.REVOKED=1]="REVOKED",t[t.ACCEPTED=2]="ACCEPTED",t}({})},wC5x:function(t,e,i){"use strict";i.d(e,"a",function(){return h});var n=i("ofXK"),c=i("ygrl"),o=i("3Pt+"),r=i("WNRK"),a=i("aCXV"),s=i("nzV2"),l=i("rpEA"),d=i("EA6F"),u=i("tyNb"),b=i("fXoL"),p=i("W/nz");let h=(()=>{class t{}return t.\u0275mod=b.Jb({type:t}),t.\u0275inj=b.Ib({factory:function(e){return new(e||t)},imports:[[n.b,o.s,o.k,a.e,d.a,u.f]]}),t})();b.rc(s.a,[c.a,n.k,l.a,p.a,u.d],[]),b.rc(l.a,[o.x,o.n,o.i,n.k,o.b,o.m,o.g,r.a,o.a],[])},wNqa:function(t,e,i){"use strict";i.d(e,"a",function(){return r}),i.d(e,"b",function(){return a});var n=i("AytR"),c=i("fXoL"),o=i("tk/3");let r=(()=>{class t{constructor(t){this.http=t}getQuests(t,e,i=10,c=0,o=null,r=null,a=null){let s="";null!=e&&(s=`&search=${encodeURIComponent(e.trim().toLowerCase())}`);let l="";o&&o.length>0&&o.forEach(t=>{l+=`&except=${encodeURIComponent(t)}`});let d="";r&&r.length>0&&r.forEach(t=>{d+=`&only=${encodeURIComponent(t)}`});let u="";return a&&a.length>0&&a.forEach(t=>{u+=`&status=${t}`}),i||(i=10),c||(c=0),this.http.get(`${n.a.apiURL}/quests?campaignId=${t}${s}&limit=${i}&offset=${c}${l}${d}${u}`).toPromise()}getQuest(t){return this.http.get(`${n.a.apiURL}/quests/${t}`).toPromise()}createQuest(t){return this.http.post(`${n.a.apiURL}/quests`,Object.assign(Object.assign({},t),{id:void 0})).toPromise()}updateQuest(t){return this.http.put(`${n.a.apiURL}/quests/${t.id}`,t).toPromise()}deleteQuest(t){return this.http.delete(`${n.a.apiURL}/quests/${t.id}`).toPromise()}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(o.b))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var a=function(t){return t[t.NONE=0]="NONE",t[t.ON_HOLD=1]="ON_HOLD",t[t.IN_PROGRESS=2]="IN_PROGRESS",t[t.TO_DO=3]="TO_DO",t[t.COMPLETED=4]="COMPLETED",t}({})},xdv0:function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i("AytR"),c=i("fXoL"),o=i("tk/3");let r=(()=>{class t{constructor(t){this.http=t}getUser(t){return this.http.get(`${n.a.apiURL}/users/${t}`).toPromise()}createUser(t){return this.http.post(`${n.a.apiURL}/users`,t).toPromise()}updateUser(t){return this.http.put(`${n.a.apiURL}/users/${t.id}`,t).toPromise()}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(o.b))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},y4Wg:function(t,e,i){"use strict";i.d(e,"a",function(){return d});var n=i("fXoL"),c=i("ofXK");const o=function(t,e,i){return{"btn-primary":t,"btn-link":e,loading:i}};function r(t,e){if(1&t){const t=n.Rb();n.Qb(0,"button",9),n.Xb("click",function(){n.oc(t);const e=n.Zb().$implicit;return n.Zb(2).setPage(e)}),n.wc(1),n.Pb()}if(2&t){const t=n.Zb().$implicit,e=n.Zb(2);n.ec("ngClass",n.kc(2,o,e.page===t,e.page!==t,e.page===t&&e.loading)),n.Ab(1),n.yc(" ",t," ")}}function a(t,e){1&t&&(n.Qb(0,"span"),n.wc(1,"..."),n.Pb())}function s(t,e){if(1&t&&(n.Qb(0,"li",2),n.vc(1,r,2,6,"button",7),n.vc(2,a,2,0,"span",8),n.Pb()),2&t){const t=e.$implicit;n.Ab(1),n.ec("ngIf",t>0),n.Ab(1),n.ec("ngIf",-1===t)}}function l(t,e){if(1&t){const t=n.Rb();n.Qb(0,"ul",1),n.Qb(1,"li",2),n.Qb(2,"button",3),n.Xb("click",function(){return n.oc(t),n.Zb().prev()}),n.Mb(3,"i",4),n.Pb(),n.Pb(),n.vc(4,s,3,2,"li",5),n.Qb(5,"li",2),n.Qb(6,"button",3),n.Xb("click",function(){return n.oc(t),n.Zb().next()}),n.Mb(7,"i",6),n.Pb(),n.Pb(),n.Pb()}if(2&t){const t=n.Zb();n.Ab(2),n.ec("disabled",!t.canPrev),n.Ab(2),n.ec("ngForOf",t.pageArr),n.Ab(2),n.ec("disabled",!t.canNext)}}let d=(()=>{class t{constructor(){this.itemsPerPage=5,this.page=0,this.autoHide=!0,this.loading=!1,this.pageChange=new n.n}ngOnInit(){}next(){this.canNext&&(this.page++,this.pageChange.emit(this.page))}prev(){this.canPrev&&(this.page--,this.pageChange.emit(this.page))}setPage(t){this.page=t,this.pageChange.emit(this.page)}get pageArr(){const t=[1];if(this.numPages>4){this.page>2&&t.push(-1);for(let e=Math.max(2,this.page-1);e<Math.min(this.page+2,this.numPages);e++)t.push(e);this.page<this.numPages-2&&t.push(-1),t.push(this.numPages)}else if(this.numPages>1)for(let e=2;e<this.numPages+1;e++)t.push(e);return t}get numPages(){return Math.ceil(this.totalItems/this.itemsPerPage)}get canNext(){return this.page<this.numPages}get canPrev(){return this.page>1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-paginator"]],inputs:{totalItems:"totalItems",itemsPerPage:"itemsPerPage",page:"page",autoHide:"autoHide",loading:"loading"},outputs:{pageChange:"pageChange"},decls:1,vars:1,consts:[["class","pagination",4,"ngIf"],[1,"pagination"],[1,"page-item"],[1,"btn","btn-link",3,"disabled","click"],[1,"icon","icon-arrow-left"],["class","page-item",4,"ngFor","ngForOf"],[1,"icon","icon-arrow-right"],["class","btn",3,"ngClass","click",4,"ngIf"],[4,"ngIf"],[1,"btn",3,"ngClass","click"]],template:function(t,e){1&t&&n.vc(0,l,8,3,"ul",0),2&t&&n.ec("ngIf",e.numPages>1||!e.autoHide)},directives:[c.k,c.j,c.i],styles:[".pagination[_ngcontent-%COMP%]{justify-content:center}"]}),t})()},ygrl:function(t,e,i){"use strict";i.d(e,"a",function(){return u});var n=i("fXoL"),c=i("ofXK"),o=i("aCXV");function r(t,e){1&t&&n.Mb(0,"i",9)}function a(t,e){if(1&t){const t=n.Rb();n.Qb(0,"a",10),n.Xb("click",function(){return n.oc(t),n.Zb().userClose(null)}),n.Pb()}}const s=[[["","modal-header",""]],[["","modal-body",""]],[["","modal-footer",""]]],l=function(t,e,i){return{active:t,"modal-sm":e,"modal-lg":i}},d=["[modal-header]","[modal-body]","[modal-footer]"];let u=(()=>{class t{constructor(){this.size="normal",this.codeOnly=!1}ngOnInit(){}open(){if(void 0!==this.openPromise)throw new Error("Cannot open modal when it is already open");return this.openPromise=new Promise((t,e)=>{this.resolve=t}),this.openPromise}userClose(t){if(!0!==this.codeOnly)return this.close(t)}close(t){if(void 0===this.openPromise)throw new Error("Cannot close modal when it has not been opened");const e=this.openPromise;return this.resolve(t),this.openPromise=void 0,this.resolve=void 0,e}get isOpen(){return void 0!==this.openPromise}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=n.Fb({type:t,selectors:[["dd-modal"]],inputs:{size:"size",codeOnly:"codeOnly"},ngContentSelectors:d,decls:12,vars:8,consts:[["id","modal-parent",1,"modal",3,"ngClass"],["aria-label","Close",1,"modal-overlay",3,"click"],["cdkDragBoundary","#modal-parent","cdkDrag","",1,"modal-container",3,"cdkDragDisabled"],[1,"modal-header","p-2"],["class","icon icon-resize-vert c-move float-left mt-1","style","margin-left: -1rem;","cdkDragHandle","",4,"ngIf"],["class","btn btn-clear float-right","aria-label","Close",3,"click",4,"ngIf"],[1,"modal-body","p-2"],[1,"content"],[1,"modal-footer","px-2","pt-2"],["cdkDragHandle","",1,"icon","icon-resize-vert","c-move","float-left","mt-1",2,"margin-left","-1rem"],["aria-label","Close",1,"btn","btn-clear","float-right",3,"click"]],template:function(t,e){1&t&&(n.dc(s),n.Qb(0,"div",0),n.Qb(1,"a",1),n.Xb("click",function(){return e.userClose(null)}),n.Pb(),n.Qb(2,"div",2),n.Qb(3,"div",3),n.vc(4,r,1,0,"i",4),n.vc(5,a,1,0,"a",5),n.cc(6),n.Pb(),n.Qb(7,"div",6),n.Qb(8,"div",7),n.cc(9,1),n.Pb(),n.Pb(),n.Qb(10,"div",8),n.cc(11,2),n.Pb(),n.Pb(),n.Pb()),2&t&&(n.ec("ngClass",n.kc(4,l,e.isOpen,"small"===e.size,"large"===e.size)),n.Ab(2),n.ec("cdkDragDisabled","small"===e.size||"large"===e.size),n.Ab(2),n.ec("ngIf","small"!==e.size&&"large"!==e.size),n.Ab(1),n.ec("ngIf",!e.codeOnly))},directives:[c.i,o.a,c.k,o.b],styles:[""]}),t})()},zUnb:function(t,e,i){"use strict";i.r(e);var n=i("jhN1"),c=i("fXoL"),o=i("aCXV"),r=i("tk/3"),a=i("3Pt+"),s=i("R1ws"),l=i("Jho9"),d=i("o2tx"),u=i("5eHb"),b=i("AytR"),p=i("tyNb"),h=i("uCWu"),m=i("ofXK");function g(t,e){1&t&&c.Mb(0,"div",2)}function f(t,e){1&t&&c.Mb(0,"router-outlet")}let v=(()=>{class t{constructor(t,e){this.campaignService=t,this.route=e}ngOnInit(){this.route.paramMap.subscribe(t=>{this.campaignService.setSelection(t.get("id"))})}ngOnDestroy(){this.campaignService.setSelection(null)}get loading(){return this.campaignService.loadingCampaign}get campaign(){return this.campaignService.campaign}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-campaign"]],decls:2,vars:2,consts:[["class","loading loading-lg",4,"ngIf"],[4,"ngIf"],[1,"loading","loading-lg"]],template:function(t,e){1&t&&(c.vc(0,g,1,0,"div",0),c.vc(1,f,1,0,"router-outlet",1)),2&t&&(c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.campaign))},directives:[m.k,p.g],styles:[""]}),t})();var y=i("edGd"),P=i("nmfD");const w=["Securing","Ripening","Planting","Cooking","Loading","Computing","Slurping","Destroying","Demolishing"],I=["trebuchets","apples","pumpkins","dank memes","characters","dinner","a smoothie","chocolate cake","gloves","a water bottle","an absolute unit"];let C=(()=>{class t{constructor(){this.chance=new P.Chance}ngOnInit(){this.generatePhrase()}generatePhrase(){this.phrase=`${w[this.chance.integer({min:0,max:w.length-1})]} ${I[this.chance.integer({min:0,max:I.length-1})]}`,setTimeout(()=>{this.generatePhrase()},this.chance.integer({min:250,max:1500}))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-phraser"]],decls:1,vars:1,template:function(t,e){1&t&&c.wc(0),2&t&&c.yc("",e.phrase,"\n")},styles:[""]}),t})();function Q(t,e){1&t&&c.Mb(0,"img",18)}function A(t,e){1&t&&c.Mb(0,"img",19)}function k(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",5),c.Qb(1,"div",6),c.Qb(2,"h5",7),c.wc(3,"Last time you logged in with..."),c.Pb(),c.Pb(),c.Qb(4,"div",8),c.Qb(5,"div",1),c.Qb(6,"div",9),c.Qb(7,"figure",10),c.Mb(8,"img",11),c.vc(9,Q,1,0,"img",12),c.vc(10,A,1,0,"img",13),c.Pb(),c.Pb(),c.Qb(11,"div",14),c.Qb(12,"h5",15),c.wc(13),c.Pb(),c.Qb(14,"span"),c.wc(15),c.Pb(),c.Pb(),c.Pb(),c.Qb(16,"button",16),c.Xb("click",function(){return c.oc(t),c.Zb().useLastLogin()}),c.wc(17,"Use This Login "),c.Mb(18,"i",17),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(8),c.ec("src",t.lastUsedLogin.picture,c.qc),c.Ab(1),c.ec("ngIf",t.lastLoginWasGoogle),c.Ab(1),c.ec("ngIf",t.lastLoginWasFacebook),c.Ab(3),c.xc(t.lastUsedLogin.name),c.Ab(2),c.xc(t.lastUsedLogin.email)}}function x(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",20),c.Qb(1,"div",6),c.Qb(2,"h2"),c.wc(3,"Login"),c.Pb(),c.Pb(),c.Qb(4,"div",8),c.Qb(5,"button",21),c.Xb("click",function(){return c.oc(t),c.Zb().authGoog()}),c.wc(6," Google "),c.Pb(),c.Mb(7,"div",22),c.Qb(8,"button",21),c.Xb("click",function(){return c.oc(t),c.Zb().authFb()}),c.wc(9," Facebook "),c.Pb(),c.Pb(),c.Pb()}}function T(t,e){1&t&&(c.Qb(0,"div",20),c.Qb(1,"div",8),c.Qb(2,"h6",23),c.wc(3,"Processing Information..."),c.Pb(),c.Mb(4,"dd-phraser"),c.Pb(),c.Pb())}let E=(()=>{class t{constructor(t,e,i){this.login=t,this.route=e,this.router=i}ngOnInit(){return t=this,void 0,i=function*(){if("callback"===this.route.snapshot.url[0].path&&window.location.hash){const t=window.location.hash;this.router.navigate([],{replaceUrl:!0}),this.login.processLoginCallback(t)}},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}authGoog(){this.login.authorize("google-oauth2",this.lastLoginWasGoogle?this.lastUsedLogin.email:void 0)}authFb(){this.login.authorize("facebook")}useLastLogin(){this.lastLoginWasFacebook?this.authFb():this.lastLoginWasGoogle&&this.authGoog()}get id(){return"dummy"}get busy(){return this.login.busy}get lastUsedLogin(){return this.login.lastUsedLogin}get lastLoginWasGoogle(){return this.lastUsedLogin&&this.lastUsedLogin.sub.startsWith("google")}get lastLoginWasFacebook(){return this.lastUsedLogin&&this.lastUsedLogin.sub.startsWith("facebook")}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(y.a),c.Lb(p.a),c.Lb(p.c))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-login"]],decls:6,vars:3,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column","col-5","col-md-8","col-sm-11","col-mx-auto"],["class","card mb-2",4,"ngIf"],["class","card text-center",4,"ngIf"],[1,"card","mb-2"],[1,"card-header"],[1,"mb-0"],[1,"card-body"],[1,"column","col-auto"],[1,"avatar","avatar-lg"],["alt","User Avatar",3,"src"],["class","avatar-icon","src","/assets/g-logo.png","alt","Google Logo",4,"ngIf"],["class","avatar-icon","src","/assets/fb-logo.png","alt","Facebook Logo",4,"ngIf"],[1,"column","mb-2"],[1,"text-bold","mb-0"],[1,"btn","mt-2","wide",3,"click"],[1,"icon","icon-arrow-right"],["src","/assets/g-logo.png","alt","Google Logo",1,"avatar-icon"],["src","/assets/fb-logo.png","alt","Facebook Logo",1,"avatar-icon"],[1,"card","text-center"],[1,"btn","btn-lg","btn-primary","wide",3,"click"],["data-content","OR",1,"divider"],[1,"mb-1"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"div",2),c.vc(3,k,19,5,"div",3),c.vc(4,x,10,0,"div",4),c.vc(5,T,5,0,"div",4),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(3),c.ec("ngIf",e.lastUsedLogin&&!e.busy),c.Ab(1),c.ec("ngIf",!e.busy),c.Ab(1),c.ec("ngIf",e.busy))},directives:[m.k,C],styles:[".wide[_ngcontent-%COMP%]{width:100%}"]}),t})();var L=i("W/nz"),M=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function S(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",5),c.Qb(1,"div",6),c.Qb(2,"h3"),c.wc(3,"Campaigns"),c.Pb(),c.Pb(),c.Qb(4,"div",7),c.Qb(5,"button",8),c.Xb("click",function(){return c.oc(t),c.Zb().createCampaign()}),c.Mb(6,"i",9),c.Qb(7,"span",10),c.wc(8," New Campaign"),c.Pb(),c.Pb(),c.Pb(),c.Pb()}}function O(t,e){1&t&&c.Mb(0,"div",11)}function N(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",12),c.Qb(1,"div",13),c.Mb(2,"i",14),c.Pb(),c.Qb(3,"p",15),c.wc(4,"There are no campaigns here"),c.Pb(),c.Qb(5,"p",16),c.wc(6," Click the button to create your own, or ask your DM for an invite "),c.Pb(),c.Qb(7,"div",17),c.Qb(8,"button",18),c.Xb("click",function(){return c.oc(t),c.Zb().createCampaign()}),c.wc(9," Create Campaign "),c.Pb(),c.Pb(),c.Pb()}}function _(t,e){if(1&t&&(c.Qb(0,"div",26),c.Mb(1,"img",27),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.imageId,"",c.qc)}}function R(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div"),c.Qb(1,"div",19),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb().selectCampaign(i)}),c.Qb(2,"div",5),c.vc(3,_,2,1,"div",20),c.Qb(4,"div",6),c.Qb(5,"div",5),c.Qb(6,"div",6),c.Qb(7,"h4",21),c.wc(8),c.Pb(),c.Mb(9,"div",22),c.Pb(),c.Qb(10,"div",23),c.Qb(11,"span",24),c.wc(12),c.Pb(),c.Pb(),c.Qb(13,"div",25),c.Qb(14,"span",24),c.wc(15),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(3),c.ec("ngIf",t.imageId),c.Ab(5),c.xc(t.name),c.Ab(1),c.ec("ddUser",t.user),c.Ab(3),c.zc("",t.members.length," Member",1===t.members.length?"":"s",""),c.Ab(3),c.zc(" ",t.members.length," Member",1===t.members.length?"":"s"," ")}}let F=(()=>{class t{constructor(t,e){this.campaignService=t,this.router=e,this.loading=!1,this.creating=!1,this.campaigns=null,this.hideHeader=!1}ngOnInit(){this.loadCampaigns()}loadCampaigns(){return M(this,void 0,void 0,function*(){this.loading=!0;try{const t=yield this.campaignService.getCampaigns();this.campaigns=t}catch(t){throw t}this.loading=!1})}createCampaign(){return M(this,void 0,void 0,function*(){this.router.navigate(["campaigns","create"])})}selectCampaign(t){this.campaignService.setSelection(t.id),this.router.navigate(["campaigns",t.id])}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b),c.Lb(p.c))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-campaign-list"]],inputs:{hideHeader:"hideHeader"},decls:5,vars:4,consts:[[1,"container","grid-xl"],["class","columns",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"loading","loading-lg"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],[1,"card","hoverable","p-2","mb-2",3,"click"],["class","column col-auto",4,"ngIf"],[1,"mb-1"],[3,"ddUser"],[1,"column","col-md-12","hide-md","col-auto"],[1,"text-gray","text-italic"],[1,"column","col-md-12","show-md"],[1,"column","col-auto"],[1,"img-responsive","s-rounded",3,"src"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,S,9,0,"div",1),c.vc(2,O,1,0,"div",2),c.vc(3,N,10,0,"div",3),c.vc(4,R,16,7,"div",4),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",!e.hideHeader),c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.campaigns&&0===e.campaigns.length),c.Ab(1),c.ec("ngForOf",e.campaigns))},directives:[m.k,m.j,L.a],styles:[""]}),t})(),U=(()=>{class t{constructor(t){this.login=t}ngOnInit(){}get user(){return this.login.currentUser}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(y.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-home"]],decls:4,vars:1,consts:[[1,"container","grid-xl"],["hideHeader","true"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"h3"),c.wc(2),c.Pb(),c.Mb(3,"dd-campaign-list",1),c.Pb()),2&t&&(c.Ab(2),c.yc("Hello, ",e.user.username,""))},directives:[F],styles:[""]}),t})();var q=i("CYb2");let G=(()=>{class t{constructor(t,e,i){this.login=t,this.router=e,this.action=i}canActivate(t,e){return i=this,void 0,c=function*(){return!!this.login.isLoggedIn||(this.action.queue.push({type:q.b.REDIRECT,data:{url:e.url}}),this.action.save(),this.router.navigate(["login"]),!1)},new((n=void 0)||(n=Promise))(function(t,e){function o(t){try{a(c.next(t))}catch(i){e(i)}}function r(t){try{a(c.throw(t))}catch(i){e(i)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n(function(t){t(i)})).then(o,r)}a((c=c.apply(i,[])).next())});var i,n,c}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(y.a),c.Ub(p.c),c.Ub(q.a))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var D=i("ygrl"),Z=i("lD+H");const $=["modal"];function X(t,e){if(1&t&&(c.Qb(0,"div",4),c.Qb(1,"div",5),c.wc(2),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(2),c.yc("Edit ",t.config.name,"")}}function H(t,e){if(1&t&&c.Mb(0,"dd-dynamic-field",9),2&t){const t=e.$implicit,i=c.Zb(3);c.ec("control",i.modifiersGroup.get(t.config.name))("config",t.config)}}function j(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,H,1,2,"dd-dynamic-field",11),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngForOf",t.modifiers)("ngForTrackBy",t.trackModifier)}}function V(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",6),c.Qb(1,"form",7,8),c.Xb("ngSubmit",function(){return c.oc(t),c.Zb().ok()}),c.Mb(3,"dd-dynamic-field",9),c.vc(4,j,2,2,"div",10),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(3),c.ec("control",t.control)("config",t.config),c.Ab(1),c.ec("ngIf",t.modifiers&&t.modifiersGroup)}}function z(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",12),c.Qb(1,"button",13),c.Xb("click",function(){return c.oc(t),c.Zb().cancel()}),c.wc(2,"Cancel"),c.Pb(),c.Qb(3,"button",14),c.Xb("click",function(){return c.oc(t),c.Zb().ok()}),c.wc(4," Save "),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(3),c.ec("disabled",t.control.invalid)}}let B=(()=>{class t{constructor(t){this.campaignService=t}ngOnInit(){}editAttribute(t,e,i){return n=this,void 0,o=function*(){if(this.config=t,this.modifiers=i,this.control=new a.e(e),this.modifiers){this.modifiersGroup=new a.h({});for(const t of this.modifiers)this.modifiersGroup.addControl(t.config.name,new a.e(t.field.value))}return this.modal.open().then(t=>(this.config=void 0,this.modifiers=void 0,this.modifiersGroup=void 0,t))},new((c=void 0)||(c=Promise))(function(t,e){function i(t){try{a(o.next(t))}catch(i){e(i)}}function r(t){try{a(o.throw(t))}catch(i){e(i)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof c?n:new c(function(t){t(n)})).then(i,r)}a((o=o.apply(n,[])).next())});var n,c,o}trackModifier(t){return t}ok(){this.control.invalid||this.modal.close({value:this.control.value,mods:this.modifiersGroup?this.modifiersGroup.value:null})}cancel(){this.modal.close(null)}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-entity-attribute-editor-modal"]],viewQuery:function(t,e){if(1&t&&c.Ac($,3),2&t){let t;c.lc(t=c.Yb())&&(e.modal=t.first)}},decls:5,vars:3,consts:[["modal",""],["modal-header","",4,"ngIf"],["modal-body","",4,"ngIf"],["modal-footer","",4,"ngIf"],["modal-header",""],[1,"modal-title"],["modal-body",""],[3,"ngSubmit"],["attrForm","ngForm"],["showLabel","false",3,"control","config"],[4,"ngIf"],["showLabel","false",3,"control","config",4,"ngFor","ngForOf","ngForTrackBy"],["modal-footer",""],[1,"btn","btn-primary","mr-2",3,"click"],[1,"btn",3,"disabled","click"]],template:function(t,e){1&t&&(c.Qb(0,"dd-modal",null,0),c.vc(2,X,3,1,"div",1),c.vc(3,V,5,3,"div",2),c.vc(4,z,5,1,"div",3),c.Pb()),2&t&&(c.Ab(2),c.ec("ngIf",e.config&&e.control),c.Ab(1),c.ec("ngIf",e.config&&e.control),c.Ab(1),c.ec("ngIf",e.config&&e.control))},directives:[D.a,m.k,a.x,a.n,a.o,Z.a,m.j],styles:[""]}),t})();var Y=i("AxCL"),W=i("dtdw"),K=i("DwCd"),J=i("WNRK");function tt(t,e){if(1&t&&(c.Qb(0,"figure",8),c.Mb(1,"img",9),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.config.imageId,"",c.qc)}}function et(t,e){if(1&t&&(c.Qb(0,"sup"),c.wc(1),c.Pb()),2&t){const t=c.Zb().$implicit,e=c.Zb(2);c.Ab(1),c.xc(e.getModifierString(e.getModifiers(t)))}}const it=function(t){return{"c-hand":t}};function nt(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",3),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).editField(i)}),c.Qb(1,"div",4),c.vc(2,tt,2,1,"figure",5),c.wc(3),c.Pb(),c.Qb(4,"div",6),c.wc(5),c.vc(6,et,2,1,"sup",7),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit,i=c.Zb(2);c.ec("ngClass",c.ic(5,it,i.editable)),c.Ab(2),c.ec("ngIf",t.config&&t.config.imageId),c.Ab(1),c.yc(" ",t.config.name," "),c.Ab(2),c.yc(" ",t.field.value," "),c.Ab(1),c.ec("ngIf",i.getModifiers(t.field.name).length>0)}}function ct(t,e){if(1&t&&(c.Qb(0,"div",1),c.vc(1,nt,7,7,"div",2),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.fields)("ngForTrackBy",t.trackField)}}function ot(t,e){if(1&t&&(c.Qb(0,"div"),c.Qb(1,"figure",14),c.Mb(2,"img",9),c.Pb(),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(2),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.config.imageId,"",c.qc)}}function rt(t,e){if(1&t&&(c.Qb(0,"sup"),c.wc(1),c.Pb()),2&t){const t=c.Zb().$implicit,e=c.Zb(2);c.Ab(1),c.yc("(",e.getModifierString(e.getModifiers(t.field.name)),")")}}function at(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",11),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).editField(i)}),c.Qb(1,"div",12),c.vc(2,ot,3,1,"div",7),c.wc(3),c.Pb(),c.Qb(4,"div",13),c.wc(5),c.vc(6,rt,2,1,"sup",7),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit,i=c.Zb(2);c.ec("ngClass",c.ic(5,it,i.editable)),c.Ab(2),c.ec("ngIf",t.config&&t.config.imageId),c.Ab(1),c.yc(" ",t.config.name," "),c.Ab(2),c.yc(" ",t.field.value," "),c.Ab(1),c.ec("ngIf",i.getModifiers(t.field.name).length>0)}}function st(t,e){if(1&t&&(c.Qb(0,"div",1),c.vc(1,at,7,7,"div",10),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.fields)("ngForTrackBy",t.trackField)}}let lt=(()=>{class t{constructor(){this.modifiers=[],this.mode="major",this.editable=!1,this.edit=new c.n}ngOnInit(){}editField(t){this.edit.emit(t)}trackField(t,e){return e.field.name}getModifiers(t){return this.modifiers.filter(e=>e.config&&e.config.options&&e.config.options.modifierFor===t&&null!=e.field.value)}getModifierString(t){return t.map(t=>t.field.value).join(" ")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-attribute-row-view"]],inputs:{fields:"fields",modifiers:"modifiers",mode:"mode",editable:"editable"},outputs:{edit:"edit"},decls:2,vars:2,consts:[["class","columns mt-2",4,"ngIf"],[1,"columns","mt-2"],["class","column col-2 col-md-3 col-sm-5 col-mx-auto text-center",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-2","col-md-3","col-sm-5","col-mx-auto","text-center",3,"ngClass","click"],[1,"h5","no-select"],["class","avatar avatar",4,"ngIf"],[1,"h4","text-bold"],[4,"ngIf"],[1,"avatar","avatar"],[3,"src"],["class","column col-2 col-md-3 col-sm-4 col-mx-auto text-center",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-2","col-md-3","col-sm-4","col-mx-auto","text-center",3,"ngClass","click"],[1,"h6","no-select"],[1,"h5"],[1,"avatar","avatar-sm"]],template:function(t,e){1&t&&(c.vc(0,ct,2,2,"div",0),c.vc(1,st,2,2,"div",0)),2&t&&(c.ec("ngIf","major"===e.mode),c.Ab(1),c.ec("ngIf","normal"===e.mode))},directives:[m.k,m.j,m.i],styles:[""]}),t})();var dt=i("qcJQ"),ut=i("0ezk");function bt(t,e){if(1&t&&(c.Qb(0,"figure",7),c.Mb(1,"img",8),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.config.imageId,"",c.qc)}}const pt=function(t){return{"c-hand":t}};function ht(t,e){if(1&t){const t=c.Rb();c.Qb(0,"tr",3),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb().editField(i)}),c.Qb(1,"td",4),c.vc(2,bt,2,1,"figure",5),c.wc(3),c.Pb(),c.Qb(4,"td",6),c.wc(5),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit,i=c.Zb();c.ec("ngClass",c.ic(4,pt,i.editable)),c.Ab(2),c.ec("ngIf",t.config&&t.config.imageId),c.Ab(1),c.yc(" ",t.field.name," "),c.Ab(2),c.xc(t.field.value)}}const mt=function(t){return{"table-hover":t}};let gt=(()=>{class t{constructor(){this.editable=!1,this.edit=new c.n}ngOnInit(){}editField(t){this.edit.emit(t)}trackField(t,e){return e.field.name}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-attribute-table-view"]],inputs:{fields:"fields",editable:"editable"},outputs:{edit:"edit"},decls:8,vars:5,consts:[[1,"table","table-striped",3,"ngClass"],[1,"w-100"],[3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngClass","click"],[1,"no-select","py-0"],["class","avatar avatar-xs",4,"ngIf"],[1,"text-bold","py-0","text-right"],[1,"avatar","avatar-xs"],[3,"src"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"thead"),c.Qb(2,"tr"),c.Qb(3,"th",1),c.wc(4,"Minor Attributes"),c.Pb(),c.Mb(5,"th"),c.Pb(),c.Pb(),c.Qb(6,"tbody"),c.vc(7,ht,6,6,"tr",2),c.Pb(),c.Pb()),2&t&&(c.ec("ngClass",c.ic(3,mt,e.editable)),c.Ab(7),c.ec("ngForOf",e.fields)("ngForTrackBy",e.trackField))},directives:[m.i,m.j,m.k],styles:[""]}),t})();var ft=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const vt=["attributemodal"];function yt(t,e){1&t&&c.Mb(0,"div",4)}function Pt(t,e){1&t&&(c.Qb(0,"div",23),c.wc(1,"Saving..."),c.Pb())}const wt=function(t,e,i){return["/campaigns",t,"entities",e,i,"edit"]};function It(t,e){if(1&t&&(c.Qb(0,"a",24),c.Mb(1,"i",25),c.Pb()),2&t){const t=c.Zb(2);c.ec("routerLink",c.kc(1,wt,t.campaign.id,t.entity.preset.id,t.entity.id))}}function Ct(t,e){if(1&t&&(c.Qb(0,"div",26),c.Mb(1,"div",27),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("ddUser",t.user)}}const Qt=function(t){return{"c-hand":t}};function At(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",28),c.Qb(1,"span",29),c.Xb("click",function(){return c.oc(t),c.Zb(2).editXP()}),c.Qb(2,"span",30),c.wc(3,"LV. "),c.Pb(),c.Qb(4,"span",31),c.wc(5),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngClass",c.ic(2,Qt,t.editable)),c.Ab(4),c.xc(t.level)}}function kt(t,e){if(1&t&&(c.Qb(0,"div",32),c.Qb(1,"span"),c.wc(2),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(2),c.zc("",t.entity.xp," / ",t.xpToNextLevel,"")}}function xt(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",33),c.Xb("click",function(){return c.oc(t),c.Zb(2).openLocationOnMap()}),c.wc(1," Location "),c.Mb(2,"i",34),c.Pb()}}function Tt(t,e){if(1&t&&(c.Qb(0,"div",5),c.Qb(1,"div",6),c.Qb(2,"div",7),c.Qb(3,"div",8),c.vc(4,Pt,2,0,"div",9),c.Pb(),c.Pb(),c.Qb(5,"div",10),c.Qb(6,"div",11),c.Qb(7,"div",12),c.Qb(8,"div"),c.Qb(9,"h3",13),c.wc(10),c.vc(11,It,2,5,"a",14),c.Pb(),c.Qb(12,"div",15),c.vc(13,Ct,2,1,"div",16),c.Qb(14,"div",17),c.wc(15),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Qb(16,"div",18),c.Qb(17,"div",19),c.vc(18,At,6,4,"div",20),c.vc(19,kt,3,2,"div",21),c.vc(20,xt,3,0,"div",22),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.tc("background-image",t.backgroundCSS(t.entity.imageId)),c.Ab(4),c.ec("ngIf",t.saving),c.Ab(6),c.yc(" ",t.entity.name," "),c.Ab(1),c.ec("ngIf",t.editable),c.Ab(2),c.ec("ngIf",t.user),c.Ab(2),c.yc("(",t.entity.preset.name,")"),c.Ab(3),c.ec("ngIf",t.preset.isXPEnabled),c.Ab(1),c.ec("ngIf",t.preset.isXPEnabled),c.Ab(1),c.ec("ngIf",null!==t.entity.mapId)}}function Et(t,e){if(1&t){const t=c.Rb();c.Qb(0,"dd-attribute-row-view",53),c.Xb("edit",function(e){return c.oc(t),c.Zb(2).editAttribute(e)}),c.Pb()}if(2&t){const t=c.Zb(2);c.ec("fields",t.majorAttributes)("modifiers",t.modifiers)("editable",t.editable)}}function Lt(t,e){1&t&&c.Mb(0,"div",54)}function Mt(t,e){if(1&t){const t=c.Rb();c.Qb(0,"dd-attribute-row-view",55),c.Xb("edit",function(e){return c.oc(t),c.Zb(2).editAttribute(e)}),c.Pb()}if(2&t){const t=c.Zb(2);c.ec("fields",t.normalAttributes)("editable",t.editable)("modifiers",t.modifiers)}}function St(t,e){1&t&&c.Mb(0,"div",54)}const Ot=function(t,e){return{"col-9 col-md-7 col-sm-12":t,"col-12 mt-2":e}};function Nt(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",56),c.Qb(1,"div",57),c.Qb(2,"dd-health-display",58),c.Xb("healthChange",function(e){return c.oc(t),c.Zb(2).onHPEdit(e)}),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.ec("ngClass",c.jc(4,Ot,t.preset.isCurrencyEnabled,!t.preset.isCurrencyEnabled)),c.Ab(2),c.ec("editable",t.editable)("preset",t.entity.preset.health)("health",t.entity.health)}}function _t(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",59),c.Qb(1,"div",60),c.Xb("click",function(){return c.oc(t),c.Zb(2).editCurrency()}),c.Mb(2,"h5",61),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngClass",c.ic(2,Qt,t.editable)),c.Ab(1),c.ec("ddCurrency",t.entity.currency)}}function Rt(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",51),c.Qb(1,"div",62),c.Xb("click",function(){return c.oc(t),c.Zb(2).editCurrency()}),c.Mb(2,"h5",61),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngClass",c.ic(2,Qt,t.editable)),c.Ab(1),c.ec("ddCurrency",t.entity.currency)}}function Ft(t,e){1&t&&c.Mb(0,"div",54)}function Ut(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",23),c.Qb(1,"button",63),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).openConceptEntities(i.id)}),c.wc(2),c.Mb(3,"i",44),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(2),c.yc(" ",t.pluralForm," ")}}function qt(t,e){1&t&&c.Mb(0,"div",54)}function Gt(t,e){if(1&t&&(c.Qb(0,"div"),c.Qb(1,"h3"),c.wc(2),c.Pb(),c.Mb(3,"dd-quill",47),c.Pb()),2&t){const t=e.$implicit;c.Ab(2),c.xc(t.field.name),c.Ab(1),c.ec("value",t.field.value)}}function Dt(t,e){if(1&t){const t=c.Rb();c.Qb(0,"dd-attribute-table-view",66),c.Xb("edit",function(e){return c.oc(t),c.Zb(3).editAttribute(e)}),c.Pb()}if(2&t){const t=c.Zb(3);c.ec("fields",t.minorAttributes)("editable",t.editable)}}function Zt(t,e){if(1&t&&(c.Qb(0,"div",64),c.vc(1,Dt,1,2,"dd-attribute-table-view",65),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngIf",t.minorAttributes.length>0)}}function $t(t,e){1&t&&c.Mb(0,"div",54)}function Xt(t,e){if(1&t&&(c.Qb(0,"div"),c.Qb(1,"h3"),c.wc(2),c.Pb(),c.Mb(3,"dd-quill",47),c.Pb()),2&t){const t=e.$implicit;c.Ab(2),c.xc(t.field.name),c.Ab(1),c.ec("value",t.field.value)}}const Ht=function(){return["purchases"]};function jt(t,e){if(1&t&&(c.Qb(0,"div",10),c.vc(1,Et,1,3,"dd-attribute-row-view",35),c.vc(2,Lt,1,0,"div",36),c.vc(3,Mt,1,3,"dd-attribute-row-view",37),c.vc(4,St,1,0,"div",36),c.Qb(5,"div",38),c.vc(6,Nt,3,7,"div",39),c.vc(7,_t,3,4,"div",40),c.vc(8,Rt,3,4,"div",41),c.Pb(),c.vc(9,Ft,1,0,"div",36),c.Qb(10,"div",38),c.vc(11,Ut,4,1,"div",42),c.Qb(12,"div",23),c.Qb(13,"button",43),c.wc(14,"Purchases "),c.Mb(15,"i",44),c.Pb(),c.Pb(),c.Pb(),c.Qb(16,"div",38),c.Qb(17,"div",45),c.Mb(18,"div",46),c.Mb(19,"dd-quill",47),c.Mb(20,"img",48),c.vc(21,qt,1,0,"div",36),c.vc(22,Gt,4,2,"div",49),c.Pb(),c.vc(23,Zt,2,1,"div",50),c.Qb(24,"div",51),c.Mb(25,"div",46),c.Mb(26,"dd-quill",47),c.Mb(27,"img",52),c.vc(28,$t,1,0,"div",36),c.vc(29,Xt,4,2,"div",49),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngIf",t.majorAttributes.length>0),c.Ab(1),c.ec("ngIf",t.majorAttributes.length>0),c.Ab(1),c.ec("ngIf",t.normalAttributes.length>0),c.Ab(1),c.ec("ngIf",t.normalAttributes.length>0),c.Ab(2),c.ec("ngIf",t.preset.isHealthEnabled),c.Ab(1),c.ec("ngIf",t.preset.isCurrencyEnabled),c.Ab(1),c.ec("ngIf",t.preset.isCurrencyEnabled),c.Ab(1),c.ec("ngIf",t.preset.isCurrencyEnabled),c.Ab(2),c.ec("ngForOf",t.conceptTypeList),c.Ab(2),c.ec("routerLink",c.hc(23,Ht)),c.Ab(5),c.Bb("data-content","About "+t.entity.name),c.Ab(1),c.ec("value",t.entity.content),c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",t.entity.imageId,"",c.qc),c.Ab(1),c.ec("ngIf",t.bigTextAttributes.length>0),c.Ab(1),c.ec("ngForOf",t.bigTextAttributes)("ngForTrackBy",t.trackAttribute),c.Ab(1),c.ec("ngIf",t.minorAttributes.length>0),c.Ab(2),c.Bb("data-content","About "+t.entity.name),c.Ab(1),c.ec("value",t.entity.content),c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",t.entity.imageId,"",c.qc),c.Ab(1),c.ec("ngIf",t.bigTextAttributes.length>0),c.Ab(1),c.ec("ngForOf",t.bigTextAttributes)("ngForTrackBy",t.trackAttribute)}}let Vt=(()=>{class t{constructor(t,e,i,n,c,o,r){this.route=t,this.entityService=e,this.campaignService=i,this.sanitizer=n,this.login=c,this.router=o,this.update=r,this.loading=!1,this.saving=!1}ngOnInit(){this.route.paramMap.subscribe(t=>{this.update.subscribeEntities([t.get("ent_id")]),this.loadEntity(t.get("ent_id"))}),this._updateHubStatus$=this.update.stateUpdate.subscribe(t=>{t===W.a.CONNECTED&&this.entity&&this.update.subscribeEntities([this.entity.id])}),this._entityUpdate$=this.update.entityUpdated.subscribe(t=>{this.entity&&t.id===this.entity.id&&(this.entity=t)})}ngOnDestroy(){this.entity&&this.update.unsubscribeEntities([this.entity.id]),this._updateHubStatus$&&this._updateHubStatus$.unsubscribe()}getEntityField(t){return this.entity.preset.fields.find(e=>e.name===t)}updateEntity(){return ft(this,void 0,void 0,function*(){this.saving=!0;const t=Object.assign(Object.assign({},this.entity),{preset:void 0});try{yield this.entityService.updateEntity(t)}catch(e){throw e}this.saving=!1})}loadEntity(t){return ft(this,void 0,void 0,function*(){this.loading=!0;try{this.entity=yield this.entityService.getEntity(t)}catch(e){throw e}this.loading=!1})}editAttribute(t){return ft(this,void 0,void 0,function*(){if(!this.editable)return;const e=this.modifiers.filter(e=>(e.config&&e.config.options&&e.config.options.modifierFor)===t.config.name),i=yield this.attributeModal.editAttribute(t.config,t.field.value,e);if(null!=i){for(const e of this.entity.fields)e.name===t.field.name&&(e.value=i.value),i.mods&&void 0!==i.mods[e.name]&&(e.value=i.mods[e.name]);this.updateEntity()}})}onHPEdit(t){return ft(this,void 0,void 0,function*(){this.entity.health=t,yield this.updateEntity()})}editCurrency(){return ft(this,void 0,void 0,function*(){if(!this.editable)return;const t=yield this.attributeModal.editAttribute({name:"Money",type:K.a.CURRENCY,options:{required:!0,levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}},this.entity.currency);null!=t&&(this.entity.currency=t.value,this.updateEntity())})}editXP(){return ft(this,void 0,void 0,function*(){if(!this.editable)return;const t=yield this.attributeModal.editAttribute({name:"XP",description:`Experience points that this ${this.entity.preset.name} has`,type:K.a.INT,options:{required:!0,min:0}},this.entity.xp.toString());null!=t&&(this.entity.xp=parseInt(t.value,10),this.updateEntity())})}openLocationOnMap(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"maps",this.entity.mapId],{queryParams:{lat:this.entity.lat,lng:this.entity.lng,entity:this.entity.id}})}openConceptEntities(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",this.entity.id,"ct",t])}trackAttribute(t,e){return e.name}get majorAttributes(){return(this.entity.fields||[]).map(t=>({field:t,config:this.getEntityField(t.name)})).filter(t=>t.config&&t.config.class===Y.a.MAJOR&&t.config.type!==K.a.TEXT_FORMATTED&&null==t.config.options.modifierFor)}get normalAttributes(){return(this.entity.fields||[]).map(t=>({field:t,config:this.getEntityField(t.name)})).filter(t=>t.config&&t.config.class===Y.a.NORMAL&&t.config.type!==K.a.TEXT_FORMATTED&&null==t.config.options.modifierFor)}get bigTextAttributes(){return(this.entity.fields||[]).map(t=>({field:t,config:this.getEntityField(t.name)})).filter(t=>t.config&&t.config.type===K.a.TEXT_FORMATTED&&t.field.value)}get minorAttributes(){return(this.entity.fields||[]).map(t=>({field:t,config:this.getEntityField(t.name)})).filter(t=>t.config&&t.config.class===Y.a.MINOR&&t.config.type!==K.a.TEXT_FORMATTED)}get unimportantAttributes(){return(this.entity.fields||[]).map(t=>({field:t,config:this.getEntityField(t.name)})).filter(t=>t.config&&t.config.class===Y.a.UNIMPORTANT&&t.config.type!==K.a.TEXT_FORMATTED)}get modifiers(){return(this.entity.fields||[]).map(t=>({field:t,config:this.getEntityField(t.name)})).filter(t=>t.config&&t.config.options&&null!=t.config.options.modifierFor)}get level(){return this.campaignService.calculateLevel(this.entity.xp)}get xpToNextLevel(){return this.campaignService.getXPToNextLevel(this.entity.xp)}get editable(){return this.campaignService.canEdit||this.entity.userId===this.login.id}get preset(){return this.entity?this.campaignService.campaign.entityPresets.find(t=>t.id===this.entity.entityPresetId):null}get user(){if(this.entity){const t=this.campaign.members.find(t=>t.userId===this.entity.userId);return t?t.user:null}return null}get campaign(){return this.campaignService.campaign}get conceptTypeList(){return this.preset?this.campaignService.campaign.conceptTypes.filter(t=>-1!==this.preset.conceptTypesEnabled.indexOf(t.id)):[]}backgroundCSS(t){return this.sanitizer.bypassSecurityTrustStyle(`linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 1) 100%),\n      url("https://res.cloudinary.com/dqhk8k6iv/image/upload/t_chr_blur/${t}.jpg")`)}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(Y.b),c.Lb(h.b),c.Lb(n.b),c.Lb(y.a),c.Lb(p.c),c.Lb(W.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-entity-view"]],viewQuery:function(t,e){if(1&t&&c.Ac(vt,3),2&t){let t;c.lc(t=c.Yb())&&(e.attributeModal=t.first)}},decls:5,vars:3,consts:[["class","loading loading-lg",4,"ngIf"],["attributemodal",""],["class","player-bg d-flex",3,"background-image",4,"ngIf"],["class","container grid-xl",4,"ngIf"],[1,"loading","loading-lg"],[1,"player-bg","d-flex"],["id","head-container"],[1,"container","grid-xl","mb-auto"],[1,"columns","text-gray"],["class","column",4,"ngIf"],[1,"container","grid-xl"],[1,"columns","text-light","mx-0"],[1,"column","text-light","mb-1","d-flex","flex-col","justify-end"],[1,"mb-0","text-bold"],["class","text-light",3,"routerLink",4,"ngIf"],[1,"columns","col-gapless"],["class","column col-auto mr-1",4,"ngIf"],[1,"column","text-italic","no-select"],[1,"column","col-auto","d-flex","justify-end","align-items-end","col-ml-auto",2,"line-height","1.2"],[1,"mb-1"],["class","text-right",4,"ngIf"],["class","text-right tooltip","data-tooltip","XP / Next Level",4,"ngIf"],["class","text-italic no-select c-hand",3,"click",4,"ngIf"],[1,"column"],[1,"text-light",3,"routerLink"],[1,"icon","icon-edit"],[1,"column","col-auto","mr-1"],[3,"ddUser"],[1,"text-right"],[3,"ngClass","click"],[1,"h5","no-select","mb-0"],[1,"h3","text-bold","mb-0"],["data-tooltip","XP / Next Level",1,"text-right","tooltip"],[1,"text-italic","no-select","c-hand",3,"click"],[1,"icon","icon-location"],[3,"fields","modifiers","editable","edit",4,"ngIf"],["class","divider",4,"ngIf"],["mode","normal",3,"fields","editable","modifiers","edit",4,"ngIf"],[1,"columns"],["class","column",3,"ngClass",4,"ngIf"],["class","column col-3 col-md-5 hide-sm",4,"ngIf"],["class","column col-12 show-sm mt-2",4,"ngIf"],["class","column",4,"ngFor","ngForOf"],[1,"btn","btn-sm","w-100",3,"routerLink"],[1,"icon","icon-arrow-right"],[1,"column","col-8","col-md-6","col-sm-12","hide-sm"],[1,"divider","text-center"],["readOnly","true",3,"value"],[1,"img-responsive","s-rounded","mt-2",3,"src"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","column col-4 col-md-6 col-sm-12 col-ml-auto",4,"ngIf"],[1,"column","col-12","show-sm","mt-2"],[1,"img-responsive","s-rounded",3,"src"],[3,"fields","modifiers","editable","edit"],[1,"divider"],["mode","normal",3,"fields","editable","modifiers","edit"],[1,"column",3,"ngClass"],[1,"h-100"],[3,"editable","preset","health","healthChange"],[1,"column","col-3","col-md-5","hide-sm"],[1,"s-rounded","h-100","p-1","currency-box","text-center",2,"height","36px",3,"ngClass","click"],[1,"mb-0",3,"ddCurrency"],[1,"card","p-1","currency-box","text-center",3,"ngClass","click"],[1,"btn","btn-sm","w-100",3,"click"],[1,"column","col-4","col-md-6","col-sm-12","col-ml-auto"],[3,"fields","editable","edit",4,"ngIf"],[3,"fields","editable","edit"]],template:function(t,e){1&t&&(c.vc(0,yt,1,0,"div",0),c.Mb(1,"dd-entity-attribute-editor-modal",null,1),c.vc(3,Tt,21,10,"div",2),c.vc(4,jt,30,24,"div",3)),2&t&&(c.ec("ngIf",e.loading),c.Ab(3),c.ec("ngIf",e.entity),c.Ab(1),c.ec("ngIf",e.entity))},directives:[m.k,B,p.e,L.a,m.i,m.j,p.d,J.a,lt,dt.a,ut.a,gt],styles:[".player-bg[_ngcontent-%COMP%]{background-color:#000;min-height:30vh;margin-top:-.4rem;background-size:cover;background-repeat:no-repeat;background-position:50%}#head-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;justify-content:flex-end}.currency-box[_ngcontent-%COMP%]{background-color:#ffb700;background-image:url(/assets/hp-pattern.png);background-repeat:repeat;background-blend-mode:multiply}.coin-icon[_ngcontent-%COMP%]{margin-bottom:-.4rem}"]}),t})();const zt=["modal"];function Bt(t,e){if(1&t&&(c.Qb(0,"label",4),c.Mb(1,"input",12),c.Mb(2,"i",6),c.wc(3),c.Pb()),2&t){const t=e.$implicit;c.Ab(1),c.ec("formControlName","ct-"+t.id),c.Ab(2),c.yc(" Export ",t.pluralForm," ")}}let Yt=(()=>{class t{constructor(t){this.campaignService=t}set conceptTypes(t){this._conceptTypes=t,this.ngOnInit()}ngOnInit(){this.formGroup=new a.h({exportQuests:new a.e(!0),exportArticles:new a.e(!0),exportEntityPresets:new a.e(!0)});for(const t of this.conceptTypes)this.formGroup.addControl(`ct-${t.id}`,new a.e(!0))}doExport(){this.modal.open()}get exportLink(){let t=`${b.a.apiURL}/export?campaignId=${this.campaignService.campaign.id}`;const e=this.formGroup.value;e.exportQuests&&(t+="&quests=true"),e.exportArticles&&(t+="&articles=true"),e.exportEntityPresets&&(t+="&entitypresets=true");for(const i of this.conceptTypes)!0===this.formGroup.get(`ct-${i.id}`).value&&(t+=`&conceptType=${i.id}`);return t}get conceptTypes(){return this._conceptTypes}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-exporter"]],viewQuery:function(t,e){if(1&t&&c.Ac(zt,3),2&t){let t;c.lc(t=c.Yb())&&(e.modal=t.first)}},inputs:{conceptTypes:"conceptTypes"},decls:22,vars:3,consts:[["modal",""],["modal-header",""],["modal-body",""],[1,"form-group",3,"formGroup"],[1,"form-checkbox"],["type","checkbox","formControlName","exportQuests"],[1,"form-icon"],["type","checkbox","formControlName","exportArticles"],["type","checkbox","formControlName","exportEntityPresets"],["class","form-checkbox",4,"ngFor","ngForOf"],["target","_blank",1,"btn","btn-primary","mt-2",3,"href"],[1,"icon","icon-download"],["type","checkbox",3,"formControlName"]],template:function(t,e){1&t&&(c.Qb(0,"dd-modal",null,0),c.Qb(2,"h4",1),c.wc(3,"Export"),c.Pb(),c.Qb(4,"div",2),c.Qb(5,"div",3),c.Qb(6,"label",4),c.Mb(7,"input",5),c.Mb(8,"i",6),c.wc(9," Export Quests "),c.Pb(),c.Qb(10,"label",4),c.Mb(11,"input",7),c.Mb(12,"i",6),c.wc(13," Export Articles "),c.Pb(),c.Qb(14,"label",4),c.Mb(15,"input",8),c.Mb(16,"i",6),c.wc(17," Export Entity Types "),c.Pb(),c.vc(18,Bt,4,2,"label",9),c.Pb(),c.Qb(19,"a",10),c.Mb(20,"i",11),c.wc(21," Export "),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(5),c.ec("formGroup",e.formGroup),c.Ab(13),c.ec("ngForOf",e.conceptTypes),c.Ab(1),c.ec("href",e.exportLink,c.qc))},directives:[D.a,a.n,a.i,a.a,a.m,a.g,m.j],styles:[""]}),t})();var Wt=i("PSD3"),Kt=i.n(Wt),Jt=i("MICr");const te=["fupload"];function ee(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Upload Image"),c.Pb())}function ie(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Change Image"),c.Pb())}function ne(t,e){if(1&t&&(c.Qb(0,"span"),c.wc(1),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.xc(t.file.name)}}function ce(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",10),c.Xb("click",function(){return c.oc(t),c.Zb().clearImage()}),c.wc(1," Clear Image "),c.Pb()}}function oe(t,e){if(1&t&&(c.Qb(0,"div",11),c.Mb(1,"div",12),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.tc("width",t.uploadProgress+"%")}}function re(t,e){if(1&t&&c.Mb(0,"img",13),2&t){const t=c.Zb();c.ec("src",t.imageURL,c.qc)}}function ae(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",14),c.Qb(1,"button",15),c.Xb("click",function(){return c.oc(t),c.Zb().clearError()}),c.Pb(),c.wc(2),c.Pb()}if(2&t){const t=c.Zb();c.Ab(2),c.yc(" ",t.fileError,"\n")}}const se=function(t){return{"drag-over":t}};let le=(()=>{class t{constructor(t,e){this.loginService=t,this.campaignService=e,this.file=null,this.fileError=null,this.isDragOver=!1,this.isUploading=!1,this.uploadProgress=null,this.eleId=""}ngOnInit(){}ngAfterViewInit(){["dragenter","dragover"].forEach(t=>this.fupload.nativeElement.addEventListener(t,t=>{t.preventDefault(),t.stopPropagation(),this.isDragOver=!0})),["dragleave","dragend","drop"].forEach(t=>this.fupload.nativeElement.addEventListener(t,t=>{t.preventDefault(),t.stopPropagation(),this.isDragOver=!1})),this.fupload.nativeElement.addEventListener("drop",t=>{t.dataTransfer.files.length>0&&this.handleFileUpload(t.dataTransfer.files[0])})}writeValue(t){this.imageId=t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){}clearImage(){this.writeValue(null)}clearError(){this.fileError=null}onFileChange(t){const e=t.target.files;e.length>0&&this.handleFileUpload(e[0])}get imageURL(){return this.imageId?`https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/${this.imageId}`:null}handleFileUpload(t){if(this.fileError=null,this.uploadProgress=null,!t.type.startsWith("image/"))return void(this.fileError="Incorrect file type! Only images are accepted");this.file=t;const e=new FormData;e.append("file",this.file),this.campaignService.campaign&&e.append("campaignId",this.campaignService.campaign.id);const i=new XMLHttpRequest;i.open("POST",`${b.a.apiURL}/upload`,!0),i.setRequestHeader("Authorization",`Bearer ${this.loginService.token}`),i.onload=t=>{const e=JSON.parse(i.responseText);this.isUploading=!1,this.file=null,this.writeValue(e.public_id),this._onChange&&this._onChange(e.public_id)},i.upload.addEventListener("progress",t=>{this.uploadProgress=t.loaded/t.total*100}),this.isUploading=!0,i.send(e)}get controlId(){return`file-upload-${this.eleId}`}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(y.a),c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-image-upload"]],viewQuery:function(t,e){if(1&t&&c.Ac(te,3),2&t){let t;c.lc(t=c.Yb())&&(e.fupload=t.first)}},inputs:{eleId:"eleId"},features:[c.zb([{provide:a.l,useExisting:Object(c.U)(()=>t),multi:!0}])],decls:12,vars:12,consts:[[1,"form-group"],["id","drop-area",1,"p-2",3,"ngClass"],["fupload",""],["type","file","accept","image/*",1,"file-input",3,"id","change"],[1,"btn","btn-sm","text-ellipsis",3,"for"],[4,"ngIf"],["class","btn btn-error btn-sm mt-2",3,"click",4,"ngIf"],["class","bar bar-sm mt-2",4,"ngIf"],["class","image-preview img-fit-contain mt-2",3,"src",4,"ngIf"],["class","toast toast-error",4,"ngIf"],[1,"btn","btn-error","btn-sm","mt-2",3,"click"],[1,"bar","bar-sm","mt-2"],["role","progressbar",1,"bar-item"],[1,"image-preview","img-fit-contain","mt-2",3,"src"],[1,"toast","toast-error"],[1,"btn","btn-clear","float-right",3,"click"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1,2),c.Qb(3,"input",3),c.Xb("change",function(t){return e.onFileChange(t)}),c.Pb(),c.Qb(4,"label",4),c.vc(5,ee,2,0,"span",5),c.vc(6,ie,2,0,"span",5),c.vc(7,ne,2,1,"span",5),c.Pb(),c.vc(8,ce,2,0,"button",6),c.vc(9,oe,2,2,"div",7),c.vc(10,re,1,1,"img",8),c.Pb(),c.Pb(),c.vc(11,ae,3,1,"div",9)),2&t&&(c.Ab(1),c.ec("ngClass",c.ic(10,se,e.isDragOver)),c.Ab(2),c.ec("id",e.controlId),c.Ab(1),c.ec("for",e.controlId),c.Ab(1),c.ec("ngIf",null===e.file&&null===e.imageURL),c.Ab(1),c.ec("ngIf",null===e.file&&null!==e.imageURL),c.Ab(1),c.ec("ngIf",null!==e.file),c.Ab(1),c.ec("ngIf",null!==e.imageURL),c.Ab(1),c.ec("ngIf",e.isUploading),c.Ab(1),c.ec("ngIf",null!==e.imageURL),c.Ab(1),c.ec("ngIf",null!==e.fileError))},directives:[m.i,m.k],styles:["#drop-area[_ngcontent-%COMP%]{border:2px dashed #5755d9;border-radius:.1rem;display:flex;align-content:center;justify-content:center;flex-direction:column}.form-group.has-error[_ngcontent-%COMP%] > #drop-area[_ngcontent-%COMP%]{border:2px dashed #e85600}#drop-area.drag-over[_ngcontent-%COMP%]{cursor:pointer;background:#f1f1fc}.file-input[_ngcontent-%COMP%]{display:none}.image-preview[_ngcontent-%COMP%]{height:10vh}"]}),t})();function de(t,e){1&t&&(c.Qb(0,"div",11),c.Qb(1,"label",9),c.wc(2,"Image"),c.Pb(),c.Mb(3,"dd-image-upload",12),c.Pb())}function ue(t,e){1&t&&(c.Qb(0,"p",13),c.wc(1," A name is required "),c.Pb())}function be(t,e){1&t&&(c.Qb(0,"p",13),c.wc(1," The name cannot be shorter than 3 characters "),c.Pb())}function pe(t,e){1&t&&(c.Qb(0,"p",13),c.wc(1," The name cannot be longer than 30 characters "),c.Pb())}const he=function(t){return{"has-error":t}};let me=(()=>{class t{constructor(){}ngOnInit(){this.formGroup.addControl("name",new a.e(this.campaign?this.campaign.name:null,[a.v.required,a.v.maxLength(30),a.v.minLength(2)])),this.formGroup.addControl("content",new a.e(this.campaign?this.campaign.content:null)),this.formGroup.addControl("imageId",new a.e(this.includeImage?""!==this.campaign.imageId&&this.campaign?this.campaign.imageId:null:"placeholder",[a.v.required]))}get name(){return this.formGroup.get("name")}get description(){return this.formGroup.get("description")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-campaign-form"]],inputs:{formGroup:"formGroup",campaign:"campaign",includeImage:"includeImage"},decls:15,vars:8,consts:[[1,"container","grid-xl",3,"formGroup"],[1,"columns"],["class","column col-3 col-md-12 col-mx-auto",4,"ngIf"],[1,"column","col-9","col-md-12"],[1,"form-group",3,"ngClass"],["for","name",1,"form-label"],["type","text","name","name","formControlName","name","id","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],[1,"form-group"],[1,"form-label"],["simple","true","formControlName","content","placeholder","Description"],[1,"column","col-3","col-md-12","col-mx-auto"],["formControlName","imageId"],[1,"form-input-hint"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.vc(2,de,4,0,"div",2),c.Qb(3,"div",3),c.Qb(4,"div",4),c.Qb(5,"label",5),c.wc(6,"Name"),c.Pb(),c.Mb(7,"input",6),c.vc(8,ue,2,0,"p",7),c.vc(9,be,2,0,"p",7),c.vc(10,pe,2,0,"p",7),c.Pb(),c.Qb(11,"div",8),c.Qb(12,"label",9),c.wc(13,"Description"),c.Pb(),c.Mb(14,"dd-quill",10),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.ec("formGroup",e.formGroup),c.Ab(2),c.ec("ngIf",e.includeImage),c.Ab(2),c.ec("ngClass",c.ic(6,he,e.name.invalid&&(e.name.dirty||e.name.touched))),c.Ab(4),c.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.required),c.Ab(1),c.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.minlength),c.Ab(1),c.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.maxlength))},directives:[a.n,a.i,m.k,m.i,a.b,a.m,a.g,J.a,le],styles:[""]}),t})();const ge=[300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3],fe=[1e3,2250,3750,5500,7500,1e4,13e3,16500,20500,26e3,32e3,39e3,47e3,57e3,69e3,83e3,99e3,119e3,143e3,175e3,21e4,255e3,31e4,375e3,45e4,55e4,675e3,825e3,1e6];let ve=(()=>{class t{constructor(){}getPresets(){return t=this,void 0,i=function*(){return[{name:"DnD 5E",xpTable:ge},{name:"DnD 4E",xpTable:fe}]},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ye=["presets"];function Pe(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",16),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb().usePreset(i)}),c.Qb(1,"h6"),c.wc(2),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(2),c.xc(t.name)}}function we(t,e){1&t&&(c.Qb(0,"p",20),c.wc(1," XP value must be more than the previous level "),c.Pb())}function Ie(t,e){1&t&&(c.Qb(0,"p",20),c.wc(1," XP value is required "),c.Pb())}function Ce(t,e){1&t&&(c.Qb(0,"p",20),c.wc(1," XP value must be more than 0 "),c.Pb())}function Qe(t,e){1&t&&(c.Qb(0,"p",20),c.wc(1," The max xp value is 2,147,483,647 "),c.Pb())}const Ae=function(t){return{"has-error":t}};function ke(t,e){if(1&t&&(c.Qb(0,"div",17),c.Qb(1,"div",6),c.Qb(2,"label",7),c.wc(3),c.Pb(),c.Pb(),c.Qb(4,"div",8),c.Mb(5,"input",18),c.vc(6,we,2,0,"p",19),c.vc(7,Ie,2,0,"p",19),c.vc(8,Ce,2,0,"p",19),c.vc(9,Qe,2,0,"p",19),c.Pb(),c.Pb()),2&t){const t=e.index,i=c.Zb();c.ec("ngClass",c.ic(7,Ae,i.hasOrderError(t)||i.controls[t].invalid&&(i.controls[t].dirty||i.controls[t].touched))),c.Ab(3),c.yc("Level ",t+2,""),c.Ab(2),c.ec("formControlName",t),c.Ab(1),c.ec("ngIf",i.hasOrderError(t)),c.Ab(1),c.ec("ngIf",i.controls[t].invalid&&(i.controls[t].dirty||i.controls[t].touched)&&i.controls[t].errors.required),c.Ab(1),c.ec("ngIf",i.controls[t].invalid&&(i.controls[t].dirty||i.controls[t].touched)&&i.controls[t].errors.min),c.Ab(1),c.ec("ngIf",i.controls[t].invalid&&(i.controls[t].dirty||i.controls[t].touched)&&i.controls[t].errors.max)}}const xe=t=>{let e=0;const i={};for(let n=0;n<t.value.length;n++)t.value[n]&&(t.value[n]>e?e=t.value[n]:i[`order-${n}`]=!0);return Object.keys(i).length>0?i:null};let Te=(()=>{class t{constructor(t){this.presets=t}ngOnInit(){if(!this.campaign)throw new Error("The param campaign is required!");this.presets.getPresets().then(t=>this.presetList=t),this.formGroup.addControl("experienceTable",new a.c(this.campaign.experienceTable.map(t=>this.createRow(t)),xe))}createRow(t){return new a.e(t||0,[a.v.required,a.v.min(0)])}usePreset(t){this.formArray.controls=t.xpTable.map(t=>this.createRow(t)),this.presetsModal.close(null)}addRow(){this.formArray.push(this.createRow())}removeRow(){this.formArray.removeAt(this.controls.length-1)}hasOrderError(t){return this.formArray.errors&&this.formArray.errors[`order-${t}`]}get formArray(){return this.formGroup.get("experienceTable")}get controls(){return this.formArray.controls}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(ve))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-experience-table-editor"]],viewQuery:function(t,e){if(1&t&&c.Ac(ye,3),2&t){let t;c.lc(t=c.Yb())&&(e.presetsModal=t.first)}},inputs:{campaign:"campaign",formGroup:"formGroup"},decls:23,vars:4,consts:[["presets",""],["modal-header",""],["modal-body",""],["class","card p-1 hoverable mb-2",3,"click",4,"ngFor","ngForOf"],[1,"form-horizontal",3,"formGroup"],[1,"form-group"],[1,"col-1","col-lg-2","col-sm-12"],[1,"form-label","text-bold"],[1,"col-11","col-lg-10","col-sm-12"],["type","number","value","0","disabled","",1,"form-input"],["class","form-group","formArrayName","experienceTable",3,"ngClass",4,"ngFor","ngForOf"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"btn","btn-sm","ml-2",3,"click"],[1,"btn","btn-sm","btn-error","ml-2",3,"disabled","click"],[1,"icon","icon-cross"],[1,"card","p-1","hoverable","mb-2",3,"click"],["formArrayName","experienceTable",1,"form-group",3,"ngClass"],["type","number","placeholder","XP",1,"form-input",3,"formControlName"],["class","form-input-hint",4,"ngIf"],[1,"form-input-hint"]],template:function(t,e){if(1&t){const t=c.Rb();c.Qb(0,"dd-modal",null,0),c.Qb(2,"div",1),c.Qb(3,"h5"),c.wc(4,"Experience Table Presets"),c.Pb(),c.Pb(),c.Qb(5,"div",2),c.vc(6,Pe,3,1,"div",3),c.Pb(),c.Pb(),c.Qb(7,"div",4),c.Qb(8,"div",5),c.Qb(9,"div",6),c.Qb(10,"label",7),c.wc(11,"Level 1"),c.Pb(),c.Pb(),c.Qb(12,"div",8),c.Mb(13,"input",9),c.Pb(),c.Pb(),c.vc(14,ke,10,9,"div",10),c.Pb(),c.Qb(15,"button",11),c.Xb("click",function(){return e.addRow()}),c.Mb(16,"i",12),c.wc(17," Add Level\n"),c.Pb(),c.Qb(18,"button",13),c.Xb("click",function(){return c.oc(t),c.mc(1).open()}),c.wc(19,"Use Preset"),c.Pb(),c.Qb(20,"button",14),c.Xb("click",function(){return e.removeRow()}),c.Mb(21,"i",15),c.wc(22," Remove Level\n"),c.Pb()}2&t&&(c.Ab(6),c.ec("ngForOf",e.presetList),c.Ab(1),c.ec("formGroup",e.formGroup),c.Ab(7),c.ec("ngForOf",e.controls),c.Ab(6),c.ec("disabled",0===e.controls.length))},directives:[D.a,m.j,a.n,a.i,a.d,m.i,a.q,a.b,a.m,a.g,m.k],styles:[""]}),t})();function Ee(t,e){1&t&&c.Mb(0,"div",24)}function Le(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",10),c.Qb(1,"div",2),c.vc(2,Ee,1,0,"div",11),c.Qb(3,"div",12),c.Mb(4,"i",13),c.Pb(),c.Qb(5,"div",14),c.Qb(6,"div",15),c.Qb(7,"label",16),c.wc(8,"Name"),c.Pb(),c.Mb(9,"input",17),c.Pb(),c.Pb(),c.Qb(10,"div",14),c.Qb(11,"div",15),c.Qb(12,"label",16),c.wc(13,"Value"),c.Pb(),c.Mb(14,"input",18),c.Pb(),c.Pb(),c.Qb(15,"div",14),c.Qb(16,"div",15),c.Qb(17,"label",19),c.wc(18,"Conversion"),c.Pb(),c.Qb(19,"label",20),c.Mb(20,"input",21),c.Mb(21,"i",9),c.wc(22," Use in conversions "),c.Pb(),c.Pb(),c.Pb(),c.Qb(23,"div",3),c.Qb(24,"label",19),c.wc(25,"Remove"),c.Pb(),c.Qb(26,"button",22),c.Xb("click",function(){c.oc(t);const i=e.index;return c.Zb().removeCurrencyLevel(i)}),c.Mb(27,"i",23),c.Pb(),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=e.index;c.ec("formGroup",e.$implicit),c.Ab(7),c.gc("for","cm-name-",t,""),c.Ab(2),c.gc("id","cm-name-",t,""),c.Ab(3),c.gc("for","cm-value-",t,""),c.Ab(2),c.gc("id","cm-value-",t,"")}}let Me=(()=>{class t{constructor(){}ngOnInit(){this.items=new a.c(this.campaign.currencyMap?this.campaign.currencyMap.map(this.getFormGroup):[{name:"gp",value:1,useInConversions:!0},{name:"cp",value:.01,useInConversions:!0},{name:"sp",value:.1,useInConversions:!0},{name:"pp",value:10,useInConversions:!1}].map(this.getFormGroup)),this.formGroup.addControl("currencyMap",this.items),this.formGroup.addControl("trackCoins",new a.e(this.campaign.trackCoins||!1))}getFormGroup(t){return new a.h({name:new a.e(t.name,[a.v.required,a.v.maxLength(20)]),value:new a.e(t.value,[a.v.required,a.v.min(.01)]),useInConversions:new a.e(t.useInConversions)})}removeCurrencyLevel(t){this.items.removeAt(t),0===this.items.length&&this.items.push(this.getFormGroup({name:"gp",value:1,useInConversions:!0})),this.formGroup.markAsDirty()}addCurrencyLevel(){this.items.push(this.getFormGroup({name:null,value:null,useInConversions:!0})),this.formGroup.markAsDirty()}drop(t){const e=this.items.at(t.previousIndex);this.items.removeAt(t.previousIndex),this.items.insert(t.currentIndex,e)}get controls(){return this.items.controls}get trackCoins(){return this.formGroup.get("trackCoins")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-currency-map-editor"]],inputs:{formGroup:"formGroup",campaign:"campaign"},decls:13,vars:2,consts:[["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",3,"formGroup",4,"ngFor","ngForOf"],[1,"columns"],[1,"column","col-auto"],[1,"btn","btn-sm","mt-2",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"form-checkbox","mt-2"],["type","checkbox",3,"formControl"],[1,"form-icon"],["cdkDrag","",3,"formGroup"],["class","drag-placeholder",4,"cdkDragPlaceholder"],["cdkDragHandle","",1,"column","col-auto","c-move"],[1,"icon","icon-resize-vert"],[1,"column"],[1,"form-group"],[1,"form-label",3,"for"],["type","text","name","name","formControlName","name",1,"form-input",3,"id"],["type","number","name","name","formControlName","value","step","0.01",1,"form-input",3,"id"],[1,"form-label"],[1,"form-checkbox"],["type","checkbox","formControlName","useInConversions"],[1,"btn","btn-sm","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"drag-placeholder"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Xb("cdkDropListDropped",function(t){return e.drop(t)}),c.vc(1,Le,28,5,"div",1),c.Qb(2,"div",2),c.Qb(3,"div",3),c.Qb(4,"button",4),c.Xb("click",function(){return e.addCurrencyLevel()}),c.Mb(5,"i",5),c.Qb(6,"span",6),c.wc(7," Add Level"),c.Pb(),c.Pb(),c.Pb(),c.Qb(8,"div",3),c.Qb(9,"label",7),c.Mb(10,"input",8),c.Mb(11,"i",9),c.wc(12," Track individual coins "),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(1),c.ec("ngForOf",e.controls),c.Ab(9),c.ec("formControl",e.trackCoins))},directives:[o.d,m.j,a.a,a.m,a.f,o.a,a.n,a.i,o.c,o.b,a.b,a.g,a.q],styles:[""]}),t})();var Se=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const Oe=["exporter"];function Ne(t,e){if(1&t&&c.Mb(0,"dd-exporter",3,4),2&t){const t=c.Zb();c.ec("conceptTypes",t.campaign.conceptTypes)}}function _e(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",17),c.Xb("click",function(){c.oc(t);const e=c.Zb(2);return e.expandXPTable=!e.expandXPTable}),c.wc(1," Expand "),c.Mb(2,"i",24),c.Pb()}}function Re(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",17),c.Xb("click",function(){c.oc(t);const e=c.Zb(2);return e.expandXPTable=!e.expandXPTable}),c.wc(1," Collapse "),c.Mb(2,"i",25),c.Pb()}}function Fe(t,e){1&t&&(c.Qb(0,"span",26),c.wc(1,"This is the experience table. This will determine entities' levels based on the amount of XP they have. For example, if level 2 was set to 30 XP, an entity would be level 2 when they reach 30 or above XP."),c.Pb())}function Ue(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Collapse "),c.Mb(2,"i",25),c.Pb())}function qe(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Expand "),c.Mb(2,"i",24),c.Pb())}function Ge(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",13),c.Qb(1,"div",7),c.Qb(2,"h3"),c.wc(3,"Entity Types"),c.Pb(),c.Pb(),c.Qb(4,"div",27),c.Qb(5,"button",17),c.Xb("click",function(){return c.oc(t),c.Zb(2).createEntityPreset()}),c.Mb(6,"i",28),c.Qb(7,"span",29),c.wc(8," New Entity Type"),c.Pb(),c.Pb(),c.Pb(),c.Pb()}}function De(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",30),c.Qb(1,"div",31),c.Mb(2,"i",32),c.Pb(),c.Qb(3,"p",33),c.wc(4,"There are no entity types :("),c.Pb(),c.Qb(5,"p",34),c.wc(6,"Click the button to create one"),c.Pb(),c.Qb(7,"div",35),c.Qb(8,"button",36),c.Xb("click",function(){return c.oc(t),c.Zb(2).createEntityPreset()}),c.wc(9," Create Type "),c.Pb(),c.Pb(),c.Pb()}}function Ze(t,e){if(1&t&&(c.Qb(0,"div",27),c.Qb(1,"figure",41),c.Mb(2,"img",42),c.Pb(),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(2),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.imageId,"",c.qc)}}function $e(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",38),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(3).selectEntityPreset(i)}),c.Qb(1,"div",6),c.vc(2,Ze,3,1,"div",39),c.Qb(3,"div",7),c.Qb(4,"h4",40),c.wc(5),c.Pb(),c.Qb(6,"span",26),c.wc(7),c.ac(8,"truncate"),c.Pb(),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(2),c.ec("ngIf",t.imageId),c.Ab(3),c.xc(t.name),c.Ab(2),c.xc(c.bc(8,3,t.description,120))}}function Xe(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,$e,9,6,"div",37),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngForOf",t.campaign.entityPresets)}}function He(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",13),c.Qb(1,"div",7),c.Qb(2,"h3"),c.wc(3,"Concept Types"),c.Pb(),c.Pb(),c.Qb(4,"div",27),c.Qb(5,"button",17),c.Xb("click",function(){return c.oc(t),c.Zb(2).createConceptType()}),c.Mb(6,"i",28),c.Qb(7,"span",29),c.wc(8," New Concept Type"),c.Pb(),c.Pb(),c.Pb(),c.Pb()}}function je(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",30),c.Qb(1,"div",31),c.Mb(2,"i",32),c.Pb(),c.Qb(3,"p",33),c.wc(4,"There are no concept types :("),c.Pb(),c.Qb(5,"p",34),c.wc(6,"Click the button to create one"),c.Pb(),c.Qb(7,"div",35),c.Qb(8,"button",36),c.Xb("click",function(){return c.oc(t),c.Zb(2).createConceptType()}),c.wc(9," Create Concept Type "),c.Pb(),c.Pb(),c.Pb()}}function Ve(t,e){if(1&t&&(c.Qb(0,"div",27),c.Mb(1,"img",43),c.Pb()),2&t){const t=c.Zb().$implicit,e=c.Zb(3);c.Ab(1),c.fc("src",e.getIcon(t.icon),c.qc)}}function ze(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",38),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(3).selectConceptType(i)}),c.Qb(1,"div",6),c.vc(2,Ve,2,1,"div",39),c.Qb(3,"div",7),c.Qb(4,"h4",40),c.wc(5),c.Pb(),c.Qb(6,"span",26),c.wc(7),c.ac(8,"truncate"),c.Pb(),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(2),c.ec("ngIf",t.icon),c.Ab(3),c.xc(t.name),c.Ab(2),c.xc(c.bc(8,3,t.description,120))}}function Be(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,ze,9,6,"div",37),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngForOf",t.campaign.conceptTypes)}}function Ye(t,e){1&t&&(c.Qb(0,"h3",44),c.wc(1,"Other Stuff"),c.Pb())}const We=function(t){return{loading:t}};function Ke(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",45),c.Qb(1,"div",46),c.Qb(2,"button",36),c.Xb("click",function(){return c.oc(t),c.Zb(2).export()}),c.Mb(3,"i",47),c.wc(4," Export Data "),c.Pb(),c.Qb(5,"label",48),c.Mb(6,"i",49),c.wc(7," Import Data "),c.Qb(8,"input",50),c.Xb("change",function(e){return c.oc(t),c.Zb(2).import(e)}),c.Pb(),c.Pb(),c.Pb(),c.Qb(9,"div",46),c.Qb(10,"h4",51),c.wc(11,"Danger!"),c.Pb(),c.Qb(12,"button",52),c.Xb("click",function(){return c.oc(t),c.Zb(2).delete()}),c.Mb(13,"i",53),c.wc(14," Delete Campaign "),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(5),c.ec("ngClass",c.ic(2,We,t.importing)),c.Ab(7),c.ec("ngClass",c.ic(4,We,t.deleting))}}function Je(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",5),c.Qb(1,"div",6),c.Qb(2,"div",7),c.Qb(3,"h2"),c.wc(4),c.Pb(),c.Pb(),c.Qb(5,"div",8),c.Qb(6,"button",9),c.Xb("click",function(){return c.oc(t),c.Zb().cancel()}),c.wc(7,"Cancel"),c.Pb(),c.Qb(8,"button",10),c.Xb("click",function(){return c.oc(t),c.Zb().save()}),c.wc(9," Save "),c.Pb(),c.Pb(),c.Pb(),c.Qb(10,"h3",11),c.wc(11,"General Settings"),c.Pb(),c.Mb(12,"dd-campaign-form",12),c.Qb(13,"div",13),c.Qb(14,"div",7),c.Qb(15,"h3",11),c.wc(16,"Experience Table"),c.Pb(),c.Pb(),c.Qb(17,"div",8),c.vc(18,_e,3,0,"button",14),c.vc(19,Re,3,0,"button",14),c.Pb(),c.Pb(),c.vc(20,Fe,2,0,"span",15),c.Mb(21,"dd-experience-table-editor",16),c.Qb(22,"div",13),c.Qb(23,"div",7),c.Qb(24,"h3",11),c.wc(25,"Currency Map"),c.Pb(),c.Pb(),c.Qb(26,"div",8),c.Qb(27,"button",17),c.Xb("click",function(){c.oc(t);const e=c.Zb();return e.expandCurrencyMapEditor=!e.expandCurrencyMapEditor}),c.vc(28,Ue,3,0,"span",18),c.vc(29,qe,3,0,"span",18),c.Pb(),c.Pb(),c.Pb(),c.Mb(30,"dd-currency-map-editor",19),c.vc(31,Ge,9,0,"div",20),c.vc(32,De,10,0,"div",21),c.vc(33,Xe,2,1,"div",18),c.vc(34,He,9,0,"div",20),c.vc(35,je,10,0,"div",21),c.vc(36,Be,2,1,"div",18),c.vc(37,Ye,2,0,"h3",22),c.vc(38,Ke,15,6,"div",23),c.Pb()}if(2&t){const t=c.Zb();c.Ab(4),c.xc(t.editing?"Settings":"Create Campaign"),c.Ab(4),c.ec("disabled",t.formGroup.invalid||t.formGroup.pristine)("ngClass",c.ic(25,We,t.saving)),c.Ab(4),c.ec("campaign",t.campaign)("formGroup",t.formGroup)("includeImage",t.editing),c.Ab(6),c.ec("ngIf",!t.expandXPTable),c.Ab(1),c.ec("ngIf",t.expandXPTable),c.Ab(1),c.ec("ngIf",t.expandXPTable),c.Ab(1),c.ec("campaign",t.campaign)("formGroup",t.formGroup)("hidden",!t.expandXPTable),c.Ab(7),c.ec("ngIf",t.expandCurrencyMapEditor),c.Ab(1),c.ec("ngIf",!t.expandCurrencyMapEditor),c.Ab(1),c.ec("hidden",!t.expandCurrencyMapEditor)("formGroup",t.formGroup)("campaign",t.campaign),c.Ab(1),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngIf",t.editing&&0===t.campaign.entityPresets.length),c.Ab(1),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngIf",t.editing&&0===t.campaign.conceptTypes.length),c.Ab(1),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngIf",t.editing)}}function ti(t,e){1&t&&c.Mb(0,"div",54)}let ei=(()=>{class t{constructor(t,e,i,n,c,o,r,a){this.campaignService=t,this.router=e,this.route=i,this.login=n,this.location=c,this.toast=o,this.http=r,this.iconService=a,this.saving=!1,this.deleting=!1,this.importing=!1,this.expandXPTable=!1,this.expandCurrencyMapEditor=!1}ngOnInit(){this.formGroup=new a.h({}),this.expandXPTable=!this.editing,this.expandCurrencyMapEditor=!this.editing,null==this.campaign.experienceTable&&(this.campaign.experienceTable=[]),"true"===this.route.snapshot.queryParamMap.get("refresh")&&(this.campaignService.refreshCurrentCampaign(),this.router.navigate([],{replaceUrl:!0}))}canDeactivate(){return!this.formGroup.dirty}selectEntityPreset(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entitytypes",t.id,"edit"])}selectConceptType(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepttypes",t.id,"edit"])}createEntityPreset(){return Se(this,void 0,void 0,function*(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entitytypes","create"])})}createConceptType(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepttypes","create"])}save(){return Se(this,void 0,void 0,function*(){if(this.saving=!0,this.editing){try{const t=this.formGroup.value,e={name:t.name,content:t.content,imageId:t.imageId,experienceTable:t.experienceTable,userId:this.login.id,currencyMap:t.currencyMap,trackCoins:t.trackCoins,id:this.campaign.id};yield this.campaignService.updateCampaign(e),this.campaignService.campaign=Object.assign(Object.assign({},this.campaign),e),this.formGroup.markAsPristine()}catch(t){throw t}this.toast.info("Campaign settings updated")}else{const e=this.formGroup.value;try{const t=yield this.campaignService.createCampaign({name:e.name,content:e.content,imageId:e.imageId,experienceTable:e.experienceTable,currencyMap:e.currencyMap,trackCoins:e.trackCoins,userId:this.login.id,id:""});this.router.navigate(["campaigns",t.id,"settings"])}catch(t){throw t}}this.saving=!1})}cancel(){this.location.back()}delete(){return Se(this,void 0,void 0,function*(){if((yield Kt.a.fire({title:"Are you sure?",text:"This will completely delete this campaign and everything that goes along with it. This cannot be undone!",showCancelButton:!0,cancelButtonText:"Back to safety",confirmButtonText:"\u2622\ufe0f Nuke It"})).value){this.deleting=!0;try{yield this.campaignService.deleteCampaign(this.campaign)}catch(t){throw t}this.deleting=!1,this.router.navigate(["home"])}})}export(){this.exporter.doExport()}import(t){return Se(this,void 0,void 0,function*(){const e=t.target.files[0];if(-1!==["application/zip","application/x-zip-compressed","multipart/x-zip"].indexOf(e.type)){this.importing=!0;try{const t=new FormData;t.append("file",e),t.append("campaignId",this.campaignService.campaign.id),this.http.post(`${b.a.apiURL}/import`,t).subscribe(t=>{const{articles:e,entityPresets:i,quests:n,concepts:c,conceptTypes:o}=t;this.importing=!1,Kt.a.fire({title:"All Done!",html:`All done importing the things. Here's how it went:<br/>Articles: ${e}<br/>Entity Types: ${i}<br/>Concepts: ${c}<br/>Quests: ${n}<br/>ConceptTypes: ${o}`}).then(()=>this.campaignService.refreshCurrentCampaign())},t=>{throw Kt.a.fire({type:"error",title:"Hmm...",text:"Something went wrong during import. Please try again"}),t})}catch(i){throw i}}else Kt.a.fire({type:"error",title:"Invalid File Type!",text:"File should be a zip file created from an export"})})}getIcon(t){return this.iconService.getIconSrc(t)}get campaign(){return this.editing?this.campaignService.campaign:{id:"",name:"",content:null,imageId:"",userId:"",experienceTable:[]}}get editing(){return this.route.snapshot.data.editing}get loading(){return this.campaignService.loadingCampaign}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b),c.Lb(p.c),c.Lb(p.a),c.Lb(y.a),c.Lb(m.g),c.Lb(u.b),c.Lb(r.b),c.Lb(Jt.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-campaign-settings"]],viewQuery:function(t,e){if(1&t&&c.Ac(Oe,1),2&t){let t;c.lc(t=c.Yb())&&(e.exporter=t.first)}},decls:3,vars:3,consts:[[3,"conceptTypes",4,"ngIf"],["class","container grid-xl",4,"ngIf"],["class","loading",4,"ngIf"],[3,"conceptTypes"],["exporter",""],[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],[1,"btn","mr-2",3,"click"],[1,"btn","btn-primary",3,"disabled","ngClass","click"],[1,"mb-0"],[3,"campaign","formGroup","includeImage"],[1,"columns","big-space"],["class","btn btn-sm",3,"click",4,"ngIf"],["class","text-gray",4,"ngIf"],[3,"campaign","formGroup","hidden"],[1,"btn","btn-sm",3,"click"],[4,"ngIf"],[3,"hidden","formGroup","campaign"],["class","columns big-space",4,"ngIf"],["class","empty",4,"ngIf"],["class","mb-2 big-space",4,"ngIf"],["class","card p-2",4,"ngIf"],[1,"icon","icon-arrow-down"],[1,"icon","icon-arrow-up"],[1,"text-gray"],[1,"column","col-auto"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["class","card p-2 mb-2 hoverable",3,"click",4,"ngFor","ngForOf"],[1,"card","p-2","mb-2","hoverable",3,"click"],["class","column col-auto",4,"ngIf"],[1,"mb-1"],[1,"avatar","avatar-lg"],[3,"src"],[1,"img-responsive",3,"src"],[1,"mb-2","big-space"],[1,"card","p-2"],[1,"card-body"],[1,"icon","icon-download"],["for","import-button",1,"btn","btn-primary","ml-2",3,"ngClass"],[1,"icon","icon-upload"],["type","file","id","import-button",2,"display","none",3,"change"],[1,"mb-2"],[1,"btn","btn-error",3,"ngClass","click"],[1,"icon","icon-cross"],[1,"loading"]],template:function(t,e){1&t&&(c.vc(0,Ne,2,1,"dd-exporter",0),c.vc(1,Je,39,27,"div",1),c.vc(2,ti,1,0,"div",2)),2&t&&(c.ec("ngIf",e.editing),c.Ab(1),c.ec("ngIf",e.campaign||!e.editing),c.Ab(1),c.ec("ngIf",e.loading))},directives:[m.k,Yt,m.i,me,a.n,a.i,Te,Me,m.j],pipes:[d.a],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),t})();var ii=i("wNqa");function ni(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",8),c.Xb("click",function(){return c.oc(t),c.Zb().addQuest()}),c.Mb(1,"i",9),c.Qb(2,"span",10),c.wc(3," Add Quest"),c.Pb(),c.Pb()}}function ci(t,e){1&t&&c.Mb(0,"div",11)}function oi(t,e){1&t&&(c.Qb(0,"p",19),c.wc(1," Click the button to create one. "),c.Pb())}function ri(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",20),c.Xb("click",function(){return c.oc(t),c.Zb(2).addQuest()}),c.wc(1," Create Quest "),c.Pb()}}function ai(t,e){if(1&t&&(c.Qb(0,"div",12),c.Qb(1,"div",13),c.Mb(2,"i",14),c.Pb(),c.Qb(3,"p",15),c.wc(4,"There are no quests here"),c.Pb(),c.vc(5,oi,2,0,"p",16),c.Qb(6,"div",17),c.vc(7,ri,2,0,"button",18),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(5),c.ec("ngIf",t.editable),c.Ab(2),c.ec("ngIf",t.editable)}}function si(t,e){1&t&&(c.Qb(0,"div",28),c.Mb(1,"i",29),c.Pb())}function li(t,e){1&t&&(c.Qb(0,"div",28),c.Mb(1,"i",30),c.Pb())}function di(t,e){1&t&&(c.Qb(0,"div",28),c.Mb(1,"i",31),c.Pb())}function ui(t,e){1&t&&(c.Qb(0,"div",28),c.Mb(1,"i",32),c.Pb())}function bi(t,e){1&t&&(c.Qb(0,"span",33),c.wc(1,"Unavailable"),c.Pb())}function pi(t,e){1&t&&(c.Qb(0,"span",34),c.wc(1,"Hidden"),c.Pb())}const hi=function(t){return{"text-gray":t}};function mi(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",22),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).viewQuest(i)}),c.Qb(1,"div",23),c.vc(2,si,2,0,"div",24),c.vc(3,li,2,0,"div",24),c.vc(4,di,2,0,"div",24),c.vc(5,ui,2,0,"div",24),c.Qb(6,"div",2),c.Qb(7,"span",25),c.wc(8),c.Pb(),c.vc(9,bi,2,0,"span",26),c.vc(10,pi,2,0,"span",27),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(2),c.ec("ngIf",1===t.status),c.Ab(1),c.ec("ngIf",2===t.status),c.Ab(1),c.ec("ngIf",3===t.status),c.Ab(1),c.ec("ngIf",4===t.status),c.Ab(2),c.ec("ngClass",c.ic(8,hi,!t.visible)),c.Ab(1),c.yc(" ",t.name," "),c.Ab(1),c.ec("ngIf",!t.available),c.Ab(1),c.ec("ngIf",!t.visible)}}function gi(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,mi,11,10,"div",21),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.quests)}}let fi=(()=>{class t{constructor(t,e,i,n){this.router=t,this.campaignService=e,this.questService=i,this.route=n,this.loading=!1}ngOnInit(){this.loadQuests()}loadQuests(){return t=this,void 0,i=function*(){this.loading=!0;try{this.quests=yield this.questService.getQuests(this.campaignService.campaign.id)}catch(t){throw t}this.loading=!1},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}viewQuest(t){this.router.navigate([t.id],{relativeTo:this.route})}addQuest(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests","create"])}get editable(){return this.campaignService.canEdit}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.c),c.Lb(h.b),c.Lb(ii.a),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-quest-manager"]],decls:10,vars:4,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-sm",3,"click",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"loading","loading-lg"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],[1,"empty-action"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"empty-subtitle"],[1,"btn","btn-primary",3,"click"],["class","card p-2 mb-2 hoverable",3,"click",4,"ngFor","ngForOf"],[1,"card","p-2","mb-2","hoverable",3,"click"],[1,"columns","col-gapless"],["class","column col-auto mr-1",4,"ngIf"],[3,"ngClass"],["class","label label-rounded",4,"ngIf"],["class","label label-rounded ml-1",4,"ngIf"],[1,"column","col-auto","mr-1"],[1,"icon","icon-stop"],[1,"icon","icon-flag"],[1,"icon","icon-time"],[1,"icon","icon-check"],[1,"label","label-rounded"],[1,"label","label-rounded","ml-1"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"div",2),c.Qb(3,"h3"),c.wc(4,"Quests"),c.Pb(),c.Pb(),c.Qb(5,"div",3),c.vc(6,ni,4,0,"button",4),c.Pb(),c.Pb(),c.vc(7,ci,1,0,"div",5),c.vc(8,ai,8,2,"div",6),c.vc(9,gi,2,1,"div",7),c.Pb()),2&t&&(c.Ab(6),c.ec("ngIf",e.editable),c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.quests&&0===e.quests.length),c.Ab(1),c.ec("ngIf",e.quests))},directives:[m.k,m.j,m.i],styles:[""]}),t})();function vi(t,e){1&t&&c.Mb(0,"div",2)}function yi(t,e){1&t&&(c.Qb(0,"div",9),c.Mb(1,"i",10),c.Pb())}const Pi=function(t){return{"text-gray":t}};function wi(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",4),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).viewQuest(i)}),c.Qb(1,"div",5),c.vc(2,yi,2,0,"div",6),c.Qb(3,"div",7),c.Qb(4,"span",8),c.wc(5),c.Pb(),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(2),c.ec("ngIf",t.active),c.Ab(2),c.ec("ngClass",c.ic(3,Pi,!t.visible)),c.Ab(1),c.yc(" ",t.name," ")}}function Ii(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,wi,6,5,"div",3),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.quests)}}let Ci=(()=>{class t{constructor(t,e,i){this.router=t,this.questService=e,this.campaignService=i,this.loading=!1}ngOnInit(){this.loadQuests()}viewQuest(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",t.id])}loadQuests(){return t=this,void 0,i=function*(){this.loading=!0;try{this.quests=yield this.questService.getQuests(this.campaignService.campaign.id,null,null,null,null,null,[ii.b.IN_PROGRESS])}catch(t){throw t}this.loading=!1},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.c),c.Lb(ii.a),c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-quest-quick-view"]],decls:2,vars:2,consts:[["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],["class","card p-2 hoverable mb-1",3,"click",4,"ngFor","ngForOf"],[1,"card","p-2","hoverable","mb-1",3,"click"],[1,"columns","col-gapless"],["class","column col-auto mr-1",4,"ngIf"],[1,"column"],[3,"ngClass"],[1,"column","col-auto","mr-1"],[1,"icon","icon-flag"]],template:function(t,e){1&t&&(c.vc(0,vi,1,0,"div",0),c.vc(1,Ii,2,1,"div",1)),2&t&&(c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.quests))},directives:[m.k,m.j,m.i],styles:[""]}),t})();function Qi(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",4),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).selectDie(i)}),c.Mb(1,"img",5),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(1),c.ec("src",t.src,c.qc)}}function Ai(t,e){if(1&t&&(c.Qb(0,"div",2),c.vc(1,Qi,2,1,"div",3),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.diceOptions)}}const ki=function(t,e){return{"col-12":t,"col-4 col-md-2 col-sm-4":e}};function xi(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",7),c.Qb(1,"button",8),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).selectDieCount(i)}),c.wc(2),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.ec("ngClass",c.jc(2,ki,1===t,1!==t)),c.Ab(2),c.yc(" ",t," ")}}function Ti(t,e){if(1&t&&(c.Qb(0,"div",2),c.vc(1,xi,3,5,"div",6),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.dieCountOptions)}}const Ei=function(t){return{"rotate-scale-up":t}};function Li(t,e){if(1&t&&(c.Qb(0,"div",17),c.Mb(1,"img",18),c.Qb(2,"div",19),c.wc(3),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(1),c.ec("ngClass",c.ic(3,Ei,t.rollValue===t.dieValue))("src",i.die.src,c.qc),c.Ab(2),c.yc(" ",t.rollValue," ")}}function Mi(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",2),c.Qb(1,"div",9),c.Qb(2,"h4"),c.wc(3),c.Pb(),c.Pb(),c.vc(4,Li,4,5,"div",10),c.Qb(5,"div",11),c.Qb(6,"button",12),c.Xb("click",function(){return c.oc(t),c.Zb().reset()}),c.Mb(7,"i",13),c.Qb(8,"span",14),c.wc(9," Reset"),c.Pb(),c.Pb(),c.Qb(10,"button",15),c.Xb("click",function(){return c.oc(t),c.Zb().roll()}),c.Mb(11,"i",16),c.Qb(12,"span",14),c.wc(13," Roll Again"),c.Pb(),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(3),c.xc(t.resultTotal),c.Ab(1),c.ec("ngForOf",t.rollResults)}}let Si=(()=>{class t{constructor(){this.diceOptions=[{n:4,src:"/assets/dice/d4.png"},{n:6,src:"/assets/dice/d6.png"},{n:8,src:"/assets/dice/d8.png"},{n:10,src:"/assets/dice/d10.png"},{n:12,src:"/assets/dice/d12.png"},{n:20,src:"/assets/dice/d20.png"}],this.dieCountOptions=[1,2,3,4,5,6,7,8,9,10,12]}ngOnInit(){}selectDie(t){this.die=t}selectDieCount(t){this.dieCount=t,this.roll()}roll(){const t=[],e=new P.Chance;for(let i=0;i<this.dieCount;i++){const i=e.integer({min:1,max:this.die.n});t.push({dieValue:this.die.n,rollValue:i})}this.rollResults=t}reset(){this.die=void 0,this.dieCount=void 0,this.rollResults=void 0}get resultTotal(){return this.rollResults?this.rollResults.map(t=>t.rollValue).reduce((t,e)=>t+e):0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-quick-dice"]],decls:4,vars:3,consts:[[1,"card","p-1"],["class","columns",4,"ngIf"],[1,"columns"],["class","column col-4 col-md-2 col-sm-4 text-center hoverable",3,"click",4,"ngFor","ngForOf"],[1,"column","col-4","col-md-2","col-sm-4","text-center","hoverable",3,"click"],["width","45",3,"src"],["class","column mb-1",3,"ngClass",4,"ngFor","ngForOf"],[1,"column","mb-1",3,"ngClass"],[1,"btn","btn-primary","w-100",3,"click"],[1,"column","text-center","col-12"],["class","column col-4 col-md-2 col-sm-4 col-mx-auto mb-1 text-center",4,"ngFor","ngForOf"],[1,"column","col-12","text-center"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[1,"btn","btn-sm","ml-2",3,"click"],[1,"icon","icon-refresh"],[1,"column","col-4","col-md-2","col-sm-4","col-mx-auto","mb-1","text-center"],["width","24",3,"ngClass","src"],[1,"text-bold"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,Ai,2,1,"div",1),c.vc(2,Ti,2,1,"div",1),c.vc(3,Mi,14,2,"div",1),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",!e.die),c.Ab(1),c.ec("ngIf",e.die&&!e.dieCount),c.Ab(1),c.ec("ngIf",e.rollResults))},directives:[m.k,m.j,m.i],styles:[".rotate-scale-up[_ngcontent-%COMP%]{-webkit-animation:rotate-scale-up .65s cubic-bezier(.165,.84,.44,1) infinite both;animation:rotate-scale-up .65s cubic-bezier(.165,.84,.44,1) infinite both}@-webkit-keyframes rotate-scale-up{0%{transform:scale(1) rotate(0)}50%{transform:scale(1.4) rotate(180deg)}to{transform:scale(1) rotate(1turn)}}@keyframes rotate-scale-up{0%{transform:scale(1) rotate(0)}50%{transform:scale(1.4) rotate(180deg)}to{transform:scale(1) rotate(1turn)}}"]}),t})();const Oi=function(t,e){return["/campaigns",t,"entities",e,"create"]};function Ni(t,e){if(1&t&&(c.Qb(0,"li",24),c.Qb(1,"a",25),c.wc(2),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(1),c.ec("routerLink",c.jc(2,Oi,i.campaign.id,t.id)),c.Ab(1),c.yc("Create ",t.name,"")}}const _i=function(t){return["/campaigns",t,"settings"]};function Ri(t,e){if(1&t&&(c.Qb(0,"li",24),c.Qb(1,"a",25),c.wc(2,"Settings"),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("routerLink",c.ic(1,_i,t.campaign.id))}}function Fi(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",26),c.Qb(1,"button",27),c.Xb("click",function(){return c.oc(t),c.Zb(2).manageMembers()}),c.Qb(2,"span",28),c.wc(3,"Manage "),c.Pb(),c.Mb(4,"i",29),c.Pb(),c.Pb()}}function Ui(t,e){if(1&t){const t=c.Rb();c.Qb(0,"span",38),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(3).selectEntity(i)}),c.Mb(1,"img",39),c.wc(2),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.imageId,"",c.qc),c.Ab(1),c.yc(" ",t.name," ")}}function qi(t,e){if(1&t&&(c.Qb(0,"div",30),c.Qb(1,"div",31),c.Qb(2,"figure",32),c.Mb(3,"img",33),c.Pb(),c.Pb(),c.Qb(4,"div",34),c.Qb(5,"div",35),c.wc(6),c.Pb(),c.Qb(7,"div",36),c.vc(8,Ui,3,2,"span",37),c.Pb(),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(3),c.ec("src",t.user.pictureURL,c.qc),c.Ab(3),c.xc(t.user.username),c.Ab(2),c.ec("ngForOf",i.userEntities(t.user.id))}}function Gi(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",26),c.Qb(1,"button",27),c.Xb("click",function(){return c.oc(t),c.Zb(2).manageQuests()}),c.Qb(2,"span",28),c.wc(3,"Manage "),c.Pb(),c.Mb(4,"i",29),c.Pb(),c.Pb()}}const Di=function(t,e){return["/campaigns",t,"concepts",e,"manage"]},Zi=function(t){return{"mb-2":t}};function $i(t,e){if(1&t&&(c.Qb(0,"button",42),c.wc(1),c.Pb()),2&t){const t=e.$implicit,i=e.index,n=c.Zb(3);c.ec("routerLink",c.jc(3,Di,n.campaign.id,t.id))("ngClass",c.ic(6,Zi,i!==n.campaign.conceptTypes.length-1)),c.Ab(1),c.yc(" ",t.pluralForm," ")}}function Xi(t,e){if(1&t&&(c.Qb(0,"div",40),c.vc(1,$i,2,8,"button",41),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngForOf",t.campaign.conceptTypes)}}function Hi(t,e){if(1&t&&(c.Qb(0,"div",1),c.Qb(1,"div",2),c.Qb(2,"div",3),c.Qb(3,"h1"),c.wc(4),c.Pb(),c.Pb(),c.Qb(5,"div",4),c.Qb(6,"h3"),c.wc(7),c.Pb(),c.Pb(),c.Qb(8,"div",5),c.Qb(9,"div",6),c.Qb(10,"button",7),c.wc(11,"Menu "),c.Mb(12,"i",8),c.Pb(),c.Qb(13,"ul",9),c.vc(14,Ni,3,5,"li",10),c.vc(15,Ri,3,3,"li",11),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Qb(16,"div",2),c.Qb(17,"div",12),c.Mb(18,"dd-quill",13),c.Pb(),c.Qb(19,"div",14),c.Qb(20,"div",15),c.Qb(21,"div",16),c.Qb(22,"div",2),c.Qb(23,"div",17),c.Qb(24,"h5"),c.wc(25,"Members"),c.Pb(),c.Pb(),c.vc(26,Fi,5,0,"div",18),c.Pb(),c.Pb(),c.Qb(27,"div",19),c.vc(28,qi,9,3,"div",20),c.Pb(),c.Pb(),c.Qb(29,"div",21),c.Qb(30,"div",16),c.Qb(31,"div",2),c.Qb(32,"div",17),c.Qb(33,"h5"),c.wc(34,"Active Quests"),c.Pb(),c.Pb(),c.vc(35,Gi,5,0,"div",18),c.Pb(),c.Pb(),c.Qb(36,"div",19),c.Mb(37,"dd-quest-quick-view"),c.Pb(),c.Pb(),c.vc(38,Xi,2,1,"div",22),c.Qb(39,"div",23),c.Mb(40,"dd-quick-dice"),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(4),c.xc(t.campaign.name),c.Ab(3),c.xc(t.campaign.name),c.Ab(7),c.ec("ngForOf",t.entityPresets),c.Ab(1),c.ec("ngIf",t.editable),c.Ab(3),c.ec("value",t.campaign.content),c.Ab(8),c.ec("ngIf",t.editable),c.Ab(2),c.ec("ngForOf",t.campaign.members),c.Ab(7),c.ec("ngIf",t.editable),c.Ab(3),c.ec("ngIf",t.campaign.conceptTypes&&t.campaign.conceptTypes.length>0)}}let ji=(()=>{class t{constructor(t,e,i){this.campaignService=t,this.router=e,this.route=i}ngOnInit(){}userEntities(t){return this.campaign.entities.filter(e=>e.userId===t&&!e.spawnable&&!e.spawnedFromId)}selectEntity(t){this.router.navigate(["..","entities",t.id],{relativeTo:this.route})}manageQuests(){this.router.navigate(["campaigns",this.campaign.id,"quests"])}manageMembers(){this.router.navigate(["campaigns",this.campaign.id,"members"])}get campaign(){return this.campaignService.campaign}get editable(){return this.campaignService.canEdit}get entityPresets(){return this.campaign.entityPresets.filter(t=>t.playerCreatable)}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b),c.Lb(p.c),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-campaign-landing"]],decls:1,vars:1,consts:[["class","container grid-xl",4,"ngIf"],[1,"container","grid-xl"],[1,"columns"],[1,"column","col-9","col-lg-8","col-md-12","hide-md"],[1,"column","col-6","col-md-12","show-md"],[1,"column","col-auto","col-ml-auto","hide-md"],[1,"dropdown","dropdown-right"],[1,"btn","btn-link","dropdown-toggle"],[1,"icon","icon-caret"],[1,"menu"],["class","menu-item",4,"ngFor","ngForOf"],["class","menu-item",4,"ngIf"],[1,"column","col-9","col-xl-8","col-md-12"],["readOnly","true",3,"value"],[1,"column","col-3","col-md-12","col-xl-4","col-ml-auto"],[1,"card"],[1,"card-header"],[1,"column"],["class","column col-auto col-ml-auto",4,"ngIf"],[1,"card-body"],["class","tile tile-centered mb-2",4,"ngFor","ngForOf"],[1,"card","mt-2"],["class","card mt-2 p-2",4,"ngIf"],[1,"mt-2"],[1,"menu-item"],[3,"routerLink"],[1,"column","col-auto","col-ml-auto"],[1,"btn","btn-sm",3,"click"],[1,"hide-sm"],[1,"icon","icon-menu"],[1,"tile","tile-centered","mb-2"],[1,"tile-icon"],[1,"avatar"],[3,"src"],[1,"tile-content"],[1,"tile-title"],[1,"d-flex"],["class","chip hoverable-chip",3,"click",4,"ngFor","ngForOf"],[1,"chip","hoverable-chip",3,"click"],[1,"avatar","avatar-sm",3,"src"],[1,"card","mt-2","p-2"],["class","btn",3,"routerLink","ngClass",4,"ngFor","ngForOf"],[1,"btn",3,"routerLink","ngClass"]],template:function(t,e){1&t&&c.vc(0,Hi,41,9,"div",0),2&t&&c.ec("ngIf",e.campaign)},directives:[m.k,m.j,J.a,Ci,Si,p.e,p.d,m.i],styles:[".d-flex[_ngcontent-%COMP%] > .chip[_ngcontent-%COMP%]{flex-shrink:0;flex-grow:0}.d-flex[_ngcontent-%COMP%]{flex-wrap:wrap}.hoverable-chip[_ngcontent-%COMP%]{transition:transform .25s}.hoverable-chip[_ngcontent-%COMP%]:hover{transform:scale(1.05);cursor:pointer;background-color:#5755d9;color:#fff}"]}),t})();var Vi=i("xdv0");const zi=function(t,e){return{"has-error":t,"has-success":e}},Bi=function(t){return{loading:t}};let Yi=(()=>{class t{constructor(t,e,i,n){this.login=t,this.userService=e,this.router=i,this.action=n,this.loading=!1}ngOnInit(){this.login.userProfile||this.router.navigate(["login"]),this.usernameControl=new a.e(this.login.userProfile.nickname,[a.v.required,a.v.minLength(3),a.v.maxLength(30)])}submit(){return t=this,void 0,i=function*(){if(this.usernameControl.valid){this.loading=!0;try{const t=yield this.userService.createUser({id:this.login.id,username:this.usernameControl.value,pictureURL:this.login.userProfile.picture});this.login.setUser(t),this.action.queue.pop(),this.action.save(),this.router.navigate(["home"])}catch(t){throw t}this.loading=!1}},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(y.a),c.Lb(Vi.a),c.Lb(p.c),c.Lb(q.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-register"]],decls:17,vars:9,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column","col-6","col-md-8","col-sm-12","col-mx-auto"],[1,"card"],[1,"card-header"],[1,"mb-0"],[1,"text-gray","text-italic"],[1,"card-body"],[3,"ngSubmit"],[1,"form-group",3,"ngClass"],["type","text","name","username","id","username","placeholder","Jimbo",1,"form-input",3,"formControl"],[1,"card-footer"],[1,"btn","btn-primary","float-right",3,"ngClass","disabled","click"],[1,"icon","icon-arrow-right"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"div",2),c.Qb(3,"div",3),c.Qb(4,"div",4),c.Qb(5,"h3",5),c.wc(6,"Username"),c.Pb(),c.Qb(7,"span",6),c.wc(8,"What should we call you?"),c.Pb(),c.Pb(),c.Qb(9,"div",7),c.Qb(10,"form",8),c.Xb("ngSubmit",function(){return e.submit()}),c.Qb(11,"div",9),c.Mb(12,"input",10),c.Pb(),c.Pb(),c.Pb(),c.Qb(13,"div",11),c.Qb(14,"button",12),c.Xb("click",function(){return e.submit()}),c.wc(15," Done "),c.Mb(16,"i",13),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(11),c.ec("ngClass",c.jc(4,zi,e.usernameControl.invalid&&(e.usernameControl.touched||e.usernameControl.dirty),e.usernameControl.valid)),c.Ab(1),c.ec("formControl",e.usernameControl),c.Ab(2),c.ec("ngClass",c.ic(7,Bi,e.loading))("disabled",e.usernameControl.invalid))},directives:[a.x,a.n,a.o,m.i,a.b,a.m,a.f],styles:[""]}),t})();var Wi=i("abTI"),Ki=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function Ji(t,e){1&t&&(c.Qb(0,"div",2),c.Qb(1,"div",3),c.Qb(2,"div",4),c.Qb(3,"div",5),c.wc(4," Processing information... "),c.Mb(5,"div",6),c.Pb(),c.Pb(),c.Pb(),c.Pb())}const tn=function(t){return{loading:t}};function en(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",10),c.Qb(1,"h2"),c.wc(2,"Would you like to join this campaign?"),c.Pb(),c.Qb(3,"figure",11),c.Mb(4,"img",12),c.Pb(),c.Qb(5,"h1"),c.wc(6),c.Pb(),c.Qb(7,"button",13),c.Xb("click",function(){return c.oc(t),c.Zb(2).deny()}),c.wc(8,"No"),c.Pb(),c.Qb(9,"button",14),c.Xb("click",function(){return c.oc(t),c.Zb(2).accept()}),c.wc(10," Yes "),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(4),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.campaign.imageId,"",c.qc),c.Ab(2),c.xc(t.campaign.name),c.Ab(3),c.ec("ngClass",c.ic(3,tn,t.accepting))}}function nn(t,e){1&t&&(c.Qb(0,"div",15),c.Qb(1,"h6"),c.wc(2,"Invalid Invite"),c.Pb(),c.Qb(3,"p"),c.wc(4," Unfortunately this invite is no longer valid. Sorry about that \xaf\\_(\u30c4)_/\xaf "),c.Pb(),c.Pb())}function cn(t,e){if(1&t&&(c.Qb(0,"div",2),c.Qb(1,"div",7),c.vc(2,en,11,5,"div",8),c.vc(3,nn,5,0,"div",9),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(2),c.ec("ngIf",0===t.invite.status),c.Ab(1),c.ec("ngIf",0!==t.invite.status)}}let on=(()=>{class t{constructor(t,e,i,n,c){this.login=t,this.actions=e,this.campaignService=i,this.router=n,this.route=c,this.loading=!1,this.accepting=!1,this.denying=!1}ngOnInit(){return Ki(this,void 0,void 0,function*(){if(this.actions.queue.unshift({type:q.b.INVITE,data:{inviteId:this.route.snapshot.paramMap.get("invite_id")}}),this.actions.save(),yield this.login.isLoggedIn){try{this.loading=!0,yield this.loadInvite(),0!==this.invite.status&&(this.actions.queue.pop(),this.actions.save())}catch(t){this.actions.queue.pop(),this.actions.save(),yield this.router.navigate(["home"])}this.loading=!1}else this.router.navigate(["login"])})}accept(){return Ki(this,void 0,void 0,function*(){this.accepting=!0;try{yield this.campaignService.acceptInvite(this.invite.id),this.actions.queue.pop(),this.actions.save(),this.router.navigate(["campaigns",this.campaign.id,"landing"])}catch(t){Wi.captureException(t)}this.accepting=!1})}deny(){return Ki(this,void 0,void 0,function*(){this.denying=!0;try{yield this.campaignService.denyInvite(this.invite.id)}catch(t){Wi.captureException(t)}this.actions.queue.pop(),this.actions.save(),this.router.navigate(["home"]),this.denying=!1})}loadInvite(){return Ki(this,void 0,void 0,function*(){try{const t=yield this.campaignService.getInvite(this.route.snapshot.paramMap.get("invite_id"));this.invite=t}catch(t){throw t}})}get campaign(){return this.invite?this.invite.campaign:null}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(y.a),c.Lb(q.a),c.Lb(h.b),c.Lb(p.c),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-invite"]],decls:3,vars:2,consts:[[1,"container","grid-xl"],["class","columns",4,"ngIf"],[1,"columns"],[1,"column","col-4","col-md-6","col-sm-12","col-mx-auto"],[1,"card"],[1,"card-body"],[1,"loading"],[1,"column","col-6","col-md-10","col-sm-12","text-center","col-mx-auto"],["class","card p-2",4,"ngIf"],["class","toast text-left toast-error",4,"ngIf"],[1,"card","p-2"],[1,"avatar","avatar-xl","align-self-center"],[3,"src"],[1,"btn","btn-lg","my-2",3,"click"],[1,"btn","btn-primary","btn-lg",3,"ngClass","click"],[1,"toast","text-left","toast-error"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,Ji,6,0,"div",1),c.vc(2,cn,4,2,"div",1),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",!e.loading&&e.campaign))},directives:[m.k,m.i],styles:[""]}),t})(),rn=(()=>{class t{constructor(t,e,i){this.actions=t,this.router=e,this.login=i}canActivate(t,e){return i=this,void 0,c=function*(){if(!this.login.isLoggedIn)return!1;const t=this.actions.queue;if(0===t.length)return!0;{const e=t.pop();switch(this.actions.save(),e.type){case q.b.ACCOUNT_SETUP:this.router.navigate(["register"]);break;case q.b.INVITE:this.router.navigate(["invite",e.data.inviteId]);break;case q.b.REDIRECT:yield this.router.navigateByUrl(e.data.url)}}return!1},new((n=void 0)||(n=Promise))(function(t,e){function o(t){try{a(c.next(t))}catch(i){e(i)}}function r(t){try{a(c.throw(t))}catch(i){e(i)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n(function(t){t(i)})).then(o,r)}a((c=c.apply(i,[])).next())});var i,n,c}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(q.a),c.Ub(p.c),c.Ub(y.a))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),an=(()=>{class t{constructor(t){this.http=t}remoteAbout(){return this.http.get(`${b.a.apiURL}/aboutinfo`).toPromise()}localAbout(){return{gitHash:b.a.gitHash,gitTag:b.a.gitTag}}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(r.b))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function sn(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"(Loading...)"),c.Pb())}function ln(t,e){if(1&t&&(c.Qb(0,"div",1),c.Qb(1,"h5",2),c.wc(2,"Commit Hash"),c.Pb(),c.Qb(3,"span",3),c.wc(4),c.Pb(),c.Qb(5,"h5",4),c.wc(6,"Version Tag"),c.Pb(),c.Qb(7,"span",3),c.wc(8),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(4),c.xc(t.remote.gitHash),c.Ab(4),c.xc(t.remote.gitTag)}}let dn=(()=>{class t{constructor(t){this.aboutService=t,this.loading=!1}ngOnInit(){this.load()}load(){return t=this,void 0,i=function*(){this.loading=!0,this.local=this.aboutService.localAbout();try{const t=yield this.aboutService.remoteAbout();this.remote=t}catch(t){throw t}this.loading=!1},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}makeDummyException(){const t=new Error("This is a test error!");throw t.name="SentryTestError",t}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(an))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-about"]],decls:20,vars:4,consts:[[1,"container","grid-xl"],[1,"card","p-2"],[1,"mb-1"],[1,"text-italic","text-gray"],[1,"mt-2","mb-1"],[1,"mt-2"],[4,"ngIf"],["class","card p-2",4,"ngIf"],[1,"btn","btn-primary",3,"click"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"h4"),c.wc(2,"DD - App"),c.Pb(),c.Qb(3,"div",1),c.Qb(4,"h5",2),c.wc(5,"Commit Hash"),c.Pb(),c.Qb(6,"span",3),c.wc(7),c.Pb(),c.Qb(8,"h5",4),c.wc(9,"Version Tag"),c.Pb(),c.Qb(10,"span",3),c.wc(11),c.Pb(),c.Pb(),c.Qb(12,"h4",5),c.wc(13,"DD - Server "),c.vc(14,sn,2,0,"span",6),c.Pb(),c.vc(15,ln,9,2,"div",7),c.Qb(16,"h4"),c.wc(17,"Error Testing"),c.Pb(),c.Qb(18,"button",8),c.Xb("click",function(){return e.makeDummyException()}),c.wc(19," Make Test Error "),c.Pb(),c.Pb()),2&t&&(c.Ab(7),c.xc(e.local.gitHash),c.Ab(4),c.xc(e.local.gitTag),c.Ab(3),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.remote))},directives:[m.k],styles:[""]}),t})(),un=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-entity"]],decls:1,vars:0,template:function(t,e){1&t&&c.Mb(0,"router-outlet")},directives:[p.g],styles:[""]}),t})();var bn=i("/uUt"),pn=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const hn=function(t){return{loading:t}};function mn(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",29),c.Xb("click",function(){return c.oc(t),c.Zb().delete()}),c.wc(1," Delete "),c.Pb()}if(2&t){const t=c.Zb();c.ec("ngClass",c.ic(1,hn,t.deleting))}}function gn(t,e){1&t&&(c.Qb(0,"p",30),c.wc(1," The quest needs a name "),c.Pb())}function fn(t,e){1&t&&(c.Qb(0,"p",30),c.wc(1," The name is too short "),c.Pb())}function vn(t,e){1&t&&(c.Qb(0,"p",30),c.wc(1," The name can't be more than 30 characters long "),c.Pb())}const yn=function(t,e){return{"has-error":t,"has-success":e}};let Pn=(()=>{class t{constructor(t,e,i,n,c){this.router=t,this.route=e,this.campaignService=i,this.questService=n,this.location=c,this.loading=!1,this.deleting=!1}ngOnInit(){if(this.formGroup=new a.h({name:new a.e(null,[a.v.required,a.v.minLength(3),a.v.maxLength(30)]),accepted:new a.e(!1),available:new a.e(!1),visible:new a.e(!1),status:new a.e("0"),content:new a.e(null)}),this.visible.valueChanges.subscribe(()=>{this.dataToUI()}),this.available.valueChanges.pipe(Object(bn.a)()).subscribe(()=>{this.dataToUI()}),this.dataToUI(),this.editing){const t=this.route.snapshot.paramMap.get("q_id");this.loadQuest(t)}}canDeactivate(){return!this.formGroup.dirty}dataToUI(){if(!this.quest&&this.editing)return;const t=this.available.value;this.visible.value?(this.available.enable(),t?(this.accepted.enable(),this.status.enable()):(this.accepted.setValue(!1),this.status.setValue(ii.b.NONE),this.accepted.disable(),this.status.disable())):(this.available.setValue(!1),this.accepted.setValue(!1),this.status.setValue(ii.b.NONE),this.accepted.disable(),this.available.disable(),this.status.disable())}loadQuest(t){return pn(this,void 0,void 0,function*(){this.loading=!0,this.formGroup.disable();try{const e=yield this.questService.getQuest(t);this.formGroup.patchValue(e),this.quest=e,setTimeout(()=>{this.dataToUI()},1)}catch(e){throw e}this.loading=!1,this.formGroup.enable()})}constructQuest(){const t={name:this.name.value,accepted:this.accepted.value,available:this.available.value,visible:this.visible.value,content:this.formGroup.get("content").value,status:this.status.value,campaignId:this.campaignService.campaign.id};return this.editing&&(t.id=this.quest.id),t}submit(){return pn(this,void 0,void 0,function*(){if(this.formGroup.invalid)return;const t=this.constructQuest();if(this.loading=!0,this.editing)try{yield this.questService.updateQuest(t),this.formGroup.markAsPristine(),this.cancel()}catch(e){throw e}else try{const e=yield this.questService.createQuest(t);this.formGroup.markAsPristine(),this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",e.id])}catch(e){throw e}this.loading=!1})}delete(){return pn(this,void 0,void 0,function*(){this.deleting=!0;try{yield this.questService.deleteQuest(this.quest)}catch(t){throw t}this.location.back(),this.deleting=!1})}cancel(){this.location.back()}get editing(){return this.route.snapshot.data.editing}get name(){return this.formGroup.get("name")}get accepted(){return this.formGroup.get("accepted")}get available(){return this.formGroup.get("available")}get visible(){return this.formGroup.get("visible")}get status(){return this.formGroup.get("status")}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.c),c.Lb(p.a),c.Lb(h.b),c.Lb(ii.a),c.Lb(m.g))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-quest-form"]],decls:52,vars:11,consts:[[1,"container","grid-xl"],[3,"formGroup","ngSubmit"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],["type","button",1,"btn","mr-2",3,"click"],["class","btn btn-error mr-2","type","button",3,"ngClass","click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled"],[1,"form-group",3,"ngClass"],["for","name",1,"form-label","label-lg"],["formControlName","name","type","text","id","name","placeholder","Name",1,"form-input","input-lg"],["class","form-input-hint",4,"ngIf"],[1,"form-group"],["for","item-description",1,"form-label"],["placeholder","Do Quest","formControlName","content"],["for","accepted",1,"form-switch"],["type","checkbox","name","accepted","id","accepted","formControlName","accepted"],[1,"form-icon"],["for","available",1,"form-switch"],["type","checkbox","name","available","id","available","formControlName","available"],["for","visible",1,"form-switch"],["type","checkbox","name","visible","id","visible","formControlName","visible"],["for","status",1,"form-label"],["name","status","id","status","formControlName","status",1,"form-input"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["type","button",1,"btn","btn-error","mr-2",3,"ngClass","click"],[1,"form-input-hint"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"form",1),c.Xb("ngSubmit",function(){return e.submit()}),c.Qb(2,"div",2),c.Qb(3,"div",3),c.Qb(4,"h3"),c.wc(5),c.Pb(),c.Pb(),c.Qb(6,"div",4),c.Qb(7,"button",5),c.Xb("click",function(){return e.cancel()}),c.wc(8," Cancel "),c.Pb(),c.vc(9,mn,2,3,"button",6),c.Qb(10,"button",7),c.wc(11," Save "),c.Pb(),c.Pb(),c.Pb(),c.Qb(12,"div",8),c.Qb(13,"label",9),c.wc(14,"Name"),c.Pb(),c.Mb(15,"input",10),c.vc(16,gn,2,0,"p",11),c.vc(17,fn,2,0,"p",11),c.vc(18,vn,2,0,"p",11),c.Pb(),c.Qb(19,"div",12),c.Qb(20,"label",13),c.wc(21,"Description"),c.Pb(),c.Mb(22,"dd-quill",14),c.Pb(),c.Qb(23,"div",12),c.Qb(24,"label",15),c.Mb(25,"input",16),c.Mb(26,"i",17),c.wc(27," The players have accepted this quest "),c.Pb(),c.Pb(),c.Qb(28,"div",12),c.Qb(29,"label",18),c.Mb(30,"input",19),c.Mb(31,"i",17),c.wc(32," This quest is available for players to accept "),c.Pb(),c.Pb(),c.Qb(33,"div",12),c.Qb(34,"label",20),c.Mb(35,"input",21),c.Mb(36,"i",17),c.wc(37," Players can see this quest "),c.Pb(),c.Pb(),c.Qb(38,"div",12),c.Qb(39,"label",22),c.wc(40," Status "),c.Pb(),c.Qb(41,"select",23),c.Qb(42,"option",24),c.wc(43,"None"),c.Pb(),c.Qb(44,"option",25),c.wc(45,"On Hold"),c.Pb(),c.Qb(46,"option",26),c.wc(47,"In Progress"),c.Pb(),c.Qb(48,"option",27),c.wc(49,"To Do"),c.Pb(),c.Qb(50,"option",28),c.wc(51,"Completed"),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(1),c.ec("formGroup",e.formGroup),c.Ab(4),c.yc("",e.editing?"Edit":"Create"," Quest"),c.Ab(4),c.ec("ngIf",e.editing),c.Ab(1),c.ec("disabled",e.formGroup.invalid),c.Ab(2),c.ec("ngClass",c.jc(8,yn,e.name.invalid&&(e.name.dirty||e.name.touched),e.name.valid)),c.Ab(4),c.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.required),c.Ab(1),c.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.minlength),c.Ab(1),c.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.maxlength))},directives:[a.x,a.n,a.i,m.k,m.i,a.b,a.m,a.g,J.a,a.a,a.t,a.p,a.w],styles:[""]}),t})();var wn=i("a8fi"),In=i("/AKn"),Cn=i("Kjs6");function Qn(t,e){1&t&&c.Mb(0,"div",4)}function An(t,e){if(1&t&&c.Mb(0,"dd-http-errors",5),2&t){const t=c.Zb();c.ec("error",t.loadError)}}function kn(t,e){1&t&&c.Mb(0,"i",19)}function xn(t,e){1&t&&c.Mb(0,"i",20)}function Tn(t,e){1&t&&c.Mb(0,"i",21)}function En(t,e){1&t&&c.Mb(0,"i",22)}function Ln(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",23),c.Xb("click",function(){return c.oc(t),c.Zb(2).edit()}),c.Mb(1,"i",24),c.Qb(2,"span",15),c.wc(3," Edit"),c.Pb(),c.Pb()}}function Mn(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div"),c.Qb(1,"div",6),c.Qb(2,"div",7),c.Qb(3,"h3"),c.vc(4,kn,1,0,"i",8),c.vc(5,xn,1,0,"i",9),c.vc(6,Tn,1,0,"i",10),c.vc(7,En,1,0,"i",11),c.wc(8),c.Pb(),c.Pb(),c.Qb(9,"div",12),c.Qb(10,"button",13),c.Xb("click",function(){return c.oc(t),c.Zb().addNote()}),c.Mb(11,"i",14),c.Qb(12,"span",15),c.wc(13," Add Note"),c.Pb(),c.Pb(),c.vc(14,Ln,4,0,"button",16),c.Pb(),c.Pb(),c.Mb(15,"dd-quill",17),c.Mb(16,"dd-note-list",18),c.Pb()}if(2&t){const t=c.Zb();c.Ab(4),c.ec("ngIf",1===t.quest.status),c.Ab(1),c.ec("ngIf",2===t.quest.status),c.Ab(1),c.ec("ngIf",3===t.quest.status),c.Ab(1),c.ec("ngIf",4===t.quest.status),c.Ab(1),c.yc(" ",t.quest.name," "),c.Ab(6),c.ec("ngIf",t.editable),c.Ab(1),c.ec("value",t.quest.content),c.Ab(1),c.ec("notes",t.notes)}}let Sn=(()=>{class t{constructor(t,e,i,n,c){this.router=t,this.route=e,this.questService=i,this.campaignService=n,this.noteService=c,this.loading=!1}ngOnInit(){this.route.paramMap.subscribe(t=>{t.get("q_id")&&(this.quest=void 0,this.loadQuest(t.get("q_id")))})}loadQuest(t){return e=this,void 0,n=function*(){this.loading=!0;try{this.quest=yield this.questService.getQuest(t),this.noteService.getNotes(this.campaignService.campaign.id,{questId:this.quest.id})}catch(e){this.loadError=e}this.loading=!1},new((i=void 0)||(i=Promise))(function(t,c){function o(t){try{a(n.next(t))}catch(e){c(e)}}function r(t){try{a(n.throw(t))}catch(e){c(e)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i(function(t){t(n)})).then(o,r)}a((n=n.apply(e,[])).next())});var e,i,n}addNote(){this.noteService.addNote({type:wn.b.QUEST,questId:this.quest.id})}edit(){this.editable&&this.router.navigate(["campaigns",this.campaignService.campaign.id,"quests",this.quest.id,"edit"])}get editable(){return this.campaignService.canEdit}get notes(){return this.quest?this.noteService.getQuestNotes(this.quest.id):[]}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.c),c.Lb(p.a),c.Lb(ii.a),c.Lb(h.b),c.Lb(wn.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-quest-view"]],decls:4,vars:3,consts:[[1,"container","grid-lg"],["class","loading loading-lg",4,"ngIf"],[3,"error",4,"ngIf"],[4,"ngIf"],[1,"loading","loading-lg"],[3,"error"],[1,"columns"],[1,"column"],["class","icon icon-stop",4,"ngIf"],["class","icon icon-flag",4,"ngIf"],["class","icon icon-time",4,"ngIf"],["class","icon icon-check",4,"ngIf"],[1,"column","col-auto","col-ml-auto"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"icon","icon-link"],[1,"hide-sm"],["class","btn btn-sm",3,"click",4,"ngIf"],["readOnly","true",3,"value"],[3,"notes"],[1,"icon","icon-stop"],[1,"icon","icon-flag"],[1,"icon","icon-time"],[1,"icon","icon-check"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-edit"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,Qn,1,0,"div",1),c.vc(2,An,1,1,"dd-http-errors",2),c.vc(3,Mn,17,8,"div",3),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.loadError),c.Ab(1),c.ec("ngIf",e.quest))},directives:[m.k,In.a,J.a,Cn.a],styles:[""]}),t})(),On=(()=>{class t{constructor(){this.sliderMax=10,this.max=60,this.min=1,this.loading=!1,this.selected=new c.n,this.cancel=new c.n,this.customInput=!1}ngOnInit(){this.inputControl=new a.e(1,[a.v.required,a.v.min(this.min),a.v.max(this.max)])}submit(){this.inputControl.valid&&this.selected.emit(this.inputControl.value)}set number(t){this.inputControl.setValue(t)}get number(){return this.inputControl.value}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-number-quick-select"]],inputs:{sliderMax:"sliderMax",max:"max",min:"min",loading:"loading",number:"number"},outputs:{selected:"selected",cancel:"cancel"},decls:9,vars:5,consts:[[1,"columns"],[1,"column"],["type","range","name","slider",1,"slider","tooltip",3,"min","max","formControl"],[1,"column","col-auto"],[1,"btn","btn-sm","mr-1",3,"click"],[1,"icon","icon-cross"],[1,"btn","btn-sm",3,"disabled","click"],[1,"icon","icon-check"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Mb(2,"input",2),c.Pb(),c.Qb(3,"div",3),c.Qb(4,"button",4),c.Xb("click",function(){return e.cancel.emit(!0)}),c.Mb(5,"i",5),c.Pb(),c.Qb(6,"button",6),c.Xb("click",function(){return e.submit()}),c.Mb(7,"i",7),c.wc(8),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(2),c.fc("min",e.min),c.fc("max",e.sliderMax),c.ec("formControl",e.inputControl),c.Ab(4),c.ec("disabled",e.inputControl.invalid||e.loading),c.Ab(2),c.yc(" ",e.inputControl.value," "))},directives:[a.r,a.b,a.m,a.f],styles:[""]}),t})();function Nn(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",5),c.Qb(1,"button",6),c.Xb("click",function(){return c.oc(t),c.Zb().edit()}),c.wc(2,"Edit"),c.Pb(),c.Qb(3,"button",7),c.Xb("click",function(){return c.oc(t),c.Zb().spawnMode=!0}),c.wc(4,"Spawn"),c.Pb(),c.Pb()}}function _n(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",8),c.Qb(1,"dd-number-quick-select",9),c.Xb("selected",function(e){return c.oc(t),c.Zb().spawn(e)})("cancel",function(){return c.oc(t),c.Zb().spawnMode=!1}),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(1),c.ec("loading",t.spawning)}}let Rn=(()=>{class t{constructor(t,e,i){this.entityService=t,this.router=e,this.campaignService=i,this.spawnMode=!1,this.spawning=!1}ngOnInit(){}edit(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",this.spawnable.entityPresetId,this.spawnable.id,"edit"])}spawn(t){return e=this,void 0,n=function*(){this.spawning=!0;try{yield this.entityService.spawnSpawnable(this.spawnable.id,t),yield this.router.navigate(["campaigns",this.campaignService.campaign.id,"overview"])}catch(e){throw e}this.spawning=!1},new((i=void 0)||(i=Promise))(function(t,c){function o(t){try{a(n.next(t))}catch(e){c(e)}}function r(t){try{a(n.throw(t))}catch(e){c(e)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i(function(t){t(n)})).then(o,r)}a((n=n.apply(e,[])).next())});var e,i,n}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(Y.b),c.Lb(p.c),c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-spawnable-list-item"]],inputs:{spawnable:"spawnable"},decls:6,vars:3,consts:[[1,"columns"],[1,"column"],[1,"mb-0"],["class","column text-right",4,"ngIf"],["class","column col-sm-12",4,"ngIf"],[1,"column","text-right"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"btn","btn-sm",3,"click"],[1,"column","col-sm-12"],[3,"loading","selected","cancel"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"h5",2),c.wc(3),c.Pb(),c.Pb(),c.vc(4,Nn,5,0,"div",3),c.vc(5,_n,2,1,"div",4),c.Pb()),2&t&&(c.Ab(3),c.xc(e.spawnable.name),c.Ab(1),c.ec("ngIf",!e.spawnMode),c.Ab(1),c.ec("ngIf",e.spawnMode))},directives:[m.k,On],styles:[""]}),t})();function Fn(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",7),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb().addSpawnable(i)}),c.Mb(1,"i",8),c.wc(2),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(2),c.yc(" ",t.name," ")}}function Un(t,e){1&t&&c.Mb(0,"div",9)}function qn(t,e){1&t&&(c.Qb(0,"div",12),c.Qb(1,"div",13),c.Mb(2,"i",14),c.Pb(),c.Qb(3,"p",15),c.wc(4,"There are no spawnables :("),c.Pb(),c.Qb(5,"p",16),c.wc(6,"Use the buttons above to create one"),c.Pb(),c.Pb())}function Gn(t,e){if(1&t&&(c.Qb(0,"div",17),c.Mb(1,"dd-spawnable-list-item",18),c.Pb()),2&t){const t=e.$implicit;c.Ab(1),c.ec("spawnable",t)}}function Dn(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,qn,7,0,"div",10),c.vc(2,Gn,2,1,"div",11),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngIf",0===t.spawnables.length),c.Ab(1),c.ec("ngForOf",t.spawnables)}}let Zn=(()=>{class t{constructor(t,e,i){this.router=t,this.entityService=e,this.campaignService=i,this.loading=!1,this.spawnables=null}ngOnInit(){this.load()}load(){return t=this,void 0,i=function*(){this.loading=!0;try{this.spawnables=yield this.entityService.getEntities(this.campaignService.campaign.id,!0)}catch(t){throw t}this.loading=!1},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}addSpawnable(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",t.id,"create"],{queryParams:{spawnable:!0}})}selectSpawnable(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",t.entityPresetId,t.id,"edit"])}get campaign(){return this.campaignService.campaign}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.c),c.Lb(Y.b),c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-spawnable-manager"]],decls:9,vars:3,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-sm ml-1",3,"click",4,"ngFor","ngForOf"],["class","loading loading-lg",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-sm","ml-1",3,"click"],[1,"icon","icon-plus"],[1,"loading","loading-lg"],["class","empty",4,"ngIf"],["class","card mb-2 p-2",4,"ngFor","ngForOf"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"card","mb-2","p-2"],[3,"spawnable"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"div",2),c.Qb(3,"h3"),c.wc(4,"Spawnables"),c.Pb(),c.Pb(),c.Qb(5,"div",3),c.vc(6,Fn,3,1,"button",4),c.Pb(),c.Pb(),c.vc(7,Un,1,0,"div",5),c.vc(8,Dn,3,2,"div",6),c.Pb()),2&t&&(c.Ab(6),c.ec("ngForOf",e.campaign.entityPresets),c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.spawnables))},directives:[m.j,m.k,Rn],styles:[""]}),t})();var $n=i("8Qhy"),Xn=i("/fvA"),Hn=i("HRrE");function jn(t,e){1&t&&(c.Qb(0,"p",27),c.wc(1," A name is required "),c.Pb())}function Vn(t,e){1&t&&(c.Qb(0,"p",27),c.wc(1," A type is required "),c.Pb())}function zn(t,e){1&t&&(c.Qb(0,"div",30),c.Qb(1,"div",31),c.Mb(2,"input",32),c.Pb(),c.Qb(3,"div",31),c.Mb(4,"input",33),c.Pb(),c.Pb())}function Bn(t,e){1&t&&(c.Qb(0,"div",30),c.Qb(1,"div",31),c.Mb(2,"input",34),c.Pb(),c.Qb(3,"div",31),c.Mb(4,"input",35),c.Pb(),c.Pb())}function Yn(t,e){if(1&t&&(c.Qb(0,"div",30),c.Qb(1,"div",31),c.Mb(2,"dd-tag-editor",36),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(2),c.ec("formGroup",t.options)}}function Wn(t,e){if(1&t&&(c.Qb(0,"div",28),c.vc(1,zn,5,0,"div",29),c.vc(2,Bn,5,0,"div",29),c.vc(3,Yn,3,1,"div",29),c.Pb()),2&t){const t=c.Zb();c.ec("ngSwitch",!0)("formGroup",t.options)("hidden",t.hideExtra),c.Ab(1),c.ec("ngSwitchCase","0"===t.type.value||0===t.type.value),c.Ab(1),c.ec("ngSwitchCase","1"===t.type.value||"2"===t.type.value||1===t.type.value||2===t.type.value),c.Ab(1),c.ec("ngSwitchCase","3"===t.type.value||"4"===t.type.value||3===t.type.value||4===t.type.value)}}function Kn(t,e){if(1&t&&(c.Qb(0,"div",37),c.Qb(1,"label",38),c.Mb(2,"input",39),c.Mb(3,"i",40),c.wc(4," Required "),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.ec("formGroup",t.options)}}function Jn(t,e){if(1&t&&(c.Qb(0,"option",24),c.wc(1),c.Pb()),2&t){const t=e.$implicit;c.ec("value",t),c.Ab(1),c.xc(t)}}function tc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"span",41),c.Xb("click",function(){return c.oc(t),c.Zb().hideExtra=!1}),c.wc(1,"Show More"),c.Pb()}}function ec(t,e){if(1&t){const t=c.Rb();c.Qb(0,"span",41),c.Xb("click",function(){return c.oc(t),c.Zb().hideExtra=!0}),c.wc(1,"Show Less"),c.Pb()}}const ic=function(t,e){return{"col-9":t,"col-12":e}},nc=function(t){return{"has-error":t}};let cc=(()=>{class t{constructor(t){this.campaignService=t,this.hideExtra=!0,this.uniqueFieldId=(new P.Chance).guid()}static createFormGroup(t){return null==t&&(t={name:null,type:null}),new a.h({name:new a.e(t.name,[a.v.required,a.v.maxLength(30)]),description:new a.e(t.description),type:new a.e(t.type,[a.v.required]),imageId:new a.e(t.imageId),options:this.createOptionsFormGroup(t.type,t.options)})}static createOptionsFormGroup(t,e){let i;switch(null==e&&(e={}),t){case K.a.STRING:return i=e,new a.h({maxLength:new a.e(i.maxLength),minLength:new a.e(i.minLength),required:new a.e(i.required),modifierFor:new a.e(i.modifierFor)});case K.a.INT:case K.a.FLOAT:return i=e,new a.h({min:new a.e(i.min),max:new a.e(i.max),required:new a.e(i.required),modifierFor:new a.e(i.modifierFor)});case K.a.ENUM:case K.a.ENUM_MULTI:return i=e,new a.h({choices:new a.c(i.choices?i.choices.map(t=>new a.e(t)):[]),required:new a.e(i.required),modifierFor:new a.e(i.modifierFor)});default:return new a.h({required:new a.e(e.required),modifierFor:new a.e(e.modifierFor)})}}ngOnInit(){this.formGroup.get("type").valueChanges.subscribe(e=>{e=parseInt(e,10),this.options=t.createOptionsFormGroup(e,this.formGroup.value.options),this.formGroup.setControl("options",this.options)}),this.options=t.createOptionsFormGroup(this.type.value,this.formGroup.value.options),this.formGroup.setControl("options",this.options)}get campaign(){return this.campaignService.campaign}get name(){return this.formGroup.get("name")}get type(){return this.formGroup.get("type")}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-field-definition-form"]],inputs:{formGroup:"formGroup",otherFields:"otherFields"},decls:40,vars:26,consts:[[1,"columns",3,"formGroup"],[1,"column","col-3",3,"hidden"],["formControlName","imageId",3,"eleId"],[1,"column","col-9",3,"ngClass"],[1,"form-group",3,"ngClass"],["type","text","name","name","placeholder","Name","formControlName","name",1,"form-input","input-sm"],["class","form-input-hint mb-0",4,"ngIf"],[1,"form-group",3,"hidden"],["type","text","name","description","formControlName","description","placeholder","Short Description",1,"form-input","input-sm"],["name","type","formControlName","type",1,"form-input","input-sm","mt-1"],["disabled","",3,"value"],["value","0"],["value","1"],["value","2"],["value","3"],["value","4"],["value","5"],["value","6"],["value","7"],[3,"ngSwitch","formGroup","hidden",4,"ngIf"],[1,"column","col-auto","mt-1",3,"hidden"],["class","form-group",3,"formGroup",4,"ngIf"],[1,"column","mt-1",3,"formGroup","hidden"],["formControlName","modifierFor",1,"form-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["class","fake-link",3,"click",4,"ngIf"],[1,"form-input-hint","mb-0"],[3,"ngSwitch","formGroup","hidden"],["class","columns",4,"ngSwitchCase"],[1,"columns"],[1,"column"],["type","number","placeholder","Minimum Length","formControlName","minLength",1,"form-input","input-sm"],["type","number","placeholder","Maximum Length","formControlName","maxLength",1,"form-input","input-sm"],["type","number","placeholder","Minimum","formControlName","min",1,"form-input","input-sm"],["type","number","placeholder","Maximum","formControlName","max",1,"form-input","input-sm"],["controlName","choices",3,"formGroup"],[1,"form-group",3,"formGroup"],[1,"form-checkbox"],["type","checkbox","formControlName","required"],[1,"form-icon"],[1,"fake-link",3,"click"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Mb(2,"dd-image-upload",2),c.Pb(),c.Qb(3,"div",3),c.Qb(4,"div",4),c.Mb(5,"input",5),c.vc(6,jn,2,0,"p",6),c.Pb(),c.Qb(7,"div",7),c.Mb(8,"input",8),c.Pb(),c.Qb(9,"div",4),c.Qb(10,"select",9),c.Qb(11,"option",10),c.wc(12,"Type"),c.Pb(),c.Qb(13,"option",11),c.wc(14,"Word"),c.Pb(),c.Qb(15,"option",12),c.wc(16,"Whole Number"),c.Pb(),c.Qb(17,"option",13),c.wc(18,"Real Number"),c.Pb(),c.Qb(19,"option",14),c.wc(20,"Selection"),c.Pb(),c.Qb(21,"option",15),c.wc(22,"Selection (Multiple)"),c.Pb(),c.Qb(23,"option",16),c.wc(24,"Text (Formatted)"),c.Pb(),c.Qb(25,"option",17),c.wc(26,"Currency"),c.Pb(),c.Qb(27,"option",18),c.wc(28,"Yes or No"),c.Pb(),c.Pb(),c.vc(29,Vn,2,0,"p",6),c.Pb(),c.vc(30,Wn,4,6,"div",19),c.Pb(),c.Qb(31,"div",20),c.vc(32,Kn,5,1,"div",21),c.Pb(),c.Qb(33,"div",22),c.Qb(34,"select",23),c.Qb(35,"option",24),c.wc(36,"Modifier For"),c.Pb(),c.vc(37,Jn,2,2,"option",25),c.Pb(),c.Pb(),c.Pb(),c.vc(38,tc,2,0,"span",26),c.vc(39,ec,2,0,"span",26)),2&t&&(c.ec("formGroup",e.formGroup),c.Ab(1),c.ec("hidden",e.hideExtra),c.Ab(1),c.ec("eleId",e.uniqueFieldId),c.Ab(1),c.ec("ngClass",c.jc(19,ic,!e.hideExtra,e.hideExtra)),c.Ab(1),c.ec("ngClass",c.ic(22,nc,e.name.invalid&&(e.name.dirty||e.name.touched))),c.Ab(2),c.ec("ngIf",e.name.invalid&&(e.name.dirty||e.name.touched)&&e.name.errors.required),c.Ab(1),c.ec("hidden",e.hideExtra),c.Ab(2),c.ec("ngClass",c.ic(24,nc,e.type.invalid&&(e.type.dirty||e.type.touched))),c.Ab(2),c.ec("value",null),c.Ab(18),c.ec("ngIf",e.type.invalid&&(e.type.dirty||e.type.touched)&&e.type.errors.required),c.Ab(1),c.ec("ngIf",e.options),c.Ab(1),c.ec("hidden",e.hideExtra),c.Ab(1),c.ec("ngIf",e.options),c.Ab(1),c.ec("formGroup",e.options)("hidden",e.hideExtra),c.Ab(2),c.ec("value",null),c.Ab(2),c.ec("ngForOf",e.otherFields),c.Ab(1),c.ec("ngIf",e.hideExtra),c.Ab(1),c.ec("ngIf",!e.hideExtra))},directives:[a.n,a.i,le,a.m,a.g,m.i,a.b,m.k,a.t,a.p,a.w,m.j,m.l,m.m,a.q,Hn.a,a.a],styles:[""]}),t})();var oc=i("kNgC"),rc=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const ac=function(t){return{loading:t}};function sc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",25),c.Xb("click",function(){return c.oc(t),c.Zb().delete()}),c.wc(1," Delete "),c.Pb()}if(2&t){const t=c.Zb();c.ec("ngClass",c.ic(1,ac,t.deleting))}}function lc(t,e){1&t&&(c.Qb(0,"div",11),c.Qb(1,"label",12),c.Mb(2,"input",26),c.Mb(3,"i",14),c.wc(4," Enable quantities "),c.Pb(),c.Qb(5,"div",18),c.wc(6,"This would be like characters having a specific number of a certain item"),c.Pb(),c.Pb())}function dc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",7),c.Qb(1,"div",27),c.Qb(2,"div",21),c.Qb(3,"h6",28),c.wc(4),c.Pb(),c.Pb(),c.Qb(5,"div",3),c.Qb(6,"button",29),c.Xb("click",function(){c.oc(t);const i=e.index;return c.Zb().removeField(i)}),c.Mb(7,"i",30),c.Qb(8,"span",31),c.wc(9," Remove"),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Mb(10,"dd-field-definition-form",32),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(4),c.xc(t.value.name),c.Ab(6),c.ec("formGroup",t)}}let uc=(()=>{class t{constructor(t,e,i,n,c,o){this.route=t,this.campaignService=e,this.conceptService=i,this.login=n,this.location=c,this.router=o,this.saving=!1,this.deleting=!1,this.loading=!1,this.nameFieldConfig={name:"Name",description:"The name of this concept",type:K.a.STRING,options:{maxLength:30,required:!0}},this.pluralFormFieldConfig={name:"Plural Form",description:"This will be used in various places, the plural form",type:K.a.STRING,options:{maxLength:32,required:!0}},this.descriptionFieldConfig={name:"Description",type:K.a.STRING,options:{maxLength:100,required:!1}}}ngOnInit(){this.formGroup=new a.h({name:new a.e(null,[a.v.required]),pluralForm:new a.e(null,[a.v.required]),description:new a.e(null),icon:new a.e(null),fields:new a.c([]),playerEditable:new a.e(!1),isShownInNavigationMenu:new a.e(!0),isLinkableToArticles:new a.e(!1),isUsableInOverviewScreen:new a.e(!1),entityConfig:new a.h({enabled:new a.e(!1),enableQuantity:new a.e(!1),fields:new a.c([])})}),this.editing&&this.route.paramMap.subscribe(t=>{const e=t.get("ct_id");this.load(e)}),this.name.valueChanges.subscribe()}constructConceptType(){const t={name:this.name.value,pluralForm:this.pluarlForm.value,description:this.description.value,userId:this.login.id,icon:this.icon.value,playerEditable:this.playerEditable.value,campaignId:this.campaignService.campaign.id,fields:this.fields.value||[],entityConfig:this.entityConfig.value,isShownInNavigationMenu:this.isShownInNavigationMenu.value,isLinkableToArticles:this.isLinkableToArticles.value,isUsableInOverviewScreen:this.isUsableInOverviewScreen.value};return this.editing&&(t.id=this.conceptType.id,t.userId=this.conceptType.userId),t}load(t){return rc(this,void 0,void 0,function*(){this.loading=!0,this.formGroup.disable();try{this.conceptType=yield this.conceptService.getConceptType(t),this.conceptType.fields.forEach(t=>this.fields.push(cc.createFormGroup(t))),this.formGroup.patchValue(this.conceptType,{emitEvent:!1})}catch(e){throw e}this.formGroup.enable({emitEvent:!1}),this.loading=!1})}addField(){this.fields.push(cc.createFormGroup(null))}removeField(t){this.fields.removeAt(t),this.formGroup.markAsDirty()}canDeactivate(){return!this.formGroup.dirty}save(){return rc(this,void 0,void 0,function*(){this.saving=!0;try{const t=this.constructConceptType();this.editing?yield this.conceptService.updateConceptType(t):yield this.conceptService.createConceptType(t),this.formGroup.markAsPristine()}catch(t){throw t}this.formGroup.markAsPristine(),this.saving=!1,yield this.router.navigate(["campaigns",this.campaignService.campaign.id,"settings"],{queryParams:{refresh:!0}})})}trackField(t){return t}cancel(){this.location.back()}delete(){return rc(this,void 0,void 0,function*(){this.deleting=!0;try{yield this.conceptService.deleteConceptType(this.conceptType.id)}catch(t){throw t}this.formGroup.markAsPristine(),this.cancel(),this.deleting=!1})}get editing(){return this.route.snapshot.data.editing}get name(){return this.formGroup.get("name")}get description(){return this.formGroup.get("description")}get pluarlForm(){return this.formGroup.get("pluralForm")}get icon(){return this.formGroup.get("icon")}get playerEditable(){return this.formGroup.get("playerEditable")}get entityConfig(){return this.formGroup.get("entityConfig")}get fields(){return this.formGroup.get("fields")}get isShownInNavigationMenu(){return this.formGroup.get("isShownInNavigationMenu")}get isLinkableToArticles(){return this.formGroup.get("isLinkableToArticles")}get isUsableInOverviewScreen(){return this.formGroup.get("isUsableInOverviewScreen")}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(h.b),c.Lb(Xn.a),c.Lb(y.a),c.Lb(m.g),c.Lb(p.c))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-type-editor"]],decls:63,vars:21,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column","mb-0"],[1,"column","col-auto"],["class","btn btn-error mr-2",3,"ngClass","click",4,"ngIf"],[1,"btn","mr-2",3,"click"],[1,"btn","btn-primary",3,"ngClass","disabled","click"],[1,"mt-2"],["showLabel","true",3,"control","config"],[1,"form-group","mt-2"],[3,"formControl"],[1,"form-group"],[1,"form-checkbox","mb-0"],["type","checkbox",3,"formControl"],[1,"form-icon"],[1,"big-space",3,"formGroup"],[1,"my-2"],["type","checkbox","formControlName","enabled"],[1,"form-input-hint","mt-0"],["class","form-group",4,"ngIf"],[1,"columns","big-space"],[1,"column"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],["class","mt-2",4,"ngFor","ngForOf","ngForTrackBy"],[1,"btn","btn-error","mr-2",3,"ngClass","click"],["type","checkbox","formControlName","enableQuantity"],[1,"columns","mb-1"],[1,"mb-0"],[1,"btn","btn-sm","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[3,"formGroup"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"div",2),c.Qb(3,"h3"),c.wc(4),c.Pb(),c.Pb(),c.Qb(5,"div",3),c.vc(6,sc,2,3,"button",4),c.Qb(7,"button",5),c.Xb("click",function(){return e.cancel()}),c.wc(8," Cancel "),c.Pb(),c.Qb(9,"button",6),c.Xb("click",function(){return e.save()}),c.wc(10," Save "),c.Pb(),c.Pb(),c.Pb(),c.Qb(11,"div",7),c.Mb(12,"dd-dynamic-field",8),c.Mb(13,"dd-dynamic-field",8),c.Mb(14,"dd-dynamic-field",8),c.Qb(15,"div",9),c.Qb(16,"label"),c.wc(17,"Icon"),c.Pb(),c.Mb(18,"dd-icon-picker",10),c.Pb(),c.Qb(19,"div",11),c.Qb(20,"label",12),c.Mb(21,"input",13),c.Mb(22,"i",14),c.wc(23," Players can manage this concept "),c.Pb(),c.Pb(),c.Qb(24,"div",11),c.Qb(25,"label",12),c.Mb(26,"input",13),c.Mb(27,"i",14),c.wc(28," This concept can be linked to articles "),c.Qb(29,"i"),c.wc(30,"(ie. items in a shop)"),c.Pb(),c.Pb(),c.Pb(),c.Qb(31,"div",11),c.Qb(32,"label",12),c.Mb(33,"input",13),c.Mb(34,"i",14),c.wc(35," Show this concept in the sidebar "),c.Pb(),c.Pb(),c.Qb(36,"div",11),c.Qb(37,"label",12),c.Mb(38,"input",13),c.Mb(39,"i",14),c.wc(40," This concept can be used in the overview screen "),c.Qb(41,"i"),c.wc(42,"(ie. character statuses)"),c.Pb(),c.Pb(),c.Pb(),c.Qb(43,"div",15),c.Qb(44,"h3",16),c.wc(45,"Entity Settings"),c.Pb(),c.Qb(46,"div",11),c.Qb(47,"label",12),c.Mb(48,"input",17),c.Mb(49,"i",14),c.wc(50," Entities can have this concept "),c.Pb(),c.Qb(51,"div",18),c.wc(52," This would be like characters having items for example "),c.Pb(),c.Pb(),c.vc(53,lc,7,0,"div",19),c.Pb(),c.Qb(54,"div",20),c.Qb(55,"div",21),c.Qb(56,"h3"),c.wc(57,"Fields"),c.Pb(),c.Pb(),c.Qb(58,"div",3),c.Qb(59,"button",22),c.Xb("click",function(){return e.addField()}),c.Mb(60,"i",23),c.wc(61," Add Field"),c.Pb(),c.Pb(),c.Pb(),c.vc(62,dc,11,2,"div",24),c.Pb(),c.Pb()),2&t&&(c.Ab(4),c.yc("",e.editing?"Edit":"Create"," Concept Type"),c.Ab(2),c.ec("ngIf",e.editing),c.Ab(3),c.ec("ngClass",c.ic(19,ac,e.saving))("disabled",e.formGroup.invalid||e.formGroup.pristine),c.Ab(3),c.ec("control",e.name)("config",e.nameFieldConfig),c.Ab(1),c.ec("control",e.pluarlForm)("config",e.pluralFormFieldConfig),c.Ab(1),c.ec("control",e.description)("config",e.descriptionFieldConfig),c.Ab(4),c.ec("formControl",e.icon),c.Ab(3),c.ec("formControl",e.playerEditable),c.Ab(5),c.ec("formControl",e.isLinkableToArticles),c.Ab(7),c.ec("formControl",e.isShownInNavigationMenu),c.Ab(5),c.ec("formControl",e.isUsableInOverviewScreen),c.Ab(5),c.ec("formGroup",e.entityConfig),c.Ab(10),c.ec("ngIf",e.entityConfig.value.enabled),c.Ab(9),c.ec("ngForOf",e.fields.controls)("ngForTrackBy",e.trackField))},directives:[m.k,m.i,Z.a,oc.a,a.m,a.f,a.a,a.n,a.i,a.g,m.j,cc],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),t})();var bc=i("Kj3r");let pc=(()=>{class t{constructor(){this.imageSize=40}ngOnInit(){}get imgSrc(){return this.concept.imageId?`https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/${this.concept.imageId}`:"https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-list-item"]],inputs:{concept:"concept",imageSize:"imageSize"},decls:6,vars:3,consts:[[1,"columns","col-gapless"],[1,"column","col-auto","mr-2"],[1,"s-rounded","img-responsive",3,"src","width"],[1,"column"],[1,"my-0"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Mb(2,"img",2),c.Pb(),c.Qb(3,"div",3),c.Qb(4,"h5",4),c.wc(5),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(2),c.ec("src",e.imgSrc,c.qc)("width",e.imageSize),c.Ab(3),c.xc(e.concept.name))},styles:[""]}),t})();var hc=i("y4Wg");function mc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",15),c.Xb("click",function(){return c.oc(t),c.Zb(2).create()}),c.Mb(1,"i",16),c.Qb(2,"span",17),c.wc(3),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(3),c.yc(" New ",t.conceptType.name,"")}}function gc(t,e){1&t&&c.Mb(0,"i",18)}function fc(t,e){1&t&&c.Mb(0,"div",19)}function vc(t,e){if(1&t&&(c.Qb(0,"div",6),c.Qb(1,"div",7),c.Qb(2,"h3",8),c.wc(3),c.Pb(),c.Pb(),c.Qb(4,"div",7),c.vc(5,mc,4,1,"button",9),c.Pb(),c.Qb(6,"div",10),c.Qb(7,"div",11),c.Mb(8,"input",12),c.vc(9,gc,1,0,"i",13),c.vc(10,fc,1,0,"div",14),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(3),c.xc(t.conceptType.pluralForm),c.Ab(2),c.ec("ngIf",t.editing),c.Ab(3),c.ec("formControl",t.searchControl),c.Ab(1),c.ec("ngIf",!t.loading||!t.concepts),c.Ab(1),c.ec("ngIf",t.loading&&t.concepts)}}function yc(t,e){1&t&&c.Mb(0,"div",20)}function Pc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",23),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).selectConcept(i)}),c.Mb(1,"dd-concept-list-item",24),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(1),c.ec("concept",t)}}function wc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"dd-paginator",25),c.Xb("pageChange",function(e){return c.oc(t),c.Zb(2).changePage(e)}),c.Pb()}if(2&t){const t=c.Zb(2);c.ec("itemsPerPage",10)("page",t.page)("autoHide",!1)("totalItems",t.totalConcepts)("loading",t.loading)}}function Ic(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,Pc,2,1,"div",21),c.vc(2,wc,1,5,"dd-paginator",22),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.concepts)("ngForTrackBy",t.trackConcept),c.Ab(1),c.ec("ngIf",t.concepts&&t.concepts.length>0)}}function Cc(t,e){1&t&&(c.Qb(0,"p",32),c.wc(1,"Click the button to create one"),c.Pb())}function Qc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",33),c.Qb(1,"button",34),c.Xb("click",function(){return c.oc(t),c.Zb(2).create()}),c.wc(2),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(2),c.yc("Create ",t.conceptType.name,"")}}function Ac(t,e){if(1&t&&(c.Qb(0,"div",26),c.Qb(1,"div",27),c.Mb(2,"i",28),c.Pb(),c.Qb(3,"p",29),c.wc(4),c.Pb(),c.vc(5,Cc,2,0,"p",30),c.vc(6,Qc,3,1,"div",31),c.Pb()),2&t){const t=c.Zb();c.Ab(4),c.yc("There are no ",t.conceptType.pluralForm,""),c.Ab(1),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngIf",t.editing)}}function kc(t,e){if(1&t&&(c.Qb(0,"p",32),c.wc(1),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.zc(" Click the button below to create a new ",t.conceptType.name," called ",t.search," ")}}function xc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",33),c.Qb(1,"button",34),c.Xb("click",function(){return c.oc(t),c.Zb(2).createFromSearch()}),c.wc(2),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(2),c.yc("Create ",t.search,"")}}function Tc(t,e){if(1&t&&(c.Qb(0,"div",26),c.Qb(1,"div",27),c.Mb(2,"i",28),c.Pb(),c.Qb(3,"p",29),c.wc(4,"Your search returned nothing"),c.Pb(),c.vc(5,kc,2,2,"p",30),c.vc(6,xc,3,1,"div",31),c.Pb()),2&t){const t=c.Zb();c.Ab(5),c.ec("ngIf",t.canCreateFromSearch),c.Ab(1),c.ec("ngIf",t.canCreateFromSearch)}}let Ec=(()=>{class t{constructor(t,e,i,n){this.route=t,this.router=e,this.conceptService=i,this.campaignService=n,this.loading=!1,this.search=null,this.page=1}ngOnInit(){this.searchControl=new a.e(null),this.searchControl.valueChanges.pipe(Object(bn.a)(),Object(bc.a)(250)).subscribe(t=>{this.search=null==t||0===t.trim().length?null:t.trim(),this.conceptType&&(this.page=1,this.load(this.conceptType.id))}),this.route.paramMap.subscribe(t=>{const e=t.get("ct_id");this.conceptType=this.getConceptType(e),this.concepts=null;const i=this.readQueryFromURL();this.searchControl.setValue(i.search),this.page=i.offset/i.limit+1,this.search=i.search,this.load(e)})}getConceptType(t){return this.campaignService.campaign.conceptTypes.find(e=>e.id===t)}writeQueryToURL(){const t={limit:10,offset:10*(this.page-1)};this.search&&(t.search=this.search),this.router.navigate([],{relativeTo:this.route,queryParams:t,replaceUrl:!0})}readQueryFromURL(){const t={limit:10,offset:0,search:void 0},e=this.route.snapshot.queryParamMap;try{e.has("limit")&&(t.limit=parseInt(e.get("limit"),10)),e.has("offset")&&(t.offset=parseInt(e.get("offset"),10)),e.has("search")&&(t.search=e.get("search"))}catch(i){}return t}load(t){return e=this,void 0,n=function*(){if(this.conceptType){this.loadError=void 0,this.loading=!0;try{const e=yield this.conceptService.getConcepts(t,10,10*(this.page-1),this.search);this.concepts=e.concepts,this.totalConcepts=e.total,this.writeQueryToURL()}catch(e){this.loadError=e}this.loading=!1}else this.loadError={status:404}},new((i=void 0)||(i=Promise))(function(t,c){function o(t){try{a(n.next(t))}catch(e){c(e)}}function r(t){try{a(n.throw(t))}catch(e){c(e)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i(function(t){t(n)})).then(o,r)}a((n=n.apply(e,[])).next())});var e,i,n}create(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,"create"])}createFromSearch(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,"create"],{queryParams:{name:this.search}})}selectConcept(t){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,t.id,"view"])}trackConcept(t,e){return e.id}changePage(t){this.page=t,this.load(this.conceptType.id)}get editing(){return this.campaignService.canEdit||this.conceptType&&this.conceptType.playerEditable}get canCreateFromSearch(){return this.editing&&this.search}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(p.c),c.Lb(Xn.a),c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-manager"]],decls:7,vars:6,consts:[[1,"container","grid-xl"],[3,"error"],["class","columns",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],[4,"ngIf"],["class","empty",4,"ngIf"],[1,"columns"],[1,"column","col-auto"],[1,"mb-0"],["class","btn btn-sm",3,"click",4,"ngIf"],[1,"column","col-sm-12","my-1"],[1,"has-icon-right"],["type","text","placeholder","Search...",1,"form-input",3,"formControl"],["class","icon icon-search form-icon",4,"ngIf"],["class","loading form-icon",4,"ngIf"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"icon","icon-search","form-icon"],[1,"loading","form-icon"],[1,"loading","loading-lg"],["class","card p-1 hoverable mb-1",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"itemsPerPage","page","autoHide","totalItems","loading","pageChange",4,"ngIf"],[1,"card","p-1","hoverable","mb-1",3,"click"],[3,"concept"],[3,"itemsPerPage","page","autoHide","totalItems","loading","pageChange"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],["class","empty-action",4,"ngIf"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Mb(1,"dd-http-errors",1),c.vc(2,vc,11,5,"div",2),c.vc(3,yc,1,0,"div",3),c.vc(4,Ic,3,3,"div",4),c.vc(5,Ac,7,3,"div",5),c.vc(6,Tc,7,2,"div",5),c.Pb()),2&t&&(c.Ab(1),c.ec("error",e.loadError),c.Ab(1),c.ec("ngIf",e.conceptType),c.Ab(1),c.ec("ngIf",e.loading&&!e.concepts),c.Ab(1),c.ec("ngIf",e.concepts&&e.conceptType),c.Ab(1),c.ec("ngIf",e.conceptType&&e.concepts&&0===e.totalConcepts&&!e.search),c.Ab(1),c.ec("ngIf",e.conceptType&&e.concepts&&0===e.concepts.length&&e.search))},directives:[In.a,m.k,a.b,a.m,a.f,m.j,pc,hc.a],styles:[""]}),t})();var Lc=i("nXDu"),Mc=i("hEiF"),Sc=i("+awi");function Oc(t,e){1&t&&(c.Qb(0,"span",7),c.wc(1,"*"),c.Pb())}function Nc(t,e){if(1&t&&(c.Qb(0,"p",8),c.wc(1),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.yc(" ",t.fieldConfig.description," ")}}const _c=function(t,e){return{"has-error":t,"has-success":e}};let Rc=(()=>{class t extends Lc.a{constructor(){super()}ngOnInit(){super.ngOnInit()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-dynamic-field-horizontal"]],features:[c.xb],decls:10,vars:11,consts:[[1,"form-group",3,"ngClass"],[1,"col-2","col-lg-3","col-sm-12"],[1,"form-label"],["class","text-primary text-large text-bold",4,"ngIf"],[1,"col-10","col-lg-9","col-md-12"],[3,"config","control"],["class","form-input-hint mb-0",4,"ngIf"],[1,"text-primary","text-large","text-bold"],[1,"form-input-hint","mb-0"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"label",2),c.wc(3),c.vc(4,Oc,2,0,"span",3),c.Pb(),c.Pb(),c.Qb(5,"div",4),c.Qb(6,"div"),c.Mb(7,"dd-dynamic-input",5),c.vc(8,Nc,2,1,"p",6),c.Mb(9,"dd-dynamic-validation-errors",5),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.ec("ngClass",c.jc(8,_c,e.control.invalid&&(e.control.dirty||e.control.touched),e.control.valid&&(e.control.dirty||e.control.touched))),c.Ab(3),c.yc("",e.fieldConfig.name," "),c.Ab(1),c.ec("ngIf",e.options.required),c.Ab(3),c.ec("config",e.fieldConfig)("control",e.control),c.Ab(1),c.ec("ngIf",e.fieldConfig.description),c.Ab(1),c.ec("config",e.fieldConfig)("control",e.control))},directives:[m.i,m.k,Mc.a,Sc.a],styles:["[_nghost-%COMP%]{display:block}"]}),t})();var Fc=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function Uc(t,e){1&t&&c.Mb(0,"div",5)}function qc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",14),c.Xb("click",function(){return c.oc(t),c.Zb(2).delete()}),c.Mb(1,"i",15),c.wc(2," Delete"),c.Pb()}}const Gc=function(t){return{loading:t}};function Dc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",6),c.Qb(1,"div",7),c.Qb(2,"h3"),c.wc(3),c.Pb(),c.Pb(),c.Qb(4,"div",8),c.Qb(5,"button",9),c.Xb("click",function(){return c.oc(t),c.Zb().cancel()}),c.Mb(6,"i",10),c.wc(7," Cancel"),c.Pb(),c.vc(8,qc,3,0,"button",11),c.Qb(9,"button",12),c.Xb("click",function(){return c.oc(t),c.Zb().save()}),c.Mb(10,"i",13),c.wc(11," Save "),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(3),c.zc("",t.editing?"Edit":"Create"," ",t.conceptType.name,""),c.Ab(5),c.ec("ngIf",t.editing),c.Ab(1),c.ec("disabled",t.formGroup.invalid||t.formGroup.pristine)("ngClass",c.ic(5,Gc,t.saving))}}function Zc(t,e){if(1&t&&c.Mb(0,"dd-dynamic-field-horizontal",26),2&t){const t=e.$implicit,i=e.index,n=c.Zb(2);c.ec("config",n.getFieldConfig(t))("control",n.fields.controls[i])}}function $c(t,e){if(1&t&&(c.Qb(0,"div",16),c.Qb(1,"div",6),c.Qb(2,"div",8),c.Mb(3,"dd-image-upload",17),c.Pb(),c.Qb(4,"div",7),c.Mb(5,"dd-dynamic-field",18),c.Mb(6,"dd-dynamic-field",18),c.Qb(7,"div",19),c.Qb(8,"label",20),c.wc(9,"Tags"),c.Pb(),c.Mb(10,"dd-tag-editor",16),c.Pb(),c.Qb(11,"label",21),c.Mb(12,"input",22),c.Mb(13,"i",23),c.wc(14),c.Pb(),c.Pb(),c.Pb(),c.Qb(15,"div",24),c.vc(16,Zc,1,2,"dd-dynamic-field-horizontal",25),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.ec("formGroup",t.formGroup),c.Ab(5),c.ec("control",t.name)("config",t.nameFieldConfig),c.Ab(1),c.ec("control",t.description)("config",t.descriptionFieldConfig),c.Ab(4),c.ec("formGroup",t.formGroup),c.Ab(4),c.yc(" This ",t.conceptType.name," is a container "),c.Ab(2),c.ec("ngForOf",t.conceptType.fields)("ngForTrackBy",t.trackField)}}let Xc=(()=>{class t{constructor(t,e,i,n,c){this.route=t,this.router=e,this.conceptService=i,this.campaignService=n,this.location=c,this.loading=!1,this.saving=!1,this.deleting=!0,this.nameFieldConfig={name:"Name",description:"The name of this concept",type:K.a.STRING,options:{maxLength:30,required:!0}},this.descriptionFieldConfig={name:"Description",type:K.a.TEXT_FORMATTED}}ngOnInit(){this.formGroup=new a.h({name:new a.e(null,[a.v.required,a.v.maxLength(30)]),imageId:new a.e(null),content:new a.e(null),isContainer:new a.e(!1),fields:new a.c([]),tags:new a.c([])}),!this.editing&&this.route.snapshot.queryParamMap.has("name")&&(this.name.setValue(this.route.snapshot.queryParamMap.get("name")),this.name.markAsDirty()),this.route.paramMap.subscribe(t=>{const e=t.get("ct_id"),i=t.get("c_id");this.conceptType=this.getConceptType(e),null==this.conceptType?this.error={status:404}:(this.conceptType.fields.forEach(()=>{this.fields.push(new a.e(null))}),this.editing&&this.load(i))})}getConceptType(t){return this.campaignService.campaign.conceptTypes.find(e=>e.id===t)}constructConcept(){const t={name:this.name.value,content:this.description.value,userId:"dmmy",isContainer:this.isContainer.value,fields:this.fields.value.map((t,e)=>({name:this.conceptType.fields[e].name,value:t})).filter(t=>null!=t.value&&""!==t.value),tags:this.tags.value,imageId:this.imageId.value,conceptTypeId:this.conceptType.id};return this.editing&&(t.id=this.concept.id),t}load(t){return Fc(this,void 0,void 0,function*(){this.loading=!0,this.formGroup.disable();try{this.concept=yield this.conceptService.getConcept(t)}catch(e){throw e}this.formGroup.patchValue(Object.assign(Object.assign({},this.concept),{fields:this.conceptType.fields.map(t=>{const e=this.concept.fields.find(e=>e.name===t.name);return e?e.value:null})}),{emitEvent:!1}),this.formGroup.setControl("tags",new a.c(this.concept.tags.map(t=>new a.e(t)))),this.formGroup.enable(),this.loading=!1,this.formGroup.markAsPristine()})}cancel(){this.location.back()}delete(){return Fc(this,void 0,void 0,function*(){if((yield Kt.a.fire({title:"Are you sure?",text:"You will not be able to undo this",showCancelButton:!0})).value){this.formGroup.markAsPristine(),this.formGroup.disable(),this.deleting=!0;try{yield this.conceptService.deleteConcept(this.concept.id)}catch(t){throw t}this.cancel()}})}save(){return Fc(this,void 0,void 0,function*(){if(this.formGroup.valid){this.saving=!0;try{const t=this.constructConcept();this.editing?yield this.conceptService.updateConcept(t):yield this.conceptService.createConcept(t),this.formGroup.markAsPristine(),this.cancel()}catch(t){throw t}this.saving=!1}})}trackField(t){return t}getFieldConfig(t){return t.type===K.a.CURRENCY&&(t.options={levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}),t}get editing(){return this.route.snapshot.data.editing}get name(){return this.formGroup.get("name")}get description(){return this.formGroup.get("content")}get imageId(){return this.formGroup.get("imageId")}get isContainer(){return this.formGroup.get("isContainer")}get fields(){return this.formGroup.get("fields")}get tags(){return this.formGroup.get("tags")}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(p.c),c.Lb(Xn.a),c.Lb(h.b),c.Lb(m.g))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-editor"]],decls:5,vars:4,consts:[[1,"container","grid-xl"],[3,"error"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column"],[1,"column","col-auto"],[1,"btn","mr-2",3,"click"],[1,"icon","icon-arrow-left"],["class","btn btn-error mr-2",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","ngClass","click"],[1,"icon","icon-check"],[1,"btn","btn-error","mr-2",3,"click"],[1,"icon","icon-cross"],[3,"formGroup"],["formControlName","imageId"],["showLabel","true",3,"control","config"],[1,"form-group"],[1,"form-label"],[1,"form-checkbox"],["type","checkbox","formControlName","isContainer"],[1,"form-icon"],[1,"form-horizontal"],["class","col-12 mb-2",3,"config","control",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-12","mb-2",3,"config","control"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Mb(1,"dd-http-errors",1),c.vc(2,Uc,1,0,"div",2),c.vc(3,Dc,12,7,"div",3),c.vc(4,$c,17,9,"div",4),c.Pb()),2&t&&(c.Ab(1),c.ec("error",e.error),c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.conceptType),c.Ab(1),c.ec("ngIf",e.conceptType))},directives:[In.a,m.k,m.i,a.n,a.i,le,a.m,a.g,Z.a,Hn.a,a.a,m.j,Rc],styles:[""]}),t})();function Hc(t,e){1&t&&c.Mb(0,"div",5)}function jc(t,e){if(1&t&&c.Mb(0,"img",16),2&t){const t=c.Zb(2);c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.concept.imageId,"",c.qc)}}function Vc(t,e){1&t&&c.Mb(0,"img",17)}function zc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",18),c.Xb("click",function(){return c.oc(t),c.Zb(2).edit()}),c.Mb(1,"i",19),c.Qb(2,"span",14),c.wc(3," Edit"),c.Pb(),c.Pb()}}function Bc(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",6),c.Qb(1,"div",7),c.vc(2,jc,1,1,"img",8),c.vc(3,Vc,1,0,"img",9),c.Pb(),c.Qb(4,"div",10),c.Qb(5,"h2",11),c.wc(6),c.Pb(),c.Pb(),c.Qb(7,"div",7),c.Qb(8,"button",12),c.Xb("click",function(){return c.oc(t),c.Zb().history()}),c.Mb(9,"i",13),c.Qb(10,"span",14),c.wc(11," History"),c.Pb(),c.Pb(),c.vc(12,zc,4,0,"button",15),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(2),c.ec("ngIf",t.concept.imageId),c.Ab(1),c.ec("ngIf",!t.concept.imageId),c.Ab(3),c.xc(t.concept.name),c.Ab(6),c.ec("ngIf",t.editable)}}function Yc(t,e){if(1&t&&(c.Qb(0,"div",29),c.Mb(1,"img",30),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",t.concept.imageId,"",c.qc),c.ec("alt","picture of"+t.concept.name)}}function Wc(t,e){if(1&t&&c.Mb(0,"dd-quill",31),2&t){const t=c.Zb(2);c.ec("value",t.concept.content)}}function Kc(t,e){1&t&&(c.Qb(0,"p",32),c.wc(1," There is nothing here... "),c.Pb())}function Jc(t,e){if(1&t&&(c.Qb(0,"div",33),c.Qb(1,"h5",34),c.wc(2),c.Pb(),c.Mb(3,"dd-quill",31),c.Pb()),2&t){const t=e.$implicit;c.Ab(2),c.xc(t.name),c.Ab(1),c.ec("value",t.value)}}function to(t,e){if(1&t&&(c.Qb(0,"div",37),c.wc(1),c.Pb()),2&t){const t=e.$implicit;c.Ab(1),c.yc(" ",t," ")}}function eo(t,e){if(1&t&&(c.Qb(0,"div",35),c.vc(1,to,2,1,"div",36),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngForOf",t.concept.tags)}}function io(t,e){if(1&t&&c.Mb(0,"span",43),2&t){const t=c.Zb().$implicit;c.ec("ddCurrency",t.field.value)}}function no(t,e){if(1&t&&(c.Qb(0,"span"),c.wc(1),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(1),c.yc(" ",t.field.value," ")}}function co(t,e){if(1&t&&(c.Qb(0,"tr"),c.Qb(1,"td"),c.wc(2),c.Pb(),c.Qb(3,"td",40),c.vc(4,io,1,1,"span",41),c.vc(5,no,2,1,"span",42),c.Pb(),c.Pb()),2&t){const t=e.$implicit;c.Ab(2),c.xc(t.field.name),c.Ab(1),c.ec("ngSwitch",t.config.type),c.Ab(1),c.ec("ngSwitchCase",6)}}function oo(t,e){if(1&t&&(c.Qb(0,"table",38),c.Qb(1,"thead"),c.Qb(2,"th"),c.wc(3,"Field"),c.Pb(),c.Qb(4,"th"),c.wc(5,"Value"),c.Pb(),c.Pb(),c.Qb(6,"tbody"),c.vc(7,co,6,3,"tr",39),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(7),c.ec("ngForOf",t.tableFields)("ngForTrackBy",t.trackField)}}function ro(t,e){if(1&t&&(c.Qb(0,"div",44),c.Mb(1,"img",30),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/w_500,q_auto:good,f_auto/",t.concept.imageId,"",c.qc),c.ec("alt","picture of"+t.concept.name)}}const ao=function(t,e){return{"col-8":t,"col-12":e}};function so(t,e){if(1&t&&(c.Qb(0,"div",20),c.vc(1,Yc,2,2,"div",21),c.Qb(2,"div",22),c.vc(3,Wc,1,1,"dd-quill",23),c.vc(4,Kc,2,0,"p",24),c.vc(5,Jc,4,2,"div",25),c.vc(6,eo,2,1,"div",26),c.vc(7,oo,8,2,"table",27),c.Pb(),c.vc(8,ro,2,2,"div",28),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngIf",t.concept.imageId),c.Ab(1),c.ec("ngClass",c.jc(8,ao,null!==t.concept.imageId,null===t.concept.imageId)),c.Ab(1),c.ec("ngIf",t.concept.content),c.Ab(1),c.ec("ngIf",!t.concept.content),c.Ab(1),c.ec("ngForOf",t.formattedTextFields),c.Ab(1),c.ec("ngIf",t.concept.tags),c.Ab(1),c.ec("ngIf",t.tableFields.length>0),c.Ab(1),c.ec("ngIf",t.concept.imageId)}}let lo=(()=>{class t{constructor(t,e,i,n){this.route=t,this.router=e,this.campaignService=i,this.conceptService=n,this.loading=!1}ngOnInit(){this.route.paramMap.subscribe(t=>{const e=t.get("c_id"),i=t.get("ct_id");this.conceptType=this.getConceptType(i),null==this.conceptType?this.loadError={status:404}:this.load(e)})}getConceptType(t){return this.campaignService.campaign.conceptTypes.find(e=>e.id===t)}load(t){return e=this,void 0,n=function*(){this.loading=!0;try{this.concept=yield this.conceptService.getConcept(t)}catch(e){this.loadError=e}this.loading=!1},new((i=void 0)||(i=Promise))(function(t,c){function o(t){try{a(n.next(t))}catch(e){c(e)}}function r(t){try{a(n.throw(t))}catch(e){c(e)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i(function(t){t(n)})).then(o,r)}a((n=n.apply(e,[])).next())});var e,i,n}edit(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,this.concept.id,"edit"])}history(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,this.concept.id,"history"])}getFieldConfig(t){return this.conceptType.fields.find(e=>e.name===t.name)}trackField(t){return t}get tableFields(){const t=[];for(const e of this.concept.fields){const i=this.getFieldConfig(e);-1!==[K.a.BOOLEAN,K.a.ENUM,K.a.ENUM_MULTI,K.a.FLOAT,K.a.INT,K.a.STRING,K.a.CURRENCY].indexOf(i.type)&&t.push({field:e,config:i})}return t}get formattedTextFields(){const t=[];for(const e of this.concept.fields)this.getFieldConfig(e).type===K.a.TEXT_FORMATTED&&t.push(e);return t}get editable(){return this.campaignService.canEdit||this.conceptType&&this.conceptType.playerEditable}get user(){if(this.concept){const t=this.campaignService.campaign.members.find(t=>t.userId===this.concept.userId);if(t)return t.user}return null}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(p.c),c.Lb(h.b),c.Lb(Xn.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-view"]],decls:5,vars:4,consts:[[1,"container","grid-xl"],["class","loading loading-lg",4,"ngIf"],[3,"error"],["class","columns",4,"ngIf"],["class","columns mt-2",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column","col-auto"],["class","s-rounded","width","64","alt","Item Picture",3,"src",4,"ngIf"],["class","s-rounded","width","64","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword","alt","Item Fallback Picture",4,"ngIf"],[1,"column"],[1,"mb-0"],[1,"btn","btn-sm","mr-1",3,"click"],[1,"icon","icon-time"],[1,"hide-sm"],["class","btn btn-sm",3,"click",4,"ngIf"],["width","64","alt","Item Picture",1,"s-rounded",3,"src"],["width","64","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword","alt","Item Fallback Picture",1,"s-rounded"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-edit"],[1,"columns","mt-2"],["class","column col-4 hide-md",4,"ngIf"],[1,"column","col-md-12",3,"ngClass"],["readOnly","true",3,"value",4,"ngIf"],["class","text-italic text-center",4,"ngIf"],["class","mt-2",4,"ngFor","ngForOf"],["class","big-space",4,"ngIf"],["class","table",4,"ngIf"],["class","column col-md-8 col-xs-11 col-mx-auto show-md mt-2",4,"ngIf"],[1,"column","col-4","hide-md"],[1,"img-responsive","s-rounded",3,"src","alt"],["readOnly","true",3,"value"],[1,"text-italic","text-center"],[1,"mt-2"],[1,"mb-1"],[1,"big-space"],["class","label label-rounded mr-1 mb-1",4,"ngFor","ngForOf"],[1,"label","label-rounded","mr-1","mb-1"],[1,"table"],[4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngSwitch"],[3,"ddCurrency",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"ddCurrency"],[1,"column","col-md-8","col-xs-11","col-mx-auto","show-md","mt-2"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,Hc,1,0,"div",1),c.Mb(2,"dd-http-errors",2),c.vc(3,Bc,13,4,"div",3),c.vc(4,so,9,11,"div",4),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("error",e.loadError),c.Ab(1),c.ec("ngIf",e.concept),c.Ab(1),c.ec("ngIf",e.concept))},directives:[m.k,In.a,m.i,m.j,J.a,m.l,m.m,m.n,ut.a],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),t})();var uo=function(t){return t[t.CREATE=0]="CREATE",t[t.UPDATE=1]="UPDATE",t[t.DELETE=2]="DELETE",t[t.RESTORE=3]="RESTORE",t}({}),bo=i("bo1M"),po=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function ho(t,e){1&t&&c.Mb(0,"div",4)}function mo(t,e){if(1&t&&c.Mb(0,"dd-http-errors",5),2&t){const t=c.Zb();c.ec("error",t.loadErr)}}function go(t,e){1&t&&c.Mb(0,"i",21)}function fo(t,e){1&t&&c.Mb(0,"i",22)}function vo(t,e){1&t&&c.Mb(0,"i",23)}function yo(t,e){1&t&&c.Mb(0,"li",26),2&t&&c.ec("innerHTML",e.$implicit,c.pc)}function Po(t,e){if(1&t&&(c.Qb(0,"ul",24),c.vc(1,yo,1,1,"li",25),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(1),c.ec("ngForOf",t.changes)}}const wo=function(t){return{loading:t}};function Io(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",27),c.Xb("click",function(){c.oc(t);const e=c.Zb().$implicit;return c.Zb(2).restore(e)}),c.Mb(1,"i",23),c.Qb(2,"span",28),c.wc(3," Restore"),c.Pb(),c.Pb()}if(2&t){const t=c.Zb().$implicit,e=c.Zb(2);c.ec("ngClass",c.ic(1,wo,e.restoringId===t.id))}}const Co=function(t){return{"icon-lg":t}};function Qo(t,e){if(1&t&&(c.Qb(0,"div",8),c.Qb(1,"div",9),c.Qb(2,"a",10),c.vc(3,go,1,0,"i",11),c.vc(4,fo,1,0,"i",12),c.vc(5,vo,1,0,"i",13),c.Pb(),c.Pb(),c.Qb(6,"div",14),c.Qb(7,"div",15),c.Qb(8,"div",16),c.Qb(9,"strong"),c.wc(10),c.Pb(),c.wc(11),c.vc(12,Po,2,1,"ul",17),c.Qb(13,"div"),c.wc(14),c.ac(15,"date"),c.Pb(),c.Mb(16,"div",18),c.Pb(),c.Qb(17,"div",19),c.vc(18,Io,4,3,"button",20),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=e.first,n=e.last,o=c.Zb(2);c.Ab(2),c.ec("ngClass",c.ic(14,Co,!i))("ngSwitch",t.actionType),c.Ab(1),c.ec("ngSwitchCase",1),c.Ab(1),c.ec("ngSwitchCase",2),c.Ab(1),c.ec("ngSwitchCase",3),c.Ab(5),c.xc(t.name),c.Ab(1),c.yc(" ",1===t.actionSource?"imported":o.getEntryActionText(t),". "),c.Ab(1),c.ec("ngIf",t.changes.length>0),c.Ab(2),c.xc(c.bc(15,11,o.getDate(t),"short")),c.Ab(2),c.ec("ddUser",o.getUser(t.userId)),c.Ab(2),c.ec("ngIf",!n&&o.editable)}}function Ao(t,e){if(1&t&&(c.Qb(0,"div",6),c.vc(1,Qo,19,16,"div",7),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.diffedHistory)}}let ko=(()=>{class t{constructor(t,e,i){this.conceptService=t,this.campaignService=e,this.route=i,this.loading=!1}ngOnInit(){this.route.paramMap.subscribe(t=>{const e=t.get("c_id");t.get("ct_id"),this.load(e)})}load(t){return po(this,void 0,void 0,function*(){this.loading=!0;try{this.conceptHistory=yield this.conceptService.getConceptHistory(t),this.diffedHistory=this.makeDiffedHistory(this.conceptHistory)}catch(e){this.loadErr=e}this.loading=!1})}prefilterHistory(t,e){return-1!==["id","userId","dateTime","actionType","actionSource","conceptId","conceptTypeId"].indexOf(e)}makeDiffedHistory(t){const e=[];for(let i=0;i<t.length;i++){if(0===i){e.push(Object.assign(Object.assign({},t[i]),{diff:null,changes:[]}));continue}const n=bo.diff(t[i-1],t[i],this.prefilterHistory),c=this.getHumanReadableListOfDiffChanges(n,t[i]);e.push(Object.assign(Object.assign({},t[i]),{diff:n,changes:c||[]}))}return e}getHumanReadableListOfDiffChanges(t,e){const i=[];if(null==t)return i;for(const n of t)if(n)switch(n.kind){case"A":if("fields"===n.path[0])switch(n.item.kind){case"N":i.push(`<b>Added ${n.item.rhs.name}:</b> ${n.item.rhs.value}`);break;case"D":i.push(`<b>Removed ${n.item.lhs.name}</b>`)}if("tags"===n.path[0])switch(n.item.kind){case"N":i.push(`<b>Added Tag:</b> ${n.item.rhs}`);break;case"D":i.push(`<b>Removed Tag</b>: ${n.item.lhs}`)}break;case"D":break;case"E":switch(n.path[0]){case"name":i.push(`<b>Name:</b> ${n.lhs} \u27a1\ufe0f ${n.rhs}`);break;case"content":i.push("<b>Updated description</b>");break;case"fields":i.push(`<b>${e.fields[n.path[1]].name}:</b> ${n.lhs} \u27a1\ufe0f ${n.rhs}`);break;case"tags":i.push(`<b>Removed Tag</b>: ${n.lhs}`),i.push(`<b>Added Tag</b>: ${n.rhs}`);break;case"imageId":i.push("<b>Changed Image</b>")}}return i}restore(t){return po(this,void 0,void 0,function*(){this.restoringId=t.id;try{yield this.conceptService.restoreConcept(t.conceptId,t.id),this.load(t.conceptId)}catch(e){throw e}this.restoringId=null})}getUser(t){const e=this.campaignService.campaign.members.find(e=>e.userId===t);return e?e.user:null}getDate(t){return new Date(t.dateTime)}getEntryActionText(t){switch(t.actionType){case uo.CREATE:return"created";case uo.DELETE:return"deleted";case uo.UPDATE:return"updated";case uo.RESTORE:return"restored"}}get editable(){return this.campaignService.canEdit}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(Xn.a),c.Lb(h.b),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-history"]],decls:4,vars:3,consts:[[1,"container","grid-sm"],["class","loading loading-lg",4,"ngIf"],[3,"error",4,"ngIf"],["class","timeline",4,"ngIf"],[1,"loading","loading-lg"],[3,"error"],[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],[1,"timeline-item"],[1,"timeline-left"],[1,"timeline-icon",3,"ngClass","ngSwitch"],["class","icon icon-edit",4,"ngSwitchCase"],["class","icon icon-delete",4,"ngSwitchCase"],["class","icon icon-refresh",4,"ngSwitchCase"],[1,"timeline-content"],[1,"tile"],[1,"tile-content"],["class","my-0",4,"ngIf"],[3,"ddUser"],[1,"tile-action"],["class","btn btn-sm",3,"ngClass","click",4,"ngIf"],[1,"icon","icon-edit"],[1,"icon","icon-delete"],[1,"icon","icon-refresh"],[1,"my-0"],[3,"innerHTML",4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"btn","btn-sm",3,"ngClass","click"],[1,"hide-sm"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,ho,1,0,"div",1),c.vc(2,mo,1,1,"dd-http-errors",2),c.vc(3,Ao,2,1,"div",3),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.loadErr),c.Ab(1),c.ec("ngIf",e.diffedHistory))},directives:[m.k,In.a,m.j,m.i,m.l,m.m,L.a],pipes:[m.d],styles:[""]}),t})();var xo=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function To(t,e){1&t&&c.Mb(0,"div",2)}const Eo=function(t){return{loading:t}};function Lo(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",10),c.Qb(1,"div",11),c.Mb(2,"i",12),c.Pb(),c.Qb(3,"p",13),c.wc(4,"There are no invites"),c.Pb(),c.Qb(5,"p",14),c.wc(6,"Click the button below to create one"),c.Pb(),c.Qb(7,"div",15),c.Qb(8,"button",16),c.Xb("click",function(){return c.oc(t),c.Zb(2).createInvite()}),c.wc(9," Create invite "),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(8),c.ec("ngClass",c.ic(1,Eo,t.creatingInvite))}}function Mo(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",17),c.Xb("click",function(){return c.oc(t),c.Zb(2).createInvite()}),c.Mb(1,"i",18),c.Qb(2,"span",19),c.wc(3," Create Invite"),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.ec("ngClass",c.ic(1,Eo,t.creatingInvite))}}function So(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Pending"),c.Pb())}function Oo(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Revoked"),c.Pb())}function No(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Accepted"),c.Pb())}function _o(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"Declined"),c.Pb())}function Ro(t,e){1&t&&(c.Qb(0,"span"),c.wc(1,"N/A"),c.Pb())}function Fo(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",27),c.Xb("click",function(){c.oc(t);const e=c.Zb().$implicit;return c.Zb(3).revokeInvite(e)}),c.Mb(1,"i",28),c.wc(2,"Revoke "),c.Pb()}}function Uo(t,e){if(1&t&&(c.Qb(0,"tr"),c.Qb(1,"td"),c.Qb(2,"a",22),c.wc(3,"Link"),c.Pb(),c.Pb(),c.Qb(4,"td"),c.wc(5),c.Pb(),c.Qb(6,"td",23),c.vc(7,So,2,0,"span",24),c.vc(8,Oo,2,0,"span",24),c.vc(9,No,2,0,"span",24),c.vc(10,_o,2,0,"span",24),c.Pb(),c.Qb(11,"td"),c.Mb(12,"div",25),c.vc(13,Ro,2,0,"span",1),c.Pb(),c.Qb(14,"td"),c.vc(15,Fo,3,0,"button",26),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(3);c.Ab(2),c.ec("href",i.getInviteLink(t.id),c.qc),c.Ab(3),c.xc(t.name),c.Ab(1),c.ec("ngSwitch",t.status),c.Ab(1),c.ec("ngSwitchCase",0),c.Ab(1),c.ec("ngSwitchCase",1),c.Ab(1),c.ec("ngSwitchCase",2),c.Ab(1),c.ec("ngSwitchCase",3),c.Ab(2),c.ec("ddUser",t.user),c.Ab(1),c.ec("ngIf",!t.user),c.Ab(2),c.ec("ngIf",0===t.status)}}function qo(t,e){if(1&t&&(c.Qb(0,"table",20),c.Qb(1,"thead"),c.Qb(2,"tr"),c.Qb(3,"th"),c.wc(4,"Link"),c.Pb(),c.Qb(5,"th"),c.wc(6,"Name"),c.Pb(),c.Qb(7,"th"),c.wc(8,"Status"),c.Pb(),c.Qb(9,"th"),c.wc(10,"User"),c.Pb(),c.Mb(11,"th"),c.Pb(),c.Pb(),c.Qb(12,"tbody"),c.vc(13,Uo,16,10,"tr",21),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(13),c.ec("ngForOf",t.invites)}}function Go(t,e){if(1&t&&(c.Qb(0,"div"),c.vc(1,Lo,10,3,"div",3),c.Qb(2,"div",4),c.Qb(3,"div",5),c.Qb(4,"h4",6),c.wc(5,"Invites"),c.Pb(),c.Pb(),c.Qb(6,"div",7),c.vc(7,Mo,4,3,"button",8),c.Pb(),c.Pb(),c.vc(8,qo,14,1,"table",9),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngIf",0===t.invites.length),c.Ab(6),c.ec("ngIf",t.invites.length>0),c.Ab(1),c.ec("ngIf",t.invites.length>0)}}let Do=(()=>{class t{constructor(t){this.campaignService=t,this.loading=!1,this.creatingInvite=!1}ngOnInit(){this.loadInvites()}createInvite(){return xo(this,void 0,void 0,function*(){this.creatingInvite=!0;const t=new P.Chance;try{const e=yield this.campaignService.createInvite(`${t.state({full:!0,territories:!0})} ${t.animal()}`);this.invites.push(e)}catch(e){throw e}this.creatingInvite=!1})}revokeInvite(t){return xo(this,void 0,void 0,function*(){try{const e=Object.assign(Object.assign({},t),{status:h.a.REVOKED});yield this.campaignService.updateInvite(e),t.status=e.status}catch(e){throw e}})}getInviteLink(t){return`${location.protocol}//${location.host}/invite/${t}`}loadInvites(){return xo(this,void 0,void 0,function*(){this.loading=!0;try{const t=yield this.campaignService.getInvites();this.invites=t}catch(t){throw t}this.loading=!1})}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-invite-manager"]],decls:2,vars:2,consts:[["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],["class","empty",4,"ngIf"],[1,"columns"],[1,"column"],[1,"mb-0"],[1,"column","col-auto"],["class","btn btn-sm",3,"ngClass","click",4,"ngIf"],["class","table",4,"ngIf"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-people","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"ngClass","click"],[1,"btn","btn-sm",3,"ngClass","click"],[1,"icon","icon-plus"],[1,"hide-sm"],[1,"table"],[4,"ngFor","ngForOf"],[3,"href"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"ddUser"],["class","btn btn-link btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-link","btn-sm",3,"click"],[1,"icon","icon-cross"]],template:function(t,e){1&t&&(c.vc(0,To,1,0,"div",0),c.vc(1,Go,9,3,"div",1)),2&t&&(c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.invites))},directives:[m.k,m.i,m.j,m.l,m.m,L.a],styles:[""]}),t})();function Zo(t,e){if(1&t){const t=c.Rb();c.Qb(0,"span",11),c.Xb("click",function(){c.oc(t);const e=c.Zb().$implicit;return c.Zb().remove(e)}),c.wc(1,"Remove"),c.Pb()}}const $o=function(t){return{faded:t}};function Xo(t,e){if(1&t&&(c.Qb(0,"tr",8),c.Mb(1,"td",9),c.Qb(2,"td"),c.wc(3,"A Date"),c.Pb(),c.Qb(4,"td"),c.vc(5,Zo,2,0,"span",10),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb();c.ec("ngClass",c.ic(3,$o,t.userId===i.campaign.userId)),c.Ab(1),c.ec("ddUser",t.user),c.Ab(4),c.ec("ngIf",t.userId!==i.campaign.userId)}}let Ho=(()=>{class t{constructor(t){this.campaignService=t}ngOnInit(){}remove(t){return e=this,void 0,n=function*(){if(!0===(yield Kt.a.fire({titleText:"Are you sure?",showCancelButton:!0})).value){this.campaignService.campaign.members=this.campaignService.campaign.members.filter(e=>!(e.userId===t.userId&&e.campaignId===t.campaignId));try{yield this.campaignService.removeMember(t)}catch(e){throw e}}},new((i=void 0)||(i=Promise))(function(t,c){function o(t){try{a(n.next(t))}catch(e){c(e)}}function r(t){try{a(n.throw(t))}catch(e){c(e)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i(function(t){t(n)})).then(o,r)}a((n=n.apply(e,[])).next())});var e,i,n}get members(){return this.campaignService.campaign.members}get campaign(){return this.campaignService.campaign}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-member-manager"]],decls:18,vars:1,consts:[[1,"container","grid-xl"],[1,"columns"],[1,"column"],[1,"mb-0"],[1,"column","col-auto"],[1,"table"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"big-space"],[3,"ngClass"],[3,"ddUser"],["class","fake-link",3,"click",4,"ngIf"],[1,"fake-link",3,"click"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.Qb(2,"div",2),c.Qb(3,"h3",3),c.wc(4,"Members"),c.Pb(),c.Pb(),c.Mb(5,"div",4),c.Pb(),c.Qb(6,"table",5),c.Qb(7,"thead"),c.Qb(8,"th"),c.wc(9,"User"),c.Pb(),c.Qb(10,"th"),c.wc(11,"Added On"),c.Pb(),c.Qb(12,"th"),c.wc(13,"Remove"),c.Pb(),c.Pb(),c.Qb(14,"tbody"),c.vc(15,Xo,6,5,"tr",6),c.Pb(),c.Pb(),c.Qb(16,"div",7),c.Mb(17,"dd-invite-manager"),c.Pb(),c.Pb()),2&t&&(c.Ab(15),c.ec("ngForOf",e.members))},directives:[m.j,Do,m.i,L.a,m.k],styles:[".big-space[_ngcontent-%COMP%]{margin-top:2rem}"]}),t})();var jo=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function Vo(t,e){1&t&&(c.Qb(0,"div",15),c.Mb(1,"i",16),c.Pb())}function zo(t,e){1&t&&c.Mb(0,"i",21)}function Bo(t,e){1&t&&c.Mb(0,"i",22)}function Yo(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",17),c.Qb(1,"button",18),c.Xb("click",function(){c.oc(t);const e=c.Zb();return e.childrenCollapsed=!e.childrenCollapsed}),c.vc(2,zo,1,0,"i",19),c.vc(3,Bo,1,0,"i",20),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(2),c.ec("ngIf",t.childrenCollapsed),c.Ab(1),c.ec("ngIf",!t.childrenCollapsed)}}function Wo(t,e){if(1&t&&c.Mb(0,"img",23),2&t){const t=c.Zb();c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.conceptEntity.concept.imageId,"",c.qc)}}function Ko(t,e){1&t&&c.Mb(0,"img",24)}function Jo(t,e){if(1&t&&(c.Qb(0,"sup",25),c.wc(1),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.yc("x",t.conceptEntity.quantity,"")}}function tr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",26),c.Xb("click",function(){return c.oc(t),c.Zb().doRemoveFromParent()}),c.Mb(1,"i",27),c.Mb(2,"span",28),c.Pb()}}function er(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",29),c.Xb("click",function(){return c.oc(t),c.Zb().doAddChild()}),c.Mb(1,"i",30),c.Qb(2,"span",28),c.wc(3),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(3),c.yc(" Add to ",t.conceptEntity.concept.name,"")}}function ir(t,e){if(1&t&&(c.Qb(0,"div",34),c.Qb(1,"div",35),c.wc(2),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(2),c.yc("This ",t.conceptEntity.concept.name," is empty")}}function nr(t,e){1&t&&c.Mb(0,"div",39)}function cr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",36),c.vc(1,nr,1,0,"div",37),c.Qb(2,"dd-concept-entity-manager-list-item",38),c.Xb("selected",function(e){return c.oc(t),c.Zb(2).select(e)}),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(2),c.ec("conceptEntity",t)("conceptType",i.conceptType)("allConceptEntities",i.allConceptEntities)("isChild",!0)}}function or(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",31),c.Xb("cdkDropListDropped",function(e){return c.oc(t),c.Zb().conceptDropped(e)}),c.vc(1,ir,3,1,"div",32),c.vc(2,cr,3,4,"div",33),c.Pb()}if(2&t){const t=c.Zb();c.Ab(1),c.ec("ngIf",0===t.children.length),c.Ab(1),c.ec("ngForOf",t.children)}}const rr=function(t){return{"bg-secondary":t}},ar=function(t){return{faded:t}},sr=function(t,e,i){return["/campaigns",t,"concepts",e,i,"view"]};let lr=(()=>{class t{constructor(t,e){this.campaignService=t,this.conceptService=e,this.selected=new c.n,this.addChild=new c.n,this.childrenCollapsed=!0}ngOnInit(){}select(t){this.selected.emit(t)}conceptDropped(t){return jo(this,void 0,void 0,function*(){const e=this.children;Object(o.f)(e,t.previousIndex,t.currentIndex),e.forEach((t,e)=>{t.sortValue=e}),yield this.conceptService.updateConceptEntities(e,this.conceptEntity.entityId)})}doAddChild(){this.addChild.emit(!0)}doRemoveFromParent(){return jo(this,void 0,void 0,function*(){this.conceptEntity.parentConceptId=null,this.conceptEntity.parentEntityId=null,yield this.conceptService.updateConceptEntity(this.conceptEntity)})}get campaign(){return this.campaignService.campaign}get quantityEnabled(){return this.conceptType.entityConfig.enabled&&this.conceptType.entityConfig.enableQuantity}get children(){const t=[];for(const e of this.allConceptEntities)e.parentConceptId===this.conceptEntity.conceptId&&t.push(e);return t.sort((t,e)=>t.sortValue-e.sortValue)}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b),c.Lb(Xn.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-entity-manager-list-item"]],inputs:{conceptEntity:"conceptEntity",conceptType:"conceptType",draggable:"draggable",isChild:"isChild",allConceptEntities:"allConceptEntities"},outputs:{selected:"selected",addChild:"addChild"},decls:16,vars:23,consts:[[1,"card","px-1","pt-1","my-1",3,"ngClass"],[1,"columns","col-gapless"],["class","column col-auto mr-2 c-move",4,"ngIf"],["class","column col-auto mr-1",4,"ngIf"],[1,"column","col-auto","mr-2",3,"ngClass","click"],["class","s-rounded","width","30","style","margin-bottom: -0.075rem",3,"src",4,"ngIf"],["class","s-rounded","width","30","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword","style","margin-bottom: -0.075rem",4,"ngIf"],[1,"column","c-hand","no-select",3,"ngClass","click"],["class","text-bold text-small",4,"ngIf"],[1,"column","col-auto"],["class","btn btn-sm btn-error mr-1",3,"click",4,"ngIf"],["class","btn btn-sm mr-1",3,"click",4,"ngIf"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-arrow-right"],["class","column col-12","cdkDropList","",3,"cdkDropListDropped",4,"ngIf"],[1,"column","col-auto","mr-2","c-move"],[1,"icon","icon-resize-vert"],[1,"column","col-auto","mr-1"],[1,"btn","btn-sm",3,"click"],["class","icon icon-arrow-down",4,"ngIf"],["class","icon icon-arrow-up",4,"ngIf"],[1,"icon","icon-arrow-down"],[1,"icon","icon-arrow-up"],["width","30",1,"s-rounded",2,"margin-bottom","-0.075rem",3,"src"],["width","30","src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/winged-sword",1,"s-rounded",2,"margin-bottom","-0.075rem"],[1,"text-bold","text-small"],[1,"btn","btn-sm","btn-error","mr-1",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[1,"btn","btn-sm","mr-1",3,"click"],[1,"icon","icon-plus"],["cdkDropList","",1,"column","col-12",3,"cdkDropListDropped"],["class","empty p-1 mb-1",4,"ngIf"],["cdkDrag","",4,"ngFor","ngForOf"],[1,"empty","p-1","mb-1"],[1,"empty-subtitle","text-italic","m-0"],["cdkDrag",""],["class","drag-placeholder",4,"cdkDragPlaceholder"],[3,"conceptEntity","conceptType","allConceptEntities","isChild","selected"],[1,"drag-placeholder"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"div",1),c.vc(2,Vo,2,0,"div",2),c.vc(3,Yo,4,2,"div",3),c.Qb(4,"div",4),c.Xb("click",function(){return e.select(e.conceptEntity)}),c.vc(5,Wo,1,1,"img",5),c.vc(6,Ko,1,0,"img",6),c.Pb(),c.Qb(7,"div",7),c.Xb("click",function(){return e.select(e.conceptEntity)}),c.wc(8),c.vc(9,Jo,2,1,"sup",8),c.Pb(),c.Qb(10,"div",9),c.vc(11,tr,3,0,"button",10),c.vc(12,er,4,1,"button",11),c.Qb(13,"button",12),c.Mb(14,"i",13),c.Pb(),c.Pb(),c.vc(15,or,3,2,"div",14),c.Pb(),c.Pb()),2&t&&(c.ec("ngClass",c.ic(13,rr,e.conceptEntity.concept.isContainer)),c.Ab(2),c.ec("ngIf",e.draggable),c.Ab(1),c.ec("ngIf",e.conceptEntity.concept.isContainer),c.Ab(1),c.ec("ngClass",c.ic(15,ar,0===e.conceptEntity.quantity)),c.Ab(1),c.ec("ngIf",e.conceptEntity.concept.imageId),c.Ab(1),c.ec("ngIf",!e.conceptEntity.concept.imageId),c.Ab(1),c.ec("ngClass",c.ic(17,ar,e.quantityEnabled&&0===e.conceptEntity.quantity)),c.Ab(1),c.yc(" ",e.conceptEntity.concept.name," "),c.Ab(1),c.ec("ngIf",e.quantityEnabled&&1!==e.conceptEntity.quantity&&null!==e.conceptEntity.quantity),c.Ab(2),c.ec("ngIf",e.isChild),c.Ab(1),c.ec("ngIf",e.conceptEntity.concept.isContainer),c.Ab(1),c.ec("routerLink",c.kc(19,sr,e.campaign.id,e.conceptType.id,e.conceptEntity.concept.id)),c.Ab(2),c.ec("ngIf",e.conceptEntity.concept.isContainer&&!e.childrenCollapsed))},directives:[m.i,m.k,p.d,o.d,m.j,o.a,o.c,t],styles:[""]}),t})();var dr=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const ur=["picker"],br=["viewandedit"],pr=["nestselector"],hr=["searchbar"];function mr(t,e){1&t&&c.Mb(0,"i",24)}function gr(t,e){1&t&&c.Mb(0,"div",25)}function fr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",26),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(),c.mc(1).close(i)}),c.Mb(1,"dd-concept-list-item",27),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(1),c.ec("concept",t)("imageSize",25)}}function vr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",26),c.Xb("click",function(){return c.oc(t),c.Zb(2).createConcept()}),c.Qb(1,"span"),c.Mb(2,"i",28),c.wc(3),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(3),c.yc(" ",t.searchControl.value,"")}}function yr(t,e){if(1&t&&(c.Qb(0,"p",35),c.wc(1),c.Pb()),2&t){const t=c.Zb(3);c.Ab(1),c.yc("Click the button below to create a new ",t.conceptType.name,"")}}function Pr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",36),c.Qb(1,"button",37),c.Xb("click",function(){return c.oc(t),c.Zb(3).createConcept()}),c.wc(2),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(3);c.Ab(2),c.yc("Create ",t.searchControl.value,"")}}function wr(t,e){if(1&t&&(c.Qb(0,"div",29),c.Qb(1,"div",30),c.Mb(2,"i",31),c.Pb(),c.Qb(3,"p",32),c.wc(4,"Your search returned no results"),c.Pb(),c.vc(5,yr,2,1,"p",33),c.vc(6,Pr,3,1,"div",34),c.Pb()),2&t){const t=c.Zb(2);c.Ab(5),c.ec("ngIf",t.conceptTypeEditable),c.Ab(1),c.ec("ngIf",t.conceptTypeEditable)}}function Ir(t,e){if(1&t&&(c.Qb(0,"dd-modal",null,13),c.Qb(2,"h4",14),c.wc(3),c.Pb(),c.Qb(4,"div",15),c.Qb(5,"div",16),c.Mb(6,"input",17,18),c.vc(8,mr,1,0,"i",19),c.vc(9,gr,1,0,"div",20),c.Pb(),c.Qb(10,"div"),c.vc(11,fr,2,2,"div",21),c.vc(12,vr,4,1,"div",22),c.Pb(),c.vc(13,wr,7,2,"div",23),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(3),c.yc("Pick ",t.conceptType.name,""),c.Ab(3),c.gc("placeholder","Search ",t.conceptType.pluralForm,""),c.ec("formControl",t.searchControl),c.Ab(2),c.ec("ngIf",!t.searchLoading),c.Ab(1),c.ec("ngIf",t.searchLoading),c.Ab(2),c.ec("ngForOf",t.searchResults)("ngForTrackBy",t.trackConcept),c.Ab(1),c.ec("ngIf",t.searchControl.value&&t.searchControl.value.trim().length>2),c.Ab(1),c.ec("ngIf",t.searchResults&&0===t.totalResults&&""!==t.searchControl.value)}}function Cr(t,e){if(1&t&&(c.Qb(0,"h4",14),c.wc(1),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.yc(" ",t.selectedConceptEntity.concept.name," ")}}function Qr(t,e){if(1&t&&c.Mb(0,"dd-dynamic-field",41),2&t){const t=c.Zb(2);c.ec("control",t.quantityControl)("config",t.quantityFieldConfig)}}function Ar(t,e){if(1&t&&(c.Qb(0,"div",38),c.vc(1,Qr,1,2,"dd-dynamic-field",39),c.Mb(2,"div",40),c.Mb(3,"dd-dynamic-field",41),c.Pb()),2&t){const t=c.Zb();c.ec("formGroup",t.editGroup),c.Ab(1),c.ec("ngIf",t.quantityEnabled),c.Ab(2),c.ec("control",t.contentControl)("config",t.notesFieldConfig)}}function kr(t,e){if(1&t&&(c.Qb(0,"h6"),c.wc(1," Quantity: "),c.Qb(2,"strong"),c.wc(3),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(3),c.xc(t.selectedConceptEntity.quantity||1)}}function xr(t,e){if(1&t&&(c.Qb(0,"div",15),c.vc(1,kr,4,1,"h6",0),c.Mb(2,"dd-quill",42),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngIf",t.quantityEnabled),c.Ab(1),c.ec("value",t.selectedConceptEntity.content)}}function Tr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",43),c.Qb(1,"button",44),c.Xb("click",function(){c.oc(t);const e=c.Zb();return e.remove(e.selectedConceptEntity)}),c.wc(2," Remove "),c.Pb(),c.Qb(3,"button",45),c.Xb("click",function(){return c.oc(t),c.Zb(),c.mc(2).close(null)}),c.wc(4,"Cancel"),c.Pb(),c.Qb(5,"button",37),c.Xb("click",function(){return c.oc(t),c.Zb().save()}),c.wc(6,"Save"),c.Pb(),c.Pb()}}function Er(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",26),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2),c.mc(8).close(i)}),c.Mb(1,"dd-concept-list-item",27),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(1),c.ec("concept",t)("imageSize",25)}}function Lr(t,e){if(1&t&&(c.Qb(0,"div",15),c.vc(1,Er,2,2,"div",21),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.nestableConcepts)("ngForTrackBy",t.trackConcept)}}function Mr(t,e){if(1&t&&(c.Qb(0,"span",54),c.wc(1),c.Pb()),2&t){const t=c.Zb(4);c.Ab(1),c.yc(" Reorder ",t.conceptType.pluralForm,"")}}function Sr(t,e){1&t&&(c.Qb(0,"span",54),c.wc(1," Save Order"),c.Pb())}const Or=function(t,e){return{"icon-resize-vert":t,"icon-check":e}};function Nr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",55),c.Xb("click",function(){return c.oc(t),c.Zb(3).toggleReorder()}),c.Mb(1,"i",56),c.vc(2,Mr,2,1,"span",57),c.vc(3,Sr,2,0,"span",57),c.Pb()}if(2&t){const t=c.Zb(3);c.Ab(1),c.ec("ngClass",c.jc(3,Or,!t.draggingEnabled,t.draggingEnabled)),c.Ab(1),c.ec("ngIf",!t.draggingEnabled),c.Ab(1),c.ec("ngIf",t.draggingEnabled)}}function _r(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",47),c.vc(1,Nr,4,6,"button",52),c.Qb(2,"button",53),c.Xb("click",function(){return c.oc(t),c.Zb(2).add()}),c.Mb(3,"i",28),c.Qb(4,"span",54),c.wc(5),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(1),c.ec("ngIf",t.editable),c.Ab(4),c.yc(" Add ",t.conceptType.name,"")}}const Rr=function(t,e){return["/campaigns",t,"entities",e]};function Fr(t,e){if(1&t&&(c.Qb(0,"div",46),c.Qb(1,"div",47),c.Qb(2,"button",48),c.Mb(3,"i",49),c.Pb(),c.Pb(),c.Qb(4,"div",50),c.Qb(5,"h5"),c.wc(6),c.Pb(),c.Pb(),c.vc(7,_r,6,2,"div",51),c.Pb()),2&t){const t=c.Zb();c.Ab(2),c.ec("routerLink",c.jc(4,Rr,t.campaign.id,t.entity.id)),c.Ab(4),c.zc("",t.conceptType.pluralForm," for ",t.entity.name,""),c.Ab(1),c.ec("ngIf",t.editable)}}function Ur(t,e){1&t&&c.Mb(0,"div",58)}function qr(t,e){if(1&t&&(c.Qb(0,"div",59),c.Qb(1,"p",35),c.wc(2),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(2),c.yc("No ",t.conceptType.pluralForm," here!")}}function Gr(t,e){1&t&&c.Mb(0,"div",63)}function Dr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",60),c.vc(1,Gr,1,0,"div",61),c.Qb(2,"dd-concept-entity-manager-list-item",62),c.Xb("selected",function(e){return c.oc(t),c.Zb().select(e)})("addChild",function(){c.oc(t);const i=e.$implicit;return c.Zb().selectChildToNest(i)}),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit,i=c.Zb();c.ec("cdkDragDisabled",!i.editable||!i.draggingEnabled),c.Ab(2),c.ec("conceptEntity",t)("conceptType",i.conceptType)("draggable",i.editable&&i.draggingEnabled)("allConceptEntities",i.conceptEntities)}}let Zr=(()=>{class t{constructor(t,e,i,n,c,o,r){this.conceptService=t,this.campaignService=e,this.entityService=i,this.updateHub=n,this.login=c,this.router=o,this.route=r,this.loading=!1,this.searchLoading=!1,this.working=!1,this.draggingEnabled=!1,this.selectedConceptEntity=null}set entity(t){this._entity=t,this.load()}get entity(){return this._entity}ngOnInit(){this.searchControl=new a.e(null),this.editGroup=new a.h({quantity:new a.e(null),content:new a.e(null)}),this.searchControl.valueChanges.pipe(Object(bn.a)(),Object(bc.a)(250)).subscribe(t=>{this.searchConcepts(null!=t?t.trim().toLowerCase():"")}),this.route.paramMap.subscribe(t=>{const e=t.get("ct_id"),i=t.get("ent_id");e&&i&&this.loadInitial(i,e)}),this._updateSubscription=this.updateHub.conceptEntityUpdate.subscribe(t=>{if(this.conceptEntities&&this.entity&&this.conceptType&&t.concept.conceptTypeId===this.conceptType.id&&t.entityId===this.entity.id){const e=this.conceptEntities.findIndex(e=>e.conceptId===t.conceptId&&e.entityId===t.entityId);-1!==e?this.conceptEntities[e]=t:this.conceptEntities.push(t),this.conceptEntities=this.conceptEntities.slice().sort((t,e)=>t.sortValue-e.sortValue)}}),this._deleteSubscription=this.updateHub.conceptEntityDelete.subscribe(t=>{this.conceptEntities&&this.entity&&this.conceptType&&t.entityId===this.entity.id&&(this.conceptEntities=this.conceptEntities.filter(e=>!(e.conceptId===t.conceptId&&e.entityId===t.entityId)))})}ngOnDestroy(){this._updateSubscription&&this._updateSubscription.unsubscribe(),this._deleteSubscription&&this._deleteSubscription.unsubscribe()}loadInitial(t,e){return dr(this,void 0,void 0,function*(){this.loading=!0;try{const[i,n]=yield Promise.all([this.conceptService.getConceptType(e),this.entityService.getEntity(t)]);this.conceptType=i,this.entity=n,this.entity&&(yield this.updateHub.unsubscribeEntities([this.entity.id])),yield this.updateHub.subscribeEntities([this.entity.id])}catch(i){this.loadErr=i}this.loading=!1})}load(){return dr(this,void 0,void 0,function*(){this.loading=!0;try{this.conceptEntities=yield this.conceptService.getConceptEntities(this.entity.id,this.conceptType.id)}catch(t){throw t}this.loading=!1})}searchConcepts(t){return dr(this,void 0,void 0,function*(){this.searchLoading=!0;try{const e=yield this.conceptService.getConcepts(this.conceptType.id,10,0,t);this.searchResults=e.concepts,this.totalResults=e.total}catch(e){throw e}this.searchLoading=!1})}createConcept(){this.router.navigate(["campaigns",this.campaignService.campaign.id,"concepts",this.conceptType.id,"create"],{queryParams:{name:this.searchControl.value}})}add(){return dr(this,void 0,void 0,function*(){this.searchControl.patchValue(null),this.searchConcepts(""),setTimeout(()=>{this.searchInput.nativeElement.focus()},1);const t=yield this.pickerModal.open();if(null!==t){const i={conceptId:t.id,concept:t,entityId:this.entity.id,quantity:this.quantityEnabled?1:null,fields:[],sortValue:this.conceptEntities.length};void 0===this.conceptEntities.find(t=>t.conceptId===i.conceptId&&t.entityId===i.entityId)&&this.conceptEntities.push(i),this.working=!0;try{yield this.conceptService.updateConceptEntity(i)}catch(e){throw e}this.working=!1}})}select(t){return dr(this,void 0,void 0,function*(){this.selectedConceptEntity=t,this.editGroup.patchValue({quantity:t.quantity||1,content:t.content}),this.viewAndEditModal.open().then(()=>{this.selectedConceptEntity=null})})}save(){return dr(this,void 0,void 0,function*(){this.working=!0;try{const t=Object.assign(Object.assign({},this.selectedConceptEntity),{quantity:this.quantityControl.value,content:this.contentControl.value});for(const e of this.conceptEntities)e.conceptId===t.conceptId&&e.entityId===t.entityId&&Object.assign(e,t);this.viewAndEditModal.close(null),yield this.conceptService.updateConceptEntity(t)}catch(t){throw t}this.working=!1})}remove(t){return dr(this,void 0,void 0,function*(){this.working=!0;try{this.conceptEntities=this.conceptEntities.filter(e=>!(e.conceptId===t.conceptId&&e.entityId===t.entityId)),this.viewAndEditModal.close(null),yield this.conceptService.deleteConceptEntity(t.entityId,t.conceptId)}catch(e){throw e}this.working=!1})}trackConcept(t,e){return e.id}trackConceptEntity(t,e){return e.conceptId+e.entityId}conceptDropped(t){const e=this.topLevelConceptEntities;Object(o.f)(e,t.previousIndex,t.currentIndex),e.forEach((t,e)=>{t.sortValue=e})}selectChildToNest(t){return dr(this,void 0,void 0,function*(){this.nestSelectorParent=t;const e=yield this.nestSelector.open();if(null!==e){const n=this.conceptEntities.find(t=>t.conceptId===e.id);n.parentConceptId=t.conceptId,n.parentEntityId=t.entityId;try{yield this.conceptService.updateConceptEntity(n)}catch(i){throw i}}})}toggleReorder(){return dr(this,void 0,void 0,function*(){this.draggingEnabled=!this.draggingEnabled,!1===this.draggingEnabled&&(yield this.conceptService.updateConceptEntities(this.topLevelConceptEntities,this.entity.id))})}get quantityEnabled(){return this.conceptType.entityConfig.enabled&&this.conceptType.entityConfig.enableQuantity}get campaign(){return this.campaignService.campaign}get quantityControl(){return this.editGroup.get("quantity")}get contentControl(){return this.editGroup.get("content")}get conceptEntities(){return this._conceptEntities}set conceptEntities(t){this._conceptEntities=t}get topLevelConceptEntities(){if(this.conceptEntities)return this.conceptEntities.filter(t=>null==t.parentConceptId).sort((t,e)=>t.sortValue-e.sortValue)}get editable(){return!!this.entity&&(this.entity.userId===this.login.id||this.campaignService.canEdit)}get quantityFieldConfig(){return this.selectedConceptEntity&&this.entity?{name:"Quantity",description:`How many ${this.selectedConceptEntity.concept.name} does ${this.entity.name} have?`,type:K.a.INT,options:{min:0}}:{name:"Quantity",type:K.a.INT}}get notesFieldConfig(){return{name:"Notes",description:"All players will be able to see these notes",type:K.a.TEXT_FORMATTED}}get conceptTypeEditable(){return!!this.conceptType&&(this.conceptType.playerEditable||this.campaignService.canEdit)}get nestableConcepts(){return this.conceptEntities.filter(t=>t.conceptId!==this.nestSelectorParent.conceptId&&null==t.parentConceptId).map(t=>t.concept)}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(Xn.a),c.Lb(h.b),c.Lb(Y.b),c.Lb(W.b),c.Lb(y.a),c.Lb(p.c),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-concept-entity-manager"]],viewQuery:function(t,e){if(1&t&&(c.Ac(ur,1),c.Ac(br,3),c.Ac(pr,3),c.Ac(hr,1)),2&t){let t;c.lc(t=c.Yb())&&(e.pickerModal=t.first),c.lc(t=c.Yb())&&(e.viewAndEditModal=t.first),c.lc(t=c.Yb())&&(e.nestSelector=t.first),c.lc(t=c.Yb())&&(e.searchInput=t.first)}},inputs:{conceptType:"conceptType",entity:"entity"},decls:16,vars:11,consts:[[4,"ngIf"],["viewandedit",""],["modal-header","","class","mb-0",4,"ngIf"],["modal-body","",3,"formGroup",4,"ngIf"],["modal-body","",4,"ngIf"],["modal-footer","",4,"ngIf"],["nestselector",""],[1,"container","grid-xl"],["class","columns",4,"ngIf"],["class","loading loading-lg",4,"ngIf"],["class","empty p-2",4,"ngIf"],["cdkDropList","",3,"cdkDropListDropped"],["cdkDrag","",3,"cdkDragDisabled",4,"ngFor","ngForOf","ngForTrackBy"],["picker",""],["modal-header","",1,"mb-0"],["modal-body",""],[1,"has-icon-right"],["type","text",1,"form-input",3,"formControl","placeholder"],["searchbar",""],["class","icon icon-search form-icon",4,"ngIf"],["class","loading form-icon",4,"ngIf"],["class","card p-1 my-1 hoverable",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["class","card p-1 my-1 hoverable",3,"click",4,"ngIf"],["class","empty mt-2",4,"ngIf"],[1,"icon","icon-search","form-icon"],[1,"loading","form-icon"],[1,"card","p-1","my-1","hoverable",3,"click"],[3,"concept","imageSize"],[1,"icon","icon-plus"],[1,"empty","mt-2"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],["class","empty-subtitle",4,"ngIf"],["class","empty-action",4,"ngIf"],[1,"empty-subtitle"],[1,"empty-action"],[1,"btn","btn-primary",3,"click"],["modal-body","",3,"formGroup"],[3,"control","config",4,"ngIf"],[1,"my-2"],[3,"control","config"],["readOnly","true",3,"value"],["modal-footer",""],[1,"btn","btn-error","mr-1",3,"click"],[1,"btn","mr-1",3,"click"],[1,"columns"],[1,"column","col-auto"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-arrow-left"],[1,"column"],["class","column col-auto",4,"ngIf"],["class","btn btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-sm","ml-1",3,"click"],[1,"hide-xs"],[1,"btn","btn-sm",3,"click"],[1,"icon",3,"ngClass"],["class","hide-xs",4,"ngIf"],[1,"loading","loading-lg"],[1,"empty","p-2"],["cdkDrag","",3,"cdkDragDisabled"],["class","drag-placeholder",4,"cdkDragPlaceholder"],[3,"conceptEntity","conceptType","draggable","allConceptEntities","selected","addChild"],[1,"drag-placeholder"]],template:function(t,e){1&t&&(c.vc(0,Ir,14,9,"dd-modal",0),c.Qb(1,"dd-modal",null,1),c.vc(3,Cr,2,1,"h4",2),c.vc(4,Ar,4,4,"div",3),c.vc(5,xr,3,2,"div",4),c.vc(6,Tr,7,0,"div",5),c.Pb(),c.Qb(7,"dd-modal",null,6),c.vc(9,Lr,2,2,"div",4),c.Pb(),c.Qb(10,"div",7),c.vc(11,Fr,8,7,"div",8),c.vc(12,Ur,1,0,"div",9),c.vc(13,qr,3,1,"div",10),c.Qb(14,"div",11),c.Xb("cdkDropListDropped",function(t){return e.conceptDropped(t)}),c.vc(15,Dr,3,5,"div",12),c.Pb(),c.Pb()),2&t&&(c.ec("ngIf",e.conceptType),c.Ab(3),c.ec("ngIf",e.selectedConceptEntity),c.Ab(1),c.ec("ngIf",e.editable&&e.selectedConceptEntity),c.Ab(1),c.ec("ngIf",!e.editable&&e.selectedConceptEntity),c.Ab(1),c.ec("ngIf",e.editable),c.Ab(3),c.ec("ngIf",e.nestSelectorParent),c.Ab(2),c.ec("ngIf",e.conceptType&&e.entity),c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.conceptEntities&&0===e.conceptEntities.length),c.Ab(2),c.ec("ngForOf",e.topLevelConceptEntities)("ngForTrackBy",e.trackConceptEntity))},directives:[m.k,D.a,o.d,m.j,a.b,a.m,a.f,pc,a.n,a.i,Z.a,J.a,p.d,m.i,o.a,o.c,lr],styles:[""]}),t})();const $r=["modal"];let Xr=(()=>{class t{constructor(){}ngOnInit(){}close(){return t=this,void 0,i=function*(){return this.modal.close(!1)},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}confirm(){return this.modal.close(!0)}deny(){return this.modal.close(!1)}getConfirmation(t="Are you sure?",e="Confirm"){return this.title=e,this.question=t,this.modal.open()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-confirmation-modal"]],viewQuery:function(t,e){if(1&t&&c.Ac($r,3),2&t){let t;c.lc(t=c.Yb())&&(e.modal=t.first)}},decls:12,vars:2,consts:[["size","small"],["modal",""],["modal-header",""],[1,"modal-title","h5"],["modal-body",""],["modal-footer",""],[1,"btn","mr-2",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(t,e){1&t&&(c.Qb(0,"dd-modal",0,1),c.Qb(2,"div",2),c.Qb(3,"h5",3),c.wc(4),c.Pb(),c.Pb(),c.Qb(5,"div",4),c.wc(6),c.Pb(),c.Qb(7,"div",5),c.Qb(8,"button",6),c.Xb("click",function(){return e.confirm()}),c.wc(9,"Yes"),c.Pb(),c.Qb(10,"button",7),c.Xb("click",function(){return e.deny()}),c.wc(11,"No"),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(4),c.xc(e.title),c.Ab(2),c.xc(e.question))},directives:[D.a],styles:[""]}),t})();const Hr=[{name:"AC",description:"Armor Class",type:K.a.INT,class:Y.a.MAJOR,redacted:!1,options:{required:!0}},{name:"Init",description:"Initiative",type:K.a.INT,class:Y.a.MAJOR,redacted:!1,options:{required:!0}},{name:"Speed",description:"Speed",type:K.a.STRING,class:Y.a.MAJOR,redacted:!1,options:{required:!0}},{name:"Class",description:"Class",type:K.a.ENUM_MULTI,class:Y.a.NORMAL,redacted:!1,options:{required:!0,choices:["Barbarian","Bard","Cleric","Druid","Fighter","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"]}},{name:"Strength",description:"Strength",type:K.a.INT,class:Y.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Strength Mod",description:"Strength Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Strength"}},{name:"Dexterity",description:"Dexterity",type:K.a.INT,class:Y.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Dex Mod",description:"Dexterity Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Dexterity"}},{name:"Constitution",description:"Constitution",type:K.a.INT,class:Y.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Con Mod",description:"Constitution Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Constitution"}},{name:"Intelligence",description:"Intelligence",type:K.a.INT,class:Y.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Int Mod",description:"Intelligence Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Intelligence"}},{name:"Wisdom",description:"Wisdom",type:K.a.INT,class:Y.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Wis Mod",description:"Wisdom Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Wisdom"}},{name:"Charisma",description:"Charisma",type:K.a.INT,class:Y.a.NORMAL,redacted:!1,options:{required:!0}},{name:"Cha Mod",description:"Charisma Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!1,options:{required:!1,modifierFor:"Charisma"}},{name:"Acrobatics",description:"Acrobatics",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Animal Handling",description:"Animal Handling",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Arcana",description:"Arcana",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Athletics",description:"Athletics",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Deception",description:"Deception",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"History",description:"History",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Insight",description:"Insight",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Intimidation",description:"Intimidation",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Investigation",description:"Investigation",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Medicine",description:"Medicine",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Nature",description:"Nature",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Perception",description:"Perception",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Performance",description:"Performance",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Persuasion",description:"Persuasion",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Religion",description:"Religion",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Sleight of Hand",description:"Sleight of Hand",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Stealth",description:"Stealth",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Survival",description:"Survival",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Alignment",description:"Alignment",type:K.a.STRING,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Race",description:"Race",type:K.a.ENUM,class:Y.a.MINOR,redacted:!1,options:{required:!1,choices:["Dragonborn","Dwarf","Eladrin","Elf","Gnome","Half-elf","Half-orc","Halfling","Human","Tiefling"]}},{name:"Age",description:"Age",type:K.a.INT,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Height",description:"Height",type:K.a.STRING,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Weight",description:"Weight",type:K.a.STRING,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Eyes",description:"Eyes",type:K.a.STRING,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Skin",description:"Skin",type:K.a.STRING,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Hair",description:"Hair",type:K.a.STRING,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Allies & Orgs",description:"Allies & Organizations",type:K.a.TEXT_FORMATTED,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Features & Traits",description:"Features & Traits",type:K.a.TEXT_FORMATTED,class:Y.a.MINOR,redacted:!1,options:{required:!1}},{name:"Backstory",description:"Backstory",type:K.a.TEXT_FORMATTED,class:Y.a.MINOR,redacted:!1,options:{required:!1}}],jr=[{name:"AC",description:"Armor Class",type:K.a.INT,class:Y.a.MAJOR,redacted:!0,options:{required:!0}},{name:"Init",description:"Initiative",type:K.a.INT,class:Y.a.MAJOR,redacted:!0,options:{required:!0}},{name:"Speed",description:"Speed",type:K.a.STRING,class:Y.a.MAJOR,redacted:!0,options:{required:!0}},{name:"Class",description:"Class",type:K.a.ENUM_MULTI,class:Y.a.NORMAL,redacted:!0,options:{required:!0,choices:["Barbarian","Bard","Cleric","Druid","Fighter","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"]}},{name:"Strength",description:"Strength",type:K.a.INT,class:Y.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Strength Mod",description:"Strength Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Strength"}},{name:"Dexterity",description:"Dexterity",type:K.a.INT,class:Y.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Dex Mod",description:"Dexterity Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Dexterity"}},{name:"Constitution",description:"Constitution",type:K.a.INT,class:Y.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Con Mod",description:"Constitution Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Constitution"}},{name:"Intelligence",description:"Intelligence",type:K.a.INT,class:Y.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Int Mod",description:"Intelligence Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Intelligence"}},{name:"Wisdom",description:"Wisdom",type:K.a.INT,class:Y.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Wis Mod",description:"Wisdom Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Wisdom"}},{name:"Charisma",description:"Charisma",type:K.a.INT,class:Y.a.NORMAL,redacted:!0,options:{required:!0}},{name:"Cha Mod",description:"Charisma Modifier",type:K.a.STRING,class:Y.a.NORMAL,redacted:!0,options:{required:!1,modifierFor:"Charisma"}},{name:"Extra",description:"Any extra information",type:K.a.TEXT_FORMATTED,class:Y.a.NORMAL,redacted:!0,options:{required:!1}}];let Vr=(()=>{class t{constructor(){}getPresets(){return t=this,void 0,i=function*(){return[{name:"DnD 5e",description:"Attributes from the 5th edition of DnD",fields:Hr},{name:"D&D 5e Enemy",description:"Fields for a 5e monster",fields:jr}]},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var zr=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};const Br=["presets"],Yr=["confirmmodal"];function Wr(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",6),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb().usePreset(i)}),c.wc(1),c.Qb(2,"span",7),c.wc(3),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(1),c.yc(" ",t.name," "),c.Ab(2),c.xc(t.description)}}function Kr(t,e){1&t&&(c.Qb(0,"h3"),c.wc(1,"Create Entity Preset"),c.Pb())}function Jr(t,e){1&t&&(c.Qb(0,"h3"),c.wc(1,"Edit Entity Preset"),c.Pb())}const ta=function(t){return{loading:t}};function ea(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",47),c.Xb("click",function(){return c.oc(t),c.Zb(2).delete()}),c.wc(1," Delete "),c.Pb()}if(2&t){const t=c.Zb(2);c.ec("ngClass",c.ic(1,ta,t.deleting))}}function ia(t,e){1&t&&(c.Qb(0,"p",37),c.wc(1," A name is required "),c.Pb())}function na(t,e){1&t&&(c.Qb(0,"p",37),c.wc(1," Name should not have less than 3 characters "),c.Pb())}function ca(t,e){1&t&&(c.Qb(0,"p",37),c.wc(1," Name should not have more than 30 characters "),c.Pb())}function oa(t,e){1&t&&(c.Qb(0,"p",37),c.wc(1," A description is required "),c.Pb())}function ra(t,e){1&t&&(c.Qb(0,"p",37),c.wc(1," The description should not have less than 3 characters "),c.Pb())}function aa(t,e){if(1&t&&(c.Qb(0,"option",48),c.wc(1),c.Pb()),2&t){const t=e.$implicit;c.ec("value",t.id),c.Ab(1),c.xc(t.name)}}function sa(t,e){if(1&t&&(c.Qb(0,"div",54),c.Qb(1,"div",27),c.Qb(2,"label",59),c.wc(3,"Bar Color"),c.Pb(),c.Mb(4,"input",60),c.Pb(),c.Pb()),2&t){const t=c.Zb(3);c.ec("hidden","0"!==t.hpType.value&&0!==t.hpType.value)}}function la(t,e){if(1&t&&(c.Qb(0,"div",49),c.Qb(1,"div",10),c.Qb(2,"div",27),c.Qb(3,"label",50),c.wc(4,"Health Type"),c.Pb(),c.Qb(5,"select",51),c.Qb(6,"option",52),c.wc(7,"Normal"),c.Pb(),c.Qb(8,"option",53),c.wc(9,"Text Based"),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Qb(10,"div",54),c.Qb(11,"div",27),c.Qb(12,"label",55),c.wc(13,"HP Bar Type"),c.Pb(),c.Qb(14,"select",56),c.Qb(15,"option",52),c.wc(16,"Dynamic"),c.Pb(),c.Qb(17,"option",53),c.wc(18,"Static"),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.vc(19,sa,5,1,"div",57),c.Qb(20,"div",54),c.Qb(21,"div",27),c.Qb(22,"label",16),c.wc(23,"Visibility"),c.Pb(),c.Qb(24,"label",28),c.Mb(25,"input",58),c.Mb(26,"i",30),c.wc(27," Hide amount for players "),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(10),c.ec("hidden","0"!==t.hpType.value&&0!==t.hpType.value),c.Ab(9),c.ec("ngIf","1"===t.hpColorType.value||1===t.hpColorType.value),c.Ab(1),c.ec("hidden","0"!==t.hpType.value&&0!==t.hpType.value)}}function da(t,e){1&t&&c.Mb(0,"div",73)}function ua(t,e){if(1&t&&(c.Qb(0,"div",39),c.Qb(1,"div",27),c.Qb(2,"label",28),c.Mb(3,"input",74),c.Mb(4,"i",30),c.wc(5," Redacted "),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(3),c.ec("formControl",t.get("redacted"))}}function ba(t,e){if(1&t&&(c.Qb(0,"div",39),c.Qb(1,"select",75),c.Qb(2,"option",52),c.wc(3,"Major"),c.Pb(),c.Qb(4,"option",53),c.wc(5,"Normal"),c.Pb(),c.Qb(6,"option",76),c.wc(7,"Minor"),c.Pb(),c.Qb(8,"option",77),c.wc(9,"Unimportant"),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb().$implicit;c.Ab(1),c.ec("formControl",t.get("class"))}}function pa(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",61),c.vc(1,da,1,0,"div",62),c.Qb(2,"div",63),c.Qb(3,"div",64),c.Mb(4,"i",65),c.Pb(),c.Qb(5,"div",66),c.Qb(6,"h6",67),c.wc(7),c.Pb(),c.Pb(),c.vc(8,ua,6,1,"div",68),c.vc(9,ba,10,1,"div",68),c.Qb(10,"div",39),c.Qb(11,"button",69),c.Xb("click",function(){c.oc(t);const i=e.index;return c.Zb(2).removeField(i)}),c.Mb(12,"i",70),c.Qb(13,"span",71),c.wc(14," Remove"),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Mb(15,"dd-field-definition-form",72),c.Pb()}if(2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(7),c.xc(t.value.name),c.Ab(1),c.ec("ngIf",t.get("redacted")),c.Ab(1),c.ec("ngIf",t.get("class")),c.Ab(6),c.ec("formGroup",t)("otherFields",i.otherFieldNames)}}const ha=function(t){return{"has-error":t}};function ma(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",8),c.Qb(1,"div",9),c.Qb(2,"div",10),c.vc(3,Kr,2,0,"h3",11),c.vc(4,Jr,2,0,"h3",11),c.Pb(),c.Qb(5,"div",12),c.vc(6,ea,2,3,"button",13),c.Qb(7,"button",14),c.Xb("click",function(){return c.oc(t),c.Zb().save()}),c.wc(8," Save "),c.Pb(),c.Pb(),c.Pb(),c.Qb(9,"div",9),c.Qb(10,"div",15),c.Qb(11,"label",16),c.wc(12,"Icon"),c.Pb(),c.Mb(13,"dd-image-upload",17),c.Pb(),c.Qb(14,"div",18),c.Qb(15,"div",19),c.Qb(16,"label",20),c.wc(17,"Name"),c.Pb(),c.Mb(18,"input",21),c.vc(19,ia,2,0,"p",22),c.vc(20,na,2,0,"p",22),c.vc(21,ca,2,0,"p",22),c.Pb(),c.Qb(22,"div",19),c.Qb(23,"label",23),c.wc(24,"Description"),c.Pb(),c.Mb(25,"textarea",24),c.vc(26,oa,2,0,"p",22),c.vc(27,ra,2,0,"p",22),c.Pb(),c.Pb(),c.Qb(28,"div",25),c.Qb(29,"h5",26),c.wc(30,"Misc"),c.Pb(),c.Qb(31,"div",9),c.Qb(32,"div",10),c.Qb(33,"div",27),c.Qb(34,"label",28),c.Mb(35,"input",29),c.Mb(36,"i",30),c.wc(37," Players can create this type of entity "),c.Pb(),c.Pb(),c.Qb(38,"div",27),c.Qb(39,"label",28),c.Mb(40,"input",31),c.Mb(41,"i",30),c.wc(42," This entity can have gold "),c.Pb(),c.Pb(),c.Qb(43,"div",27),c.Qb(44,"label",28),c.Mb(45,"input",32),c.Mb(46,"i",30),c.wc(47," This entity can have XP "),c.Pb(),c.Pb(),c.Qb(48,"div",27),c.Qb(49,"label",28),c.Mb(50,"input",33),c.Mb(51,"i",30),c.wc(52," This entity can have health "),c.Pb(),c.Pb(),c.Qb(53,"div",27),c.Qb(54,"label",34),c.wc(55,"Concept Types"),c.Pb(),c.Qb(56,"select",35),c.vc(57,aa,2,2,"option",36),c.Pb(),c.Qb(58,"div",37),c.wc(59,"The entity will have these concept types enabled"),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.vc(60,la,28,3,"div",38),c.Pb(),c.Pb(),c.Qb(61,"div"),c.Qb(62,"div",9),c.Qb(63,"div",10),c.Qb(64,"h3",26),c.wc(65,"Fields"),c.Pb(),c.Pb(),c.Qb(66,"div",39),c.Qb(67,"button",40),c.Xb("click",function(){return c.oc(t),c.Zb(),c.mc(3).open()}),c.wc(68," Use Preset "),c.Pb(),c.Qb(69,"button",41),c.Xb("click",function(){return c.oc(t),c.Zb().addField()}),c.Mb(70,"i",42),c.wc(71," Add Field"),c.Pb(),c.Pb(),c.Pb(),c.Qb(72,"div",43),c.Xb("cdkDropListDropped",function(e){return c.oc(t),c.Zb().drop(e)}),c.vc(73,pa,16,5,"div",44),c.Pb(),c.Pb(),c.Qb(74,"div",45),c.Qb(75,"button",46),c.Xb("click",function(){return c.oc(t),c.Zb().backToTop()}),c.wc(76,"Back to Top"),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.ec("formGroup",t.formGroup),c.Ab(3),c.ec("ngIf",!t.editing),c.Ab(1),c.ec("ngIf",t.editing),c.Ab(2),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngClass",c.ic(16,ta,t.saving))("disabled",t.formGroup.invalid),c.Ab(8),c.ec("ngClass",c.ic(18,ha,t.name.invalid&&(t.name.dirty||t.name.touched))),c.Ab(4),c.ec("ngIf",t.name.invalid&&t.name.dirty&&t.name.errors.required),c.Ab(1),c.ec("ngIf",t.name.invalid&&t.name.dirty&&t.name.errors.minlength),c.Ab(1),c.ec("ngIf",t.name.invalid&&t.name.dirty&&t.name.errors.maxlength),c.Ab(1),c.ec("ngClass",c.ic(20,ha,t.description.invalid&&(t.description.dirty||t.description.touched))),c.Ab(4),c.ec("ngIf",t.description.invalid&&t.description.dirty&&t.description.errors.required),c.Ab(1),c.ec("ngIf",t.description.invalid&&t.description.dirty&&t.description.errors.minlength),c.Ab(30),c.ec("ngForOf",t.conceptTypeList),c.Ab(3),c.ec("ngIf",!0===t.isHealthEnabled.value),c.Ab(13),c.ec("ngForOf",t.fields.controls)}}let ga=(()=>{class t{constructor(t,e,i,n,c,o){this.entityService=t,this.campaignService=e,this.presets=i,this.login=n,this.router=c,this.route=o,this.saving=!1,this.deleting=!1,this.loading=!1}ngOnInit(){this.formGroup=new a.h({id:new a.e,name:new a.e(null,[a.v.required,a.v.minLength(3),a.v.maxLength(30)]),description:new a.e(null,[a.v.required,a.v.minLength(3)]),health:new a.h({type:new a.e("0"),colorType:new a.e("0"),staticColor:new a.e(null),amountHidden:new a.e(!1)}),playerCreatable:new a.e(!1),spawnable:new a.e(!1),isCurrencyEnabled:new a.e(!1),isXPEnabled:new a.e(!1),isHealthEnabled:new a.e(!1),conceptTypesEnabled:new a.e([]),imageId:new a.e(null,a.v.required),attributes:new a.c([]),fields:new a.c([])}),this.route.params.subscribe(t=>{t.ent_id&&this.loadEntityPreset(t.ent_id)}),this.presets.getPresets().then(t=>this.presetList=t)}canDeactivate(){return!this.formGroup.dirty}loadEntityPreset(t){return zr(this,void 0,void 0,function*(){this.loading=!0,this.formGroup.disable();try{const e=yield this.entityService.getEntityPreset(t);this.entityPreset=e,setTimeout(()=>{(e.fields||[]).forEach(t=>{const e=cc.createFormGroup(t);e.addControl("class",new a.e(0)),e.addControl("redacted",new a.e(!1)),this.fields.push(e)}),this.formGroup.patchValue(Object.assign(Object.assign({},e),{fields:e.fields||[]}),{emitEvent:!1})},1)}catch(e){throw e}this.loading=!1,this.formGroup.enable()})}constructEntityPreset(){const t=this.formGroup.value;t.health||(t.health={});const e={userId:this.login.id,campaignId:this.campaignService.campaign.id,name:t.name,description:t.description,health:{type:t.health.type,colorType:t.health.colorType,staticColor:t.health.staticColor,amountHidden:t.health.amountHidden},fields:t.fields,imageId:t.imageId,isCurrencyEnabled:t.isCurrencyEnabled,isXPEnabled:t.isXPEnabled,isHealthEnabled:t.isHealthEnabled,conceptTypesEnabled:t.conceptTypesEnabled,playerCreatable:t.playerCreatable};return this.editing&&(e.id=this.entityPreset.id,e.userId=this.entityPreset.userId,e.campaignId=this.entityPreset.campaignId),e}usePreset(t){this.fields.reset(),setTimeout(()=>{t.fields.forEach(t=>{const e=cc.createFormGroup(t);e.addControl("class",new a.e(t.class)),e.addControl("redacted",new a.e(t.redacted)),this.fields.push(e)}),this.presetsModal.close()},1)}removeAttribute(t){this.formGroup.get("attributes").removeAt(t)}save(){return zr(this,void 0,void 0,function*(){if(this.formGroup.invalid)return;const t=this.constructEntityPreset();this.formGroup.disable(),this.saving=!0;try{this.editing?yield this.entityService.updateEntityPreset(t):yield this.entityService.createEntityPreset(t),yield this.router.navigate(["campaigns",this.campaignService.campaign.id,"settings"],{queryParams:{refresh:!0}})}catch(e){throw e}this.formGroup.enable(),this.formGroup.markAsPristine(),this.saving=!1})}delete(){return zr(this,void 0,void 0,function*(){if(yield this.confirmModal.getConfirmation("Are you sure you want to delete this entity? This cannot be undone")){this.deleting=!0,this.formGroup.disable();try{yield this.entityService.deleteEntityPreset(this.campaignService.campaign.id,"1"),yield this.router.navigate(["campaigns",this.campaignService.campaign.id,"settings"])}catch(t){throw t}this.formGroup.enable(),this.deleting=!1}})}addField(){const t=cc.createFormGroup(null);t.addControl("class",new a.e(0)),t.addControl("redacted",new a.e(!1)),this.fields.push(t)}backToTop(){document.getElementById("app-content").scrollTo(0,0)}removeField(t){this.fields.removeAt(t),this.formGroup.markAsDirty()}drop(t){const e=this.fields.at(t.previousIndex);this.fields.removeAt(t.previousIndex),this.fields.insert(t.currentIndex,e)}get attributeControls(){return this.formGroup.get("attributes").controls}get name(){return this.formGroup.get("name")}get description(){return this.formGroup.get("description")}get isHealthEnabled(){return this.formGroup.get("isHealthEnabled")}get hpColorType(){return this.formGroup.get("health.colorType")}get hpType(){return this.formGroup.get("health.type")}get conceptTypeList(){return this.campaignService.campaign.conceptTypes.filter(t=>!0===t.entityConfig.enabled)}get fields(){return this.formGroup.get("fields")}get otherFieldNames(){return this.fields.value.map(t=>t.name)}get editing(){return this.route.snapshot.data.editing}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(Y.b),c.Lb(h.b),c.Lb(Vr),c.Lb(y.a),c.Lb(p.c),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-entity-preset-editor"]],viewQuery:function(t,e){if(1&t&&(c.Ac(Br,3),c.Ac(Yr,3)),2&t){let t;c.lc(t=c.Yb())&&(e.presetsModal=t.first),c.lc(t=c.Yb())&&(e.confirmModal=t.first)}},decls:10,vars:2,consts:[["confirmmodal",""],["presets",""],["modal-header",""],["modal-body",""],["class","card p-1 mb-1 hoverable",3,"click",4,"ngFor","ngForOf"],["class","container grid-xl",3,"formGroup",4,"ngIf"],[1,"card","p-1","mb-1","hoverable",3,"click"],[1,"text-gray"],[1,"container","grid-xl",3,"formGroup"],[1,"columns"],[1,"column"],[4,"ngIf"],[1,"column","col-auto","col-ml-auto"],["class","btn btn-error mr-2",3,"ngClass","click",4,"ngIf"],[1,"btn",3,"ngClass","disabled","click"],[1,"column","col-3","col-md-5","col-sm-12","col-mx-auto"],[1,"form-label"],["formControlName","imageId"],[1,"column","col-9","col-md-12"],[1,"form-group",3,"ngClass"],["for","name",1,"form-label"],["type","text","name","name","id","name","formControlName","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],["for","description",1,"form-label"],["name","description","id","description","rows","4","formControlName","description","placeholder","Description",1,"form-input"],[1,"column","col-12"],[1,"mt-2"],[1,"form-group"],[1,"form-checkbox"],["type","checkbox","formControlName","playerCreatable"],[1,"form-icon"],["type","checkbox","formControlName","isCurrencyEnabled"],["type","checkbox","formControlName","isXPEnabled"],["type","checkbox","formControlName","isHealthEnabled"],["for","conceptTypesEnabled",1,"form-label"],["name","conceptTypesEnabled","id","conceptTypesEnabled","formControlName","conceptTypesEnabled","multiple","",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"form-input-hint"],["formGroupName","health","class","columns mb-2",4,"ngIf"],[1,"column","col-auto"],[1,"btn","btn-sm","mr-2",3,"click"],[1,"btn","btn-sm",3,"click"],[1,"icon","icon-plus"],["cdkDropList","",3,"cdkDropListDropped"],["class","mt-2","cdkDrag","",4,"ngFor","ngForOf"],[1,"text-center"],[1,"btn","btn-link",3,"click"],[1,"btn","btn-error","mr-2",3,"ngClass","click"],[3,"value"],["formGroupName","health",1,"columns","mb-2"],["for","health-type",1,"form-label"],["name","health-type","id","health-type","formControlName","type",1,"form-input"],["value","0"],["value","1"],[1,"column",3,"hidden"],["for","bar-type",1,"form-label"],["formControlName","colorType","name","bar-type","id","bar-type",1,"form-input"],["class","column",3,"hidden",4,"ngIf"],["type","checkbox","formControlName","amountHidden"],["for","bar-color",1,"form-label"],["formControlName","staticColor","type","color","name","bar-color","id","bar-color",1,"form-input"],["cdkDrag","",1,"mt-2"],["class","drag-placeholder",4,"cdkDragPlaceholder"],[1,"columns","mb-1"],["cdkDragHandle","",1,"column","col-auto","c-move"],[1,"icon","icon-resize-vert"],[1,"column","d-flex","align-items-center"],[1,"mb-0"],["class","column col-auto",4,"ngIf"],[1,"btn","btn-sm","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"hide-sm"],[3,"formGroup","otherFields"],[1,"drag-placeholder"],["type","checkbox",3,"formControl"],[1,"form-input","input-sm",3,"formControl"],["value","2"],["value","3"]],template:function(t,e){1&t&&(c.Mb(0,"dd-confirmation-modal",null,0),c.Qb(2,"dd-modal",null,1),c.Qb(4,"div",2),c.Qb(5,"h4"),c.wc(6,"Attribute Presets"),c.Pb(),c.Pb(),c.Qb(7,"div",3),c.vc(8,Wr,4,2,"div",4),c.Pb(),c.Pb(),c.vc(9,ma,77,22,"div",5)),2&t&&(c.Ab(8),c.ec("ngForOf",e.presetList),c.Ab(1),c.ec("ngIf",e.entityPreset||!e.editing))},directives:[Xr,D.a,m.j,m.k,a.n,a.i,m.i,le,a.m,a.g,a.b,a.a,a.u,o.d,a.p,a.w,a.j,a.t,o.a,o.c,o.b,cc,a.f],styles:[""]}),t})();var fa=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function va(t,e){1&t&&c.Mb(0,"div",4)}function ya(t,e){if(1&t){const t=c.Rb();c.Qb(0,"button",11),c.Xb("click",function(){return c.oc(t),c.Zb(2).delete()}),c.wc(1," Delete "),c.Pb()}}const Pa=function(t){return{loading:t}};function wa(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",5),c.Qb(1,"div",6),c.Qb(2,"h3"),c.wc(3),c.Pb(),c.Pb(),c.Qb(4,"div",7),c.Qb(5,"button",8),c.Xb("click",function(){return c.oc(t),c.Zb().cancel()}),c.wc(6,"Cancel"),c.Pb(),c.vc(7,ya,2,0,"button",9),c.Qb(8,"button",10),c.Xb("click",function(){return c.oc(t),c.Zb().save()}),c.wc(9," Save "),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(3),c.zc("",t.editing?"Edit":"Create"," ",t.preset.name,""),c.Ab(4),c.ec("ngIf",t.editing),c.Ab(1),c.ec("ngClass",c.ic(5,Pa,t.saving))("disabled",t.formGroup.invalid)}}function Ia(t,e){1&t&&(c.Qb(0,"p",34),c.wc(1," An XP value is required "),c.Pb())}function Ca(t,e){1&t&&(c.Qb(0,"p",34),c.wc(1," Can't have negative XP :/ "),c.Pb())}const Qa=function(t,e){return{"has-error":t,"has-success":e}};function Aa(t,e){if(1&t&&(c.Qb(0,"div",17),c.Qb(1,"label",32),c.wc(2,"XP "),c.Qb(3,"span",19),c.wc(4,"*"),c.Pb(),c.Pb(),c.Mb(5,"input",33),c.vc(6,Ia,2,0,"p",21),c.vc(7,Ca,2,0,"p",21),c.Pb()),2&t){const t=c.Zb(2);c.ec("ngClass",c.jc(3,Qa,t.xp.invalid&&(t.xp.touched||t.xp.dirty),t.xp.valid&&(t.xp.touched||t.xp.dirty))),c.Ab(6),c.ec("ngIf",t.xp.invalid&&(t.xp.touched||t.xp.dirty)&&t.xp.errors.required),c.Ab(1),c.ec("ngIf",t.xp.invalid&&(t.xp.touched||t.xp.dirty)&&t.xp.errors.min)}}function ka(t,e){1&t&&(c.Qb(0,"p",34),c.wc(1," A name is required "),c.Pb())}function xa(t,e){1&t&&(c.Qb(0,"p",34),c.wc(1," The name can't be shorter than 2 characters "),c.Pb())}function Ta(t,e){1&t&&(c.Qb(0,"p",34),c.wc(1," The name can't be longer than 20 characters "),c.Pb())}function Ea(t,e){if(1&t&&(c.Qb(0,"div",22),c.Qb(1,"label",35),c.Mb(2,"input",36),c.Mb(3,"i",37),c.wc(4),c.Pb(),c.Qb(5,"p",34),c.wc(6),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(4),c.yc(" This ",t.preset.name," is spawnable "),c.Ab(2),c.yc("Turns this ",t.preset.name," into a preset that can be quickly spawned into game sessions.")}}function La(t,e){if(1&t&&c.Mb(0,"dd-dynamic-field",38),2&t){const t=c.Zb(2);c.ec("config",t.currencyConfig)("control",t.currency)}}function Ma(t,e){1&t&&(c.Qb(0,"p",47),c.wc(1," A value is required for current health "),c.Pb())}function Sa(t,e){1&t&&(c.Qb(0,"p",47),c.wc(1," A value is required for max health "),c.Pb())}function Oa(t,e){if(1&t&&(c.Qb(0,"div",39),c.Qb(1,"label",40),c.wc(2,"Health "),c.Qb(3,"span",41),c.wc(4,"*"),c.Pb(),c.Pb(),c.Qb(5,"div",42),c.Mb(6,"input",43),c.Qb(7,"span",44),c.wc(8,"/"),c.Pb(),c.Mb(9,"input",45),c.Pb(),c.vc(10,Ma,2,0,"p",46),c.vc(11,Sa,2,0,"p",46),c.Pb()),2&t){const t=c.Zb(2);c.ec("ngClass",c.jc(3,Qa,t.health.invalid&&(t.health.dirty||t.health.touched),t.health.valid&&(t.health.dirty||t.health.touched))),c.Ab(10),c.ec("ngIf",t.hpCurrent.invalid&&(t.hpMax.dirty||t.hpMax.touched||t.hpCurrent.dirty||t.hpCurrent.touched)&&t.hpCurrent.errors.required),c.Ab(1),c.ec("ngIf",t.hpMax.invalid&&(t.hpMax.dirty||t.hpMax.touched||t.hpCurrent.dirty||t.hpCurrent.touched)&&t.hpMax.errors.required)}}function Na(t,e){if(1&t&&(c.Qb(0,"div",54),c.Qb(1,"p",55),c.wc(2),c.Pb(),c.Pb()),2&t){const t=c.Zb(3);c.Ab(2),c.yc("This ",t.preset.name," has no health text yet, (players will see nothing)")}}function _a(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",12),c.Qb(1,"div",5),c.Qb(2,"div",56),c.Qb(3,"div",42),c.Mb(4,"input",57),c.Qb(5,"div",44),c.wc(6," % "),c.Pb(),c.Pb(),c.Pb(),c.Qb(7,"div",6),c.Mb(8,"input",58),c.Pb(),c.Qb(9,"div",49),c.Qb(10,"button",59),c.Xb("click",function(){c.oc(t);const i=e.index;return c.Zb(3).removeHealthText(i)}),c.Mb(11,"i",60),c.Pb(),c.Pb(),c.Pb(),c.Pb()}2&t&&c.ec("formGroup",e.$implicit)}function Ra(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",48),c.Qb(1,"div",5),c.Qb(2,"div",6),c.Qb(3,"label",40),c.wc(4,"Health Text"),c.Pb(),c.Pb(),c.Qb(5,"div",49),c.Qb(6,"button",50),c.Xb("click",function(){return c.oc(t),c.Zb(2).addHealthText()}),c.Mb(7,"div",51),c.Pb(),c.Pb(),c.Pb(),c.vc(8,Na,3,1,"div",52),c.vc(9,_a,12,1,"div",53),c.Pb()}if(2&t){const t=c.Zb(2);c.Ab(8),c.ec("ngIf",0===t.hpTextLevels.length),c.Ab(1),c.ec("ngForOf",t.hpTextLevels.controls)}}function Fa(t,e){1&t&&(c.Qb(0,"h3",61),c.wc(1,"Custom Attributes"),c.Pb())}function Ua(t,e){if(1&t&&c.Mb(0,"dd-dynamic-field-horizontal",62),2&t){const t=e.$implicit,i=e.index,n=c.Zb(2);c.ec("config",n.getFieldConfig(t))("control",n.fields.controls[i])}}function qa(t,e){if(1&t&&(c.Qb(0,"div",12),c.Qb(1,"div",5),c.Qb(2,"div",13),c.Mb(3,"dd-image-upload",14),c.vc(4,Aa,8,6,"div",15),c.Pb(),c.Qb(5,"div",16),c.Qb(6,"div",17),c.Qb(7,"label",18),c.wc(8,"Name "),c.Qb(9,"span",19),c.wc(10,"*"),c.Pb(),c.Pb(),c.Mb(11,"input",20),c.vc(12,ka,2,0,"p",21),c.vc(13,xa,2,0,"p",21),c.vc(14,Ta,2,0,"p",21),c.Pb(),c.Qb(15,"div",22),c.Qb(16,"label",23),c.wc(17,"Description"),c.Pb(),c.Mb(18,"dd-quill",24),c.Pb(),c.vc(19,Ea,7,2,"div",25),c.vc(20,La,1,2,"dd-dynamic-field",26),c.vc(21,Oa,12,6,"div",27),c.vc(22,Ra,10,2,"div",28),c.Pb(),c.Pb(),c.vc(23,Fa,2,0,"h3",29),c.Qb(24,"div",30),c.vc(25,Ua,1,2,"dd-dynamic-field-horizontal",31),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.ec("formGroup",t.formGroup),c.Ab(4),c.ec("ngIf",t.preset.isXPEnabled),c.Ab(2),c.ec("ngClass",c.jc(13,Qa,t.name.invalid&&(t.name.touched||t.name.dirty),t.name.valid&&(t.name.touched||t.name.dirty))),c.Ab(6),c.ec("ngIf",t.name.invalid&&(t.name.touched||t.name.dirty)&&t.name.errors.required),c.Ab(1),c.ec("ngIf",t.name.invalid&&(t.name.touched||t.name.dirty)&&t.name.errors.minlength),c.Ab(1),c.ec("ngIf",t.name.invalid&&(t.name.touched||t.name.dirty)&&t.name.errors.maxlength),c.Ab(5),c.ec("ngIf",t.campaignEditable),c.Ab(1),c.ec("ngIf",t.preset.isCurrencyEnabled),c.Ab(1),c.ec("ngIf",t.preset.isHealthEnabled),c.Ab(1),c.ec("ngIf",t.preset.isHealthEnabled&&1===t.preset.health.type),c.Ab(1),c.ec("ngIf",t.preset.fields&&t.preset.fields.length>0),c.Ab(2),c.ec("ngForOf",t.preset.fields)("ngForTrackBy",t.trackField)}}let Ga=(()=>{class t{constructor(t,e,i,n,c,o){this.route=t,this.router=e,this.entityService=i,this.campaignService=n,this.login=c,this.location=o,this.loading=!1,this.saving=!1}ngOnInit(){this._entTypeId=this.route.snapshot.paramMap.get("ent_type_id"),this.formGroup=new a.h({name:new a.e(null,[a.v.required,a.v.minLength(2),a.v.maxLength(20)]),content:new a.e(null),spawnable:new a.e(!1),xp:new a.e(0,[a.v.min(0)]),currency:new a.e(null,[a.v.min(0)]),health:new a.h({max:new a.e(null,[a.v.min(1)]),current:new a.e(null,[a.v.min(0)]),textDamageLevels:new a.c([])}),fields:new a.c([]),imageId:new a.e("uncertainty"),imageColor1:new a.e("#fff"),imageColor2:new a.e("#000")}),this.route.paramMap.subscribe(t=>{const e=t.get("ent_id");this._entTypeId=t.get("ent_type_id"),this.editing&&this.loadEntity(e),this.fields.reset(),(this.preset.fields||[]).forEach(()=>{this.fields.push(new a.e(null))})}),this.editing||(this.setFormValidators(),"true"===this.route.snapshot.queryParamMap.get("spawnable")&&this.formGroup.patchValue({spawnable:!0}))}canDeactivate(){return this.formGroup.pristine}setFormValidators(){this.preset.isXPEnabled&&this.formGroup.get("xp").setValidators([a.v.min(0),a.v.required]),this.preset.isHealthEnabled&&(this.formGroup.get("health.max").setValidators([a.v.min(1),a.v.required]),this.formGroup.get("health.current").setValidators([a.v.min(0),a.v.required]))}constructEntity(){const t=this.formGroup.value;let e=null;this.preset.isHealthEnabled&&this.preset.health.type===Y.d.TEXT_BASED&&(e={},this.hpTextLevels.controls.forEach(t=>{e[t.value.percent]=t.value.text}));const i={id:this.entity?this.entity.id:"",name:t.name,content:t.content,xp:t.xp,imageId:t.imageId,imageColor1:t.imageColor1,imageColor2:t.imageColor2,currency:t.currency,spawnable:t.spawnable,fields:this.fields.value.map((t,e)=>({name:this.preset.fields[e].name,value:t})).filter(t=>null!=t.value&&""!==t.value),health:{max:t.health.max,current:t.health.current,textDamageLevels:e},userId:this.editing?this.entity.userId:this.login.id,campaignId:this.campaignService.campaign.id,entityPresetId:this.preset.id,mapId:this.entity?this.entity.mapId:void 0,lat:this.entity?this.entity.lat:void 0,lng:this.entity?this.entity.lng:void 0,spawnedFromId:this.entity?this.entity.spawnedFromId:void 0};return this.preset.isHealthEnabled||(i.health=null),i}loadEntity(t){return fa(this,void 0,void 0,function*(){this.loading=!0,this.entity=null,this.formGroup.disable();try{const e=yield this.entityService.getEntity(t);this.entity=e,this.setFormValidators(),this.entity.health&&this.entity.health.textDamageLevels&&Object.keys(this.entity.health.textDamageLevels).forEach(()=>{this.addHealthText()}),setTimeout(()=>{const t=Object.assign({},e);if(t.fields=(this.preset.fields||[]).map(t=>{const e=(this.entity.fields||[]).find(e=>e.name===t.name);return e?e.value:null}),t.health&&t.health.textDamageLevels){const e=Object.keys(t.health.textDamageLevels).map(e=>({percent:e,text:t.health.textDamageLevels[e]}));t.health.textDamageLevels=e}else t.health&&(t.health.textDamageLevels=[]);null===e.health&&(e.health={max:1,current:0}),this.formGroup.patchValue(t)},1)}catch(e){throw e}this.formGroup.enable(),this.loading=!1})}save(){return fa(this,void 0,void 0,function*(){const t=this.constructEntity();if(this.saving=!0,this.formGroup.disable(),this.editing)try{yield this.entityService.updateEntity(t),this.formGroup.markAsPristine(),this.cancel()}catch(e){throw e}else try{const e=yield this.entityService.createEntity(t);this.formGroup.markAsPristine(),this.router.navigate(["campaigns",this.campaignService.campaign.id,"entities",e.id])}catch(e){throw e}this.formGroup.enable(),this.saving=!1})}delete(){return fa(this,void 0,void 0,function*(){const{value:t}=yield Kt.a.fire({title:"Are you sure?",text:"This cannot be undone!",type:"question",showCancelButton:!0,showConfirmButton:!0});if(!0===t)try{yield this.entityService.deleteEntity(this.entity.id),this.router.navigate(["campaigns",this.campaignService.campaign.id,"overview"])}catch(e){throw e}})}addHealthText(){this.hpTextLevels.push(new a.h({percent:new a.e(null,[a.v.required,a.v.min(0),a.v.max(100)]),text:new a.e(null,[a.v.required,a.v.maxLength(150)])}))}removeHealthText(t){this.hpTextLevels.removeAt(t)}trackField(t){return t}getFieldConfig(t){return t.type===K.a.CURRENCY&&(t.options={levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}),t}cancel(){this.location.back()}get preset(){return this.campaignService.campaign.entityPresets.find(t=>t.id===(this._entTypeId||this.route.snapshot.paramMap.get("ent_type_id")))}get name(){return this.formGroup.get("name")}get content(){return this.formGroup.get("content")}get xp(){return this.formGroup.get("xp")}get currency(){return this.formGroup.get("currency")}get health(){return this.formGroup.get("health")}get hpMax(){return this.formGroup.get("health.max")}get hpCurrent(){return this.formGroup.get("health.current")}get hpTextLevels(){return this.formGroup.get("health.textDamageLevels")}get campaignEditable(){return this.campaignService.canEdit}get editing(){return this.route.snapshot.data.editing}get currencyConfig(){return{name:"Money",type:K.a.CURRENCY,options:{levels:this.campaignService.campaign.currencyMap,trackCoins:this.campaignService.campaign.trackCoins}}}get fields(){return this.formGroup.get("fields")}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(p.c),c.Lb(Y.b),c.Lb(h.b),c.Lb(y.a),c.Lb(m.g))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-entity-editor"]],decls:4,vars:3,consts:[[1,"container","grid-xl"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column"],[1,"column","col-auto","col-ml-auto"],[1,"btn","mr-2",3,"click"],["class","btn btn-error mr-2",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"ngClass","disabled","click"],[1,"btn","btn-error","mr-2",3,"click"],[3,"formGroup"],[1,"column","col-3","col-md-12"],["formControlName","imageId"],["class","form-group",3,"ngClass",4,"ngIf"],[1,"column","col-9","col-md-12"],[1,"form-group",3,"ngClass"],["for","name",1,"form-lable"],[1,"text-large","text-bold","text-primary"],["type","text","name","name","id","name","formControlName","name","placeholder","Name",1,"form-input"],["class","form-input-hint",4,"ngIf"],[1,"form-group"],["for","description",1,"form-label"],["simple","true","formControlName","content","placeholder","Description"],["class","form-group",4,"ngIf"],[3,"config","control",4,"ngIf"],["class","form-group","formGroupName","health",3,"ngClass",4,"ngIf"],["class","form-group","formGroupName","health",4,"ngIf"],["class","mt-2",4,"ngIf"],[1,"form-horizontal"],["class","col-12 mb-2",3,"config","control",4,"ngFor","ngForOf","ngForTrackBy"],["for","xp",1,"form-label"],["type","number","name","xp","id","xp","placeholder","XP","formControlName","xp",1,"form-input"],[1,"form-input-hint"],[1,"form-checkbox"],["type","checkbox","formControlName","spawnable"],[1,"form-icon"],[3,"config","control"],["formGroupName","health",1,"form-group",3,"ngClass"],[1,"form-label"],[1,"text-primary","text-large","text-bold"],[1,"input-group"],["type","number","name","current-hp","formControlName","current","id","current-hp","placeholder","Current HP",1,"form-input"],[1,"input-group-addon"],["type","number","name","current-hp","formControlName","max","placeholder","Max HP","id","current-hp",1,"form-input"],["class","form-input-hint mb-0",4,"ngIf"],[1,"form-input-hint","mb-0"],["formGroupName","health",1,"form-group"],[1,"column","col-auto"],[1,"button","btn","btn-sm",3,"click"],[1,"i","icon","icon-plus"],["class","empty p-2",4,"ngIf"],[3,"formGroup",4,"ngFor","ngForOf"],[1,"empty","p-2"],[1,"empty-subtitle"],[1,"column","col-2","form-group"],["type","number","min","0","max","100","placeholder","80","formControlName","percent",1,"form-input"],["type","text","placeholder","Looking a little bit sad","formControlName","text",1,"form-input"],[1,"btn","btn-error",3,"click"],[1,"icon","icon-cross"],[1,"mt-2"],[1,"col-12","mb-2",3,"config","control"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,va,1,0,"div",1),c.vc(2,wa,10,7,"div",2),c.vc(3,qa,26,16,"div",3),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.entity||!e.editing),c.Ab(1),c.ec("ngIf",e.entity||!e.editing))},directives:[m.k,m.i,a.n,a.i,le,a.m,a.g,a.b,J.a,m.j,a.q,a.a,Z.a,a.j,Rc],styles:[""]}),t})(),Da=(()=>{class t{constructor(t,e){this.login=t,this.router=e}canActivate(t,e){return i=this,void 0,c=function*(){return!(yield this.login.isLoggedIn)||(this.router.navigate(["home"]),!1)},new((n=void 0)||(n=Promise))(function(t,e){function o(t){try{a(c.next(t))}catch(i){e(i)}}function r(t){try{a(c.throw(t))}catch(i){e(i)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n(function(t){t(i)})).then(o,r)}a((c=c.apply(i,[])).next())});var i,n,c}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(y.a),c.Ub(p.c))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Za=(()=>{class t{constructor(t){this.http=t}getPurchases(t,e=10,i=0,n=null,c=null,o=null){let r="";return n&&(r=`&entityId=${n}`),this.http.get(`${b.a.apiURL}/purchases?limit=${e}&offset=${i}&campaignId=${t}${r}`).toPromise()}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(r.b))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var $a=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function Xa(t,e){1&t&&c.Mb(0,"div",6)}const Ha=function(t,e){return["/campaigns",t,"entities",e]};function ja(t,e){if(1&t&&(c.Qb(0,"div",7),c.Qb(1,"div",8),c.Qb(2,"button",9),c.Mb(3,"i",10),c.Pb(),c.Pb(),c.Qb(4,"div",11),c.Qb(5,"h5"),c.wc(6),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(2),c.ec("routerLink",c.jc(2,Ha,t.campaign.id,t.entity.id)),c.Ab(4),c.yc("Purchases for ",t.entity.name,"")}}function Va(t,e){if(1&t&&(c.Qb(0,"div",12),c.Qb(1,"div",13),c.Mb(2,"i",14),c.Pb(),c.Qb(3,"p",15),c.wc(4),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(4),c.yc("",t.entity.name," has not made any purchases")}}const za=function(t,e,i){return["/campaigns",t,"concepts",e,i,"view"]},Ba=function(t,e){return["/campaigns",t,"articles",e]};function Ya(t,e){if(1&t&&(c.Qb(0,"div",18),c.Qb(1,"div",19),c.Mb(2,"a",20),c.Pb(),c.Qb(3,"div",21),c.Qb(4,"div"),c.Qb(5,"b"),c.wc(6),c.Pb(),c.wc(7," purchased "),c.Qb(8,"b"),c.wc(9),c.Pb(),c.Qb(10,"a",22),c.wc(11),c.Pb(),c.wc(12," from "),c.Qb(13,"a",22),c.wc(14),c.Pb(),c.Pb(),c.Qb(15,"div"),c.Mb(16,"div",23),c.Qb(17,"div"),c.wc(18),c.ac(19,"date"),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(6),c.xc(i.entity.name),c.Ab(3),c.yc("",t.quantity,"x "),c.Ab(1),c.ec("routerLink",c.kc(11,za,i.campaign.id,t.concept.conceptTypeId,t.concept.id)),c.Ab(1),c.xc(t.concept.name),c.Ab(2),c.ec("routerLink",c.jc(15,Ba,i.campaign.id,t.article.id)),c.Ab(1),c.xc(t.article.name),c.Ab(2),c.ec("ddCurrency",t.totalCurrencyCost),c.Ab(2),c.xc(c.bc(19,8,t.dateTime,"short"))}}function Wa(t,e){if(1&t&&(c.Qb(0,"div",16),c.vc(1,Ya,20,18,"div",17),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("ngForOf",t.purchases)}}function Ka(t,e){if(1&t){const t=c.Rb();c.Qb(0,"dd-paginator",24),c.Xb("pageChange",function(e){return c.oc(t),c.Zb().setPage(e)}),c.Pb()}if(2&t){const t=c.Zb();c.ec("totalItems",t.totalPurchases)("autoHide",!1)("page",t.page)}}const Ja=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"invite/:invite_id",component:on},{path:"about",component:dn},{path:"login",component:E,canActivate:[Da]},{path:"register",component:Yi},{path:"callback",component:E},{path:"account",canActivate:[G,rn],loadChildren:()=>Promise.resolve().then(i.bind(null,"zrcO")).then(t=>t.UsersModule)},{path:"campaigns/list",component:F,canActivate:[G,rn]},{path:"home",component:U,canActivate:[G,rn]},{path:"campaigns/create",component:ei,canActivate:[G,rn],data:{editing:!1}},{path:"campaigns/:id",component:v,canActivate:[G,rn],children:[{path:"",pathMatch:"full",redirectTo:"landing"},{path:"landing",component:ji,data:{suggestable:!0}},{path:"entities",component:un,children:[{path:":ent_id",component:Vt,data:{suggestable:!0}},{path:":ent_id/purchases",component:(()=>{class t{constructor(t,e,i,n,c){this.route=t,this.router=e,this.purchaseService=i,this.campaignService=n,this.entityService=c,this.loading=!1,this.page=1}ngOnInit(){this.route.paramMap.subscribe(t=>{this.load(t.get("ent_id"))})}load(t){return $a(this,void 0,void 0,function*(){this.loading=!0;try{yield Promise.all([this.loadPurchases(t),this.loadEntity(t)])}catch(e){throw e}this.loading=!1})}loadEntity(t){return $a(this,void 0,void 0,function*(){this.entity=yield this.entityService.getEntity(t)})}loadPurchases(t){return $a(this,void 0,void 0,function*(){const e=yield this.purchaseService.getPurchases(this.campaignService.campaign.id,10,10*(this.page-1),t);this.totalPurchases=e.total,this.purchases=e.purchases})}setPage(t){this.entity&&(this.page=t,this.load(this.entity.id))}get campaign(){return this.campaignService.campaign}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(p.c),c.Lb(Za),c.Lb(h.b),c.Lb(Y.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-entity-purchase-list"]],decls:6,vars:5,consts:[[1,"container","grid-lg"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],["class","empty mt-2",4,"ngIf"],["class","timeline",4,"ngIf"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column","col-auto"],[1,"btn","btn-sm",3,"routerLink"],[1,"icon","icon-arrow-left"],[1,"column"],[1,"empty","mt-2"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"timeline"],["class","timeline-item",4,"ngFor","ngForOf"],[1,"timeline-item"],[1,"timeline-left"],[1,"timeline-icon"],[1,"timeline-content"],[3,"routerLink"],[1,"label","label-warning","mt-1","text-dark",3,"ddCurrency"],["itemsPerPage","10",3,"totalItems","autoHide","page","pageChange"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.vc(1,Xa,1,0,"div",1),c.vc(2,ja,7,5,"div",2),c.vc(3,Va,5,1,"div",3),c.vc(4,Wa,2,1,"div",4),c.vc(5,Ka,1,3,"dd-paginator",5),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",e.loading&&!e.purchases),c.Ab(1),c.ec("ngIf",e.entity&&e.purchases),c.Ab(1),c.ec("ngIf",e.entity&&e.purchases&&0===e.totalPurchases),c.Ab(1),c.ec("ngIf",e.entity&&e.purchases),c.Ab(1),c.ec("ngIf",e.entity&&e.purchases&&e.totalPurchases>0))},directives:[m.k,p.d,m.j,p.e,ut.a,hc.a],pipes:[m.d],styles:[""]}),t})(),data:{suggestable:!0}},{path:":ent_id/ct/:ct_id",component:Zr},{path:":ent_type_id/create",component:Ga,canDeactivate:[$n.a],data:{editing:!1}},{path:":ent_type_id/:ent_id/edit",component:Ga,canDeactivate:[$n.a],data:{editing:!0}}]},{path:"notes",loadChildren:()=>Promise.resolve().then(i.bind(null,"reMG")).then(t=>t.NotesModule)},{path:"concepttypes/create",component:uc,canDeactivate:[$n.a],data:{editing:!1}},{path:"concepttypes/:ct_id/edit",component:uc,canDeactivate:[$n.a],data:{editing:!0}},{path:"concepts/:ct_id/manage",component:Ec,data:{suggestable:!0}},{path:"concepts/:ct_id/create",component:Xc,data:{editing:!1}},{path:"concepts/:ct_id/:c_id/edit",component:Xc,data:{editing:!0}},{path:"concepts/:ct_id/:c_id/view",component:lo,data:{suggestable:!0}},{path:"concepts/:ct_id/:c_id/history",component:ko,data:{suggestable:!0}},{path:"entitytypes/create",component:ga,data:{editing:!1}},{path:"entitytypes/:ent_id/edit",component:ga,data:{editing:!0}},{path:"spawnables",component:Zn},{path:"settings",component:ei,canDeactivate:[$n.a],data:{editing:!0}},{path:"overview",loadChildren:()=>i.e(8).then(i.bind(null,"h0u9")).then(t=>t.OverviewModule)},{path:"quests",component:fi,data:{suggestable:!0}},{path:"quests/create",component:Pn,canDeactivate:[$n.a],data:{editing:!1}},{path:"quests/:q_id/edit",component:Pn,canDeactivate:[$n.a],data:{editing:!0}},{path:"quests/:q_id",component:Sn,data:{suggestable:!0}},{path:"maps",loadChildren:()=>Promise.resolve().then(i.bind(null,"HboH")).then(t=>t.MappingModule)},{path:"articles",loadChildren:()=>i.e(7).then(i.bind(null,"+mPt")).then(t=>t.ArticlesModule)},{path:"members",component:Ho},{path:"sketchpad",loadChildren:()=>i.e(6).then(i.bind(null,"qd9+")).then(t=>t.SketchpadModule)}]}];let ts=(()=>{class t{}return t.\u0275mod=c.Jb({type:t}),t.\u0275inj=c.Ib({factory:function(e){return new(e||t)},imports:[[p.f.forRoot(Ja,{relativeLinkResolution:"legacy"})],p.f]}),t})(),es=(()=>{class t{constructor(t){this.router=t,this._sidebarOpen=!1,t.events.subscribe(t=>{this.sidebarOpen=!1})}toggle(){this.sidebarOpen=!this.sidebarOpen}set sidebarOpen(t){this._sidebarOpen=t}get sidebarOpen(){return this._sidebarOpen}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(p.c))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var is=i("nzV2");const ns=function(){return["login"]};function cs(t,e){1&t&&(c.Qb(0,"a",1),c.wc(1,"Login"),c.Pb()),2&t&&c.ec("routerLink",c.hc(1,ns))}const os=function(){return["home"]},rs=function(){return["campaigns","list"]},as=function(){return["/account"]};function ss(t,e){if(1&t){const t=c.Rb();c.Qb(0,"li",4),c.Qb(1,"a",1),c.wc(2,"Me"),c.Pb(),c.Qb(3,"ul",7),c.Qb(4,"li",4),c.Qb(5,"a",1),c.wc(6,"Campaigns"),c.Pb(),c.Pb(),c.Qb(7,"li",4),c.Qb(8,"a",1),c.wc(9,"Account"),c.Pb(),c.Pb(),c.Qb(10,"li",4),c.Qb(11,"a",8),c.Xb("click",function(){return c.oc(t),c.Zb().logOut()}),c.wc(12,"Logout"),c.Pb(),c.Pb(),c.Pb(),c.Pb()}2&t&&(c.Ab(1),c.ec("routerLink",c.hc(3,os)),c.Ab(4),c.ec("routerLink",c.hc(4,rs)),c.Ab(3),c.ec("routerLink",c.hc(5,as)))}const ls=function(t,e){return["campaigns",t,"concepts",e,"manage"]};function ds(t,e){if(1&t&&(c.Qb(0,"li",4),c.Qb(1,"a",1),c.wc(2),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(1),c.ec("routerLink",c.jc(2,ls,i.campaign.id,t.id)),c.Ab(1),c.xc(t.pluralForm)}}const us=function(t){return["campaigns",t,"spawnables"]};function bs(t,e){if(1&t&&(c.Qb(0,"li",4),c.Qb(1,"a",1),c.wc(2,"Spawnables"),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("routerLink",c.ic(1,us,t.campaign.id))}}const ps=function(t,e){return["campaigns",t,"entities",e,"create"]};function hs(t,e){if(1&t&&(c.Qb(0,"li",4),c.Qb(1,"a",1),c.wc(2),c.Pb(),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(2);c.Ab(1),c.ec("routerLink",c.jc(2,ps,i.campaign.id,t.id)),c.Ab(1),c.yc("Create ",t.name,"")}}const ms=function(t){return["campaigns",t,"settings"]};function gs(t,e){if(1&t&&(c.Qb(0,"li",4),c.Qb(1,"a",1),c.wc(2,"Settings"),c.Pb(),c.Pb()),2&t){const t=c.Zb(2);c.Ab(1),c.ec("routerLink",c.ic(1,ms,t.campaign.id))}}const fs=function(t){return["campaigns",t,"landing"]},vs=function(t){return["campaigns",t,"articles"]},ys=function(t){return["campaigns",t,"quests"]},Ps=function(t){return["campaigns",t,"notes"]},ws=function(t){return["campaigns",t,"overview"]},Is=function(t){return["campaigns",t,"maps"]};function Cs(t,e){if(1&t&&(c.Qb(0,"li",4),c.Qb(1,"a",1),c.wc(2),c.ac(3,"truncate"),c.Pb(),c.Qb(4,"ul",7),c.Qb(5,"li",4),c.Qb(6,"a",1),c.wc(7,"Articles"),c.Pb(),c.Pb(),c.Qb(8,"li",4),c.Qb(9,"a",1),c.wc(10,"Quests"),c.Pb(),c.Pb(),c.Qb(11,"li",4),c.Qb(12,"a",1),c.wc(13,"Notebook"),c.Pb(),c.Pb(),c.Qb(14,"li",4),c.Qb(15,"a",1),c.wc(16,"Overview"),c.Pb(),c.Pb(),c.Qb(17,"li",4),c.Qb(18,"a",1),c.wc(19,"Maps"),c.Pb(),c.Pb(),c.vc(20,ds,3,5,"li",9),c.vc(21,bs,3,3,"li",6),c.vc(22,hs,3,5,"li",9),c.vc(23,gs,3,3,"li",6),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(1),c.ec("routerLink",c.ic(14,fs,t.campaign.id)),c.Ab(1),c.yc(" ",c.bc(3,11,t.campaign.name,20)," "),c.Ab(4),c.ec("routerLink",c.ic(16,vs,t.campaign.id)),c.Ab(3),c.ec("routerLink",c.ic(18,ys,t.campaign.id)),c.Ab(3),c.ec("routerLink",c.ic(20,Ps,t.campaign.id)),c.Ab(3),c.ec("routerLink",c.ic(22,ws,t.campaign.id)),c.Ab(3),c.ec("routerLink",c.ic(24,Is,t.campaign.id)),c.Ab(2),c.ec("ngForOf",t.conceptTypes),c.Ab(1),c.ec("ngIf",t.campaignEditable),c.Ab(1),c.ec("ngForOf",t.entityPresets),c.Ab(1),c.ec("ngIf",t.campaignEditable)}}const Qs=function(){return["about"]};let As=(()=>{class t{constructor(t,e,i){this.campaignService=t,this.login=e,this.router=i}ngOnInit(){}logOut(){this.login.logout(),this.router.navigate(["login"]),this.campaignService.campaign=void 0}get entityPresets(){if(this.campaign)return this.campaignService.canEdit?this.campaign.entityPresets:this.campaign.entityPresets.filter(t=>t.playerCreatable)}get loadingCampaign(){return this.campaignService.loadingCampaign}get campaign(){return this.campaignService.campaign}get navEntities(){return this.campaign.entities.filter(t=>!t.spawnable&&null===t.spawnedFromId&&t.userId===this.login.id)}get conceptTypes(){return this.campaign.conceptTypes.filter(t=>!0===t.isShownInNavigationMenu)}get loggedIn(){return this.login.isLoggedIn}get campaignEditable(){return this.campaignService.canEdit}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b),c.Lb(y.a),c.Lb(p.c))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-nav-sidebar"]],decls:11,vars:7,consts:[[1,"brand","text-center","mt-2"],[3,"routerLink"],["src","/assets/icons/android-chrome-72x72.png","width","32"],[1,"nav","ml-2"],[1,"nav-item"],[3,"routerLink",4,"ngIf"],["class","nav-item",4,"ngIf"],[1,"nav"],[1,"c-hand",3,"click"],["class","nav-item",4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(c.Qb(0,"div",0),c.Qb(1,"a",1),c.Mb(2,"img",2),c.Pb(),c.Pb(),c.Qb(3,"ul",3),c.Qb(4,"li",4),c.vc(5,cs,2,2,"a",5),c.Pb(),c.vc(6,ss,13,6,"li",6),c.vc(7,Cs,24,26,"li",6),c.Qb(8,"li",4),c.Qb(9,"a",1),c.wc(10,"About"),c.Pb(),c.Pb(),c.Pb()),2&t&&(c.Ab(1),c.ec("routerLink",c.hc(5,os)),c.Ab(4),c.ec("ngIf",!e.loggedIn),c.Ab(1),c.ec("ngIf",e.loggedIn),c.Ab(1),c.ec("ngIf",e.campaign),c.Ab(2),c.ec("routerLink",c.hc(6,Qs)))},directives:[p.e,m.k,m.j],pipes:[d.a],styles:[".brand[_ngcontent-%COMP%]{display:flex}.brand[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column}"]}),t})();var ks=i("S36L"),xs=i("pLZG"),Ts=i("lJxs");function Es(t,e){1&t&&c.Mb(0,"div",2)}function Ls(t,e){1&t&&(c.Qb(0,"div",9),c.Qb(1,"div",10),c.Mb(2,"i",11),c.Pb(),c.Qb(3,"p",12),c.wc(4,"You have no new notifications"),c.Pb(),c.Qb(5,"p",13),c.wc(6,"Don't worry, they'll show up one day :)"),c.Pb(),c.Pb())}function Ms(t,e){if(1&t&&c.Mb(0,"div",26),2&t){const t=c.Zb().$implicit;c.ec("ddUser",t.suggestedBy)}}function Ss(t,e){if(1&t){const t=c.Rb();c.Qb(0,"li",27),c.Xb("click",function(){c.oc(t);const e=c.Zb().$implicit;return c.Zb(2).viewSuggestion(e)}),c.Qb(1,"div"),c.wc(2,"View Suggestion "),c.Mb(3,"i",28),c.Pb(),c.Pb()}}function Os(t,e){if(1&t){const t=c.Rb();c.Qb(0,"li",27),c.Xb("click",function(){c.oc(t);const e=c.Zb().$implicit;return c.Zb(2).viewCampaign(e)}),c.Qb(1,"div"),c.wc(2),c.Mb(3,"i",28),c.Pb(),c.Pb()}if(2&t){const t=c.Zb().$implicit;c.Ab(2),c.yc("",t.campaign.name," ")}}function Ns(t,e){if(1&t){const t=c.Rb();c.Qb(0,"li",27),c.Xb("click",function(){c.oc(t);const e=c.Zb().$implicit;return c.Zb(2).viewMap(e)}),c.Qb(1,"div"),c.wc(2,"View Map "),c.Mb(3,"i",28),c.Pb(),c.Pb()}}function _s(t,e){if(1&t){const t=c.Rb();c.Qb(0,"li",27),c.Xb("click",function(){c.oc(t);const e=c.Zb().$implicit;return c.Zb(2).viewQuest(e)}),c.Qb(1,"div"),c.wc(2,"View Quest "),c.Mb(3,"i",28),c.Pb(),c.Pb()}}function Rs(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",14),c.Qb(1,"div",15),c.Qb(2,"div",16),c.Qb(3,"button",17),c.Xb("click",function(){c.oc(t);const i=e.$implicit;return c.Zb(2).clearNotification(i)}),c.Mb(4,"i",18),c.Pb(),c.Pb(),c.Qb(5,"div",19),c.wc(6),c.vc(7,Ms,1,1,"div",20),c.Pb(),c.Qb(8,"div",16),c.Qb(9,"div",21),c.Qb(10,"button",22),c.Mb(11,"i",23),c.Pb(),c.Qb(12,"ul",24),c.vc(13,Ss,4,0,"li",25),c.vc(14,Os,4,1,"li",25),c.vc(15,Ns,4,0,"li",25),c.vc(16,_s,4,0,"li",25),c.Pb(),c.Pb(),c.Pb(),c.Pb(),c.Pb()}if(2&t){const t=e.$implicit;c.Ab(6),c.yc(" ",t.message," "),c.Ab(1),c.ec("ngIf",t.suggestedBy),c.Ab(6),c.ec("ngIf",null!=t.suggestionURL),c.Ab(1),c.ec("ngIf",null!=t.campaign),c.Ab(1),c.ec("ngIf",null!=t.mapId),c.Ab(1),c.ec("ngIf",null!=t.questId)}}const Fs=function(t){return{"big-space":t}};function Us(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",3),c.Qb(1,"button",4),c.Xb("click",function(){return c.oc(t),c.Zb().clearAll()}),c.Mb(2,"i",5),c.Qb(3,"span",6),c.wc(4," Clear All"),c.Pb(),c.Pb(),c.vc(5,Ls,7,0,"div",7),c.vc(6,Rs,17,6,"div",8),c.Pb()}if(2&t){const t=c.Zb();c.ec("ngClass",c.ic(3,Fs,t.notifications&&t.notifications.length>0)),c.Ab(5),c.ec("ngIf",0===t.notifications.length),c.Ab(1),c.ec("ngForOf",t.notifications)}}let qs=(()=>{class t{constructor(t,e){this.notificationService=t,this.router=e,this.done=new c.n}ngOnInit(){}clearNotification(t){this.notificationService.removeNotification(t)}viewCampaign(t){this.notificationService.removeNotification(t),this.router.navigate(["campaigns",t.campaignId,"landing"]),this.done.emit(!0)}viewMap(t){this.notificationService.removeNotification(t),this.router.navigate(["campaigns",t.campaignId,"maps",t.mapId]),this.done.emit(!0)}viewQuest(t){this.notificationService.removeNotification(t),this.router.navigate(["campaigns",t.campaignId,"quests",t.questId]),this.done.emit(!0)}viewSuggestion(t){this.notificationService.removeNotification(t),this.router.navigateByUrl(t.suggestionURL),this.done.emit(!0)}clearAll(){this.notificationService.clearAll()}get notifications(){return this.notificationService.notifications}get loading(){return this.notificationService.loading}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(ks.a),c.Lb(p.c))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-notifications"]],outputs:{done:"done"},decls:3,vars:2,consts:[["class","loading",4,"ngIf"],[3,"ngClass",4,"ngIf"],[1,"loading"],[3,"ngClass"],[1,"btn","btn-sm","mb-2",3,"click"],[1,"icon","icon-delete"],[1,"hide-sm"],["class","empty",4,"ngIf"],["class","card p-2 mb-2",4,"ngFor","ngForOf"],[1,"empty"],[1,"empty-icon"],[1,"icon","icon-flag","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[1,"card","p-2","mb-2"],[1,"columns","col-gapless"],[1,"column","col-auto"],["aria-label","Close",1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-cross"],[1,"column"],[3,"ddUser",4,"ngIf"],[1,"dropdown","dropdown-right"],["tabindex","0",1,"btn","btn-sm","dropdown-toggle"],[1,"icon","icon-menu"],[1,"menu"],["class","menu-item",3,"click",4,"ngIf"],[3,"ddUser"],[1,"menu-item",3,"click"],[1,"icon","icon-arrow-right"]],template:function(t,e){1&t&&(c.Qb(0,"div"),c.vc(1,Es,1,0,"div",0),c.vc(2,Us,7,5,"div",1),c.Pb()),2&t&&(c.Ab(1),c.ec("ngIf",e.loading),c.Ab(1),c.ec("ngIf",e.notifications))},directives:[m.k,m.i,m.j,L.a],styles:[".big-space[_ngcontent-%COMP%]{margin-bottom:6rem}"]}),t})();function Gs(t,e){if(1&t){const t=c.Rb();c.Qb(0,"div",12),c.Qb(1,"button",16),c.Xb("click",function(){return c.oc(t),c.Zb(2).suggest()}),c.Mb(2,"i",17),c.Pb(),c.Pb()}}const Ds=function(t,e){return["/campaigns",t,"entities",e]};function Zs(t,e){if(1&t&&(c.Qb(0,"figure",18),c.Mb(1,"img",19),c.Pb()),2&t){const t=e.$implicit,i=c.Zb(2);c.ec("routerLink",c.jc(3,Ds,i.campaign.id,t.id)),c.Bb("data-tooltip",t.name),c.Ab(1),c.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.imageId,"",c.qc)}}function $s(t,e){if(1&t){const t=c.Rb();c.Qb(0,"section",10),c.vc(1,Gs,3,0,"div",11),c.Qb(2,"div",12),c.vc(3,Zs,2,6,"figure",13),c.Pb(),c.Qb(4,"button",14),c.Xb("click",function(){return c.oc(t),c.Zb(),c.mc(1).open()}),c.Mb(5,"i",15),c.Pb(),c.Pb()}if(2&t){const t=c.Zb();c.Ab(1),c.ec("ngIf",t.campaign&&t.suggestable),c.Ab(2),c.ec("ngForOf",t.navEntities)("ngForTrackBy",t.trackEntity),c.Ab(1),c.Bb("data-badge",t.notificationText)}}const Xs=function(){return["login"]};function Hs(t,e){1&t&&(c.Qb(0,"section"),c.Qb(1,"a",20),c.wc(2,"Login"),c.Pb(),c.Pb()),2&t&&(c.Ab(1),c.ec("routerLink",c.hc(1,Xs)))}let js=(()=>{class t{constructor(t,e,i,n,c,o){this.campaignService=t,this.login=e,this.sidebar=i,this.notificationService=n,this.router=c,this.route=o,this.suggestable=!1}ngOnInit(){this.router.events.pipe(Object(xs.a)(t=>t instanceof p.b),Object(Ts.a)(()=>{let t=this.route.firstChild;for(;t;){if(!t.firstChild)return t.snapshot.data?t.snapshot.data:null;t=t.firstChild}return null})).subscribe(t=>{this.suggestable=!0===t.suggestable})}toggle(){this.sidebar.toggle()}trackEntity(t,e){return e.id}suggest(){return t=this,void 0,i=function*(){if(this.campaign)try{yield this.notificationService.suggestCurrentURL()}catch(t){throw t}},new((e=void 0)||(e=Promise))(function(n,c){function o(t){try{a(i.next(t))}catch(e){c(e)}}function r(t){try{a(i.throw(t))}catch(e){c(e)}}function a(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(o,r)}a((i=i.apply(t,[])).next())});var t,e,i}get loadingCampaign(){return this.campaignService.loadingCampaign}get campaign(){return this.campaignService.campaign}get loggedIn(){return this.login.isLoggedIn}get navEntities(){return this.loggedIn&&this.campaign?this.campaign.entities.filter(t=>!t.spawnable&&null===t.spawnedFromId&&t.userId===this.login.id):null}get notificationText(){return this.notificationService.notifications?this.notificationService.notifications.length:"..."}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(h.b),c.Lb(y.a),c.Lb(es),c.Lb(ks.a),c.Lb(p.c),c.Lb(p.a))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-nav"]],decls:13,vars:2,consts:[["notifmodal",""],["modal-header","",1,"mb-0"],["modal-body","",3,"done"],[1,"bg-light"],[1,"p-2"],[1,"navbar"],[1,"off-canvas-toggle","btn","btn-link","btn-action",3,"click"],[1,"icon","icon-menu"],["class","navbar-section p-1",4,"ngIf"],[4,"ngIf"],[1,"navbar-section","p-1"],["class","mr-2",4,"ngIf"],[1,"mr-2"],["class","avatar mx-1 entity-hover tooltip tooltip-bottom",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],[1,"btn","badge",3,"click"],[1,"icon","icon-flag"],["data-tooltip","Suggest this",1,"btn","s-circle","tooltip","tooltip-bottom",3,"click"],[1,"icon","icon-share"],[1,"avatar","mx-1","entity-hover","tooltip","tooltip-bottom",3,"routerLink"],["alt","Avatar",3,"src"],[1,"btn","btn-link",3,"routerLink"]],template:function(t,e){if(1&t){const t=c.Rb();c.Qb(0,"dd-modal",null,0),c.Qb(2,"h4",1),c.wc(3,"Notifications"),c.Pb(),c.Qb(4,"dd-notifications",2),c.Xb("done",function(){return c.oc(t),c.mc(1).close(null)}),c.Pb(),c.Pb(),c.Qb(5,"div",3),c.Qb(6,"div",4),c.Qb(7,"header",5),c.Qb(8,"section"),c.Qb(9,"a",6),c.Xb("click",function(){return e.toggle()}),c.Mb(10,"i",7),c.Pb(),c.Pb(),c.vc(11,$s,6,4,"section",8),c.vc(12,Hs,3,2,"section",9),c.Pb(),c.Pb(),c.Pb()}2&t&&(c.Ab(11),c.ec("ngIf",e.loggedIn),c.Ab(1),c.ec("ngIf",!e.loggedIn))},directives:[D.a,qs,m.k,m.j,p.d,p.e],styles:[".entity-hover[_ngcontent-%COMP%]{transition:all .2s;-webkit-tap-highlight-color:rgba(255,255,255,0);-webkit-tap-highlight-color:transparent}.entity-hover[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{border:1px solid #6362dc}.entity-hover[_ngcontent-%COMP%]:active, .entity-hover[_ngcontent-%COMP%]:hover{transform:scale(1.3);cursor:pointer}.entity-hover[_ngcontent-%COMP%]:active > img[_ngcontent-%COMP%], .entity-hover[_ngcontent-%COMP%]:hover > img[_ngcontent-%COMP%]{border:2px solid #5755d9}.entity-hover.active[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{border:2px dashed #5755d9}"]}),t})();function Vs(t,e){1&t&&(c.Qb(0,"div",6),c.wc(1,"Not Connected"),c.Pb())}function zs(t,e){1&t&&(c.Qb(0,"div",6),c.wc(1,"Connected"),c.Pb())}function Bs(t,e){1&t&&(c.Qb(0,"div",6),c.wc(1,"Disconnected"),c.Pb())}function Ys(t,e){1&t&&(c.Qb(0,"div",6),c.wc(1," Connecting ... "),c.Pb())}function Ws(t,e){1&t&&(c.Qb(0,"div",6),c.wc(1,"Authenticating"),c.Pb())}function Ks(t,e){if(1&t&&(c.Qb(0,"div",1),c.Qb(1,"div",2),c.wc(2," \ud83d\udc4c DD "),c.Qb(3,"div",3),c.Qb(4,"div",4),c.vc(5,Vs,2,0,"div",5),c.vc(6,zs,2,0,"div",5),c.vc(7,Bs,2,0,"div",5),c.vc(8,Ys,2,0,"div",5),c.vc(9,Ws,2,0,"div",5),c.Pb(),c.Pb(),c.Pb(),c.Pb()),2&t){const t=c.Zb();c.Ab(4),c.ec("ngSwitch",t.connectionStatus),c.Ab(1),c.ec("ngSwitchCase",0),c.Ab(1),c.ec("ngSwitchCase",1),c.Ab(1),c.ec("ngSwitchCase",2),c.Ab(1),c.ec("ngSwitchCase",3),c.Ab(1),c.ec("ngSwitchCase",4)}}let Js=(()=>{class t{constructor(t,e,i){this.route=t,this.router=e,this.hub=i,this.hidden=!1}ngOnInit(){this.route.data.subscribe(t=>{this.hidden=!1===t.footer})}get connectionStatus(){return this.hub.state}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(p.a),c.Lb(p.c),c.Lb(W.b))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-footer"]],decls:1,vars:1,consts:[["class","bg-secondary",4,"ngIf"],[1,"bg-secondary"],[1,"container","grid-xl","text-center","footer-container"],[1,"connection-status","text-center"],[1,"mt-2",3,"ngSwitch"],["class","label label-secondary",4,"ngSwitchCase"],[1,"label","label-secondary"]],template:function(t,e){1&t&&c.vc(0,Ks,10,6,"div",0),2&t&&c.ec("ngIf",!e.hidden)},directives:[m.k,m.l,m.m],styles:["[_nghost-%COMP%]{margin-top:auto}.footer-container[_ngcontent-%COMP%]{margin-top:3rem;padding-top:1rem;padding-bottom:3rem}"]}),t})();const tl=function(t){return{active:t}};let el=(()=>{class t{constructor(t){this.sidebar=t,this.title="ui"}toggle(){this.sidebar.toggle()}get sidebarOpen(){return this.sidebar.sidebarOpen}}return t.\u0275fac=function(e){return new(e||t)(c.Lb(es))},t.\u0275cmp=c.Fb({type:t,selectors:[["dd-root"]],decls:9,vars:3,consts:[[1,"body-container","off-canvas","off-canvas-sidebar-show"],["id","sidebar-id",1,"off-canvas-sidebar",3,"ngClass"],[1,"off-canvas-overlay",3,"click"],["id","app-content",1,"off-canvas-content","content","d-flex","flex-col","p-0"]],template:function(t,e){1&t&&(c.Mb(0,"dd-note-editor"),c.Qb(1,"div",0),c.Qb(2,"div",1),c.Mb(3,"dd-nav-sidebar"),c.Pb(),c.Qb(4,"a",2),c.Xb("click",function(){return e.toggle()}),c.Pb(),c.Qb(5,"div",3),c.Mb(6,"dd-nav"),c.Mb(7,"router-outlet"),c.Mb(8,"dd-footer"),c.Pb(),c.Pb()),2&t&&(c.Ab(2),c.ec("ngClass",c.ic(1,tl,e.sidebarOpen)))},directives:[is.a,m.i,As,js,p.g,Js],styles:[".body-container[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]{height:100vh}.content[_ngcontent-%COMP%]{overflow-y:auto}.h-100[_ngcontent-%COMP%]{height:100vh}"]}),t})(),il=(()=>{class t{constructor(t){this.login=t}intercept(t,e){const i=this.login.token;if(i){const n=t.clone({headers:t.headers.set("Authorization",`Bearer ${i}`)});return e.handle(n)}return e.handle(t)}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(y.a))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac}),t})();var nl=i("wC5x"),cl=i("EA6F"),ol=i("vkgz"),rl=i("nYR2");let al=(()=>{class t{constructor(t,e){this.router=t,this.login=e,this.silenceErrors=!1}intercept(t,e){let i;return e.handle(t).pipe(Object(ol.a)(()=>{},t=>i=t),Object(rl.a)(()=>{return e=this,void 0,c=function*(){if(void 0!==i){if(this.silenceErrors)return;if(i instanceof r.d)switch(i.status){case 401:this.silenceErrors=!0,this.login.logout(),console.log("REDIR TO",this.router.url),yield Kt.a.fire({title:"Session Expired",text:"Your login session has expired, you will be redirected to the login page",type:"warning",confirmButtonText:"Okay"}),yield this.router.navigate(["login"]);break;case 404:-1!==t.url.indexOf("/users/")||(yield Kt.a.fire({title:"Not Found",text:"The resource you requested could not be found! Sorry about that.",type:"error",confirmButtonText:"Okay"}));break;case 400:this.handleBadRequest(i);break;case 403:yield Kt.a.fire({title:"No Permissions",text:"Looks like you don't have permission for that!",type:"error",confirmButtonText:"Shucks"});break;case 0:yield Kt.a.fire({title:"Could Not Connect",text:"A connection to the server could not be established. Please make sure you are connected to the internet",type:"error",confirmButtonText:"Okay"});break;default:yield Kt.a.fire({title:"Unknown Error!",text:"An unknown error occured. Maybe this will help: "+i.message,type:"error",confirmButtonText:"Okay"})}else console.log("UNKNOWN ERR",i)}else this.silenceErrors=!1},new((n=void 0)||(n=Promise))(function(t,i){function o(t){try{a(c.next(t))}catch(e){i(e)}}function r(t){try{a(c.throw(t))}catch(e){i(e)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n(function(t){t(i)})).then(o,r)}a((c=c.apply(e,[])).next())});var e,n,c}))}handleBadRequest(t){const e=t.error;let i=e;switch(e){case"already in campaign":i="You are already a member of this campaign!"}Kt.a.fire({type:"error",confirmButtonText:"\xaf\\_(\u30c4)_/\xaf",title:"Oh Dear",text:i})}}return t.\u0275fac=function(e){return new(e||t)(c.Ub(p.c),c.Ub(y.a))},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac}),t})();var sl=i("HboH"),ll=i("reMG");let dl=(()=>{class t{constructor(){}handleError(t){console.log("Handling Error",t.name,t.message,t),Wi.captureException(t.originalError||t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=c.Hb({token:t,factory:t.\u0275fac}),t})();var ul=i("zrcO");let bl=(()=>{class t{}return t.\u0275mod=c.Jb({type:t,bootstrap:[el]}),t.\u0275inj=c.Ib({factory:function(e){return new(e||t)},providers:[{provide:r.a,useClass:il,multi:!0},{provide:r.a,useClass:al,multi:!0},{provide:c.m,useClass:dl}],imports:[[n.a,ts,a.s,a.k,s.a,u.a.forRoot({positionClass:"toast-top-center"}),d.b,r.c,ll.NotesModule,o.e,sl.MappingModule,nl.a,cl.a,ul.UsersModule,l.a.register("ngsw-worker.js",{enabled:b.a.production})]]}),t})();b.a.production&&(Object(c.T)(),Wi.init({dsn:b.a.sentryDSN,enabled:b.a.production,environment:b.a.production?"Production":"Development",release:"REPLACE_GIT_HASH"})),n.c().bootstrapModule(bl).catch(t=>console.error(t))},zn8P:function(t,e){function i(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}i.keys=function(){return[]},i.resolve=i,t.exports=i,i.id="zn8P"},zrcO:function(t,e,i){"use strict";i.r(e),i.d(e,"UsersModule",function(){return v});var n=i("ofXK"),c=i("tyNb"),o=i("xdv0"),r=i("edGd"),a=i("3Pt+"),s=i("fXoL"),l=function(t,e,i,n){return new(i||(i=Promise))(function(c,o){function r(t){try{s(n.next(t))}catch(e){o(e)}}function a(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){var e;t.done?c(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,a)}s((n=n.apply(t,e||[])).next())})};function d(t,e){1&t&&s.Mb(0,"div",3)}function u(t,e){if(1&t){const t=s.Rb();s.Qb(0,"h3"),s.wc(1),s.Qb(2,"button",12),s.Xb("click",function(){s.oc(t);const e=s.Zb(2);return e.editUsername=!e.editUsername}),s.Mb(3,"i",13),s.Pb(),s.Pb()}if(2&t){const t=s.Zb(2);s.Ab(1),s.yc(" ",t.user.username," ")}}function b(t,e){if(1&t){const t=s.Rb();s.Qb(0,"div",14),s.Mb(1,"input",15),s.Qb(2,"button",16),s.Xb("click",function(){return s.oc(t),s.Zb(2).editUsername=!1}),s.Mb(3,"i",17),s.Pb(),s.Pb()}if(2&t){const t=s.Zb(2);s.Ab(1),s.ec("formControl",t.username)}}const p=function(t){return{loading:t}};function h(t,e){if(1&t){const t=s.Rb();s.Qb(0,"div",5),s.Qb(1,"button",18),s.Xb("click",function(){return s.oc(t),s.Zb(2).save()}),s.wc(2," Save "),s.Pb(),s.Pb()}if(2&t){const t=s.Zb(2);s.Ab(1),s.ec("disabled",t.formGroup.invalid)("ngClass",s.ic(2,p,t.saving))}}function m(t,e){if(1&t&&(s.Qb(0,"div",4),s.Qb(1,"div",5),s.Qb(2,"figure",6),s.Mb(3,"img",7),s.Pb(),s.Pb(),s.Qb(4,"div",8),s.vc(5,u,4,1,"h3",9),s.vc(6,b,4,1,"div",10),s.Pb(),s.vc(7,h,3,4,"div",11),s.Pb()),2&t){const t=s.Zb();s.Ab(3),s.ec("src",t.user.pictureURL,s.qc),s.Ab(2),s.ec("ngIf",!t.editUsername),s.Ab(1),s.ec("ngIf",t.editUsername),s.Ab(1),s.ec("ngIf",t.dirty)}}const g=[{path:"",component:(()=>{class t{constructor(t,e){this.userService=t,this.login=e,this.loading=!1,this.saving=!1,this.editUsername=!1}ngOnInit(){this.formGroup=new a.h({username:new a.e(null,[a.v.required,a.v.minLength(3),a.v.maxLength(30)])}),this.load()}load(){return l(this,void 0,void 0,function*(){this.loading=!0;try{this.user=yield this.userService.getUser(this.login.currentUser.id),this.patchForm()}catch(t){throw t}this.loading=!1})}patchForm(){this.formGroup.patchValue(this.user)}save(){return l(this,void 0,void 0,function*(){if(!this.formGroup.invalid){this.user.username=this.username.value,this.saving=!0;try{yield this.userService.updateUser(this.user)}catch(t){throw t}this.editUsername=!1,this.formGroup.markAsPristine(),this.saving=!1}})}get username(){return this.formGroup.get("username")}get dirty(){return this.formGroup.dirty}}return t.\u0275fac=function(e){return new(e||t)(s.Lb(o.a),s.Lb(r.a))},t.\u0275cmp=s.Fb({type:t,selectors:[["dd-account-settings"]],decls:3,vars:2,consts:[[1,"container","grid-xl"],["class","loading loading-lg",4,"ngIf"],["class","columns",4,"ngIf"],[1,"loading","loading-lg"],[1,"columns"],[1,"column","col-auto"],[1,"avatar","avatar-xl"],[3,"src"],[1,"column","d-flex","align-items-center"],[4,"ngIf"],["class","form-group",4,"ngIf"],["class","column col-auto",4,"ngIf"],[1,"btn","btn-sm","btn-link",3,"click"],[1,"icon","icon-edit"],[1,"form-group"],["type","text","name","username","id","username",1,"form-input","input-lg",3,"formControl"],[1,"btn","mt-2",3,"click"],[1,"icon","icon-cross"],[1,"btn","btn-sm",3,"disabled","ngClass","click"]],template:function(t,e){1&t&&(s.Qb(0,"div",0),s.vc(1,d,1,0,"div",1),s.vc(2,m,8,4,"div",2),s.Pb()),2&t&&(s.Ab(1),s.ec("ngIf",e.loading),s.Ab(1),s.ec("ngIf",e.user))},directives:[n.k,a.b,a.m,a.f,n.i],styles:[""]}),t})()}];let f=(()=>{class t{}return t.\u0275mod=s.Jb({type:t}),t.\u0275inj=s.Ib({factory:function(e){return new(e||t)},imports:[[c.f.forChild(g)],c.f]}),t})(),v=(()=>{class t{}return t.\u0275mod=s.Jb({type:t}),t.\u0275inj=s.Ib({factory:function(e){return new(e||t)},imports:[[n.b,f,a.s]]}),t})()}},[[0,0,5]]]);