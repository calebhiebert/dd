!function(){function e(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||n(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,r=!1,o=void 0;try{for(var c,a=e[Symbol.iterator]();!(i=(c=a.next()).done)&&(n.push(c.value),!t||n.length!==t);i=!0);}catch(s){r=!0,o=s}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{h0u9:function(n,i,o){"use strict";o.r(i),o.d(i,"OverviewModule",function(){return se});var a,s,u=o("ofXK"),l=o("tyNb"),v=o("uCWu"),d=o("AytR"),b=o("fXoL"),p=o("tk/3"),h=((a=function(){function e(t){r(this,e),this.http=t}return c(e,[{key:"getOverviewState",value:function(e){return this.http.get("".concat(d.a.apiURL,"/overviewstates/").concat(e)).toPromise()}},{key:"updateOverviewState",value:function(e,t){return this.http.put("".concat(d.a.apiURL,"/overviewstates/campaign/").concat(t),e).toPromise()}}]),e}()).\u0275fac=function(e){return new(e||a)(b.Ub(p.b))},a.\u0275prov=b.Hb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),f=o("aCXV"),m=o("dtdw"),g=o("/fvA"),y=function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function c(e){try{s(i.next(e))}catch(t){o(t)}}function a(e){try{s(i.throw(e))}catch(t){o(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((i=i.apply(e,t||[])).next())})},w=((s=function(){function n(e,t,i,o){var c=this;r(this,n),this.campaignService=e,this.stateService=t,this.updateService=i,this.conceptService=o,this._viewMode="full",this._reorderable=!1,this._loading=!1,i.overviewStateUpdate.subscribe(function(e){c._overviewState=e})}return c(n,[{key:"getSortOrder",value:function(e){var t={};return e.forEach(function(e,n){t[e.id]=n}),t}},{key:"updateState",value:function(){return y(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._loading=!0,e.prev=1,this.stateService.updateOverviewState(this._overviewState,this.campaignService.campaign.id),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),e.t0;case 8:this._loading=!1;case 9:case"end":return e.stop()}},e,this,[[1,5]])}))}},{key:"cleanseEntityConceptTypes",value:function(e){this._overviewState&&(Object.entries(this._overviewState.entityConcepts).forEach(function(n){var i=t(n,2),r=(i[0],i[1]);r[e]&&delete r[e]}),this.updateState())}},{key:"getConceptsForEntities",value:function(){return y(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,r,o,c,a,s,u,l,v,d,b,h,f,m,g=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this._overviewState){n.next=2;break}return n.abrupt("return");case 2:for(i={},r=0,o=Object.entries(this._overviewState.entityConcepts);r<o.length;r++)for((c=t(o[r],2))[0],a=c[1],s=0,u=Object.entries(a);s<u.length;s++)v=t(u[s],2),d=v[0],(b=v[1])&&(i[d]||(i[d]=[]),(l=i[d]).push.apply(l,e(b)));return h=Object.entries(i).map(function(e){var n=t(e,2),i=n[0],r=n[1];return y(g,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.conceptService.getConcepts(i,50,0,null,null,r);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",(e.t0 instanceof p.d&&404===e.t0.status&&this.cleanseEntityConceptTypes(i),{concepts:[],total:0}));case 9:case"end":return e.stop()}},e,this,[[0,6]])}))}),n.next=7,Promise.all(h);case 7:f=n.sent,m={},f.forEach(function(e){e.concepts.forEach(function(e){m[e.id]=e})}),this._concepts=m;case 10:case"end":return n.stop()}},n,this)}))}},{key:"loadOverviewState",value:function(){return y(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.campaignService.campaign.overviewStateId&&this.campaignService.canEdit){e.next=15;break}return this._loading=!0,e.prev=2,e.next=5,this.stateService.getOverviewState(this.campaignService.campaign.overviewStateId);case 5:this._overviewState=e.sent,this.getConceptsForEntities(),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(2),e.t0;case 12:this._loading=!1,e.next=26;break;case 15:return this._loading=!0,e.prev=16,e.next=19,this.stateService.updateOverviewState({entitySortOrder:{},entityLabels:{},entityConcepts:{}},this.campaignService.campaign.id);case 19:this._overviewState=e.sent,e.next=25;break;case 22:throw e.prev=22,e.t1=e.catch(16),e.t1;case 25:this._loading=!1;case 26:case"end":return e.stop()}},e,this,[[2,9],[16,22]])}))}},{key:"setViewMode",value:function(e){this._viewMode=e}},{key:"toggleReorderable",value:function(){this._reorderable=!this._reorderable}},{key:"swapEntities",value:function(t,n){var i=e(this.sortedEntities);Object(f.f)(i,t,n),this._overviewState&&(this._overviewState.entitySortOrder=this.getSortOrder(i),this.updateState())}},{key:"setLabel",value:function(e,t){return y(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=this._overviewState,!n.t0){n.next=5;break}return this._overviewState.entityLabels[e.id]=t,n.next=5,this.updateState();case 5:case"end":return n.stop()}},n,this)}))}},{key:"addConceptEntity",value:function(e,t,n){return y(this,void 0,void 0,regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.t0=this._overviewState,!i.t0){i.next=8;break}return this._overviewState.entityConcepts[e.id]||(this._overviewState.entityConcepts[e.id]={}),this._overviewState.entityConcepts[e.id][n.id]||(this._overviewState.entityConcepts[e.id][n.id]=[]),-1===this._overviewState.entityConcepts[e.id][n.id].indexOf(t.id)&&this._overviewState.entityConcepts[e.id][n.id].push(t.id),this.getConceptsForEntities(),i.next=8,this.updateState();case 8:case"end":return i.stop()}},i,this)}))}},{key:"clearConceptEntities",value:function(e,t){return y(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=this._overviewState&&this._overviewState.entityConcepts[e.id]&&this._overviewState.entityConcepts[e.id][t.id],!n.t0){n.next=5;break}return delete this._overviewState.entityConcepts[e.id][t.id],n.next=5,this.updateState();case 5:case"end":return n.stop()}},n,this)}))}},{key:"entities",get:function(){return this.campaignService.campaign.entities.filter(function(e){return!e.spawnable})}},{key:"sortedEntities",get:function(){var t=this;return this._overviewState?e(this.entities).sort(function(e,n){return(t._overviewState.entitySortOrder[e.id]||0)-(t._overviewState.entitySortOrder[n.id]||0)}):this.entities}},{key:"reorderable",get:function(){return this._reorderable}},{key:"state",get:function(){return this._overviewState}},{key:"viewMode",get:function(){return this._viewMode}},{key:"concepts",get:function(){return this._concepts||{}}}]),n}()).\u0275fac=function(e){return new(e||s)(b.Ub(v.b),b.Ub(h),b.Ub(m.b),b.Ub(g.a))},s.\u0275prov=b.Hb({token:s,factory:s.\u0275fac,providedIn:"root"}),s),k=o("ygrl"),S=o("DwCd"),C=o("3Pt+"),P=o("Pqmk"),x=o("5eHb"),Q=o("lD+H"),_=o("AxCL"),E=o("edGd"),I=o("PSD3"),A=o.n(I),R=o("qcJQ"),O=function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function c(e){try{s(i.next(e))}catch(t){o(t)}}function a(e){try{s(i.throw(e))}catch(t){o(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((i=i.apply(e,t||[])).next())})};function L(e,t){1&e&&(b.Qb(0,"div",27),b.Mb(1,"i",28),b.Pb())}var M=function(e){return{badge:e}};function F(e,t){if(1&e&&(b.Qb(0,"div",29),b.Qb(1,"figure",30),b.Mb(2,"img",31),b.Pb(),b.Pb()),2&e){var n=b.Zb();b.Ab(1),b.ec("ngClass",b.ic(3,M,n.label)),b.Bb("data-badge",n.label),b.Ab(1),b.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.entity.imageId,"",b.qc)}}var T=function(e,t,n){return["/campaigns",e,"concepts",t,n,"view"]};function j(e,t){if(1&e&&(b.Qb(0,"figure",32),b.Mb(1,"img",33),b.Pb()),2&e){var n=t.$implicit,i=b.Zb();b.ec("routerLink",b.kc(3,T,i.entity.campaignId,n.conceptTypeId,n.id)),b.Bb("data-tooltip",n.name),b.Ab(1),b.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",n.imageId,"",b.qc)}}function D(e,t){if(1&e){var n=b.Rb();b.Qb(0,"dd-health-display",34),b.Xb("healthChange",function(e){return b.oc(n),b.Zb().onHealthChange(e)}),b.Pb()}if(2&e){var i=b.Zb();b.ec("health",i.entity.health)("editable",i.editable)("mini",!0)("preset",i.preset.health)}}function X(e,t){if(1&e){var n=b.Rb();b.Qb(0,"li",35),b.Xb("click",function(){return b.oc(n),b.Zb().editLabel.emit(!0)}),b.Qb(1,"div"),b.Mb(2,"i",36),b.wc(3," Label"),b.Pb(),b.Pb()}}function Z(e,t){if(1&e){var n=b.Rb();b.Qb(0,"li",35),b.Xb("click",function(){b.oc(n);var e=t.$implicit;return b.Zb().editConceptRelations(e)}),b.Qb(1,"div"),b.Mb(2,"i",37),b.wc(3),b.Pb(),b.Pb()}if(2&e){var i=t.$implicit;b.Ab(3),b.yc(" Add ",i.name,"")}}function U(e,t){if(1&e){var n=b.Rb();b.Qb(0,"li",35),b.Xb("click",function(){b.oc(n);var e=t.$implicit;return b.Zb().clearConcepts.emit(e)}),b.Qb(1,"div"),b.Mb(2,"i",38),b.wc(3),b.Pb(),b.Pb()}if(2&e){var i=t.$implicit;b.Ab(3),b.yc(" Clear ",i.pluralForm,"")}}function $(e,t){if(1&e){var n=b.Rb();b.Qb(0,"li",35),b.Xb("click",function(){return b.oc(n),b.Zb().kill()}),b.Qb(1,"div"),b.Mb(2,"i",39),b.wc(3," Kill"),b.Pb(),b.Pb()}}var q,H,B=function(e,t){return["/campaigns",e,"entities",t]},G=((q=function(){function e(t,n,i,o){r(this,e),this.campaignService=t,this.loginService=n,this.entityService=i,this.overviewService=o,this.saving=!1,this.editLabel=new b.n,this.addConcept=new b.n,this.clearConcepts=new b.n}return c(e,[{key:"ngOnInit",value:function(){}},{key:"updateEntity",value:function(e){return O(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.saving=!0,t.prev=1,t.next=4,this.entityService.updateEntity(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(1),t.t0;case 9:this.saving=!1;case 10:case"end":return t.stop()}},t,this,[[1,6]])}))}},{key:"onHealthChange",value:function(e){this.updateEntity(Object.assign(Object.assign({},this.entity),{health:e}))}},{key:"kill",value:function(){return O(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=!0,e.next=3,A.a.fire({titleText:"Are you sure?",text:"You will not be able to undo this"});case 3:if(e.t1=e.sent.value,e.t2=e.t0===e.t1,!e.t2){e.next=8;break}return e.next=8,this.entityService.deleteEntity(this.entity.id);case 8:case"end":return e.stop()}},e,this)}))}},{key:"editConceptRelations",value:function(e){this.addConcept.emit(e)}},{key:"trackConcept",value:function(e,t){return t.id}},{key:"preset",get:function(){var e=this;return this.campaignService.campaign.entityPresets.find(function(t){return t.id===e.entity.entityPresetId})}},{key:"editable",get:function(){return(this.campaignService.canEdit||this.entity.userId===this.loginService.id)&&"full"===this.overviewService.viewMode}},{key:"conceptTypes",get:function(){return this.campaignService.campaign.conceptTypes.filter(function(e){return!0===e.isUsableInOverviewScreen})}},{key:"concepts",get:function(){var e=this;if(!this.conceptEntities||!this.overviewService.concepts)return[];for(var n=[],i=0,r=Object.entries(this.conceptEntities);i<r.length;i++){var o=t(r[i],2);o[0],o[1].forEach(function(t){var i=e.overviewService.concepts[t];i&&n.push(i)})}return n}}]),e}()).\u0275fac=function(e){return new(e||q)(b.Lb(v.b),b.Lb(E.a),b.Lb(_.b),b.Lb(w))},q.\u0275cmp=b.Fb({type:q,selectors:[["dd-overview-entity"]],inputs:{entity:"entity",label:"label",showMoveIcon:"showMoveIcon",conceptEntities:"conceptEntities"},outputs:{editLabel:"editLabel",addConcept:"addConcept",clearConcepts:"clearConcepts"},decls:33,vars:20,consts:[[1,"card","p-2"],[1,"columns"],["cdkDragHandle","",4,"ngIf"],["class","column col-auto",4,"ngIf"],[1,"column"],[1,"columns","no-select"],[1,"column","col-2","col-md-3","col-sm-12"],[1,"fake-link","d-inline",3,"routerLink"],[1,"d-inline-block","mb-2"],["class","avatar avatar-sm tooltip c-hand ml-2",3,"routerLink",4,"ngFor","ngForOf","ngForTrackBy"],[1,"column","col-10","col-md-9","col-sm-12"],[3,"health","editable","mini","preset","healthChange",4,"ngIf"],[1,"column","col-auto","d-flex","align-items-center"],[1,"dropdown","dropdown-right"],["tabindex","0",1,"btn","btn-sm","dropdown-toggle"],[1,"icon","icon-menu"],[1,"menu","p-1","pt-2"],[1,"menu-item"],[1,"tile","tile-centered"],[1,"tile-icon"],["alt","avatar",1,"avatar",3,"src"],[1,"tile-content"],[1,"divider"],[1,"menu-item",3,"routerLink"],[1,"icon","icon-arrow-right"],["class","menu-item",3,"click",4,"ngIf"],["class","menu-item",3,"click",4,"ngFor","ngForOf"],["cdkDragHandle",""],[1,"icon","icon-resize-vert","c-move"],[1,"column","col-auto"],[1,"avatar",3,"ngClass"],[3,"src"],[1,"avatar","avatar-sm","tooltip","c-hand","ml-2",3,"routerLink"],["alt","",3,"src"],[3,"health","editable","mini","preset","healthChange"],[1,"menu-item",3,"click"],[1,"icon","icon-edit"],[1,"icon","icon-plus"],[1,"icon","icon-delete"],[1,"icon","icon-cross"]],template:function(e,t){1&e&&(b.Qb(0,"div",0),b.Qb(1,"div",1),b.vc(2,L,2,0,"div",2),b.vc(3,F,3,5,"div",3),b.Qb(4,"div",4),b.Qb(5,"div",5),b.Qb(6,"div",6),b.Qb(7,"h6",7),b.wc(8),b.Pb(),b.Qb(9,"div",8),b.vc(10,j,2,7,"figure",9),b.Pb(),b.Pb(),b.Qb(11,"div",10),b.vc(12,D,1,4,"dd-health-display",11),b.Pb(),b.Pb(),b.Pb(),b.Qb(13,"div",12),b.Qb(14,"div",13),b.Qb(15,"button",14),b.Mb(16,"i",15),b.Pb(),b.Qb(17,"ul",16),b.Qb(18,"li",17),b.Qb(19,"section",18),b.Qb(20,"div",19),b.Mb(21,"img",20),b.Pb(),b.Qb(22,"div",21),b.wc(23),b.Pb(),b.Pb(),b.Pb(),b.Mb(24,"li",22),b.Qb(25,"li",23),b.Qb(26,"div"),b.Mb(27,"i",24),b.wc(28," View"),b.Pb(),b.Pb(),b.vc(29,X,4,0,"li",25),b.vc(30,Z,4,1,"li",26),b.vc(31,U,4,1,"li",26),b.vc(32,$,4,0,"li",25),b.Pb(),b.Pb(),b.Pb(),b.Pb(),b.Pb()),2&e&&(b.Ab(2),b.ec("ngIf",t.showMoveIcon),b.Ab(1),b.ec("ngIf",t.entity.imageId),b.Ab(4),b.ec("routerLink",b.jc(14,B,t.entity.campaignId,t.entity.id)),b.Ab(1),b.xc(t.entity.name),b.Ab(2),b.ec("ngForOf",t.concepts)("ngForTrackBy",t.trackConcept),b.Ab(2),b.ec("ngIf",t.entity.health),b.Ab(9),b.gc("src","https://res.cloudinary.com/dqhk8k6iv/image/upload/t_thumb/",t.entity.imageId,"",b.qc),b.Ab(2),b.yc(" ",t.entity.name," "),b.Ab(2),b.ec("routerLink",b.jc(17,B,t.entity.campaignId,t.entity.id)),b.Ab(4),b.ec("ngIf",t.editable),b.Ab(1),b.ec("ngForOf",t.conceptTypes),b.Ab(1),b.ec("ngForOf",t.conceptTypes),b.Ab(1),b.ec("ngIf",t.editable))},directives:[u.k,l.d,u.j,f.b,u.i,R.a],styles:[""]}),q),V=function(e){return{"btn-primary":e}},J=((H=function(){function e(t){r(this,e),this.overviewService=t}return c(e,[{key:"ngOnInit",value:function(){var e=this;this.sortGroup=new C.h({mode:new C.e(0),direction:new C.e(0)}),this.viewModeControl=new C.e(this.overviewService.viewMode),this.viewModeControl.valueChanges.subscribe(function(t){e.overviewService.setViewMode(t)})}},{key:"toggleReorderable",value:function(){this.overviewService.toggleReorderable()}},{key:"reorderable",get:function(){return this.overviewService.reorderable}}]),e}()).\u0275fac=function(e){return new(e||H)(b.Lb(w))},H.\u0275cmp=b.Fb({type:H,selectors:[["dd-overview-toolbar"]],inputs:{state:"state"},decls:10,vars:5,consts:[[1,"columns",3,"formGroup"],[1,"column","col-auto"],[1,"btn",3,"ngClass","click"],[1,"icon","icon-resize-vert"],[1,"column"],[1,"form-input",3,"formControl"],["value","full"],["value","spectate"]],template:function(e,t){1&e&&(b.Qb(0,"div",0),b.Qb(1,"div",1),b.Qb(2,"button",2),b.Xb("click",function(){return t.toggleReorderable()}),b.Mb(3,"i",3),b.Pb(),b.Pb(),b.Qb(4,"div",4),b.Qb(5,"select",5),b.Qb(6,"option",6),b.wc(7,"Full"),b.Pb(),b.Qb(8,"option",7),b.wc(9,"Spectate"),b.Pb(),b.Pb(),b.Pb(),b.Pb()),2&e&&(b.ec("formGroup",t.sortGroup),b.Ab(2),b.ec("ngClass",b.ic(3,V,t.reorderable)),b.Ab(3),b.ec("formControl",t.viewModeControl))},directives:[C.n,C.i,u.i,C.t,C.m,C.f,C.p,C.w],styles:[""]}),H),z=function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function c(e){try{s(i.next(e))}catch(t){o(t)}}function a(e){try{s(i.throw(e))}catch(t){o(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,a)}s((i=i.apply(e,t||[])).next())})},Y=["labelmodal"],K=["conceptselector"];function N(e,t){1&e&&b.Mb(0,"div",21)}function W(e,t){if(1&e){var n=b.Rb();b.Qb(0,"div",18),b.vc(1,N,1,0,"div",19),b.Qb(2,"dd-overview-entity",20),b.Xb("editLabel",function(){b.oc(n);var e=t.$implicit;return b.Zb().editLabel(e)})("addConcept",function(e){b.oc(n);var i=t.$implicit;return b.Zb().addConceptTypeToEntity(e,i)})("clearConcepts",function(e){b.oc(n);var i=t.$implicit;return b.Zb().clearConcepts(e,i)}),b.Pb(),b.Pb()}if(2&e){var i=t.$implicit,r=b.Zb();b.ec("cdkDragDisabled",!r.reorderable),b.Ab(2),b.ec("entity",i)("showMoveIcon",r.reorderable)("label",r.labels&&r.labels[i.id])("conceptEntities",r.getConceptsForEntity(i.id))}}function ee(e,t){1&e&&(b.Qb(0,"div",22),b.Qb(1,"div",23),b.Mb(2,"i",24),b.Pb(),b.Qb(3,"p",25),b.wc(4,"There's nothing here"),b.Pb(),b.Qb(5,"p",26),b.wc(6,"Once the campaign gets going this will fill up"),b.Pb(),b.Pb())}function te(e,t){if(1&e&&b.Mb(0,"dd-overview-toolbar",27),2&e){var n=b.Zb();b.ec("state",n.state)}}var ne,ie,re,oe=[{path:"",component:(ne=function(){function e(t,n,i,o){r(this,e),this.campaignService=t,this.overviewService=n,this.conceptService=i,this.toast=o,this.loading=!1}return c(e,[{key:"ngOnInit",value:function(){var e=this;this.labelControl=new C.e(null),this.overviewService.loadOverviewState(),this.loadConcepts=function(t){return z(e,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._addingConceptType){e.next=4;break}return e.next=3,this.conceptService.getConcepts(this._addingConceptType.id,6,0,t);case 3:return e.abrupt("return",e.sent.concepts.map(function(e){return{displayHtml:e.name,value:e}}));case 4:case"end":return e.stop()}},e,this)}))}}},{key:"trackEntityElement",value:function(e,t){return t.id}},{key:"entityDropped",value:function(e){this.overviewService.swapEntities(e.previousIndex,e.currentIndex)}},{key:"editLabel",value:function(e){return z(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.labels&&this.labels[e.id]&&this.labelControl.setValue(this.labels[e.id]),t.next=3,this._labelModal.open();case 3:n=t.sent,this.labelControl.setValue(null),"clear-label"!==n?n&&this.overviewService.setLabel(e,n):this.overviewService.setLabel(e,null);case 5:case"end":return t.stop()}},t,this)}))}},{key:"addConceptTypeToEntity",value:function(e,t){return z(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this._addingConceptType=e,n.next=3,this._conceptSelector.openSelector();case 3:i=n.sent,this._addingConceptType=null,i&&i.value&&this.overviewService.addConceptEntity(t,i.value,e);case 5:case"end":return n.stop()}},n,this)}))}},{key:"clearConcepts",value:function(e,t){return z(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.overviewService.clearConceptEntities(t,e);case 2:this.toast.info("Removed all ".concat(e.pluralForm," from ").concat(t.name));case 3:case"end":return n.stop()}},n,this)}))}},{key:"getConceptsForEntity",value:function(e){return this.state?this.state.entityConcepts[e]:null}},{key:"campaign",get:function(){return this.campaign}},{key:"editable",get:function(){return this.campaignService.canEdit}},{key:"sortedEntities",get:function(){return this.overviewService.sortedEntities}},{key:"state",get:function(){return this.overviewService.state}},{key:"reorderable",get:function(){return this.overviewService.reorderable}},{key:"labels",get:function(){return this.state&&this.state.entityLabels}},{key:"labelFieldConfig",get:function(){return{name:"Label",description:"A label that will show up in the overview screen",type:S.a.STRING,options:{required:!1,maxLength:8}}}}]),e}(),ne.\u0275fac=function(e){return new(e||ne)(b.Lb(v.b),b.Lb(w),b.Lb(g.a),b.Lb(x.b))},ne.\u0275cmp=b.Fb({type:ne,selectors:[["dd-overview"]],viewQuery:function(e,t){var n;1&e&&(b.Ac(Y,3),b.Ac(K,3)),2&e&&(b.lc(n=b.Yb())&&(t._labelModal=n.first),b.lc(n=b.Yb())&&(t._conceptSelector=n.first))},decls:23,vars:9,consts:[["size","small"],["labelmodal",""],["modal-header",""],["modal-body",""],[3,"config","control"],["modal-footer",""],[1,"btn","btn-sm","btn-error","mr-2",3,"click"],[1,"icon","icon-cross"],[1,"btn","btn-sm",3,"disabled","click"],[3,"searchable","loadSelectItems"],["conceptselector",""],[1,"container"],[1,"columns"],[1,"column"],["cdkDropList","",3,"cdkDropListDropped"],["class","mb-2","cdkDrag","",3,"cdkDragDisabled",4,"ngFor","ngForOf","ngForTrackBy"],["class","empty mb-2",4,"ngIf"],[3,"state",4,"ngIf"],["cdkDrag","",1,"mb-2",3,"cdkDragDisabled"],["class","drag-placeholder",4,"cdkDragPlaceholder"],[3,"entity","showMoveIcon","label","conceptEntities","editLabel","addConcept","clearConcepts"],[1,"drag-placeholder"],[1,"empty","mb-2"],[1,"empty-icon"],[1,"icon","icon-search","icon-4x"],[1,"empty-title","h5"],[1,"empty-subtitle"],[3,"state"]],template:function(e,t){if(1&e){var n=b.Rb();b.Qb(0,"dd-modal",0,1),b.Qb(2,"h5",2),b.wc(3,"Edit Label"),b.Pb(),b.Qb(4,"div",3),b.Mb(5,"dd-dynamic-field",4),b.Pb(),b.Qb(6,"div",5),b.Qb(7,"button",6),b.Xb("click",function(){return b.oc(n),b.mc(1).close("clear-label")}),b.Mb(8,"i",7),b.wc(9," Clear Label"),b.Pb(),b.Qb(10,"button",8),b.Xb("click",function(){return b.oc(n),b.mc(1).close(t.labelControl.value)}),b.wc(11," Save "),b.Pb(),b.Pb(),b.Pb(),b.Mb(12,"dd-selector-popup",9,10),b.Qb(14,"div",11),b.Qb(15,"div",12),b.Qb(16,"div",13),b.Qb(17,"h3"),b.wc(18,"Overview"),b.Pb(),b.Pb(),b.Pb(),b.Qb(19,"div",14),b.Xb("cdkDropListDropped",function(e){return t.entityDropped(e)}),b.vc(20,W,3,5,"div",15),b.Pb(),b.vc(21,ee,7,0,"div",16),b.vc(22,te,1,1,"dd-overview-toolbar",17),b.Pb()}2&e&&(b.Ab(5),b.ec("config",t.labelFieldConfig)("control",t.labelControl),b.Ab(5),b.ec("disabled",t.labelControl.invalid),b.Ab(2),b.ec("searchable",!0)("loadSelectItems",t.loadConcepts),b.Ab(8),b.ec("ngForOf",t.sortedEntities)("ngForTrackBy",t.trackEntityElement),b.Ab(1),b.ec("ngIf",0===t.sortedEntities.length),b.Ab(1),b.ec("ngIf",t.sortedEntities.length>0&&t.editable))},directives:[k.a,Q.a,P.a,f.d,u.j,u.k,f.a,f.c,G,J],styles:["[_nghost-%COMP%] > .container[_ngcontent-%COMP%]{height:100%}"]}),ne),data:{suggestable:!0}}],ce=((ie=function e(){r(this,e)}).\u0275mod=b.Jb({type:ie}),ie.\u0275inj=b.Ib({factory:function(e){return new(e||ie)},imports:[[l.f.forChild(oe)],l.f]}),ie),ae=o("wC5x"),se=((re=function e(){r(this,e)}).\u0275mod=b.Jb({type:re}),re.\u0275inj=b.Ib({factory:function(e){return new(e||re)},imports:[[u.b,ce,ae.a,C.s,C.k,f.e]]}),re)}}])}();